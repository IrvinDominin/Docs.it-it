---
uid: identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project
title: Aggiunta di form di ASP.NET Identity a un Web esistente o vuoto progetto | Documenti Microsoft
author: raquelsa
description: In questa esercitazione viene illustrato come aggiungere identità di ASP.NET (il nuovo sistema di appartenenze di ASP.NET) a un'applicazione ASP.NET. Quando si crea un nuovo Web Form o MVC...
ms.author: aspnetcontent
manager: wpickett
ms.date: 10/23/2013
ms.topic: article
ms.assetid: 1cbc0ed2-5bd6-4b62-8d34-4c193dcd8b25
ms.technology: ''
ms.prod: .net-framework
msc.legacyurl: /identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project
msc.type: authoredcontent
ms.openlocfilehash: 8961e596f0d6cc4810e2439be1ec2915bddb8c78
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/06/2018
ms.locfileid: "30874655"
---
<a name="adding-aspnet-identity-to-an-empty-or-existing-web-forms-project"></a><span data-ttu-id="e1bde-104">Aggiunta di ASP.NET Identity a un Web esistente o vuoto form progetto</span><span class="sxs-lookup"><span data-stu-id="e1bde-104">Adding ASP.NET Identity to an Empty or Existing Web Forms Project</span></span>
====================
<span data-ttu-id="e1bde-105">da [Raquel Soares De Almeida](https://github.com/raquelsa)</span><span class="sxs-lookup"><span data-stu-id="e1bde-105">by [Raquel Soares De Almeida](https://github.com/raquelsa)</span></span>

> <span data-ttu-id="e1bde-106">In questa esercitazione viene illustrato come aggiungere [ASP.NET Identity](introduction-to-aspnet-identity.md) (il nuovo sistema di appartenenze di ASP.NET) a un'applicazione ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="e1bde-106">This tutorial shows you how to add [ASP.NET Identity](introduction-to-aspnet-identity.md) (the new membership system for ASP.NET) to an ASP.NET application.</span></span>
> 
> <span data-ttu-id="e1bde-107">Quando si crea un nuovo progetto di Web Form o MVC in Visual Studio 2013 RTM con account individuali, Visual Studio verrà installare tutti i pacchetti necessari e aggiungere tutte le classi necessarie per l'utente.</span><span class="sxs-lookup"><span data-stu-id="e1bde-107">When you create a new Web Forms or MVC project in Visual Studio 2013 RTM with Individual Accounts, Visual Studio will install all the required packages and add all necessary classes for you.</span></span> <span data-ttu-id="e1bde-108">In questa esercitazione verrà illustrati i passaggi per aggiungere il supporto di ASP.NET Identity per il progetto di Web Form esistente o un nuovo progetto vuoto.</span><span class="sxs-lookup"><span data-stu-id="e1bde-108">This tutorial will illustrate the steps to add ASP.NET Identity support to your existing Web Forms project or a new empty project.</span></span> <span data-ttu-id="e1bde-109">Verranno descritti tutti i pacchetti di NuGet che è necessario installare e le classi, che è necessario aggiungere.</span><span class="sxs-lookup"><span data-stu-id="e1bde-109">I will outline all the NuGet packages you need to install, and classes you need to add.</span></span> <span data-ttu-id="e1bde-110">Esaminerà Web Form di esempio per la registrazione di nuovi utenti e la registrazione durante l'evidenziazione di tutte le API di punto di ingresso principale per l'autenticazione e gestione degli utenti.</span><span class="sxs-lookup"><span data-stu-id="e1bde-110">I will go over sample Web Forms for registering new users and logging in while highlighting all main entry point APIs for user management and authentication.</span></span> <span data-ttu-id="e1bde-111">In questo esempio utilizzerà l'implementazione predefinita di ASP.NET Identity per l'archiviazione di dati SQL che si basa su Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="e1bde-111">This sample will use the ASP.NET Identity default implementation for SQL data storage which is built on Entity Framework.</span></span> <span data-ttu-id="e1bde-112">Questa esercitazione si utilizzerà del database locale per il database SQL.</span><span class="sxs-lookup"><span data-stu-id="e1bde-112">This tutorial, we will use LocalDB for the SQL database.</span></span>
> 
> <span data-ttu-id="e1bde-113">In questa esercitazione è stato scritto dal Raquel Soares De Almeida e Rick Anderson ( [ @RickAndMSFT ](https://twitter.com/#!/RickAndMSFT) ).</span><span class="sxs-lookup"><span data-stu-id="e1bde-113">This tutorial was written by Raquel Soares De Almeida and Rick Anderson ( [@RickAndMSFT](https://twitter.com/#!/RickAndMSFT) ).</span></span>


## <a name="getting-started-aspnet-identity"></a><span data-ttu-id="e1bde-114">Introduzione a ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="e1bde-114">Getting Started ASP.NET Identity</span></span>

1. <span data-ttu-id="e1bde-115">Avviare l'installazione ed eseguendo [Visual Studio Express 2013 per Web](https://go.microsoft.com/fwlink/?LinkId=299058) o [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span><span class="sxs-lookup"><span data-stu-id="e1bde-115">Start by installing and running [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span></span>
2. <span data-ttu-id="e1bde-116">Fare clic su **nuovo progetto** dall'inizio pagina oppure è possibile utilizzare il menu e selezionare **File**e quindi **nuovo progetto**.</span><span class="sxs-lookup"><span data-stu-id="e1bde-116">Click **New Project** from the Start page, or you can use the menu and select **File**, and then **New Project**.</span></span>
3. <span data-ttu-id="e1bde-117">Selezionare **Visual c# i** n riquadro a sinistra, quindi **Web** e quindi selezionare **applicazione Web ASP.NET**.</span><span class="sxs-lookup"><span data-stu-id="e1bde-117">Select **Visual C# i** n the left pane, then **Web** and then select **ASP.NET Web Application**.</span></span> <span data-ttu-id="e1bde-118">Denominare il progetto "WebFormsIdentity" e quindi fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="e1bde-118">Name your project "WebFormsIdentity" and then click **OK**.</span></span>   
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image1.png)
4. <span data-ttu-id="e1bde-119">Nel **nuovo progetto ASP.NET** finestra di dialogo Seleziona il **vuoto** modello.</span><span class="sxs-lookup"><span data-stu-id="e1bde-119">In the **New ASP.NET Project** dialog, select the **Empty** template.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image2.png)  
  
   <span data-ttu-id="e1bde-120">Si noti il **Modifica autenticazione** pulsante è disabilitato e non viene fornito alcun supporto per l'autenticazione in questo modello.</span><span class="sxs-lookup"><span data-stu-id="e1bde-120">Notice the **Change Authentication** button is disabled and no authentication support is provided in this template.</span></span> <span data-ttu-id="e1bde-121">I modelli Web Form, MVC e Web API consentono di selezionare l'approccio di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="e1bde-121">The Web Forms, MVC and Web API templates allow you to select the authentication approach.</span></span> <span data-ttu-id="e1bde-122">Per ulteriori informazioni, vedere [panoramica dell'autenticazione](../../../visual-studio/overview/2013/creating-web-projects-in-visual-studio.md#auth) .</span><span class="sxs-lookup"><span data-stu-id="e1bde-122">For more information, see [Overview of Authentication](../../../visual-studio/overview/2013/creating-web-projects-in-visual-studio.md#auth) .</span></span>

## <a name="adding-identity-packages-to-your-app"></a><span data-ttu-id="e1bde-123">Aggiunta di pacchetti di identità applicazione in uso.</span><span class="sxs-lookup"><span data-stu-id="e1bde-123">Adding Identity Packages to your App</span></span>

<span data-ttu-id="e1bde-124">In Esplora risorse, mouse sul progetto e selezionare **Gestisci pacchetti NuGet**.</span><span class="sxs-lookup"><span data-stu-id="e1bde-124">In Solution Explorer, right-click your project and select **Manage NuGet Packages**.</span></span> <span data-ttu-id="e1bde-125">Nella finestra di dialogo di testo di ricerca, digitare "*Identity.E*".</span><span class="sxs-lookup"><span data-stu-id="e1bde-125">In the search text box dialog, type "*Identity.E*".</span></span> <span data-ttu-id="e1bde-126">Fare clic su Installa per questo pacchetto.</span><span class="sxs-lookup"><span data-stu-id="e1bde-126">Click install for this package.</span></span>   
  
![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image3.png)  
  
<span data-ttu-id="e1bde-127">Si noti che questo pacchetto installerà i pacchetti di dipendenza: EntityFramework e Microsoft ASP.NET Identity Core.</span><span class="sxs-lookup"><span data-stu-id="e1bde-127">Note that this package will install the dependency packages: EntityFramework and Microsoft ASP.NET Identity Core.</span></span>

## <a name="adding-web-forms-to-register-users"></a><span data-ttu-id="e1bde-128">Aggiunta di Web Form per registrare gli utenti</span><span class="sxs-lookup"><span data-stu-id="e1bde-128">Adding Web Forms to Register Users</span></span>

1. <span data-ttu-id="e1bde-129">In **Esplora**, mouse sul progetto e fare clic su **Aggiungi**e quindi **Web Form**.</span><span class="sxs-lookup"><span data-stu-id="e1bde-129">In **Solution Explorer**, right-click your project and click **Add**, and then **Web Form**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image4.png)
2. <span data-ttu-id="e1bde-130">Nel **specificare il nome per l'elemento** della finestra di dialogo Nome nuovo web form **registrare**, quindi fare clic su **OK**</span><span class="sxs-lookup"><span data-stu-id="e1bde-130">In the **Specify Name for Item** dialog box, name the new web form **Register**, and then click **OK**</span></span>
3. <span data-ttu-id="e1bde-131">Sostituire il markup generato *Register* file con il codice seguente.</span><span class="sxs-lookup"><span data-stu-id="e1bde-131">Replace the markup in the generated *Register.aspx* file with the code below.</span></span> <span data-ttu-id="e1bde-132">Le modifiche al codice sono evidenziate.</span><span class="sxs-lookup"><span data-stu-id="e1bde-132">The code changes are highlighted.</span></span>   

    [!code-aspx[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample1.aspx?highlight=9,12-40)]

    > [!NOTE]
    > <span data-ttu-id="e1bde-133">Questo è solo una versione semplificata di *Register* file creato quando si crea un nuovo progetto di Web Form ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="e1bde-133">This is just a simplified version of the *Register.aspx* file that is created when you create a new ASP.NET Web Forms project.</span></span> <span data-ttu-id="e1bde-134">Il codice precedente aggiunge i campi del form e un pulsante per registrare un nuovo utente.</span><span class="sxs-lookup"><span data-stu-id="e1bde-134">The markup above adds form fields and a button to register a new user.</span></span>
4. <span data-ttu-id="e1bde-135">Aprire il *Register.aspx.cs* file e sostituire il contenuto del file con il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="e1bde-135">Open the *Register.aspx.cs* file and replace the contents of the file with the following code:</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample2.cs)]

    > [!NOTE] 
    > 
    > 1. <span data-ttu-id="e1bde-136">Il codice precedente è una versione semplificata di *Register.aspx.cs* file creato quando si crea un nuovo progetto di Web Form ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="e1bde-136">The code above is a simplified version of the *Register.aspx.cs* file that is created when you create a new ASP.NET Web Forms project.</span></span>
    > 2. <span data-ttu-id="e1bde-137">Il *IdentityUser* classe è l'implementazione di EntityFramework predefinita del *IUser* interfaccia.</span><span class="sxs-lookup"><span data-stu-id="e1bde-137">The *IdentityUser* class is the default EntityFramework implementation of the *IUser* interface.</span></span> <span data-ttu-id="e1bde-138">*IUser* è l'interfaccia minima per un utente in ASP.NET Identity Core.</span><span class="sxs-lookup"><span data-stu-id="e1bde-138">*IUser* interface is the minimal interface for a user on ASP.NET Identity Core.</span></span>
    > 3. <span data-ttu-id="e1bde-139">Il *nello UserStore* classe è l'implementazione di EntityFramework predefinita di un archivio utente.</span><span class="sxs-lookup"><span data-stu-id="e1bde-139">The *UserStore* class is the default EntityFramework implementation of a user store.</span></span> <span data-ttu-id="e1bde-140">Questa classe implementa interfacce del ASP.NET Identity Core minimo: *IUserStore*, *IUserLoginStore*, *IUserClaimStore* e *IUserRoleStore* .</span><span class="sxs-lookup"><span data-stu-id="e1bde-140">This class implements the ASP.NET Identity Core's minimal interfaces: *IUserStore*, *IUserLoginStore*, *IUserClaimStore* and *IUserRoleStore*.</span></span>
    > 4. <span data-ttu-id="e1bde-141">Il *UserManager* API che salvano automaticamente le modifiche a correlate all'utente di classe espone il *nello UserStore*.</span><span class="sxs-lookup"><span data-stu-id="e1bde-141">The *UserManager* class exposes user related APIs which will automatically save changes to the *UserStore*.</span></span>
    > 5. <span data-ttu-id="e1bde-142">Il *IdentityResult* classe rappresenta il risultato di un'operazione di identità.</span><span class="sxs-lookup"><span data-stu-id="e1bde-142">The *IdentityResult* class represents the result of an identity operation.</span></span>
5. <span data-ttu-id="e1bde-143">In **Esplora**, mouse sul progetto e fare clic su **Aggiungi**, **Aggiungi cartella ASP.NET** e quindi **App\_dati**.</span><span class="sxs-lookup"><span data-stu-id="e1bde-143">In **Solution Explorer**, right-click your project and click **Add**, **Add ASP.NET Folder** and then **App\_Data**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image5.png)
6. <span data-ttu-id="e1bde-144">Aprire il *Web. config* file e aggiungere una stringa di connessione per il database verrà utilizzato per archiviare informazioni utente.</span><span class="sxs-lookup"><span data-stu-id="e1bde-144">Open the *Web.config* file and add a connection string entry for the database we will use to store user information.</span></span> <span data-ttu-id="e1bde-145">Il database verrà creato in fase di esecuzione da EntityFramework per le entità di identità.</span><span class="sxs-lookup"><span data-stu-id="e1bde-145">The database will be created at runtime by EntityFramework for the Identity entities.</span></span> <span data-ttu-id="e1bde-146">La stringa di connessione è simile a quello creato automaticamente quando si crea un nuovo progetto di Web Form.</span><span class="sxs-lookup"><span data-stu-id="e1bde-146">The connection string is similar to one created for you when you create a new Web Forms project.</span></span> <span data-ttu-id="e1bde-147">Il codice evidenziato di seguito viene illustrato il markup che è necessario aggiungere:</span><span class="sxs-lookup"><span data-stu-id="e1bde-147">The highlighted code shows the markup you should add:</span></span>

    [!code-xml[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample3.xml?highlight=11-14)]
    
    > [!NOTE] 
    > <span data-ttu-id="e1bde-148">Per Visual Studio 2015 o versione successiva, sostituire `(localdb)\v11.0` con `(localdb)\MSSQLLocalDB` nella stringa di connessione.</span><span class="sxs-lookup"><span data-stu-id="e1bde-148">For Visual Studio 2015 or higher, replace `(localdb)\v11.0` with `(localdb)\MSSQLLocalDB` in your connection string.</span></span>
    
7. <span data-ttu-id="e1bde-149">Fare clic con il pulsante destro file *Register* nel progetto e selezionare **imposta come pagina iniziale**.</span><span class="sxs-lookup"><span data-stu-id="e1bde-149">Right click file *Register.aspx* in your project and select **Set as Start Page**.</span></span> <span data-ttu-id="e1bde-150">Premere Ctrl + F5 per compilare ed eseguire l'applicazione web.</span><span class="sxs-lookup"><span data-stu-id="e1bde-150">Press Ctrl + F5 to build and run the web application.</span></span> <span data-ttu-id="e1bde-151">Immettere un nuovo nome utente e una password e quindi fare clic su **registrare**.</span><span class="sxs-lookup"><span data-stu-id="e1bde-151">Enter a new user name and password and then click on **Register**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image6.png)  

    > [!NOTE]
    > <span data-ttu-id="e1bde-152">ASP.NET Identity dispone del supporto per la convalida e in questo esempio è possibile verificare il comportamento predefinito e la Password utente validator provenienti dal pacchetto di base di identità.</span><span class="sxs-lookup"><span data-stu-id="e1bde-152">ASP.NET Identity has support for validation and in this sample you can verify the default behavior on User and Password validators that come from the Identity Core package.</span></span> <span data-ttu-id="e1bde-153">Il validator predefinito per l'utente (`UserValidator`) ha una proprietà `AllowOnlyAlphanumericUserNames` che ha il valore predefinito impostato su `true`.</span><span class="sxs-lookup"><span data-stu-id="e1bde-153">The default validator for User (`UserValidator`) has a property `AllowOnlyAlphanumericUserNames` that has default value set to `true`.</span></span> <span data-ttu-id="e1bde-154">Il validator predefinito per la Password (`MinimumLengthValidator`) garantisce che la password è di almeno 6 caratteri.</span><span class="sxs-lookup"><span data-stu-id="e1bde-154">The default validator for Password (`MinimumLengthValidator`) ensures that password has at least 6 characters.</span></span> <span data-ttu-id="e1bde-155">Queste convalide presenti proprietà `UserManager` che può essere sottoposto a override se si desidera che la convalida personalizzata,</span><span class="sxs-lookup"><span data-stu-id="e1bde-155">These validators are properties on `UserManager` that can be overridden if you want to have custom validation,</span></span>

## <a name="verifying-the-localdb-identity-database-and-tables-generated-by-entity-framework"></a><span data-ttu-id="e1bde-156">Verifica per determinare se il Database di identità del database locale e tabelle generate da Entity Framework</span><span class="sxs-lookup"><span data-stu-id="e1bde-156">Verifying the LocalDb Identity Database and Tables Generated by Entity Framework</span></span>

1. <span data-ttu-id="e1bde-157">Nel **vista** menu, fare clic su **Esplora Server**.</span><span class="sxs-lookup"><span data-stu-id="e1bde-157">In the **View** menu, click **Server Explorer**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image7.png)
2. <span data-ttu-id="e1bde-158">Espandere **DefaultConnection (WebFormsIdentity)**, espandere **tabelle**, fare clic destro **AspNetUsers** e fare clic su **Mostra dati tabella**.</span><span class="sxs-lookup"><span data-stu-id="e1bde-158">Expand **DefaultConnection (WebFormsIdentity)**, expand **Tables**, right click **AspNetUsers** and click **Show Table Data**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image8.png)  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image9.png)

## <a name="configuring-the-application-for-owin-authentication"></a><span data-ttu-id="e1bde-159">Configurazione dell'applicazione per l'autenticazione OWIN</span><span class="sxs-lookup"><span data-stu-id="e1bde-159">Configuring the application for OWIN authentication</span></span>

<span data-ttu-id="e1bde-160">A questo punto è stato aggiunto solo il supporto per la creazione di utenti.</span><span class="sxs-lookup"><span data-stu-id="e1bde-160">At this point we have only added support for creating users.</span></span> <span data-ttu-id="e1bde-161">A questo punto, verrà per illustrare come è possibile aggiungere l'autenticazione per accedere a un utente.</span><span class="sxs-lookup"><span data-stu-id="e1bde-161">Now, we are going to demonstrate how we can add authentication to login a user.</span></span> <span data-ttu-id="e1bde-162">Identità di ASP.NET utilizza middleware di autenticazione di Microsoft OWIN per l'autenticazione basata su form.</span><span class="sxs-lookup"><span data-stu-id="e1bde-162">ASP.NET Identity uses Microsoft OWIN Authentication middleware for forms authentication.</span></span> <span data-ttu-id="e1bde-163">L'autenticazione dei Cookie OWIN un cookie e attestazioni meccanismo di autenticazione in base che può essere utilizzato da qualsiasi framework ospitati in [OWIN](https://msdn.microsoft.com/magazine/dn451439.aspx) o IIS.</span><span class="sxs-lookup"><span data-stu-id="e1bde-163">The OWIN Cookie Authentication is a cookie and claims based authentication mechanism that can be used by any framework hosted on [OWIN](https://msdn.microsoft.com/magazine/dn451439.aspx) or IIS.</span></span> <span data-ttu-id="e1bde-164">Con questo modello, è possono utilizzare gli stessi pacchetti di autenticazione in più Framework, ad esempio ASP.NET MVC e Web Form.</span><span class="sxs-lookup"><span data-stu-id="e1bde-164">With this model, the same authentication packages can be used across multiple frameworks including ASP.NET MVC and Web Forms.</span></span> <span data-ttu-id="e1bde-165">Per ulteriori informazioni sul progetto Katana e come eseguire middleware in un host indipendente vedere [introduzione con il progetto Katana](https://msdn.microsoft.com/magazine/dn451439.aspx).</span><span class="sxs-lookup"><span data-stu-id="e1bde-165">For more information on project Katana and how to run middleware in a host agnostic see [Getting Started with the Katana Project](https://msdn.microsoft.com/magazine/dn451439.aspx).</span></span>

## <a name="installing-authentication-packages-to-your-application"></a><span data-ttu-id="e1bde-166">L'installazione di pacchetti di autenticazione all'applicazione</span><span class="sxs-lookup"><span data-stu-id="e1bde-166">Installing authentication packages to your application</span></span>

1. <span data-ttu-id="e1bde-167">In Esplora risorse, mouse sul progetto e selezionare **Gestisci pacchetti NuGet**.</span><span class="sxs-lookup"><span data-stu-id="e1bde-167">In Solution Explorer, right-click your project and select **Manage NuGet Packages**.</span></span> <span data-ttu-id="e1bde-168">Nella finestra di dialogo di testo di ricerca, digitare "*Identity.Owin*".</span><span class="sxs-lookup"><span data-stu-id="e1bde-168">In the search text box dialog, type "*Identity.Owin*".</span></span> <span data-ttu-id="e1bde-169">Fare clic su Installa per questo pacchetto.</span><span class="sxs-lookup"><span data-stu-id="e1bde-169">Click install for this package.</span></span>   
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image10.png)
2. <span data-ttu-id="e1bde-170">Cerca pacchetto ***systemweb*** e installarlo.</span><span class="sxs-lookup"><span data-stu-id="e1bde-170">Search for package ***Microsoft.Owin.Host.SystemWeb*** and install it.</span></span>   

    > [!NOTE]
    > <span data-ttu-id="e1bde-171">Il **italiano** pacchetto contiene un set di classi di estensione OWIN per gestire e configurare il middleware di autenticazione OWIN devono essere utilizzate dai pacchetti di ASP.NET Identity Core.</span><span class="sxs-lookup"><span data-stu-id="e1bde-171">The **Microsoft.Aspnet.Identity.Owin** package contains a set of OWIN extension classes to manage and configure OWIN authentication middleware to be consumed by ASP.NET Identity Core packages.</span></span>  
    > <span data-ttu-id="e1bde-172">Il **systemweb** pacchetto contiene un server OWIN che consente alle applicazioni basate su OWIN per l'esecuzione in IIS tramite la pipeline della richiesta ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="e1bde-172">The **Microsoft.Owin.Host.SystemWeb** package contains an OWIN server that enables OWIN-based applications to run on IIS using the ASP.NET request pipeline.</span></span> <span data-ttu-id="e1bde-173">Per ulteriori informazioni vedere [Middleware OWIN in IIS è integrata pipeline](../../../aspnet/overview/owin-and-katana/owin-middleware-in-the-iis-integrated-pipeline.md).</span><span class="sxs-lookup"><span data-stu-id="e1bde-173">For more information see [OWIN Middleware in the IIS integrated pipeline](../../../aspnet/overview/owin-and-katana/owin-middleware-in-the-iis-integrated-pipeline.md).</span></span>

## <a name="adding-owin-startup-and-authentication-configuration-classes"></a><span data-ttu-id="e1bde-174">Aggiunta di classi di configurazione di autenticazione e di avvio di OWIN</span><span class="sxs-lookup"><span data-stu-id="e1bde-174">Adding OWIN Startup and Authentication Configuration Classes</span></span>

1. <span data-ttu-id="e1bde-175">In **Esplora**mouse sul progetto, fare clic su **Aggiungi**e quindi **Aggiungi nuovo elemento**.</span><span class="sxs-lookup"><span data-stu-id="e1bde-175">In **Solution Explorer**, right-click your project, click **Add**, and then **Add New Item**.</span></span> <span data-ttu-id="e1bde-176">Nella finestra di dialogo di testo di ricerca, digitare "*owin*".</span><span class="sxs-lookup"><span data-stu-id="e1bde-176">In the search text box dialog, type "*owin*".</span></span> <span data-ttu-id="e1bde-177">Nome della classe "*avvio*" e fare clic su **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="e1bde-177">Name the class "*Startup*" and click **Add**.</span></span>   
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image11.png)
2. <span data-ttu-id="e1bde-178">Nel file Startup.cs, aggiungere il codice evidenziato mostrato di seguito per configurare l'autenticazione dei cookie OWIN.</span><span class="sxs-lookup"><span data-stu-id="e1bde-178">In the Startup.cs file, add the highlighted code shown below to configure OWIN cookie authentication.</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample4.cs?highlight=1,3,15-19)]

    > [!NOTE]
    > <span data-ttu-id="e1bde-179">Questa classe contiene il `OwinStartup` attributo per specificare la classe di avvio OWIN.</span><span class="sxs-lookup"><span data-stu-id="e1bde-179">This class contains the `OwinStartup` attribute for specifying the OWIN startup class.</span></span> <span data-ttu-id="e1bde-180">Ogni applicazione OWIN dispone di una classe di avvio in cui è necessario specificare i componenti per la pipeline dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="e1bde-180">Every OWIN application has a startup class where you specify components for the application pipeline.</span></span> <span data-ttu-id="e1bde-181">Vedere [OWIN avvio classe rilevamento](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) per ulteriori informazioni su questo modello.</span><span class="sxs-lookup"><span data-stu-id="e1bde-181">See [OWIN Startup Class Detection](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) for more info on this model.</span></span>

## <a name="adding-web-forms-for-registering-and-logging-in-users"></a><span data-ttu-id="e1bde-182">Aggiunta di Web Form per la registrazione e la connessione degli utenti</span><span class="sxs-lookup"><span data-stu-id="e1bde-182">Adding Web Forms for Registering and Logging in Users</span></span>

1. <span data-ttu-id="e1bde-183">Aprire il *Register.cs* file e aggiungere il codice seguente che avranno accesso all'utente quando la registrazione ha esito positivo.</span><span class="sxs-lookup"><span data-stu-id="e1bde-183">Open the *Register.cs* file and add the following code which will log in the user when registration succeeds.</span></span> <span data-ttu-id="e1bde-184">Le modifiche sono evidenziate.</span><span class="sxs-lookup"><span data-stu-id="e1bde-184">The changes are highlighted below.</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample5.cs)]

    > [!NOTE] 
    > 
    > - <span data-ttu-id="e1bde-185">Poiché ASP.NET Identity e autenticazione dei Cookie OWIN sistema basata sulle attestazioni, il framework richiede allo sviluppatore di app generare un [ClaimsIdentity](https://msdn.microsoft.com/library/microsoft.identitymodel.claims.claimsidentity.aspx) per l'utente.</span><span class="sxs-lookup"><span data-stu-id="e1bde-185">Since ASP.NET Identity and OWIN Cookie Authentication are claims based system, the framework requires the app developer to generate a [ClaimsIdentity](https://msdn.microsoft.com/library/microsoft.identitymodel.claims.claimsidentity.aspx) for the user.</span></span> <span data-ttu-id="e1bde-186">ClaimsIdentity dispone di informazioni su tutte le attestazioni per l'utente, ad esempio i ruoli a cui appartiene l'utente.</span><span class="sxs-lookup"><span data-stu-id="e1bde-186">ClaimsIdentity has information about all the claims for the user such as what Roles the user belongs to.</span></span> <span data-ttu-id="e1bde-187">È anche possibile aggiungere ulteriori attestazioni per l'utente in questa fase.</span><span class="sxs-lookup"><span data-stu-id="e1bde-187">You can also add more claims for the user at this stage.</span></span>
    > - <span data-ttu-id="e1bde-188">Può accedere l'utente usando AuthenticationManager da OWIN e chiamare il metodo `SignIn` e passando l'oggetto ClaimsIdentity come illustrato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="e1bde-188">You can sign in the user by using the AuthenticationManager from OWIN and calling `SignIn` and passing in the ClaimsIdentity as shown above.</span></span> <span data-ttu-id="e1bde-189">Questo codice verrà accesso dell'utente e generare anche un cookie.</span><span class="sxs-lookup"><span data-stu-id="e1bde-189">This code will sign in the user and generate a cookie as well.</span></span> <span data-ttu-id="e1bde-190">Questa chiamata è analoga a [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) utilizzato il [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) modulo.</span><span class="sxs-lookup"><span data-stu-id="e1bde-190">This call is analogous to [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
2. <span data-ttu-id="e1bde-191">In **Esplora**, fare clic il progetto **Aggiungi**e quindi **Web Form**.</span><span class="sxs-lookup"><span data-stu-id="e1bde-191">In **Solution Explorer**, right-click your project click **Add**, and then **Web Form**.</span></span> <span data-ttu-id="e1bde-192">Nome del web form **accesso**.</span><span class="sxs-lookup"><span data-stu-id="e1bde-192">Name the web form **Login**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image12.png)
3. <span data-ttu-id="e1bde-193">Sostituire il contenuto del *Login.aspx* file con il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="e1bde-193">Replace the contents of the *Login.aspx* file with the following code:</span></span>  

    [!code-aspx[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample6.aspx)]
4. <span data-ttu-id="e1bde-194">Sostituire il contenuto del *Login.aspx.cs* file con le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="e1bde-194">Replace the contents of the *Login.aspx.cs* file with the following:</span></span>  

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample7.cs)]

    > [!NOTE] 
    > 
    > - <span data-ttu-id="e1bde-195">Il `Page_Load` ora controlla lo stato dell'utente corrente e accetta azione in base alle relative `Context.User.Identity.IsAuthenticated` stato.</span><span class="sxs-lookup"><span data-stu-id="e1bde-195">The `Page_Load` now checks for the status of current user and takes action based on its `Context.User.Identity.IsAuthenticated` status.</span></span>  
    >     <span data-ttu-id="e1bde-196">**Visualizzare connesso in nome utente** : Microsoft ASP.NET Identity Framework ha aggiunto i metodi di estensione nel [IIdentity](https://msdn.microsoft.com/library/system.security.principal.iidentity.aspx) che consente di ottenere il `UserName` e `UserId` per il Utente connesso.</span><span class="sxs-lookup"><span data-stu-id="e1bde-196">**Display Logged in User Name** : The Microsoft ASP.NET Identity Framework has added extension methods on [System.Security.Principal.IIdentity](https://msdn.microsoft.com/library/system.security.principal.iidentity.aspx) that allows you to get the `UserName` and `UserId`  for the logged in User.</span></span> <span data-ttu-id="e1bde-197">Questi metodi di estensione sono definiti nel `Microsoft.AspNet.Identity.Core` assembly.</span><span class="sxs-lookup"><span data-stu-id="e1bde-197">These extension methods are defined in the `Microsoft.AspNet.Identity.Core` assembly.</span></span> <span data-ttu-id="e1bde-198">Questi metodi di estensione sono la sostituzione di [HttpContext.User.Identity.Name](https://msdn.microsoft.com/library/system.web.httpcontext.user.aspx) .</span><span class="sxs-lookup"><span data-stu-id="e1bde-198">These extension methods are the replacement for [HttpContext.User.Identity.Name](https://msdn.microsoft.com/library/system.web.httpcontext.user.aspx) .</span></span>
    > - <span data-ttu-id="e1bde-199">Metodo di accesso:</span><span class="sxs-lookup"><span data-stu-id="e1bde-199">SignIn method:</span></span>   
    >     <span data-ttu-id="e1bde-200">`This` metodo sostituisce la precedente `CreateUser_Click` metodo in questo esempio e l'ora consente l'accesso l'utente dopo la creazione di utente.</span><span class="sxs-lookup"><span data-stu-id="e1bde-200">`This` method replaces the previous `CreateUser_Click` method in this sample and now signs in the user after successfully creating the user.</span></span>   
    >  <span data-ttu-id="e1bde-201">Il Framework di Microsoft OWIN ha aggiunto i metodi di estensione in `System.Web.HttpContext` che consente di ottenere un riferimento a un `IOwinContext`.</span><span class="sxs-lookup"><span data-stu-id="e1bde-201">The Microsoft OWIN Framework has added extension methods on `System.Web.HttpContext` that allows you to get a reference to an `IOwinContext`.</span></span> <span data-ttu-id="e1bde-202">Questi metodi di estensione sono definiti `Microsoft.Owin.Host.SystemWeb` assembly.</span><span class="sxs-lookup"><span data-stu-id="e1bde-202">These extension methods are defined in `Microsoft.Owin.Host.SystemWeb` assembly.</span></span> <span data-ttu-id="e1bde-203">Il `OwinContext` classe espone un `IAuthenticationManager` proprietà che rappresenta la funzionalità middleware di autenticazione disponibile sulla richiesta corrente.</span><span class="sxs-lookup"><span data-stu-id="e1bde-203">The `OwinContext` class exposes an `IAuthenticationManager` property that represents the Authentication middleware functionality available on the current request.</span></span>  
    >  <span data-ttu-id="e1bde-204">Può accedere l'utente usando il `AuthenticationManager` da OWIN e chiamare il metodo `SignIn` e passando il `ClaimsIdentity` come illustrato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="e1bde-204">You can sign in the user by using the `AuthenticationManager` from OWIN and calling `SignIn`  and passing in the `ClaimsIdentity`  as shown above.</span></span>   
    >  <span data-ttu-id="e1bde-205">Poiché ASP.NET Identity e autenticazione dei Cookie OWIN sono sistema basata sulle attestazioni, il framework richiede che l'app per generare un `ClaimsIdentity` per l'utente.</span><span class="sxs-lookup"><span data-stu-id="e1bde-205">Because ASP.NET Identity and OWIN Cookie Authentication are claims-based system, the framework requires the app to generate a `ClaimsIdentity` for the user.</span></span>   
    >  <span data-ttu-id="e1bde-206">Il `ClaimsIdentity` dispone di informazioni su tutte le attestazioni per l'utente, ad esempio i ruoli a cui appartiene l'utente.</span><span class="sxs-lookup"><span data-stu-id="e1bde-206">The `ClaimsIdentity` has information about all the claims for the user, such as what roles the user belongs to.</span></span> <span data-ttu-id="e1bde-207">È inoltre possibile aggiungere ulteriori attestazioni per l'utente in questa fase</span><span class="sxs-lookup"><span data-stu-id="e1bde-207">You can also add more claims for the user at this stage</span></span>  
    >  <span data-ttu-id="e1bde-208">Questo codice verrà accesso dell'utente e generare anche un cookie.</span><span class="sxs-lookup"><span data-stu-id="e1bde-208">This code will sign in the user and generate a cookie as well.</span></span> <span data-ttu-id="e1bde-209">Questa chiamata è analoga a [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) utilizzato il [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) modulo.</span><span class="sxs-lookup"><span data-stu-id="e1bde-209">This call is analogous to [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
    > - <span data-ttu-id="e1bde-210">`SignOut` metodo:</span><span class="sxs-lookup"><span data-stu-id="e1bde-210">`SignOut` method:</span></span>   
    >  <span data-ttu-id="e1bde-211">Ottiene un riferimento di `AuthenticationManager` da OWIN e chiama `SignOut`.</span><span class="sxs-lookup"><span data-stu-id="e1bde-211">Gets a reference to the `AuthenticationManager` from OWIN and calls `SignOut`.</span></span> <span data-ttu-id="e1bde-212">Questo comportamento è analogo a [FormsAuthentication. SignOut](https://msdn.microsoft.com/library/system.web.security.formsauthentication.signout.aspx) utilizzato dal metodo di [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) modulo.</span><span class="sxs-lookup"><span data-stu-id="e1bde-212">This is analogous to [FormsAuthentication.SignOut](https://msdn.microsoft.com/library/system.web.security.formsauthentication.signout.aspx) method used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
5. <span data-ttu-id="e1bde-213">Premere **Ctrl + F5** per compilare ed eseguire l'applicazione web.</span><span class="sxs-lookup"><span data-stu-id="e1bde-213">Press **Ctrl + F5** to build and run the web application.</span></span> <span data-ttu-id="e1bde-214">Immettere un nuovo nome utente e una password e quindi fare clic su **registrare**.</span><span class="sxs-lookup"><span data-stu-id="e1bde-214">Enter a new user name and password and then click on **Register**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image13.png)  
   <span data-ttu-id="e1bde-215">Nota: A questo punto, il nuovo utente viene creato e registrato.</span><span class="sxs-lookup"><span data-stu-id="e1bde-215">Note: At this point, the new user is created and logged in.</span></span>
6. <span data-ttu-id="e1bde-216">Fare clic su **disconnettersi** pulsante. Si verrà reindirizzati per il Log nel modulo.</span><span class="sxs-lookup"><span data-stu-id="e1bde-216">Click on **Log out** button.You will be redirected to the Log in form.</span></span>
7. <span data-ttu-id="e1bde-217">Immettere un nome utente non valido o password e fare clic **Accedi** pulsante.</span><span class="sxs-lookup"><span data-stu-id="e1bde-217">Enter an invalid user name or password and Click on **Log in** button.</span></span>   
   <span data-ttu-id="e1bde-218">Il `UserManager.Find` metodo restituirà null e il messaggio di errore: " *nome utente non valido o password* " verranno visualizzati.</span><span class="sxs-lookup"><span data-stu-id="e1bde-218">The `UserManager.Find`  method will return null and the error message: " *Invalid user name or password* " will be displayed.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image14.png)
