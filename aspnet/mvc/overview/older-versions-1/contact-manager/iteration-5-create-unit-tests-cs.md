---
uid: mvc/overview/older-versions-1/contact-manager/iteration-5-create-unit-tests-cs
title: 'Iterazione #5: creazione di unit test (c#) | Documenti Microsoft'
author: microsoft
description: Nella quinta iterazione, si rende l'applicazione di più facile da gestire e modificare tramite l'aggiunta di unit test. È simulare il nostro classi del modello di dati e generare unit test per o...
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/20/2009
ms.topic: article
ms.assetid: 28ad8f80-b8a5-444e-b478-8b15a846060c
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-5-create-unit-tests-cs
msc.type: authoredcontent
ms.openlocfilehash: 7a61b5791a40088df9d27f7b1bd37df1831ef22b
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/06/2018
---
<a name="iteration-5--create-unit-tests-c"></a><span data-ttu-id="dda24-104">Iterazione #5: creare unit test (c#)</span><span class="sxs-lookup"><span data-stu-id="dda24-104">Iteration #5 – Create unit tests (C#)</span></span>
====================
<span data-ttu-id="dda24-105">by [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="dda24-105">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="dda24-106">Scaricare il codice</span><span class="sxs-lookup"><span data-stu-id="dda24-106">Download Code</span></span>](iteration-5-create-unit-tests-cs/_static/contactmanager_5_cs1.zip)

> <span data-ttu-id="dda24-107">Nella quinta iterazione, si rende l'applicazione di più facile da gestire e modificare tramite l'aggiunta di unit test.</span><span class="sxs-lookup"><span data-stu-id="dda24-107">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="dda24-108">È simulare il nostro classi del modello di dati e generare unit test per i controller e logica di convalida.</span><span class="sxs-lookup"><span data-stu-id="dda24-108">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>


## <a name="building-a-contact-management-aspnet-mvc-application-c"></a><span data-ttu-id="dda24-109">Creazione di un'applicazione ASP.NET MVC di gestione dei contatti (c#)</span><span class="sxs-lookup"><span data-stu-id="dda24-109">Building a Contact Management ASP.NET MVC Application (C#)</span></span>

<span data-ttu-id="dda24-110">In questa serie di esercitazioni, si compila un'intera applicazione di gestione dei contatti dall'inizio completamento.</span><span class="sxs-lookup"><span data-stu-id="dda24-110">In this series of tutorials, we build an entire Contact Management application from start to finish.</span></span> <span data-ttu-id="dda24-111">L'applicazione Contact Manager consente di archiviare le informazioni di contatto - nomi, i numeri di telefono e indirizzi di posta elettronica: per un elenco di persone.</span><span class="sxs-lookup"><span data-stu-id="dda24-111">The Contact Manager application enables you to store contact information - names, phone numbers and email addresses - for a list of people.</span></span>

<span data-ttu-id="dda24-112">È compilare l'applicazione più iterazioni.</span><span class="sxs-lookup"><span data-stu-id="dda24-112">We build the application over multiple iterations.</span></span> <span data-ttu-id="dda24-113">A ogni iterazione, gradualmente è migliorare l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="dda24-113">With each iteration, we gradually improve the application.</span></span> <span data-ttu-id="dda24-114">L'obiettivo di questo approccio iterazione più è che consentono di comprendere il motivo per ogni modifica.</span><span class="sxs-lookup"><span data-stu-id="dda24-114">The goal of this multiple iteration approach is to enable you to understand the reason for each change.</span></span>

- <span data-ttu-id="dda24-115">Iterazione #1 - creare l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="dda24-115">Iteration #1 - Create the application.</span></span> <span data-ttu-id="dda24-116">Nella prima iterazione, verranno create Contact Manager in modo più semplice possibile.</span><span class="sxs-lookup"><span data-stu-id="dda24-116">In the first iteration, we create the Contact Manager in the simplest way possible.</span></span> <span data-ttu-id="dda24-117">Viene aggiunto il supporto per le operazioni di database basic: creazione, lettura, aggiornamento ed eliminazione (CRUD).</span><span class="sxs-lookup"><span data-stu-id="dda24-117">We add support for basic database operations: Create, Read, Update, and Delete (CRUD).</span></span>

- <span data-ttu-id="dda24-118">Iterazione #2 - verificare l'applicazione l'aspetto.</span><span class="sxs-lookup"><span data-stu-id="dda24-118">Iteration #2 - Make the application look nice.</span></span> <span data-ttu-id="dda24-119">In questa iterazione, è migliorare l'aspetto dell'applicazione modificando il valore predefinito di pagina master di visualizzazione ASP.NET MVC e foglio di stile CSS.</span><span class="sxs-lookup"><span data-stu-id="dda24-119">In this iteration, we improve the appearance of the application by modifying the default ASP.NET MVC view master page and cascading style sheet.</span></span>

- <span data-ttu-id="dda24-120">Iterazione #3 - aggiungere la convalida dei form.</span><span class="sxs-lookup"><span data-stu-id="dda24-120">Iteration #3 - Add form validation.</span></span> <span data-ttu-id="dda24-121">Nella terza iterazione, è aggiungere la convalida di form di base.</span><span class="sxs-lookup"><span data-stu-id="dda24-121">In the third iteration, we add basic form validation.</span></span> <span data-ttu-id="dda24-122">È impedire agli utenti di inviare un modulo senza completare i campi modulo necessari.</span><span class="sxs-lookup"><span data-stu-id="dda24-122">We prevent people from submitting a form without completing required form fields.</span></span> <span data-ttu-id="dda24-123">È inoltre possibile convalidare gli indirizzi di posta elettronica e numeri di telefono.</span><span class="sxs-lookup"><span data-stu-id="dda24-123">We also validate email addresses and phone numbers.</span></span>

- <span data-ttu-id="dda24-124">Iterazione #4: verificare l'applicazione ad accoppiamento debole.</span><span class="sxs-lookup"><span data-stu-id="dda24-124">Iteration #4 - Make the application loosely coupled.</span></span> <span data-ttu-id="dda24-125">In questa terza iterazione, possiamo usufruire dei diversi modelli di progettazione di software per renderne più semplice gestire e modificare l'applicazione Gestione contatti.</span><span class="sxs-lookup"><span data-stu-id="dda24-125">In this third iteration, we take advantage of several software design patterns to make it easier to maintain and modify the Contact Manager application.</span></span> <span data-ttu-id="dda24-126">Ad esempio, si effettua il refactoring l'applicazione di utilizzare il modello di Repository e il modello di inserimento di dipendenze.</span><span class="sxs-lookup"><span data-stu-id="dda24-126">For example, we refactor our application to use the Repository pattern and the Dependency Injection pattern.</span></span>

- <span data-ttu-id="dda24-127">Iterazione #5 - creare unit test.</span><span class="sxs-lookup"><span data-stu-id="dda24-127">Iteration #5 - Create unit tests.</span></span> <span data-ttu-id="dda24-128">Nella quinta iterazione, si rende l'applicazione di più facile da gestire e modificare tramite l'aggiunta di unit test.</span><span class="sxs-lookup"><span data-stu-id="dda24-128">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="dda24-129">È simulare il nostro classi del modello di dati e generare unit test per i controller e logica di convalida.</span><span class="sxs-lookup"><span data-stu-id="dda24-129">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

- <span data-ttu-id="dda24-130">Iterazione 6 # - utilizzare sviluppo basato su test.</span><span class="sxs-lookup"><span data-stu-id="dda24-130">Iteration #6 - Use test-driven development.</span></span> <span data-ttu-id="dda24-131">In questa iterazione sesto è aggiungere nuove funzionalità per l'applicazione scrivendo unit test prima e la scrittura di codice per gli unit test.</span><span class="sxs-lookup"><span data-stu-id="dda24-131">In this sixth iteration, we add new functionality to our application by writing unit tests first and writing code against the unit tests.</span></span> <span data-ttu-id="dda24-132">In questa iterazione, è aggiungere gruppi di contatti.</span><span class="sxs-lookup"><span data-stu-id="dda24-132">In this iteration, we add contact groups.</span></span>

- <span data-ttu-id="dda24-133">Iterazione #7 - aggiunta di funzionalità Ajax.</span><span class="sxs-lookup"><span data-stu-id="dda24-133">Iteration #7 - Add Ajax functionality.</span></span> <span data-ttu-id="dda24-134">Nella settima iterazione, è migliorare la velocità di risposta e prestazioni dell'applicazione aggiunta del supporto per Ajax.</span><span class="sxs-lookup"><span data-stu-id="dda24-134">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>


## <a name="this-iteration"></a><span data-ttu-id="dda24-135">Questa iterazione</span><span class="sxs-lookup"><span data-stu-id="dda24-135">This Iteration</span></span>

<span data-ttu-id="dda24-136">Nell'iterazione precedente dell'applicazione Gestione contatti, abbiamo suddiviso all'applicazione di essere più strettamente collegati.</span><span class="sxs-lookup"><span data-stu-id="dda24-136">In the previous iteration of the Contact Manager application, we refactored the application to be more loosely coupled.</span></span> <span data-ttu-id="dda24-137">L'applicazione in controller distinti, servizio e livelli di repository, abbiamo separato.</span><span class="sxs-lookup"><span data-stu-id="dda24-137">We separated the application into distinct controller, service, and repository layers.</span></span> <span data-ttu-id="dda24-138">Ogni livello interagisce con il livello sottostante tramite le interfacce.</span><span class="sxs-lookup"><span data-stu-id="dda24-138">Each layer interacts with the layer beneath it through interfaces.</span></span>

<span data-ttu-id="dda24-139">Abbiamo suddiviso l'applicazione per rendere più facile da gestire e modificare l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="dda24-139">We refactored the application to make the application easier to maintain and modify.</span></span> <span data-ttu-id="dda24-140">Ad esempio, se è necessario utilizzare una nuova tecnologia di accesso ai dati, è possibile modificare semplicemente il livello di repository senza toccare il controller o il livello di servizio.</span><span class="sxs-lookup"><span data-stu-id="dda24-140">For example, if we need to use a new data access technology, we can simply change the repository layer without touching the controller or service layer.</span></span> <span data-ttu-id="dda24-141">Rendendo il responsabile del contatto ad accoppiamento debole, abbiamo ve apportate più flessibile per modificare l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="dda24-141">By making the Contact Manager loosely coupled, we ve made the application more resilient to change.</span></span>

<span data-ttu-id="dda24-142">Ma cosa accade quando è necessario aggiungere una nuova funzionalità per l'applicazione Gestione contatti?</span><span class="sxs-lookup"><span data-stu-id="dda24-142">But, what happens when we need to add a new feature to the Contact Manager application?</span></span> <span data-ttu-id="dda24-143">In alternativa, cosa accade quando è possibile risolvere un bug?</span><span class="sxs-lookup"><span data-stu-id="dda24-143">Or, what happens when we fix a bug?</span></span> <span data-ttu-id="dda24-144">Un verità sad, ma anche si basa sulla collaudata, della scrittura del codice è che ogni volta che si tocca codice creato il rischio di introdurre nuovi bug.</span><span class="sxs-lookup"><span data-stu-id="dda24-144">A sad, but well proven, truth of writing code is that whenever you touch code you create the risk of introducing new bugs.</span></span>

<span data-ttu-id="dda24-145">Ad esempio, un giorno di fine, il manager potrebbe essere richiesta per aggiungere una nuova funzionalità per la gestione del contatto.</span><span class="sxs-lookup"><span data-stu-id="dda24-145">For example, one fine day, your manager might ask you to add a new feature to the Contact Manager.</span></span> <span data-ttu-id="dda24-146">È possibile aggiungere il supporto per i gruppi di contatto desiderate.</span><span class="sxs-lookup"><span data-stu-id="dda24-146">She wants you to add support for Contact Groups.</span></span> <span data-ttu-id="dda24-147">Si desidera, è possibile consentire agli utenti di organizzare i contatti in gruppi, ad esempio amici, Business e così via.</span><span class="sxs-lookup"><span data-stu-id="dda24-147">She wants you to enable users to organize their contacts into groups such as Friends, Business, and so on.</span></span>

<span data-ttu-id="dda24-148">Per implementare questa nuova funzionalità, è necessario modificare tutti i tre livelli dell'applicazione Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="dda24-148">In order to implement this new feature, you'll need to modify all three layers of the Contact Manager application.</span></span> <span data-ttu-id="dda24-149">È necessario aggiungere nuove funzionalità per i controller, il livello di servizio e del repository.</span><span class="sxs-lookup"><span data-stu-id="dda24-149">You'll need to add new functionality to the controllers, the service layer, and the repository.</span></span> <span data-ttu-id="dda24-150">Non appena si inizia la modifica del codice, si rischia di funzionalità che funzionavano prima di rilievo.</span><span class="sxs-lookup"><span data-stu-id="dda24-150">As soon as you start modifying code, you risk breaking functionality that worked before.</span></span>

<span data-ttu-id="dda24-151">Refactoring l'applicazione in livelli distinti, come è stato fatto nell'iterazione precedente, è un vantaggio.</span><span class="sxs-lookup"><span data-stu-id="dda24-151">Refactoring our application into separate layers, as we did in the previous iteration, was a good thing.</span></span> <span data-ttu-id="dda24-152">È un vantaggio poiché consente di apportare modifiche ai livelli intera senza toccare il resto dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="dda24-152">It was a good thing because it enables us to make changes to entire layers without touching the rest of the application.</span></span> <span data-ttu-id="dda24-153">Tuttavia, se si desidera rendere più facile da gestire e modificare il codice all'interno di un livello, è necessario creare unit test per il codice.</span><span class="sxs-lookup"><span data-stu-id="dda24-153">However, if you want to make the code within a layer easier to maintain and modify, you need to create unit tests for the code.</span></span>

<span data-ttu-id="dda24-154">Utilizzare una unit test a test una singola unità di codice.</span><span class="sxs-lookup"><span data-stu-id="dda24-154">You use a unit test to test an individual unit of code.</span></span> <span data-ttu-id="dda24-155">Queste unità di codice sono inferiori a livelli dell'intera applicazione.</span><span class="sxs-lookup"><span data-stu-id="dda24-155">These units of code are smaller than entire application layers.</span></span> <span data-ttu-id="dda24-156">In genere, si utilizza uno unit test per verificare se un particolare metodo nel codice si comporta nel modo previsto.</span><span class="sxs-lookup"><span data-stu-id="dda24-156">Typically, you use a unit test to verify whether a particular method in your code behaves in the way that you expect.</span></span> <span data-ttu-id="dda24-157">Ad esempio, si creerà uno unit test per il metodo CreateContact() esposto dalla classe ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="dda24-157">For example, you would create a unit test for the CreateContact() method exposed by the ContactManagerService class.</span></span>

<span data-ttu-id="dda24-158">Gli unit test per un lavoro dell'applicazione solo come rete di protezione.</span><span class="sxs-lookup"><span data-stu-id="dda24-158">The unit tests for an application work just like a safety net.</span></span> <span data-ttu-id="dda24-159">Quando si modifica il codice in un'applicazione, è possibile eseguire un set di unit test per verificare se la modifica si interrompe la funzionalità esistente.</span><span class="sxs-lookup"><span data-stu-id="dda24-159">Whenever you modify code in an application, you can run a set of unit tests to check whether the modification breaks existing functionality.</span></span> <span data-ttu-id="dda24-160">Unit test rendere sicuro modificare il codice.</span><span class="sxs-lookup"><span data-stu-id="dda24-160">Unit tests make your code safe to modify.</span></span> <span data-ttu-id="dda24-161">Unit test creare tutto il codice dell'applicazione più flessibile per modificare.</span><span class="sxs-lookup"><span data-stu-id="dda24-161">Unit tests make all of the code in your application more resilient to change.</span></span>

<span data-ttu-id="dda24-162">In questa iterazione, è aggiungere unit test per l'applicazione di gestione di contatto.</span><span class="sxs-lookup"><span data-stu-id="dda24-162">In this iteration, we add unit tests to our Contact Manager application.</span></span> <span data-ttu-id="dda24-163">In questo modo, nell'iterazione successiva, è possibile aggiungere gruppi di contatto per l'applicazione senza doversi preoccupare di compromettere le funzionalità esistenti.</span><span class="sxs-lookup"><span data-stu-id="dda24-163">That way, in the next iteration, we can add Contact Groups to our application without worrying about breaking existing functionality.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="dda24-164">Sono disponibili un'ampia gamma di unit test Framework, ad esempio NUnit xUnit.net e MbUnit.</span><span class="sxs-lookup"><span data-stu-id="dda24-164">There are a variety of unit testing frameworks including NUnit, xUnit.net, and MbUnit.</span></span> <span data-ttu-id="dda24-165">In questa esercitazione, si usa il framework unit test inclusi in Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="dda24-165">In this tutorial, we use the unit testing framework included with Visual Studio.</span></span> <span data-ttu-id="dda24-166">Tuttavia, è possibile leggerlo altrettanto facilmente utilizzare uno di questi Framework alternativi.</span><span class="sxs-lookup"><span data-stu-id="dda24-166">However, you could just as easily use one of these alternative frameworks.</span></span>


## <a name="what-gets-tested"></a><span data-ttu-id="dda24-167">Ciò che verrà sottoposta a test</span><span class="sxs-lookup"><span data-stu-id="dda24-167">What Gets Tested</span></span>

<span data-ttu-id="dda24-168">Nel mondo ideale, tutto il codice rientrerebbero unit test.</span><span class="sxs-lookup"><span data-stu-id="dda24-168">In the perfect world, all of your code would be covered by unit tests.</span></span> <span data-ttu-id="dda24-169">Nel mondo ideale, sarebbe necessario perfetta rete di protezione.</span><span class="sxs-lookup"><span data-stu-id="dda24-169">In the perfect world, you would have the perfect safety net.</span></span> <span data-ttu-id="dda24-170">È possibile modificare qualsiasi riga di codice nell'applicazione e sapere immediatamente, tramite l'esecuzione di unit test, se la modifica ha superato le funzionalità esistenti.</span><span class="sxs-lookup"><span data-stu-id="dda24-170">You would be able to modify any line of code in your application and know instantly, by executing your unit tests, whether the change broke existing functionality.</span></span>

<span data-ttu-id="dda24-171">Tuttavia, non abbiamo t in tempo reale in una situazione ideale.</span><span class="sxs-lookup"><span data-stu-id="dda24-171">However, we don t live in a perfect world.</span></span> <span data-ttu-id="dda24-172">In pratica, durante la scrittura di unit test, è concentrarsi sulla scrittura di test per la logica di business (ad esempio, la logica di convalida).</span><span class="sxs-lookup"><span data-stu-id="dda24-172">In practice, when writing unit tests, you concentrate on writing tests for your business logic (for example, validation logic).</span></span> <span data-ttu-id="dda24-173">In particolare, si *non* scrivere unit test per i dati di accesso logica o la logica di visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="dda24-173">In particular, you *do not* write unit tests for your data access logic or your view logic.</span></span>

<span data-ttu-id="dda24-174">Per essere utile, è necessario eseguire gli unit test molto rapidamente.</span><span class="sxs-lookup"><span data-stu-id="dda24-174">To be useful, unit tests must execute very quickly.</span></span> <span data-ttu-id="dda24-175">È facilmente possibile accumulare centinaia o migliaia di unit test per un'applicazione.</span><span class="sxs-lookup"><span data-stu-id="dda24-175">You easily can accumulate hundreds (or even thousands) of unit tests for an application.</span></span> <span data-ttu-id="dda24-176">Se gli unit test richiedere molto tempo per l'esecuzione, quindi permette di evitare di eseguirle.</span><span class="sxs-lookup"><span data-stu-id="dda24-176">If the unit tests take a long time to run then you'll avoid executing them.</span></span> <span data-ttu-id="dda24-177">In altre parole, tempo di esecuzione di unit test sono inutilizzabili per la codifica di un giorno a altro scopo.</span><span class="sxs-lookup"><span data-stu-id="dda24-177">In other words, long running unit tests are useless for day to day coding purposes.</span></span>

<span data-ttu-id="dda24-178">Per questo motivo, è in genere non scrivere unit test per codice che interagisce con un database.</span><span class="sxs-lookup"><span data-stu-id="dda24-178">For this reason, you typically do not write unit tests for code that interacts with a database.</span></span> <span data-ttu-id="dda24-179">Che eseguono centinaia di unit test su un database in tempo reale sarebbe troppo lento.</span><span class="sxs-lookup"><span data-stu-id="dda24-179">Running hundreds of unit tests against a live database would be too slow.</span></span> <span data-ttu-id="dda24-180">Al contrario, simulare il database e scrivere codice che interagisce con il database fittizio (approfondiremo tali un database sotto).</span><span class="sxs-lookup"><span data-stu-id="dda24-180">Instead, you mock your database and write code that interacts with the mock database (we discuss mocking a database below).</span></span>

<span data-ttu-id="dda24-181">Per un motivo simile, è in genere non scrivere unit test per le viste.</span><span class="sxs-lookup"><span data-stu-id="dda24-181">For a similar reason, you typically do not write unit tests for views.</span></span> <span data-ttu-id="dda24-182">Per testare una vista, è necessario attivare un server web.</span><span class="sxs-lookup"><span data-stu-id="dda24-182">In order to test a view, you must spin up a web server.</span></span> <span data-ttu-id="dda24-183">Poiché la rotazione di un server web è un processo relativamente lento, non è consigliabile creare unit test per le visualizzazioni.</span><span class="sxs-lookup"><span data-stu-id="dda24-183">Because spinning up a web server is a relatively slow process, creating unit tests for your views is not recommended.</span></span>

<span data-ttu-id="dda24-184">Se la vista contiene una logica complessa quindi è consigliabile spostare la logica nei metodi di supporto.</span><span class="sxs-lookup"><span data-stu-id="dda24-184">If your view contains complicated logic then you should consider moving the logic into Helper methods.</span></span> <span data-ttu-id="dda24-185">È possibile scrivere unit test per metodi Helper per l'esecuzione senza la rotazione di un server web.</span><span class="sxs-lookup"><span data-stu-id="dda24-185">You can write unit tests for Helper methods that execute without spinning up a web server.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="dda24-186">Durante la scrittura di test per la logica di accesso ai dati o di logica di visualizzazione non è consigliabile verificare durante la scrittura di unit test, questi test possono essere molto utili quando edificio funzionale o integrazione test.</span><span class="sxs-lookup"><span data-stu-id="dda24-186">While writing tests for data access logic or view logic is not a good idea when writing unit tests, these tests can be very valuable when building functional or integration tests.</span></span>


> [!NOTE] 
> 
> <span data-ttu-id="dda24-187">ASP.NET MVC è il motore di visualizzazione Web Form.</span><span class="sxs-lookup"><span data-stu-id="dda24-187">ASP.NET MVC is the Web Forms View Engine.</span></span> <span data-ttu-id="dda24-188">Mentre il motore di visualizzazione Web Form è dipendente da un server web, potrebbero non essere altri motori di visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="dda24-188">While the Web Forms View Engine is dependent on a web server, other view engines might not be.</span></span>


## <a name="using-a-mock-object-framework"></a><span data-ttu-id="dda24-189">Utilizzo di un Framework di oggetti fittizi</span><span class="sxs-lookup"><span data-stu-id="dda24-189">Using a Mock Object Framework</span></span>

<span data-ttu-id="dda24-190">Durante la creazione di unit test, è quasi sempre necessario sfruttare i vantaggi di un framework di simulare oggetto.</span><span class="sxs-lookup"><span data-stu-id="dda24-190">When building unit tests, you almost always need to take advantage of a Mock Object framework.</span></span> <span data-ttu-id="dda24-191">Un framework di simulare oggetto consente di creare oggetti fittizi e stub per le classi nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="dda24-191">A Mock Object framework enables you to create mocks and stubs for the classes in your application.</span></span>

<span data-ttu-id="dda24-192">Ad esempio, è possibile utilizzare un framework di simulare oggetto per generare una versione fittizia della classe del repository.</span><span class="sxs-lookup"><span data-stu-id="dda24-192">For example, you can use a Mock Object framework to generate a mock version of your repository class.</span></span> <span data-ttu-id="dda24-193">In questo modo, è possibile utilizzare la classe repository fittizio anziché la classe repository reale negli unit test.</span><span class="sxs-lookup"><span data-stu-id="dda24-193">That way, you can use the mock repository class instead of the real repository class in your unit tests.</span></span> <span data-ttu-id="dda24-194">Il repository fittizio consente di evitare l'esecuzione del codice del database durante l'esecuzione di uno unit test.</span><span class="sxs-lookup"><span data-stu-id="dda24-194">Using the mock repository enables you to avoid executing database code when executing a unit test.</span></span>

<span data-ttu-id="dda24-195">Visual Studio non include un framework di simulare oggetto.</span><span class="sxs-lookup"><span data-stu-id="dda24-195">Visual Studio does not include a Mock Object framework.</span></span> <span data-ttu-id="dda24-196">Tuttavia, sono disponibili diversi framework di simulare oggetto commerciali e open source di .NET framework:</span><span class="sxs-lookup"><span data-stu-id="dda24-196">However, there are several commercial and open source Mock Object frameworks available for the .NET framework:</span></span>

1. <span data-ttu-id="dda24-197">Moq - questo framework è disponibile con la licenza BSD open source.</span><span class="sxs-lookup"><span data-stu-id="dda24-197">Moq - This framework is available under the open source BSD license.</span></span> <span data-ttu-id="dda24-198">È possibile scaricare da Moq [ https://code.google.com/p/moq/ ](https://code.google.com/p/moq/).</span><span class="sxs-lookup"><span data-stu-id="dda24-198">You can download Moq from [https://code.google.com/p/moq/](https://code.google.com/p/moq/).</span></span>
2. <span data-ttu-id="dda24-199">Rhino Mocks, questo framework è disponibile con la licenza BSD open source.</span><span class="sxs-lookup"><span data-stu-id="dda24-199">Rhino Mocks - This framework is available under the open source BSD license.</span></span> <span data-ttu-id="dda24-200">È possibile scaricare Rhino Mocks dal [ http://ayende.com/projects/rhino-mocks.aspx ](http://ayende.com/projects/rhino-mocks.aspx).</span><span class="sxs-lookup"><span data-stu-id="dda24-200">You can download Rhino Mocks from [http://ayende.com/projects/rhino-mocks.aspx](http://ayende.com/projects/rhino-mocks.aspx).</span></span>
3. <span data-ttu-id="dda24-201">Typemock parimenti - si tratta di un framework commerciale.</span><span class="sxs-lookup"><span data-stu-id="dda24-201">Typemock Isolator - This is a commercial framework.</span></span> <span data-ttu-id="dda24-202">È possibile scaricare una versione di valutazione dal [ http://www.typemock.com/ ](http://www.typemock.com/).</span><span class="sxs-lookup"><span data-stu-id="dda24-202">You can download a trial version from [http://www.typemock.com/](http://www.typemock.com/).</span></span>

<span data-ttu-id="dda24-203">In questa esercitazione, ho deciso di utilizzare Moq.</span><span class="sxs-lookup"><span data-stu-id="dda24-203">In this tutorial, I decided to use Moq.</span></span> <span data-ttu-id="dda24-204">Tuttavia, è possibile utilizzare la stessa facilità Rhino Mocks o parimenti Typemock per la simulazione di creare oggetti per l'applicazione Gestione contatti.</span><span class="sxs-lookup"><span data-stu-id="dda24-204">However, you could just as easily use Rhino Mocks or Typemock Isolator to create the Mock objects for the Contact Manager application.</span></span>

<span data-ttu-id="dda24-205">Prima di poter utilizzare Moq, è necessario completare i passaggi seguenti:</span><span class="sxs-lookup"><span data-stu-id="dda24-205">Before you can use Moq, you need to complete the following steps:</span></span>

1. <span data-ttu-id="dda24-206">.</span><span class="sxs-lookup"><span data-stu-id="dda24-206">.</span></span>
2. <span data-ttu-id="dda24-207">Prima di aver decompresso il download, assicurarsi che il file e di fare clic sul pulsante **Unblock** (vedere la figura 1).</span><span class="sxs-lookup"><span data-stu-id="dda24-207">Before you unzip the download, make sure that you right-click the file and click the button labeled **Unblock** (see Figure 1).</span></span>
3. <span data-ttu-id="dda24-208">Decomprimere il download.</span><span class="sxs-lookup"><span data-stu-id="dda24-208">Unzip the download.</span></span>
4. <span data-ttu-id="dda24-209">Aggiungere un riferimento all'assembly Moq facendo clic sulla cartella riferimenti nel progetto ContactManager.Tests e selezionando **Aggiungi riferimento**.</span><span class="sxs-lookup"><span data-stu-id="dda24-209">Add a reference to the Moq assembly by right-clicking the References folder in the ContactManager.Tests project and selecting **Add Reference**.</span></span> <span data-ttu-id="dda24-210">Nella scheda Sfoglia, selezionare la cartella in cui è stato decompresso Moq e selezionare l'assembly Moq.dll.</span><span class="sxs-lookup"><span data-stu-id="dda24-210">Under the Browse tab, browse to the folder where you unzipped Moq and select the Moq.dll assembly.</span></span> <span data-ttu-id="dda24-211">Fare clic su di **OK** pulsante.</span><span class="sxs-lookup"><span data-stu-id="dda24-211">Click the **OK** button.</span></span>
5. <span data-ttu-id="dda24-212">Dopo aver completato questi passaggi, la cartella Riferimenti dovrebbe essere come nella figura 2.</span><span class="sxs-lookup"><span data-stu-id="dda24-212">After you complete these steps, your References folder should look like Figure 2.</span></span>


<span data-ttu-id="dda24-213">[![Sblocco Moq](iteration-5-create-unit-tests-cs/_static/image1.jpg)](iteration-5-create-unit-tests-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="dda24-213">[![Unblocking Moq](iteration-5-create-unit-tests-cs/_static/image1.jpg)](iteration-5-create-unit-tests-cs/_static/image1.png)</span></span>

<span data-ttu-id="dda24-214">**Figura 01**: Moq sblocco ([fare clic per visualizzare l'immagine ingrandita](iteration-5-create-unit-tests-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="dda24-214">**Figure 01**: Unblocking Moq([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image2.png))</span></span>


<span data-ttu-id="dda24-215">[![Riferimenti dopo l'aggiunta di Moq](iteration-5-create-unit-tests-cs/_static/image2.jpg)](iteration-5-create-unit-tests-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="dda24-215">[![References after adding Moq](iteration-5-create-unit-tests-cs/_static/image2.jpg)](iteration-5-create-unit-tests-cs/_static/image3.png)</span></span>

<span data-ttu-id="dda24-216">**Figura 02**: i riferimenti dopo l'aggiunta di Moq ([fare clic per visualizzare l'immagine ingrandita](iteration-5-create-unit-tests-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="dda24-216">**Figure 02**: References after adding Moq([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image4.png))</span></span>


## <a name="creating-unit-tests-for-the-service-layer"></a><span data-ttu-id="dda24-217">Creazione di Unit test per il livello di servizio</span><span class="sxs-lookup"><span data-stu-id="dda24-217">Creating Unit Tests for the Service Layer</span></span>

<span data-ttu-id="dda24-218">Consente di iniziare creando un set di unit test per il livello di servizio di Contact Manager applicazione s s.</span><span class="sxs-lookup"><span data-stu-id="dda24-218">Let s start by creating a set of unit tests for our Contact Manager application s service layer.</span></span> <span data-ttu-id="dda24-219">Si userà questi test per verificare la logica di convalida.</span><span class="sxs-lookup"><span data-stu-id="dda24-219">We'll use these tests to verify our validation logic.</span></span>

<span data-ttu-id="dda24-220">Creare una nuova cartella denominata modelli nel progetto ContactManager.Tests.</span><span class="sxs-lookup"><span data-stu-id="dda24-220">Create a new folder named Models in the ContactManager.Tests project.</span></span> <span data-ttu-id="dda24-221">Successivamente, la cartella modelli e scegliere **Aggiungi, nuovo Test**.</span><span class="sxs-lookup"><span data-stu-id="dda24-221">Next, right-click the Models folder and select **Add, New Test**.</span></span> <span data-ttu-id="dda24-222">Il **Aggiungi nuovo Test** viene visualizzata la finestra illustrata nella figura 3.</span><span class="sxs-lookup"><span data-stu-id="dda24-222">The **Add New Test** dialog shown in Figure 3 appears.</span></span> <span data-ttu-id="dda24-223">Selezionare il **Unit Test** modello e denominare il nuovo test ContactManagerServiceTest.cs.</span><span class="sxs-lookup"><span data-stu-id="dda24-223">Select the **Unit Test** template and name your new test ContactManagerServiceTest.cs.</span></span> <span data-ttu-id="dda24-224">Fare clic su di **OK** pulsante per aggiungere il nuovo test al progetto di Test.</span><span class="sxs-lookup"><span data-stu-id="dda24-224">Click the **OK** button to add your new test to your Test Project.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="dda24-225">In generale, si desidera la struttura di cartelle del progetto di Test per corrispondere alla struttura della cartella del progetto ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="dda24-225">In general, you want the folder structure of your Test Project to match the folder structure of your ASP.NET MVC project.</span></span> <span data-ttu-id="dda24-226">Ad esempio, inserire i test controller in una cartella controller, il test del modello in una cartella di modelli e così via.</span><span class="sxs-lookup"><span data-stu-id="dda24-226">For example, you place controller tests in a Controllers folder, model tests in a Models folder, and so on.</span></span>


<span data-ttu-id="dda24-227">[![Models\ContactManagerServiceTest.cs](iteration-5-create-unit-tests-cs/_static/image3.jpg)](iteration-5-create-unit-tests-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="dda24-227">[![Models\ContactManagerServiceTest.cs](iteration-5-create-unit-tests-cs/_static/image3.jpg)](iteration-5-create-unit-tests-cs/_static/image5.png)</span></span>

<span data-ttu-id="dda24-228">**Figura 03**: Models\ContactManagerServiceTest.cs ([fare clic per visualizzare l'immagine ingrandita](iteration-5-create-unit-tests-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="dda24-228">**Figure 03**: Models\ContactManagerServiceTest.cs([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image6.png))</span></span>


<span data-ttu-id="dda24-229">Inizialmente, si vuole testare il metodo CreateContact() esposto dalla classe ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="dda24-229">Initially, we want to test the CreateContact() method exposed by the ContactManagerService class.</span></span> <span data-ttu-id="dda24-230">Si creerà i cinque test seguenti:</span><span class="sxs-lookup"><span data-stu-id="dda24-230">We'll create the following five tests:</span></span>

- <span data-ttu-id="dda24-231">Test che CreateContact() CreateContact() - restituisce il valore true quando un contatto valido viene passato al metodo.</span><span class="sxs-lookup"><span data-stu-id="dda24-231">CreateContact() - Tests that CreateContact() returns the value true when a valid Contact is passed to the method.</span></span>
- <span data-ttu-id="dda24-232">CreateContactRequiredFirstName() - test che un messaggio di errore viene aggiunto allo stato di modello quando un contatto con un nome mancano viene passato al metodo CreateContact().</span><span class="sxs-lookup"><span data-stu-id="dda24-232">CreateContactRequiredFirstName() - Tests that an error message is added to model state when a Contact with a missing first name is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="dda24-233">CreateContactRequredLastName() - test che un messaggio di errore viene aggiunto allo stato di modello quando un contatto con un cognome mancano viene passato al metodo CreateContact().</span><span class="sxs-lookup"><span data-stu-id="dda24-233">CreateContactRequredLastName() - Tests that an error message is added to model state when a Contact with a missing last name is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="dda24-234">CreateContactInvalidPhone() - test, che viene aggiunto un messaggio di errore per lo stato del modello quando un contatto con un numero di telefono non valido viene passato al metodo CreateContact().</span><span class="sxs-lookup"><span data-stu-id="dda24-234">CreateContactInvalidPhone() - Tests that an error message is added to model state when a Contact with an invalid phone number is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="dda24-235">CreateContactInvalidEmail() - test che un messaggio di errore viene aggiunto per lo stato del modello quando un contatto con un indirizzo di posta elettronica non valido viene passato al metodo CreateContact()...</span><span class="sxs-lookup"><span data-stu-id="dda24-235">CreateContactInvalidEmail() - Tests that an error message is added to model state when a Contact with an invalid email address is passed to the CreateContact() method..</span></span>

<span data-ttu-id="dda24-236">Il primo test verifica che un contatto valido non genera un errore di convalida.</span><span class="sxs-lookup"><span data-stu-id="dda24-236">The first test verifies that a valid Contact does not generate a validation error.</span></span> <span data-ttu-id="dda24-237">I restanti test consente di controllare ogni delle regole di convalida.</span><span class="sxs-lookup"><span data-stu-id="dda24-237">The remaining tests check each of the validation rules.</span></span>

<span data-ttu-id="dda24-238">Il codice per questi test è contenuto in elenco 1.</span><span class="sxs-lookup"><span data-stu-id="dda24-238">The code for these tests is contained in Listing 1.</span></span>

<span data-ttu-id="dda24-239">**Elenco 1 - Models\ContactManagerServiceTest.cs**</span><span class="sxs-lookup"><span data-stu-id="dda24-239">**Listing 1 - Models\ContactManagerServiceTest.cs**</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample1.cs)]


<span data-ttu-id="dda24-240">Poiché si utilizza la classe di contatto nel listato 1, è necessario aggiungere un riferimento a Entity Framework Microsoft per il progetto di Test.</span><span class="sxs-lookup"><span data-stu-id="dda24-240">Because we use the Contact class in Listing 1, we need to add a reference to the Microsoft Entity Framework to our Test project.</span></span> <span data-ttu-id="dda24-241">Aggiungere un riferimento all'assembly System.Data.Entity.</span><span class="sxs-lookup"><span data-stu-id="dda24-241">Add a reference to the System.Data.Entity assembly.</span></span>


<span data-ttu-id="dda24-242">Elenco 1 contiene un metodo denominato Initialize () che è decorata con l'attributo [TestInitialize].</span><span class="sxs-lookup"><span data-stu-id="dda24-242">Listing 1 contains a method named Initialize() that is decorated with the [TestInitialize] attribute.</span></span> <span data-ttu-id="dda24-243">Questo metodo viene chiamato automaticamente prima di eseguita ognuno degli unit test (viene chiamato 5 volte immediatamente prima di ogni unit test).</span><span class="sxs-lookup"><span data-stu-id="dda24-243">This method is called automatically before each of the unit tests is run (it is called 5 times right before each of the unit tests).</span></span> <span data-ttu-id="dda24-244">Il metodo Initialize () crea un repository fittizio con la riga di codice seguente:</span><span class="sxs-lookup"><span data-stu-id="dda24-244">The Initialize() method creates a mock repository with the following line of code:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample2.cs)]

<span data-ttu-id="dda24-245">Questa riga di codice utilizza il framework Moq per generare un repository fittizio dall'interfaccia IContactManagerRepository.</span><span class="sxs-lookup"><span data-stu-id="dda24-245">This line of code uses the Moq framework to generate a mock repository from the IContactManagerRepository interface.</span></span> <span data-ttu-id="dda24-246">Il repository fittizio viene utilizzato anziché il EntityContactManagerRepository effettivo per evitare l'accesso al database quando viene eseguito ogni unit test.</span><span class="sxs-lookup"><span data-stu-id="dda24-246">The mock repository is used instead of the actual EntityContactManagerRepository to avoid accessing the database when each unit test is run.</span></span> <span data-ttu-id="dda24-247">Il repository fittizio implementa i metodi dell'interfaccia IContactManagerRepository, ma in realtà non t don metodi.</span><span class="sxs-lookup"><span data-stu-id="dda24-247">The mock repository implements the methods of the IContactManagerRepository interface, but the methods don t actually do anything.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="dda24-248">Quando si utilizza il framework Moq, viene fatta distinzione tra \_mockRepository e \_mockRepository.Object.</span><span class="sxs-lookup"><span data-stu-id="dda24-248">When using the Moq framework, there is a distinction between \_mockRepository and \_mockRepository.Object.</span></span> <span data-ttu-id="dda24-249">Il primo si intende la simulazione&lt;IContactManagerRepository&gt; classe che contiene metodi per specificare il comportamento di repository fittizio.</span><span class="sxs-lookup"><span data-stu-id="dda24-249">The former refers to the Mock&lt;IContactManagerRepository&gt; class that contains methods for specifying how the mock repository will behave.</span></span> <span data-ttu-id="dda24-250">Il secondo si riferisce al repository fittizio effettivo che implementa l'interfaccia IContactManagerRepository.</span><span class="sxs-lookup"><span data-stu-id="dda24-250">The latter refers to the actual mock repository that implements the IContactManagerRepository interface.</span></span>


<span data-ttu-id="dda24-251">Il repository fittizio viene utilizzato nel metodo Initialize () quando si crea un'istanza della classe ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="dda24-251">The mock repository is used in the Initialize() method when creating an instance of the ContactManagerService class.</span></span> <span data-ttu-id="dda24-252">Tutti i singoli unit test utilizzare questa istanza della classe ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="dda24-252">All of the individual unit tests use this instance of the ContactManagerService class.</span></span>

<span data-ttu-id="dda24-253">Elenco 1 contiene cinque metodi che corrispondono a ognuno degli unit test.</span><span class="sxs-lookup"><span data-stu-id="dda24-253">Listing 1 contains five methods that correspond to each of the unit tests.</span></span> <span data-ttu-id="dda24-254">Ognuno di questi metodi è decorata con l'attributo [TestMethod].</span><span class="sxs-lookup"><span data-stu-id="dda24-254">Each of these methods is decorated with the [TestMethod] attribute.</span></span> <span data-ttu-id="dda24-255">Quando si esegue gli unit test, viene chiamato qualsiasi metodo che dispone di questo attributo.</span><span class="sxs-lookup"><span data-stu-id="dda24-255">When you run the unit tests, any method that has this attribute is called.</span></span> <span data-ttu-id="dda24-256">In altre parole, qualsiasi metodo che è decorata con l'attributo [TestMethod] è uno unit test.</span><span class="sxs-lookup"><span data-stu-id="dda24-256">In other words, any method that is decorated with the [TestMethod] attribute is a unit test.</span></span>

<span data-ttu-id="dda24-257">Il primo unit test, denominato CreateContact(), verifica che la chiamata CreateContact() restituisce il valore true quando un'istanza della classe contatto valida viene passata al metodo.</span><span class="sxs-lookup"><span data-stu-id="dda24-257">The first unit test, named CreateContact(), verifies that calling CreateContact() returns the value true when a valid instance of the Contact class is passed to the method.</span></span> <span data-ttu-id="dda24-258">Il test crea un'istanza della classe di contatto, chiama il metodo CreateContact() e verifica che CreateContact() restituisce il valore true.</span><span class="sxs-lookup"><span data-stu-id="dda24-258">The test creates an instance of the Contact class, calls the CreateContact() method, and verifies that CreateContact() returns the value true.</span></span>

<span data-ttu-id="dda24-259">I restanti test di verificare che quando viene chiamato il metodo CreateContact() con un contatto valido quindi il metodo restituisce false e il messaggio di errore di convalida previsto è aggiunto allo stato del modello.</span><span class="sxs-lookup"><span data-stu-id="dda24-259">The remaining tests verify that when the CreateContact() method is called with an invalid Contact then the method returns false and the expected validation error message is added to model state.</span></span> <span data-ttu-id="dda24-260">Ad esempio, il test CreateContactRequiredFirstName() crea un'istanza della classe contatto con una stringa vuota per la relativa proprietà FirstName.</span><span class="sxs-lookup"><span data-stu-id="dda24-260">For example, the CreateContactRequiredFirstName() test creates an instance of the Contact class with an empty string for its FirstName property.</span></span> <span data-ttu-id="dda24-261">Successivamente, il metodo CreateContact() viene chiamato con il contatto non valido.</span><span class="sxs-lookup"><span data-stu-id="dda24-261">Next, the CreateContact() method is called with the invalid Contact.</span></span> <span data-ttu-id="dda24-262">Infine, il test di verifica che CreateContact() restituisce false e che lo stato del modello contiene il messaggio di errore di convalida previsto "First name è obbligatorio."</span><span class="sxs-lookup"><span data-stu-id="dda24-262">Finally, the test verifies that CreateContact() returns false and that model state contains the expected validation error message "First name is required."</span></span>

<span data-ttu-id="dda24-263">È possibile eseguire gli unit test nel listato 1 selezionando l'opzione di menu **Test eseguire, tutti i test nella soluzione (CTRL + R, A)**.</span><span class="sxs-lookup"><span data-stu-id="dda24-263">You can run the unit tests in Listing 1 by selecting the menu option **Test, Run, All Tests in Solution (CTRL+R, A)**.</span></span> <span data-ttu-id="dda24-264">I risultati dei test vengono visualizzati nella finestra Risultati Test (vedere la figura 4).</span><span class="sxs-lookup"><span data-stu-id="dda24-264">The results of the tests are displayed in the Test Results window (see Figure 4).</span></span>


<span data-ttu-id="dda24-265">[![Risultati dei test](iteration-5-create-unit-tests-cs/_static/image4.jpg)](iteration-5-create-unit-tests-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="dda24-265">[![Test Results](iteration-5-create-unit-tests-cs/_static/image4.jpg)](iteration-5-create-unit-tests-cs/_static/image7.png)</span></span>

<span data-ttu-id="dda24-266">**Figura 04**: i risultati del Test ([fare clic per visualizzare l'immagine ingrandita](iteration-5-create-unit-tests-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="dda24-266">**Figure 04**: Test Results ([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image8.png))</span></span>


## <a name="creating-unit-tests-for-controllers"></a><span data-ttu-id="dda24-267">Creazione di Unit test per i controller</span><span class="sxs-lookup"><span data-stu-id="dda24-267">Creating Unit Tests for Controllers</span></span>

<span data-ttu-id="dda24-268">Applicazione ASP.NETMVC controllare il flusso dell'interazione dell'utente.</span><span class="sxs-lookup"><span data-stu-id="dda24-268">ASP.NETMVC application control the flow of user interaction.</span></span> <span data-ttu-id="dda24-269">Quando un controller di test, si desidera verificare se il controller restituisca l'azione a destra di risultati e visualizzare i dati.</span><span class="sxs-lookup"><span data-stu-id="dda24-269">When testing a controller, you want to test whether the controller returns the right action result and view data.</span></span> <span data-ttu-id="dda24-270">È anche consigliabile verificare se un controller interagisce con le classi di modello nel modo previsto.</span><span class="sxs-lookup"><span data-stu-id="dda24-270">You also might want to test whether a controller interacts with model classes in the manner expected.</span></span>

<span data-ttu-id="dda24-271">Ad esempio, il listato 2 contiene due unit test per il metodo di metodo di creazione del controller di contatto.</span><span class="sxs-lookup"><span data-stu-id="dda24-271">For example, Listing 2 contains two unit tests for the Contact controller Create() method.</span></span> <span data-ttu-id="dda24-272">Il primo unit test verifica quindi che quindi reindirizza il metodo di creazione per l'operazione sull'indice, un contatto valido viene passato al metodo del metodo di creazione.</span><span class="sxs-lookup"><span data-stu-id="dda24-272">The first unit test verifies that when a valid Contact is passed to the Create() method then the Create() method redirects to the Index action.</span></span> <span data-ttu-id="dda24-273">In altre parole, quando viene passato un contatto valido, il metodo di creazione metodo deve restituire un RedirectToRouteResult che rappresenta l'operazione sull'indice.</span><span class="sxs-lookup"><span data-stu-id="dda24-273">In other words, when passed a valid Contact, the Create() method should return a RedirectToRouteResult that represents the Index action.</span></span>

<span data-ttu-id="dda24-274">Non abbiamo t desidera testare il livello di servizio ContactManager quando sottoposti a test il livello di controller.</span><span class="sxs-lookup"><span data-stu-id="dda24-274">We don t want to test the ContactManager service layer when we are testing the controller layer.</span></span> <span data-ttu-id="dda24-275">Pertanto, è simulare il livello di servizio con il codice seguente nel metodo di inizializzazione:</span><span class="sxs-lookup"><span data-stu-id="dda24-275">Therefore, we mock the service layer with the following code in the Initialize method:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample3.cs)]

<span data-ttu-id="dda24-276">Nello unit test, CreateValidContact() è simulare il comportamento della chiamata a livello di servizio metodo CreateContact() con la riga di codice seguente:</span><span class="sxs-lookup"><span data-stu-id="dda24-276">In the CreateValidContact() unit test, we mock the behavior of calling the service layer CreateContact() method with the following line of code:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample4.cs)]

<span data-ttu-id="dda24-277">Questa riga di codice, il servizio di ContactManager fittizio restituire il valore true, quando viene chiamato il metodo CreateContact().</span><span class="sxs-lookup"><span data-stu-id="dda24-277">This line of code causes the mock ContactManager service to return the value true when its CreateContact() method is called.</span></span> <span data-ttu-id="dda24-278">Da tali il livello di servizio, è possibile testare il comportamento di questo controller senza la necessità di eseguire qualsiasi codice del livello di servizio.</span><span class="sxs-lookup"><span data-stu-id="dda24-278">By mocking the service layer, we can test the behavior of our controller without needing to execute any code in the service layer.</span></span>

<span data-ttu-id="dda24-279">Il secondo unit test verifica che l'azione del metodo di creazione restituisce la visualizzazione Create quando un contatto non valido viene passato al metodo.</span><span class="sxs-lookup"><span data-stu-id="dda24-279">The second unit test verifies that the Create() action returns the Create view when an invalid contact is passed to the method.</span></span> <span data-ttu-id="dda24-280">Si causa il livello di servizio CreateContact() metodo per restituire il valore false, con la riga di codice seguente:</span><span class="sxs-lookup"><span data-stu-id="dda24-280">We cause the service layer CreateContact() method to return the value false with the following line of code:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample5.cs)]

<span data-ttu-id="dda24-281">Se il metodo di metodo di creazione si comporta esattamente come si prevede quindi deve restituire la visualizzazione Create quando il livello di servizio restituisce il valore false.</span><span class="sxs-lookup"><span data-stu-id="dda24-281">If the Create() method behaves as we expect then it should return the Create view when the service layer returns the value false.</span></span> <span data-ttu-id="dda24-282">In questo modo, il controller può visualizzare i messaggi di errore di convalida nella visualizzazione di creazione e l'utente ha la possibilità di correggere tale proprietà di contatto non valido.</span><span class="sxs-lookup"><span data-stu-id="dda24-282">That way, the controller can display the validation error messages in the Create view and the user has a chance to correct that invalid Contact properties.</span></span>


<span data-ttu-id="dda24-283">Se si prevede di unit test per i controller di compilazione è necessario restituire i nomi delle viste esplicita dalle azioni del controller.</span><span class="sxs-lookup"><span data-stu-id="dda24-283">If you plan to build unit tests for your controllers then you need to return explicit view names from your controller actions.</span></span> <span data-ttu-id="dda24-284">Ad esempio, non restituiscono una visualizzazione simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="dda24-284">For example, do not return a view like this:</span></span>

<span data-ttu-id="dda24-285">restituire View();</span><span class="sxs-lookup"><span data-stu-id="dda24-285">return View();</span></span>

<span data-ttu-id="dda24-286">Al contrario, restituire la visualizzazione simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="dda24-286">Instead, return the view like this:</span></span>

<span data-ttu-id="dda24-287">restituire View("Create");</span><span class="sxs-lookup"><span data-stu-id="dda24-287">return View("Create");</span></span>

<span data-ttu-id="dda24-288">Se non si esplicita per la restituzione di una visualizzazione di proprietà ViewResult.ViewName restituisce una stringa vuota.</span><span class="sxs-lookup"><span data-stu-id="dda24-288">If you are not explicit when returning a view then the ViewResult.ViewName property returns an empty string.</span></span>


<span data-ttu-id="dda24-289">**Il listato 2 - Controllers\ContactControllerTest.cs**</span><span class="sxs-lookup"><span data-stu-id="dda24-289">**Listing 2 - Controllers\ContactControllerTest.cs**</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample6.cs)]

## <a name="summary"></a><span data-ttu-id="dda24-290">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="dda24-290">Summary</span></span>

<span data-ttu-id="dda24-291">In questa iterazione, è creare unit test per l'applicazione Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="dda24-291">In this iteration, we created unit tests for our Contact Manager application.</span></span> <span data-ttu-id="dda24-292">In qualsiasi momento per verificare che l'applicazione continuerà a funzionare in modo che si prevede che è possibile eseguire gli unit test.</span><span class="sxs-lookup"><span data-stu-id="dda24-292">We can run these unit tests at any time to verify that our application still behaves in the manner that we expect.</span></span> <span data-ttu-id="dda24-293">Gli unit test agire come rete di protezione per l'applicazione permette di modificare in modo sicuro l'applicazione in futuro.</span><span class="sxs-lookup"><span data-stu-id="dda24-293">The unit tests act as a safety net for our application enabling us to safely modify our application in the future.</span></span>

<span data-ttu-id="dda24-294">Due set di unit test è stato creato.</span><span class="sxs-lookup"><span data-stu-id="dda24-294">We created two sets of unit tests.</span></span> <span data-ttu-id="dda24-295">In primo luogo, è stato testato la logica di convalida tramite la creazione di unit test per il livello di servizio.</span><span class="sxs-lookup"><span data-stu-id="dda24-295">First, we tested our validation logic by creating unit tests for our service layer.</span></span> <span data-ttu-id="dda24-296">Successivamente, è stato testato la logica del flusso di controllo mediante la creazione di unit test per il livello di controller.</span><span class="sxs-lookup"><span data-stu-id="dda24-296">Next, we tested our flow control logic by creating unit tests for our controller layer.</span></span> <span data-ttu-id="dda24-297">Quando si testa il livello di servizio, è isolata i test per il livello di servizio da questo livello di repository da tali il livello di repository.</span><span class="sxs-lookup"><span data-stu-id="dda24-297">When testing our service layer, we isolated our tests for our service layer from our repository layer by mocking our repository layer.</span></span> <span data-ttu-id="dda24-298">Quando il livello di controller di test, i test è isolato per il livello di controller in base a tali il livello di servizio.</span><span class="sxs-lookup"><span data-stu-id="dda24-298">When testing the controller layer, we isolated our tests for our controller layer by mocking the service layer.</span></span>

<span data-ttu-id="dda24-299">Nell'iterazione successiva, modificare è l'applicazione Gestione contatti in modo che supporti i gruppi di contatto.</span><span class="sxs-lookup"><span data-stu-id="dda24-299">In the next iteration, we modify the Contact Manager application so that it supports Contact Groups.</span></span> <span data-ttu-id="dda24-300">Questa nuova funzionalità verrà aggiunto all'applicazione mediante un processo di progettazione software denominato sviluppo basato su test.</span><span class="sxs-lookup"><span data-stu-id="dda24-300">We'll add this new functionality to our application using a software design process called test-driven development.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="dda24-301">[Precedente](iteration-4-make-the-application-loosely-coupled-cs.md)
> [Successivo](iteration-6-use-test-driven-development-cs.md)</span><span class="sxs-lookup"><span data-stu-id="dda24-301">[Previous](iteration-4-make-the-application-loosely-coupled-cs.md)
[Next](iteration-6-use-test-driven-development-cs.md)</span></span>
