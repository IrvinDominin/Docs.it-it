---
uid: mvc/overview/older-versions-1/contact-manager/iteration-3-add-form-validation-cs
title: 'Iterazione #3: aggiunta della convalida del form (c#) | Documenti Microsoft'
author: microsoft
description: Nella terza iterazione, è aggiungere la convalida di form di base. È impedire agli utenti di inviare un modulo senza completare i campi modulo necessari. È inoltre possibile convalidare emai...
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/20/2009
ms.topic: article
ms.assetid: 51a0d175-913b-43d8-95e3-840fb96ad1a9
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-3-add-form-validation-cs
msc.type: authoredcontent
ms.openlocfilehash: b9353c32b2839fd760513982c5742bb8f521e94a
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/06/2018
---
<a name="iteration-3--add-form-validation-c"></a><span data-ttu-id="0e1bb-105">Iterazione #3: aggiunta della convalida del form (c#)</span><span class="sxs-lookup"><span data-stu-id="0e1bb-105">Iteration #3 – Add form validation (C#)</span></span>
====================
<span data-ttu-id="0e1bb-106">by [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="0e1bb-106">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="0e1bb-107">Scaricare il codice</span><span class="sxs-lookup"><span data-stu-id="0e1bb-107">Download Code</span></span>](iteration-3-add-form-validation-cs/_static/contactmanager_3_cs1.zip)

> <span data-ttu-id="0e1bb-108">Nella terza iterazione, è aggiungere la convalida di form di base.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-108">In the third iteration, we add basic form validation.</span></span> <span data-ttu-id="0e1bb-109">È impedire agli utenti di inviare un modulo senza completare i campi modulo necessari.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-109">We prevent people from submitting a form without completing required form fields.</span></span> <span data-ttu-id="0e1bb-110">È inoltre possibile convalidare gli indirizzi di posta elettronica e numeri di telefono.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-110">We also validate email addresses and phone numbers.</span></span>


## <a name="building-a-contact-management-aspnet-mvc-application-c"></a><span data-ttu-id="0e1bb-111">Creazione di un'applicazione ASP.NET MVC di gestione dei contatti (c#)</span><span class="sxs-lookup"><span data-stu-id="0e1bb-111">Building a Contact Management ASP.NET MVC Application (C#)</span></span>
  

<span data-ttu-id="0e1bb-112">In questa serie di esercitazioni, si compila un'intera applicazione di gestione dei contatti dall'inizio completamento.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-112">In this series of tutorials, we build an entire Contact Management application from start to finish.</span></span> <span data-ttu-id="0e1bb-113">L'applicazione Contact Manager consente di archiviare le informazioni di contatto - nomi, i numeri di telefono e indirizzi di posta elettronica: per un elenco di persone.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-113">The Contact Manager application enables you to store contact information - names, phone numbers and email addresses - for a list of people.</span></span>

<span data-ttu-id="0e1bb-114">È compilare l'applicazione più iterazioni.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-114">We build the application over multiple iterations.</span></span> <span data-ttu-id="0e1bb-115">A ogni iterazione, gradualmente è migliorare l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-115">With each iteration, we gradually improve the application.</span></span> <span data-ttu-id="0e1bb-116">L'obiettivo di questo approccio iterazione più è che consentono di comprendere il motivo per ogni modifica.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-116">The goal of this multiple iteration approach is to enable you to understand the reason for each change.</span></span>

- <span data-ttu-id="0e1bb-117">Iterazione #1 - creare l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-117">Iteration #1 - Create the application.</span></span> <span data-ttu-id="0e1bb-118">Nella prima iterazione, verranno create Contact Manager in modo più semplice possibile.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-118">In the first iteration, we create the Contact Manager in the simplest way possible.</span></span> <span data-ttu-id="0e1bb-119">Viene aggiunto il supporto per le operazioni di database basic: creazione, lettura, aggiornamento ed eliminazione (CRUD).</span><span class="sxs-lookup"><span data-stu-id="0e1bb-119">We add support for basic database operations: Create, Read, Update, and Delete (CRUD).</span></span>

- <span data-ttu-id="0e1bb-120">Iterazione #2 - verificare l'applicazione l'aspetto.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-120">Iteration #2 - Make the application look nice.</span></span> <span data-ttu-id="0e1bb-121">In questa iterazione, è migliorare l'aspetto dell'applicazione modificando il valore predefinito di pagina master di visualizzazione ASP.NET MVC e foglio di stile CSS.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-121">In this iteration, we improve the appearance of the application by modifying the default ASP.NET MVC view master page and cascading style sheet.</span></span>

- <span data-ttu-id="0e1bb-122">Iterazione #3 - aggiungere la convalida dei form.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-122">Iteration #3 - Add form validation.</span></span> <span data-ttu-id="0e1bb-123">Nella terza iterazione, è aggiungere la convalida di form di base.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-123">In the third iteration, we add basic form validation.</span></span> <span data-ttu-id="0e1bb-124">È impedire agli utenti di inviare un modulo senza completare i campi modulo necessari.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-124">We prevent people from submitting a form without completing required form fields.</span></span> <span data-ttu-id="0e1bb-125">È inoltre possibile convalidare gli indirizzi di posta elettronica e numeri di telefono.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-125">We also validate email addresses and phone numbers.</span></span>

- <span data-ttu-id="0e1bb-126">Iterazione #4: verificare l'applicazione ad accoppiamento debole.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-126">Iteration #4 - Make the application loosely coupled.</span></span> <span data-ttu-id="0e1bb-127">In questa terza iterazione, possiamo usufruire dei diversi modelli di progettazione di software per renderne più semplice gestire e modificare l'applicazione Gestione contatti.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-127">In this third iteration, we take advantage of several software design patterns to make it easier to maintain and modify the Contact Manager application.</span></span> <span data-ttu-id="0e1bb-128">Ad esempio, si effettua il refactoring l'applicazione di utilizzare il modello di Repository e il modello di inserimento di dipendenze.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-128">For example, we refactor our application to use the Repository pattern and the Dependency Injection pattern.</span></span>

- <span data-ttu-id="0e1bb-129">Iterazione #5 - creare unit test.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-129">Iteration #5 - Create unit tests.</span></span> <span data-ttu-id="0e1bb-130">Nella quinta iterazione, si rende l'applicazione di più facile da gestire e modificare tramite l'aggiunta di unit test.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-130">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="0e1bb-131">È simulare il nostro classi del modello di dati e generare unit test per i controller e logica di convalida.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-131">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

- <span data-ttu-id="0e1bb-132">Iterazione 6 # - utilizzare sviluppo basato su test.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-132">Iteration #6 - Use test-driven development.</span></span> <span data-ttu-id="0e1bb-133">In questa iterazione sesto è aggiungere nuove funzionalità per l'applicazione scrivendo unit test prima e la scrittura di codice per gli unit test.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-133">In this sixth iteration, we add new functionality to our application by writing unit tests first and writing code against the unit tests.</span></span> <span data-ttu-id="0e1bb-134">In questa iterazione, è aggiungere gruppi di contatti.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-134">In this iteration, we add contact groups.</span></span>

- <span data-ttu-id="0e1bb-135">Iterazione #7 - aggiunta di funzionalità Ajax.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-135">Iteration #7 - Add Ajax functionality.</span></span> <span data-ttu-id="0e1bb-136">Nella settima iterazione, è migliorare la velocità di risposta e prestazioni dell'applicazione aggiunta del supporto per Ajax.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-136">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>


## <a name="this-iteration"></a><span data-ttu-id="0e1bb-137">Questa iterazione</span><span class="sxs-lookup"><span data-stu-id="0e1bb-137">This Iteration</span></span>

<span data-ttu-id="0e1bb-138">In questa seconda iterazione dell'applicazione Contact Manager, è aggiungere la convalida di form di base.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-138">In this second iteration of the Contact Manager application, we add basic form validation.</span></span> <span data-ttu-id="0e1bb-139">È impedire agli utenti di inviare un contatto senza l'immissione di valori per i campi modulo necessari.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-139">We prevent people from submitting a contact without entering values for required form fields.</span></span> <span data-ttu-id="0e1bb-140">È inoltre possibile convalidare i numeri di telefono e indirizzi di posta elettronica (vedere la figura 1).</span><span class="sxs-lookup"><span data-stu-id="0e1bb-140">We also validate phone numbers and email addresses (see Figure 1).</span></span>


<span data-ttu-id="0e1bb-141">[![La finestra di dialogo Nuovo progetto](iteration-3-add-form-validation-cs/_static/image1.jpg)](iteration-3-add-form-validation-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="0e1bb-141">[![The New Project dialog box](iteration-3-add-form-validation-cs/_static/image1.jpg)](iteration-3-add-form-validation-cs/_static/image1.png)</span></span>

<span data-ttu-id="0e1bb-142">**Figura 01**: un form con convalida ([fare clic per visualizzare l'immagine ingrandita](iteration-3-add-form-validation-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="0e1bb-142">**Figure 01**: A form with validation ([Click to view full-size image](iteration-3-add-form-validation-cs/_static/image2.png))</span></span>


<span data-ttu-id="0e1bb-143">In questa iterazione, la logica di convalida è aggiungere direttamente per le azioni del controller.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-143">In this iteration, we add the validation logic directly to the controller actions.</span></span> <span data-ttu-id="0e1bb-144">In generale, questo non è il modo consigliato per aggiungere la convalida a un'applicazione MVC ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-144">In general, this is not the recommended way to add validation to an ASP.NET MVC application.</span></span> <span data-ttu-id="0e1bb-145">Un approccio migliore consiste nell'inserire la logica di convalida s un'applicazione in un apposito [livello di servizio](http://martinfowler.com/eaaCatalog/serviceLayer.html).</span><span class="sxs-lookup"><span data-stu-id="0e1bb-145">A better approach is to place an application s validation logic in a separate [service layer](http://martinfowler.com/eaaCatalog/serviceLayer.html).</span></span> <span data-ttu-id="0e1bb-146">Nell'iterazione successiva, è effettuare il refactoring l'applicazione di gestione di contatto per rendere più gestibile l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-146">In the next iteration, we refactor the Contact Manager application to make the application more maintainable.</span></span>

<span data-ttu-id="0e1bb-147">In questa iterazione, per semplicità, è scrivere tutto il codice di convalida manualmente.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-147">In this iteration, to keep things simple, we write all of the validation code by hand.</span></span> <span data-ttu-id="0e1bb-148">Invece di scrivere il codice di convalida effettuata, è possibile sfruttare i vantaggi di un framework di convalida.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-148">Instead of writing the validation code ourselves, we could take advantage of a validation framework.</span></span> <span data-ttu-id="0e1bb-149">Ad esempio, è possibile utilizzare Microsoft Enterprise Library convalida applicazione blocco (VAB) per implementare la logica di convalida per l'applicazione ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-149">For example, you can use the Microsoft Enterprise Library Validation Application Block (VAB) to implement the validation logic for your ASP.NET MVC application.</span></span> <span data-ttu-id="0e1bb-150">Per ulteriori informazioni sul blocco di applicazione di convalida, vedere:</span><span class="sxs-lookup"><span data-stu-id="0e1bb-150">To learn more about the Validation Application Block, see:</span></span>

[*http://msdn.microsoft.com/library/dd203099.aspx*](https://msdn.microsoft.com/library/dd203099.aspx)

## <a name="adding-validation-to-the-create-view"></a><span data-ttu-id="0e1bb-151">Aggiunta della convalida per la visualizzazione di creazione</span><span class="sxs-lookup"><span data-stu-id="0e1bb-151">Adding Validation to the Create View</span></span>

<span data-ttu-id="0e1bb-152">Consente di iniziare, aggiungere la logica di convalida per la visualizzazione di creazione s.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-152">Let s start by adding validation logic to the Create view.</span></span> <span data-ttu-id="0e1bb-153">Fortunatamente, perché è stato generato della visualizzazione di creazione con Visual Studio, la visualizzazione di creazione contiene già tutta la logica dell'interfaccia utente necessari per visualizzare i messaggi di convalida.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-153">Fortunately, because we generated the Create view with Visual Studio, the Create view already contains all of the necessary user interface logic to display validation messages.</span></span> <span data-ttu-id="0e1bb-154">Visualizzazione di creazione è contenuta in elenco 1.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-154">The Create view is contained in Listing 1.</span></span>

<span data-ttu-id="0e1bb-155">**Elenco 1 - \Views\Contact\Create.aspx**</span><span class="sxs-lookup"><span data-stu-id="0e1bb-155">**Listing 1 - \Views\Contact\Create.aspx**</span></span>

[!code-aspx[Main](iteration-3-add-form-validation-cs/samples/sample1.aspx)]

<span data-ttu-id="0e1bb-156">Si noti la chiamata al metodo di supporto Html.ValidationSummary() che viene visualizzato immediatamente sopra il form HTML.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-156">Notice the call to the Html.ValidationSummary() helper method that appears immediately above the HTML form.</span></span> <span data-ttu-id="0e1bb-157">Se sono presenti messaggi di errore di convalida, questo metodo visualizza i messaggi di convalida in un elenco puntato.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-157">If there are validation error messages, then this method displays validation messages in a bulleted list.</span></span>

<span data-ttu-id="0e1bb-158">Si noti, inoltre, le chiamate a Html.ValidationMessage() visualizzati accanto a ogni campo del form.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-158">Notice, furthermore, the calls to Html.ValidationMessage() that appear next to each form field.</span></span> <span data-ttu-id="0e1bb-159">L'helper ValidationMessage() Visualizza un messaggio di errore di convalida singoli.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-159">The ValidationMessage() helper displays an individual validation error message.</span></span> <span data-ttu-id="0e1bb-160">Nel caso di listato 1, viene visualizzato un asterisco, quando si verifica un errore di convalida.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-160">In the case of Listing 1, an asterisk is displayed when there is a validation error.</span></span>

<span data-ttu-id="0e1bb-161">Infine, l'helper Html.TextBox() automaticamente esegue il rendering di una classe foglio di stile CSS quando si verifica un errore di convalida associato alla proprietà visualizzata per il supporto.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-161">Finally, the Html.TextBox() helper automatically renders a Cascading Style Sheet class when there is a validation error associated with the property displayed by the helper.</span></span> <span data-ttu-id="0e1bb-162">L'helper Html.TextBox() esegue il rendering di una classe denominata **errore di convalida input**.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-162">The Html.TextBox() helper renders a class named **input-validation-error**.</span></span>

<span data-ttu-id="0e1bb-163">Quando si crea una nuova applicazione MVC ASP.NET, un foglio di stile denominato Site viene creato automaticamente nella cartella del contenuto.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-163">When you create a new ASP.NET MVC application, a style sheet named Site.css is created in the Content folder automatically.</span></span> <span data-ttu-id="0e1bb-164">Questo foglio di stile contiene le definizioni per classi CSS correlate all'aspetto dei messaggi di errore seguenti:</span><span class="sxs-lookup"><span data-stu-id="0e1bb-164">This style sheet contains the following definitions for CSS classes related to the appearance of validation error messages:</span></span>

[!code-css[Main](iteration-3-add-form-validation-cs/samples/sample2.css)]

<span data-ttu-id="0e1bb-165">La classe di errore di convalida campo viene utilizzata per definire lo stile dell'output sottoposto a rendering dall'helper della Html.ValidationMessage().</span><span class="sxs-lookup"><span data-stu-id="0e1bb-165">The field-validation-error class is used to style the output rendered by the Html.ValidationMessage() helper.</span></span> <span data-ttu-id="0e1bb-166">La classe di errore di convalida di input viene utilizzata per definire lo stile di casella di testo (input) eseguito il rendering dall'helper della Html.TextBox().</span><span class="sxs-lookup"><span data-stu-id="0e1bb-166">The input-validation-error class is used to style the textbox (input) rendered by the Html.TextBox() helper.</span></span> <span data-ttu-id="0e1bb-167">La classe di errori di riepilogo di convalida viene utilizzata per definire lo stile di elenco non ordinato dall'helper della Html.ValidationSummary() sottoposto a rendering.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-167">The validation-summary-errors class is used to style the unordered list rendered by the Html.ValidationSummary() helper.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="0e1bb-168">È possibile modificare le classi del foglio di stile descritte in questa sezione per personalizzare l'aspetto dei messaggi di errore di convalida.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-168">You can modify the style sheet classes described in this section to customize the appearance of validation error messages.</span></span>


## <a name="adding-validation-logic-to-the-create-action"></a><span data-ttu-id="0e1bb-169">Aggiunta della logica di convalida di creare azioni</span><span class="sxs-lookup"><span data-stu-id="0e1bb-169">Adding Validation Logic to the Create Action</span></span>

<span data-ttu-id="0e1bb-170">Al momento, crea mai visualizzati messaggi di errore di convalida perché non è stato scritto la logica per generare i messaggi.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-170">Right now, the Create view never displays validation error messages because we have not written the logic to generate any messages.</span></span> <span data-ttu-id="0e1bb-171">Per visualizzare i messaggi di errore di convalida, è necessario aggiungere i messaggi di errore ModelState.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-171">In order to display validation error messages, you need to add the error messages to ModelState.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="0e1bb-172">Il metodo UpdateModel() aggiunge messaggi di errore per ModelState automaticamente quando si verifica un errore di assegnazione del valore di un campo modulo a una proprietà.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-172">The UpdateModel() method adds error messages to ModelState automatically when there is an error assigning the value of a form field to a property.</span></span> <span data-ttu-id="0e1bb-173">Ad esempio, se si tenta di assegnare la stringa "apple" a una proprietà di data di nascita che accetta valori di data/ora, il metodo UpdateModel() aggiunge un errore per ModelState.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-173">For example, if you attempt to assign the string "apple" to a BirthDate property that accepts DateTime values, then the UpdateModel() method adds an error to ModelState.</span></span>


<span data-ttu-id="0e1bb-174">Il metodo di metodo di creazione modificato nel listato 2 contiene una nuova sezione che convalida le proprietà della classe di contatto, prima che venga inserito il nuovo contatto nel database.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-174">The modified Create() method in Listing 2 contains a new section that validates the properties of the Contact class before the new contact is inserted into the database.</span></span>

<span data-ttu-id="0e1bb-175">**Il listato 2 - Controllers\ContactController.cs (Create con la convalida)**</span><span class="sxs-lookup"><span data-stu-id="0e1bb-175">**Listing 2 - Controllers\ContactController.cs (Create with validation)**</span></span>

[!code-csharp[Main](iteration-3-add-form-validation-cs/samples/sample3.cs)]

<span data-ttu-id="0e1bb-176">La sezione Convalida applica quattro regole di convalida distinti:</span><span class="sxs-lookup"><span data-stu-id="0e1bb-176">The validate section enforces four distinct validation rules:</span></span>

- <span data-ttu-id="0e1bb-177">La proprietà FirstName deve avere una lunghezza maggiore di zero (e non può essere composti esclusivamente da spazi)</span><span class="sxs-lookup"><span data-stu-id="0e1bb-177">The FirstName property must have a length greater than zero (and it cannot consist solely of spaces)</span></span>
- <span data-ttu-id="0e1bb-178">La proprietà LastName deve avere una lunghezza maggiore di zero (e non può essere composti esclusivamente da spazi)</span><span class="sxs-lookup"><span data-stu-id="0e1bb-178">The LastName property must have a length greater than zero (and it cannot consist solely of spaces)</span></span>
- <span data-ttu-id="0e1bb-179">Se la proprietà Phone ha un valore (ha una lunghezza maggiore di 0), quindi la proprietà Phone deve corrispondere a un'espressione regolare.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-179">If the Phone property has a value (has a length greater than 0) then the Phone property must match a regular expression.</span></span>
- <span data-ttu-id="0e1bb-180">Se la proprietà del messaggio di posta elettronica ha un valore (ha una lunghezza maggiore di 0), quindi la proprietà di messaggio di posta elettronica deve corrispondere a un'espressione regolare.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-180">If the Email property has a value (has a length greater than 0) then the Email property must match a regular expression.</span></span>

<span data-ttu-id="0e1bb-181">Quando si verifica una violazione delle regole di convalida, viene aggiunto un messaggio di errore per ModelState con l'aiuto del metodo AddModelError().</span><span class="sxs-lookup"><span data-stu-id="0e1bb-181">When there is a validation rule violation, an error message is added to ModelState with the help of the AddModelError() method.</span></span> <span data-ttu-id="0e1bb-182">Quando si aggiunge un messaggio a ModelState, fornire il nome di una proprietà e il testo di un messaggio di errore di convalida.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-182">When you add a message to ModelState, you provide the name of a property and the text of a validation error message.</span></span> <span data-ttu-id="0e1bb-183">Questo messaggio di errore viene visualizzato nella vista dai metodi di supporto Html.ValidationSummary() e Html.ValidationMessage().</span><span class="sxs-lookup"><span data-stu-id="0e1bb-183">This error message is displayed in the view by the Html.ValidationSummary() and Html.ValidationMessage() helper methods.</span></span>

<span data-ttu-id="0e1bb-184">Dopo che vengono eseguite le regole di convalida, viene controllata la proprietà IsValid di ModelState.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-184">After the validation rules are executed, the IsValid property of ModelState is checked.</span></span> <span data-ttu-id="0e1bb-185">La proprietà IsValid restituisce false quando sono stati aggiunti gli eventuali messaggi di errore di convalida per ModelState.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-185">The IsValid property returns false when any validation error messages have been added to ModelState.</span></span> <span data-ttu-id="0e1bb-186">Se la convalida non riesce, viene visualizzata di nuovo il modulo Crea con i messaggi di errore.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-186">If validation fails, the Create form is redisplayed with the error messages.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="0e1bb-187">Ho le espressioni regolari per convalidare l'indirizzo di posta elettronica e numero di telefono dal repository di espressione regolare in [*http://regexlib.com*](http://regexlib.com)</span><span class="sxs-lookup"><span data-stu-id="0e1bb-187">I got the regular expressions for validating the phone number and email address from the regular expression repository at [*http://regexlib.com*](http://regexlib.com)</span></span>


## <a name="adding-validation-logic-to-the-edit-action"></a><span data-ttu-id="0e1bb-188">Aggiunta di logica di convalida per l'azione di modifica</span><span class="sxs-lookup"><span data-stu-id="0e1bb-188">Adding Validation Logic to the Edit Action</span></span>

<span data-ttu-id="0e1bb-189">L'azione Edit() aggiorna un contatto.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-189">The Edit() action updates a Contact.</span></span> <span data-ttu-id="0e1bb-190">L'azione Edit() deve eseguire la stessa convalida l'azione del metodo di creazione.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-190">The Edit() action needs to perform exactly the same validation as the Create() action.</span></span> <span data-ttu-id="0e1bb-191">Anziché ripetere lo stesso codice di convalida, si dovrebbe effettuare il refactoring di controller di contatto in modo che sia il metodo di creazione Edit() azioni chiamare lo stesso metodo di convalida.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-191">Instead of duplicating the same validation code, we should refactor the Contact controller so that both the Create() and Edit() actions call the same validation method.</span></span>

<span data-ttu-id="0e1bb-192">La classe controller contatto modificata è contenuta nel listato 3.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-192">The modified Contact controller class is contained in Listing 3.</span></span> <span data-ttu-id="0e1bb-193">Questa classe è un nuovo metodo ValidateContact() che viene chiamato all'interno di azioni Edit() sia il metodo di creazione.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-193">This class has a new ValidateContact() method that is called within both the Create() and Edit() actions.</span></span>

<span data-ttu-id="0e1bb-194">**Elenco di 3 - Controllers\ContactController.cs**</span><span class="sxs-lookup"><span data-stu-id="0e1bb-194">**Listing 3 - Controllers\ContactController.cs**</span></span>

[!code-csharp[Main](iteration-3-add-form-validation-cs/samples/sample4.cs)]

## <a name="summary"></a><span data-ttu-id="0e1bb-195">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="0e1bb-195">Summary</span></span>

<span data-ttu-id="0e1bb-196">In questa iterazione, abbiamo aggiunto la convalida dei form di base per l'applicazione di gestione di contatto.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-196">In this iteration, we added basic form validation to our Contact Manager application.</span></span> <span data-ttu-id="0e1bb-197">La logica di convalida impedisce l'invio di un nuovo contatto o la modifica di un contatto esistente senza fornire valori per le proprietà FirstName e LastName.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-197">Our validation logic prevents users from submitting a new contact or editing an existing contact without supplying values for the FirstName and LastName properties.</span></span> <span data-ttu-id="0e1bb-198">Inoltre, gli utenti devono fornire gli indirizzi di posta elettronica e numeri di telefono valido.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-198">Furthermore, users must supply valid phone numbers and email addresses.</span></span>

<span data-ttu-id="0e1bb-199">In questa iterazione, la logica di convalida è aggiunto all'applicazione Gestione contatti nel modo più semplice possibile.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-199">In this iteration, we added the validation logic to our Contact Manager application in the easiest way possible.</span></span> <span data-ttu-id="0e1bb-200">Tuttavia, si unisce la logica di convalida la logica di controller creerà problemi per noi a lungo termine.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-200">However, mixing our validation logic into our controller logic will create problems for us in the long term.</span></span> <span data-ttu-id="0e1bb-201">L'applicazione sarà più difficile da gestire e modificare nel tempo.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-201">Our application will be more difficult to maintain and modify over time.</span></span>

<span data-ttu-id="0e1bb-202">Nell'iterazione successiva, è eseguire il refactoring la logica di convalida e la logica di accesso ai database da questo controller.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-202">In the next iteration, we will refactor our validation logic and database access logic out of our controllers.</span></span> <span data-ttu-id="0e1bb-203">Verrà usufruire dei principi di progettazione software diversi per consentirci di creare un'applicazione più regime di controllo e più gestibile.</span><span class="sxs-lookup"><span data-stu-id="0e1bb-203">We'll take advantage of several software design principles to enable us to create a more loosely coupled, and more maintainable, application.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="0e1bb-204">[Precedente](iteration-2-make-the-application-look-nice-cs.md)
> [Successivo](iteration-4-make-the-application-loosely-coupled-cs.md)</span><span class="sxs-lookup"><span data-stu-id="0e1bb-204">[Previous](iteration-2-make-the-application-look-nice-cs.md)
[Next](iteration-4-make-the-application-loosely-coupled-cs.md)</span></span>
