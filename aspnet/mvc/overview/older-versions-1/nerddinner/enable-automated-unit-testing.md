---
uid: mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
title: Abilita automatizzata Unit test | Documenti Microsoft
author: microsoft
description: Passaggio 12 illustra come sviluppare un gruppo di unit test automatizzati per verificare la funzionalità NerdDinner e che ci consentirà di confidenza per apportare modifiche...
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/27/2010
ms.topic: article
ms.assetid: a19ff2ce-3f7e-4358-9a51-a1403da9c63e
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
msc.type: authoredcontent
ms.openlocfilehash: fede08be7e06327c6d04fa5d36f7dd818d79b380
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/06/2018
---
<a name="enable-automated-unit-testing"></a><span data-ttu-id="8ddab-103">Abilitare Unit test automatici</span><span class="sxs-lookup"><span data-stu-id="8ddab-103">Enable Automated Unit Testing</span></span>
====================
<span data-ttu-id="8ddab-104">by [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="8ddab-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="8ddab-105">Scarica il PDF</span><span class="sxs-lookup"><span data-stu-id="8ddab-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="8ddab-106">Si tratta di passaggio 12 della gratuito [esercitazione applicazione "NerdDinner"](introducing-the-nerddinner-tutorial.md) che si interromperanno-through come compilare un piccolo, ma completa, un'applicazione web con ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="8ddab-106">This is step 12 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="8ddab-107">Passaggio 12 illustra come sviluppare un gruppo di unit test automatizzati per verificare la funzionalità NerdDinner e che ci consentirà di confidenza per apportare modifiche e miglioramenti per l'applicazione in futuro.</span><span class="sxs-lookup"><span data-stu-id="8ddab-107">Step 12 shows how to develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>
> 
> <span data-ttu-id="8ddab-108">Se si utilizza ASP.NET MVC 3, è consigliabile seguire il [recupero avviato con MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) o [negozio MVC](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) esercitazioni.</span><span class="sxs-lookup"><span data-stu-id="8ddab-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>


## <a name="nerddinner-step-12-unit-testing"></a><span data-ttu-id="8ddab-109">NerdDinner passaggio 12: Unit test</span><span class="sxs-lookup"><span data-stu-id="8ddab-109">NerdDinner Step 12: Unit Testing</span></span>

<span data-ttu-id="8ddab-110">Consente lo sviluppo di un gruppo di unit test automatizzati per verificare la funzionalità NerdDinner e che ci consentirà di confidenza per apportare modifiche e miglioramenti per l'applicazione in futuro.</span><span class="sxs-lookup"><span data-stu-id="8ddab-110">Let's develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>

### <a name="why-unit-test"></a><span data-ttu-id="8ddab-111">Motivo per cui Unit Test?</span><span class="sxs-lookup"><span data-stu-id="8ddab-111">Why Unit Test?</span></span>

<span data-ttu-id="8ddab-112">Nell'unità di lavoro uno mattina è un improvviso flash di ispirato relative a un'applicazione che si sta lavorando.</span><span class="sxs-lookup"><span data-stu-id="8ddab-112">On the drive into work one morning you have a sudden flash of inspiration about an application you are working on.</span></span> <span data-ttu-id="8ddab-113">Si rende conto viene apportata una modifica è possibile implementare che consentirà l'applicazione notevolmente migliori.</span><span class="sxs-lookup"><span data-stu-id="8ddab-113">You realize there is a change you can implement that will make the application dramatically better.</span></span> <span data-ttu-id="8ddab-114">Potrebbe essere un'operazione di refactoring che pulisce il codice, viene aggiunta una nuova funzionalità o corregge un bug.</span><span class="sxs-lookup"><span data-stu-id="8ddab-114">It might be a refactoring that cleans up the code, adds a new feature, or fixes a bug.</span></span>

<span data-ttu-id="8ddab-115">La domanda che confronts è arrivati a computer in uso è: "modalità provvisoria per rendere questo miglioramento?"</span><span class="sxs-lookup"><span data-stu-id="8ddab-115">The question that confronts you when you arrive at your computer is – "how safe is it to make this improvement?"</span></span> <span data-ttu-id="8ddab-116">Cosa accade se la modifica ha effetti collaterali o interruzioni di un elemento?</span><span class="sxs-lookup"><span data-stu-id="8ddab-116">What if making the change has side effects or breaks something?</span></span> <span data-ttu-id="8ddab-117">La modifica potrebbe essere semplice e richiedere solo alcuni minuti per implementare, ma cosa accade se richiede ore per testare manualmente tutti gli scenari di applicazione?</span><span class="sxs-lookup"><span data-stu-id="8ddab-117">The change might be simple and only take a few minutes to implement, but what if it takes hours to manually test out all of the application scenarios?</span></span> <span data-ttu-id="8ddab-118">Cosa accade se si dimentica di coprire un scenario e un'applicazione passa in produzione?</span><span class="sxs-lookup"><span data-stu-id="8ddab-118">What if you forget to cover a scenario and a broken application goes into production?</span></span> <span data-ttu-id="8ddab-119">Effettua questo miglioramento effettivamente tutti la pena?</span><span class="sxs-lookup"><span data-stu-id="8ddab-119">Is making this improvement really worth all the effort?</span></span>

<span data-ttu-id="8ddab-120">Unit test automatizzati consentono di rete di protezione che consente di migliorare continuamente le proprie applicazioni ed evitando teme il codice che si sta lavorando.</span><span class="sxs-lookup"><span data-stu-id="8ddab-120">Automated unit tests can provide a safety net that enables you to continually enhance your applications, and avoid being afraid of the code you are working on.</span></span> <span data-ttu-id="8ddab-121">Esecuzione con test per verificare rapidamente funzionalità consente di codice con confidenza – e consentono di migliorare i prodotti potrebbe in caso contrario non hanno ritenuto preferisci automatizzati.</span><span class="sxs-lookup"><span data-stu-id="8ddab-121">Having automated tests that quickly verify functionality enables you to code with confidence – and empower you to make improvements you might otherwise not have felt comfortable doing.</span></span> <span data-ttu-id="8ddab-122">Consentono inoltre di creare soluzioni che sono più facili da gestire e hanno una durata più lunga, che garantisce un maggiore dell'utile sugli investimenti.</span><span class="sxs-lookup"><span data-stu-id="8ddab-122">They also help create solutions that are more maintainable and have a longer lifetime - which leads to a much higher return on investment.</span></span>

<span data-ttu-id="8ddab-123">Il Framework di MVC ASP.NET è più semplice e naturale alle funzionalità di unit test dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="8ddab-123">The ASP.NET MVC Framework makes it easy and natural to unit test application functionality.</span></span> <span data-ttu-id="8ddab-124">Consente inoltre di un flusso di lavoro di Test Driven Development (TDD) che consente lo sviluppo basato su test preliminare.</span><span class="sxs-lookup"><span data-stu-id="8ddab-124">It also enables a Test Driven Development (TDD) workflow that enables test-first based development.</span></span>

### <a name="nerddinnertests-project"></a><span data-ttu-id="8ddab-125">NerdDinner.Tests Project</span><span class="sxs-lookup"><span data-stu-id="8ddab-125">NerdDinner.Tests Project</span></span>

<span data-ttu-id="8ddab-126">Quando abbiamo creato l'applicazione NerdDinner all'inizio di questa esercitazione, alla richiesta con una finestra di dialogo che chiede se si desidera creare un progetto di unit test per passare insieme al progetto di applicazione:</span><span class="sxs-lookup"><span data-stu-id="8ddab-126">When we created our NerdDinner application at the beginning of this tutorial, we were prompted with a dialog asking whether we wanted to create a unit test project to go along with the application project:</span></span>

![](enable-automated-unit-testing/_static/image1.png)

<span data-ttu-id="8ddab-127">È stata mantenuta "Sì, crea un progetto di unit test" pulsante di opzione selezionato, che hanno comportato un progetto "NerdDinner.Tests" da aggiungere per la soluzione:</span><span class="sxs-lookup"><span data-stu-id="8ddab-127">We kept the "Yes, create a unit test project" radio button selected – which resulted in a "NerdDinner.Tests" project being added to our solution:</span></span>

![](enable-automated-unit-testing/_static/image2.png)

<span data-ttu-id="8ddab-128">Il progetto NerdDinner.Tests fa riferimento all'assembly del progetto di applicazione NerdDinner e consente di aggiungere facilmente i test automatizzati di cui verificare la funzionalità dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="8ddab-128">The NerdDinner.Tests project references the NerdDinner application project assembly, and enables us to easily add automated tests to it that verify the application functionality.</span></span>

### <a name="creating-unit-tests-for-our-dinner-model-class"></a><span data-ttu-id="8ddab-129">Creazione di Unit test per la classe modello cena</span><span class="sxs-lookup"><span data-stu-id="8ddab-129">Creating Unit Tests for our Dinner Model Class</span></span>

<span data-ttu-id="8ddab-130">Aggiungere alcuni test al progetto NerdDinner.Tests per verificare la classe Dinner creata quando è stato creato il livello del modello.</span><span class="sxs-lookup"><span data-stu-id="8ddab-130">Let's add some tests to our NerdDinner.Tests project that verify the Dinner class we created when we built our model layer.</span></span>

<span data-ttu-id="8ddab-131">Si inizierà creando una nuova cartella all'interno del progetto di test denominato "Modelli" è in cui inserire i test correlati al modello.</span><span class="sxs-lookup"><span data-stu-id="8ddab-131">We'll start by creating a new folder within our test project called "Models" where we'll place our model-related tests.</span></span> <span data-ttu-id="8ddab-132">Verrà quindi pulsante destro del mouse sulla cartella e scegliere il **Add -&gt;nuovo Test** comando di menu.</span><span class="sxs-lookup"><span data-stu-id="8ddab-132">We'll then right-click on the folder and choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="8ddab-133">Verrà visualizzata la finestra di dialogo "Aggiungi nuovo Test".</span><span class="sxs-lookup"><span data-stu-id="8ddab-133">This will bring up the "Add New Test" dialog.</span></span>

<span data-ttu-id="8ddab-134">Verrà scelto creare un "Unit Test" e denominarla "DinnerTest.cs":</span><span class="sxs-lookup"><span data-stu-id="8ddab-134">We'll choose to create a "Unit Test" and name it "DinnerTest.cs":</span></span>

![](enable-automated-unit-testing/_static/image3.png)

<span data-ttu-id="8ddab-135">Quando si fa clic sul pulsante "ok" Visual Studio verrà aggiunto (e aperto) un file DinnerTest.cs al progetto:</span><span class="sxs-lookup"><span data-stu-id="8ddab-135">When we click the "ok" button Visual Studio will add (and open) a DinnerTest.cs file to the project:</span></span>

![](enable-automated-unit-testing/_static/image4.png)

<span data-ttu-id="8ddab-136">Il modello di test predefinito Visual Studio unitario dispone di un gruppo di codice di stampa o editoriale all'interno che è possibile individuare un po' disordinato.</span><span class="sxs-lookup"><span data-stu-id="8ddab-136">The default Visual Studio unit test template has a bunch of boiler-plate code within it that I find a little messy.</span></span> <span data-ttu-id="8ddab-137">Di seguito liberare spazio per contenere solo il codice riportato di seguito:</span><span class="sxs-lookup"><span data-stu-id="8ddab-137">Let's clean it up to just contain the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample1.cs)]

<span data-ttu-id="8ddab-138">Identifica l'attributo [TestClass] sulla classe DinnerTest come una classe che conterrà i test, nonché l'inizializzazione di testing facoltativo e il codice di disinstallazione.</span><span class="sxs-lookup"><span data-stu-id="8ddab-138">The [TestClass] attribute on the DinnerTest class above identifies it as a class that will contain tests, as well as optional test initialization and teardown code.</span></span> <span data-ttu-id="8ddab-139">È possibile definire i test all'interno di esso tramite l'aggiunta di metodi pubblici che hanno un attributo [TestMethod] su di essi.</span><span class="sxs-lookup"><span data-stu-id="8ddab-139">We can define tests within it by adding public methods that have a [TestMethod] attribute on them.</span></span>

<span data-ttu-id="8ddab-140">Di seguito sono il primo di due test verrà aggiunto che utilizzano la classe Dinner.</span><span class="sxs-lookup"><span data-stu-id="8ddab-140">Below are the first of two tests we'll add that exercise our Dinner class.</span></span> <span data-ttu-id="8ddab-141">Il primo test verifica che il nostro Dinner non è valido se viene creato un nuovo Dinner senza tutte le proprietà siano impostate correttamente.</span><span class="sxs-lookup"><span data-stu-id="8ddab-141">The first test verifies that our Dinner is invalid if a new Dinner is created without all properties being set correctly.</span></span> <span data-ttu-id="8ddab-142">Il secondo test verifica che il nostro Dinner è valido quando un Dinner dispone di tutte le proprietà impostate con i valori validi:</span><span class="sxs-lookup"><span data-stu-id="8ddab-142">The second test verifies that our Dinner is valid when a Dinner has all properties set with valid values:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample2.cs)]

<span data-ttu-id="8ddab-143">Si noterà che in precedenza che i nomi di test sono molto esplicite (e in qualche modo dettagliato).</span><span class="sxs-lookup"><span data-stu-id="8ddab-143">You'll notice above that our test names are very explicit (and somewhat verbose).</span></span> <span data-ttu-id="8ddab-144">Ciò viene poiché è possibile finire la creazione di centinaia o migliaia di test di piccole dimensioni e si vuole rendono più facile individuare rapidamente la finalità e il comportamento di ognuno di essi (in particolare quando si analizzi un elenco di errori in un test runner).</span><span class="sxs-lookup"><span data-stu-id="8ddab-144">We are doing this because we might end up creating hundreds or thousands of small tests, and we want to make it easy to quickly determine the intent and behavior of each of them (especially when we are looking through a list of failures in a test runner).</span></span> <span data-ttu-id="8ddab-145">I nomi dei test devono essere denominati dopo la funzionalità che sottoposto a test.</span><span class="sxs-lookup"><span data-stu-id="8ddab-145">The test names should be named after the functionality they are testing.</span></span> <span data-ttu-id="8ddab-146">Sopra si sta usando un "sostantivo\_deve\_verbo" modello di denominazione.</span><span class="sxs-lookup"><span data-stu-id="8ddab-146">Above we are using a "Noun\_Should\_Verb" naming pattern.</span></span>

<span data-ttu-id="8ddab-147">Ci stiamo strutturare i test tramite il modello: è l'acronimo di "Arrange, Act, Assert" test "AAA":</span><span class="sxs-lookup"><span data-stu-id="8ddab-147">We are structuring the tests using the "AAA" testing pattern – which stands for "Arrange, Act, Assert":</span></span>

- <span data-ttu-id="8ddab-148">Disponi: Configurare l'unità sottoposto a test</span><span class="sxs-lookup"><span data-stu-id="8ddab-148">Arrange: Setup the unit being tested</span></span>
- <span data-ttu-id="8ddab-149">ACT: Rispettare l'unità sottoposta a test e acquisire i risultati</span><span class="sxs-lookup"><span data-stu-id="8ddab-149">Act: Exercise the unit under test and capture results</span></span>
- <span data-ttu-id="8ddab-150">Asserzione: Verificare il comportamento</span><span class="sxs-lookup"><span data-stu-id="8ddab-150">Assert: Verify the behavior</span></span>

<span data-ttu-id="8ddab-151">Quando si scrivono test che si desidera evitare che i singoli test eseguire troppo elevato.</span><span class="sxs-lookup"><span data-stu-id="8ddab-151">When we write tests we want to avoid having the individual tests do too much.</span></span> <span data-ttu-id="8ddab-152">Ogni test deve verificare invece solo un singolo concetto (che renderà molto più semplice individuare la causa di errori).</span><span class="sxs-lookup"><span data-stu-id="8ddab-152">Instead each test should verify only a single concept (which will make it much easier to pinpoint the cause of failures).</span></span> <span data-ttu-id="8ddab-153">Buona consiste nel provare e avere solo una singola istruzione per ogni test di asserzione.</span><span class="sxs-lookup"><span data-stu-id="8ddab-153">A good guideline is to try and only have a single assert statement for each test.</span></span> <span data-ttu-id="8ddab-154">Se si dispone di più istruzioni in un metodo di test di asserzione, assicurarsi che sono tutti utilizzati per testare lo stesso concetto.</span><span class="sxs-lookup"><span data-stu-id="8ddab-154">If you have more than one assert statement in a test method, make sure they are all being used to test the same concept.</span></span> <span data-ttu-id="8ddab-155">In caso di dubbi, rendere un altro test.</span><span class="sxs-lookup"><span data-stu-id="8ddab-155">When in doubt, make another test.</span></span>

### <a name="running-tests"></a><span data-ttu-id="8ddab-156">Esecuzione test</span><span class="sxs-lookup"><span data-stu-id="8ddab-156">Running Tests</span></span>

<span data-ttu-id="8ddab-157">Visual Studio 2008 Professional (e versioni successive) includono un programma test runner che può essere utilizzato per eseguire progetti di Visual Studio di Unit Test all'interno dell'IDE.</span><span class="sxs-lookup"><span data-stu-id="8ddab-157">Visual Studio 2008 Professional (and higher editions) includes a built-in test runner that can be used to run Visual Studio Unit Test projects within the IDE.</span></span> <span data-ttu-id="8ddab-158">È possibile selezionare il **Test -&gt;esecuzione -&gt;tutti i test nella soluzione** menu comando (o tipo Ctrl R,) per eseguire tutti i test di unità.</span><span class="sxs-lookup"><span data-stu-id="8ddab-158">We can select the **Test-&gt;Run-&gt;All Tests in Solution** menu command (or type Ctrl R, A) to run all of our unit tests.</span></span> <span data-ttu-id="8ddab-159">Oppure in alternativa è possibile posizionare il cursore all'interno di un metodo di test o di classe di test specifici e utilizzare il **Test -&gt;esecuzione -&gt;test nel contesto corrente** comando di menu (o tipo Ctrl R, T) per eseguire un subset degli unit test.</span><span class="sxs-lookup"><span data-stu-id="8ddab-159">Or alternatively we can position our cursor within a specific test class or test method and use the **Test-&gt;Run-&gt;Tests in Current Context** menu command (or type Ctrl R, T) to run a subset of the unit tests.</span></span>

<span data-ttu-id="8ddab-160">È ora possibile posizionare il cursore all'interno della classe DinnerTest e digitare "Ctrl R, T" per eseguire i due test definita.</span><span class="sxs-lookup"><span data-stu-id="8ddab-160">Let's position our cursor within the DinnerTest class and type "Ctrl R, T" to run the two tests we just defined.</span></span> <span data-ttu-id="8ddab-161">Quando si esegue questa operazione una "finestra Risultati Test" verrà visualizzato all'interno di Visual Studio e verranno esaminati i risultati di test eseguire elencati all'interno di essa:</span><span class="sxs-lookup"><span data-stu-id="8ddab-161">When we do this a "Test Results" window will appear within Visual Studio and we'll see the results of our test run listed within it:</span></span>

![](enable-automated-unit-testing/_static/image5.png)

<span data-ttu-id="8ddab-162">*Nota: La finestra Risultati test di Visual Studio non visualizza la colonna nome della classe per impostazione predefinita. È possibile aggiungere questo facendo clic all'interno della finestra risultati del Test e utilizzando il comando di menu Aggiungi/Rimuovi colonne.*</span><span class="sxs-lookup"><span data-stu-id="8ddab-162">*Note: The VS test results window does not show the Class Name column by default. You can add this by right-clicking within the Test Results window and using the Add/Remove Columns menu command.*</span></span>

<span data-ttu-id="8ddab-163">I due test ha richiesto solo una frazione di secondo per l'esecuzione e come si può vedere entrambi passati.</span><span class="sxs-lookup"><span data-stu-id="8ddab-163">Our two tests took only a fraction of a second to run – and as you can see they both passed.</span></span> <span data-ttu-id="8ddab-164">È possibile passare e li aumentare mediante la creazione di altri test che verifica le convalide di regole specifici, nonché coprire i due metodi helper - IsUserHost() e IsUserRegisterd(): aggiunto alla classe di Dinner.</span><span class="sxs-lookup"><span data-stu-id="8ddab-164">We can now go on and augment them by creating additional tests that verify specific rule validations, as well as cover the two helper methods - IsUserHost() and IsUserRegisterd() – that we added to the Dinner class.</span></span> <span data-ttu-id="8ddab-165">Quando tutti questi test in posizione centralizzata per la classe Dinner renderà molto più semplice e sicuro per aggiungervi nuove regole business e le convalide in futuro.</span><span class="sxs-lookup"><span data-stu-id="8ddab-165">Having all these tests in place for the Dinner class will make it much easier and safer to add new business rules and validations to it in the future.</span></span> <span data-ttu-id="8ddab-166">È possibile aggiungere la nuova logica della regola a cena e quindi verificare che non è stata interrotta la precedente funzionalità logica entro pochi secondi.</span><span class="sxs-lookup"><span data-stu-id="8ddab-166">We can add our new rule logic to Dinner, and then within seconds verify that it hasn't broken any of our previous logic functionality.</span></span>

<span data-ttu-id="8ddab-167">Si noti come utilizzando un nome descrittivo test semplifica comprendere rapidamente cosa si verifica ogni test.</span><span class="sxs-lookup"><span data-stu-id="8ddab-167">Notice how using a descriptive test name makes it easy to quickly understand what each test is verifying.</span></span> <span data-ttu-id="8ddab-168">Si consiglia di utilizzare il **Tools -&gt;opzioni** comando di menu, aprire Strumenti di Test -&gt;schermata di configurazione di esecuzione di Test e verifica il "facendo doppio clic su un risultato del test non riusciti o senza risultati unità Visualizza casella di controllo al punto di errore nel test".</span><span class="sxs-lookup"><span data-stu-id="8ddab-168">I recommend using the **Tools-&gt;Options** menu command, opening the Test Tools-&gt;Test Execution configuration screen, and checking the "Double-clicking a failed or inconclusive unit test result displays the point of failure in the test" checkbox.</span></span> <span data-ttu-id="8ddab-169">In questo modo sarà possibile fare doppio clic su un errore nella finestra dei risultati di test e passare immediatamente all'errore di asserzione.</span><span class="sxs-lookup"><span data-stu-id="8ddab-169">This will allow you to double-click on a failure in the test results window and jump immediately to the assert failure.</span></span>

### <a name="creating-dinnerscontroller-unit-tests"></a><span data-ttu-id="8ddab-170">Creazione di DinnersController Unit test</span><span class="sxs-lookup"><span data-stu-id="8ddab-170">Creating DinnersController Unit Tests</span></span>

<span data-ttu-id="8ddab-171">Creare ora alcuni unit test per verificare la funzionalità DinnersController.</span><span class="sxs-lookup"><span data-stu-id="8ddab-171">Let's now create some unit tests that verify our DinnersController functionality.</span></span> <span data-ttu-id="8ddab-172">Viene innanzitutto facendo clic sulla cartella "Controller" all'interno del progetto di Test e quindi scegliere il **Add -&gt;nuovo Test** comando di menu.</span><span class="sxs-lookup"><span data-stu-id="8ddab-172">We'll start by right-clicking on the "Controllers" folder within our Test project and then choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="8ddab-173">Viene creato uno "Unit Test" e denominarla "DinnersControllerTest.cs".</span><span class="sxs-lookup"><span data-stu-id="8ddab-173">We'll create a "Unit Test" and name it "DinnersControllerTest.cs".</span></span>

<span data-ttu-id="8ddab-174">Verranno create due metodi di test che verificano il metodo di azione Details() sul DinnersController.</span><span class="sxs-lookup"><span data-stu-id="8ddab-174">We'll create two test methods that verify the Details() action method on the DinnersController.</span></span> <span data-ttu-id="8ddab-175">Il primo consente di verificare che una vista viene restituita quando viene richiesto un Dinner esistente.</span><span class="sxs-lookup"><span data-stu-id="8ddab-175">The first will verify that a View is returned when an existing Dinner is requested.</span></span> <span data-ttu-id="8ddab-176">Il secondo verificherà che una visualizzazione "NotFound" viene restituita quando viene richiesto un Dinner inesistente:</span><span class="sxs-lookup"><span data-stu-id="8ddab-176">The second will verify that a "NotFound" view is returned when a non-existent Dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample3.cs)]

<span data-ttu-id="8ddab-177">Il codice sopra riportato compila pulito.</span><span class="sxs-lookup"><span data-stu-id="8ddab-177">The above code compiles clean.</span></span> <span data-ttu-id="8ddab-178">Quando si esegue il test, tuttavia, hanno entrambi esito negativo:</span><span class="sxs-lookup"><span data-stu-id="8ddab-178">When we run the tests, though, they both fail:</span></span>

![](enable-automated-unit-testing/_static/image6.png)

<span data-ttu-id="8ddab-179">Esaminare i messaggi di errore, si vedrà che il test abbia avuto esito negativo è perché la classe DinnersRepository non è riuscita a connettersi a un database.</span><span class="sxs-lookup"><span data-stu-id="8ddab-179">If we look at the error messages, we'll see that the reason the tests failed was because our DinnersRepository class was unable to connect to a database.</span></span> <span data-ttu-id="8ddab-180">L'applicazione NerdDinner utilizza una stringa di connessione in un file locale di SQL Server Express che si trova sotto il \App\_directory dei dati del progetto di applicazione NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="8ddab-180">Our NerdDinner application is using a connection-string to a local SQL Server Express file which lives under the \App\_Data directory of the NerdDinner application project.</span></span> <span data-ttu-id="8ddab-181">Poiché il progetto NerdDinner.Tests compilato ed eseguito in una directory diversa quindi il progetto di applicazione, il percorso relativo della stringa di connessione non è corretto.</span><span class="sxs-lookup"><span data-stu-id="8ddab-181">Because our NerdDinner.Tests project compiles and runs in a different directory then the application project, the relative path location of our connection-string is incorrect.</span></span>

<span data-ttu-id="8ddab-182">Abbiamo *Impossibile* risolvere il problema, copiare il file di database SQL Express per il progetto di test e quindi aggiungervi una stringa di connessione appropriato di test di App. config del progetto test.</span><span class="sxs-lookup"><span data-stu-id="8ddab-182">We *could* fix this by copying the SQL Express database file to our test project, and then add an appropriate test connection-string to it in the App.config of our test project.</span></span> <span data-ttu-id="8ddab-183">Si potrebbe ottenere questi test sbloccato e in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="8ddab-183">This would get the above tests unblocked and running.</span></span>

<span data-ttu-id="8ddab-184">Unit test del codice con un database reale, tuttavia, è accompagnata da una serie di difficoltà.</span><span class="sxs-lookup"><span data-stu-id="8ddab-184">Unit testing code using a real database, though, brings with it a number of challenges.</span></span> <span data-ttu-id="8ddab-185">In particolare:</span><span class="sxs-lookup"><span data-stu-id="8ddab-185">Specifically:</span></span>

- <span data-ttu-id="8ddab-186">Rallenta notevolmente il tempo di esecuzione di unit test.</span><span class="sxs-lookup"><span data-stu-id="8ddab-186">It significantly slows down the execution time of unit tests.</span></span> <span data-ttu-id="8ddab-187">Il tempo necessario per eseguire i test, minore probabilità che vengano eseguite di frequente.</span><span class="sxs-lookup"><span data-stu-id="8ddab-187">The longer it takes to run tests, the less likely you are to execute them frequently.</span></span> <span data-ttu-id="8ddab-188">Idealmente si desidera che gli unit test per poter essere eseguiti in secondi e fare in modo essere è eseguire come naturalmente come la compilazione del progetto.</span><span class="sxs-lookup"><span data-stu-id="8ddab-188">Ideally you want your unit tests to be able to be run in seconds – and have it be something you do as naturally as compiling the project.</span></span>
- <span data-ttu-id="8ddab-189">Rende più difficile la logica di programma di installazione e pulizia all'interno di test.</span><span class="sxs-lookup"><span data-stu-id="8ddab-189">It complicates the setup and cleanup logic within tests.</span></span> <span data-ttu-id="8ddab-190">Si desidera che ogni unit test per essere isolato e indipendente dalle altre (senza effetti collaterali o con dipendenze).</span><span class="sxs-lookup"><span data-stu-id="8ddab-190">You want each unit test to be isolated and independent of others (with no side effects or dependencies).</span></span> <span data-ttu-id="8ddab-191">Quando si lavora su un database reale che è necessario tenere conto dello stato e ripristinare le impostazioni tra i test.</span><span class="sxs-lookup"><span data-stu-id="8ddab-191">When working against a real database you have to be mindful of state and reset it between tests.</span></span>

<span data-ttu-id="8ddab-192">Esaminiamo un modello di struttura denominato "inserimento di dipendenze" che è possibile contribuire a risolvere questi problemi ed evitare la necessità di utilizzare un database reale con i test.</span><span class="sxs-lookup"><span data-stu-id="8ddab-192">Let's look at a design pattern called "dependency injection" that can help us work around these issues and avoid the need to use a real database with our tests.</span></span>

### <a name="dependency-injection"></a><span data-ttu-id="8ddab-193">Inserimento di dipendenze</span><span class="sxs-lookup"><span data-stu-id="8ddab-193">Dependency Injection</span></span>

<span data-ttu-id="8ddab-194">Ora DinnersController è strettamente "a" alla classe DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="8ddab-194">Right now DinnersController is tightly "coupled" to the DinnerRepository class.</span></span> <span data-ttu-id="8ddab-195">"Associazione" si riferisce a una situazione in cui una classe in modo esplicito si basa su un'altra classe per poter funzionare:</span><span class="sxs-lookup"><span data-stu-id="8ddab-195">"Coupling" refers to a situation where a class explicitly relies on another class in order to work:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample4.cs)]

<span data-ttu-id="8ddab-196">Poiché la classe DinnerRepository richiede l'accesso a un database, la dipendenza fortemente accoppiata la classe DinnersController ha alle estremità DinnerRepository le necessità di disporre di un database in modo che i metodi di azione DinnersController da testare.</span><span class="sxs-lookup"><span data-stu-id="8ddab-196">Because the DinnerRepository class requires access to a database, the tightly coupled dependency the DinnersController class has on the DinnerRepository ends up requiring us to have a database in order for the DinnersController action methods to be tested.</span></span>

<span data-ttu-id="8ddab-197">È possibile ottenere il problema, è necessario distribuire un modello di struttura denominato "inserimento di dipendenze:" che è un approccio in cui le dipendenze (ad esempio le classi di repository che forniscono accesso ai dati) non è più in modo implicito vengono create all'interno di classi che li utilizzano.</span><span class="sxs-lookup"><span data-stu-id="8ddab-197">We can get around this by employing a design pattern called "dependency injection" – which is an approach where dependencies (like repository classes that provide data access) are no longer implicitly created within classes that use them.</span></span> <span data-ttu-id="8ddab-198">Al contrario, le dipendenze possono essere passate in modo esplicito alla classe in cui vengono utilizzati con gli argomenti del costruttore.</span><span class="sxs-lookup"><span data-stu-id="8ddab-198">Instead, dependencies can be explicitly passed to the class that uses them using constructor arguments.</span></span> <span data-ttu-id="8ddab-199">Se le dipendenze vengono definite utilizzando le interfacce, è necessario disporre della flessibilità di passare in implementazioni di dipendenza "false" per gli scenari di unit test.</span><span class="sxs-lookup"><span data-stu-id="8ddab-199">If the dependencies are defined using interfaces, we then have the flexibility to pass in "fake" dependency implementations for unit test scenarios.</span></span> <span data-ttu-id="8ddab-200">In questo modo sarà possibile creare le implementazioni di dipendenza specifiche che in realtà non richiedono l'accesso a un database.</span><span class="sxs-lookup"><span data-stu-id="8ddab-200">This enables us to create test-specific dependency implementations that do not actually require access to a database.</span></span>

<span data-ttu-id="8ddab-201">Per vedere un esempio pratico, si implementa l'inserimento di dipendenze con il nostro DinnersController.</span><span class="sxs-lookup"><span data-stu-id="8ddab-201">To see this in action, let's implement dependency injection with our DinnersController.</span></span>

#### <a name="extracting-an-idinnerrepository-interface"></a><span data-ttu-id="8ddab-202">Estrazione di un'interfaccia IDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="8ddab-202">Extracting an IDinnerRepository interface</span></span>

<span data-ttu-id="8ddab-203">Il primo passaggio è necessario creare una nuova interfaccia IDinnerRepository che incapsula il controller necessari per recuperare e aggiornare Dinners il contratto di repository.</span><span class="sxs-lookup"><span data-stu-id="8ddab-203">Our first step will be to create a new IDinnerRepository interface that encapsulates the repository contract our controllers require to retrieve and update Dinners.</span></span>

<span data-ttu-id="8ddab-204">È possibile definire questa interfaccia di contratto manualmente facendo clic sulla cartella \Models, e quindi scegliendo il **Add -&gt;nuovo elemento** comando di menu e la creazione di una nuova interfaccia denominata IDinnerRepository.cs.</span><span class="sxs-lookup"><span data-stu-id="8ddab-204">We can define this interface contract manually by right-clicking on the \Models folder, and then choosing the **Add-&gt;New Item** menu command and creating a new interface named IDinnerRepository.cs.</span></span>

<span data-ttu-id="8ddab-205">In alternativa è possibile usare il refactoring automaticamente compilato in Visual Studio Professional strumenti (e versioni successive) per estrarre e creare un'interfaccia per noi dalla classe DinnerRepository esistente.</span><span class="sxs-lookup"><span data-stu-id="8ddab-205">Alternatively we can use the refactoring tools built-into Visual Studio Professional (and higher editions) to automatically extract and create an interface for us from our existing DinnerRepository class.</span></span> <span data-ttu-id="8ddab-206">Per estrarre l'interfaccia usando Visual Studio, è sufficiente posizionare il cursore nell'editor di testo sulla classe DinnerRepository, quindi fare doppio clic su e scegliere il **refactoring -&gt;Estrai interfaccia** comando di menu:</span><span class="sxs-lookup"><span data-stu-id="8ddab-206">To extract this interface using VS, simply position the cursor in the text editor on the DinnerRepository class, and then right-click and choose the **Refactor-&gt;Extract Interface** menu command:</span></span>

![](enable-automated-unit-testing/_static/image7.png)

<span data-ttu-id="8ddab-207">Verrà aperta la finestra di dialogo "Estrai interfaccia" e ci richiedere il nome dell'interfaccia da creare.</span><span class="sxs-lookup"><span data-stu-id="8ddab-207">This will launch the "Extract Interface" dialog and prompt us for the name of the interface to create.</span></span> <span data-ttu-id="8ddab-208">Verrà IDinnerRepository per impostazione predefinita e selezionare automaticamente tutti i metodi pubblici della classe DinnerRepository esistente da aggiungere all'interfaccia:</span><span class="sxs-lookup"><span data-stu-id="8ddab-208">It will default to IDinnerRepository and automatically select all public methods on the existing DinnerRepository class to add to the interface:</span></span>

![](enable-automated-unit-testing/_static/image8.png)

<span data-ttu-id="8ddab-209">Quando si fa clic sul pulsante "ok", Visual Studio aggiungerà una nuova interfaccia IDinnerRepository all'applicazione:</span><span class="sxs-lookup"><span data-stu-id="8ddab-209">When we click the "ok" button, Visual Studio will add a new IDinnerRepository interface to our application:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample5.cs)]

<span data-ttu-id="8ddab-210">E la classe DinnerRepository esistente verrà aggiornata in modo che implementi l'interfaccia:</span><span class="sxs-lookup"><span data-stu-id="8ddab-210">And our existing DinnerRepository class will be updated so that it implements the interface:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample6.cs)]

#### <a name="updating-dinnerscontroller-to-support-constructor-injection"></a><span data-ttu-id="8ddab-211">Aggiornamento DinnersController per supportare l'inserimento del costruttore</span><span class="sxs-lookup"><span data-stu-id="8ddab-211">Updating DinnersController to support constructor injection</span></span>

<span data-ttu-id="8ddab-212">A questo punto verrà aggiornata la classe DinnersController per utilizzare la nuova interfaccia.</span><span class="sxs-lookup"><span data-stu-id="8ddab-212">We'll now update the DinnersController class to use the new interface.</span></span>

<span data-ttu-id="8ddab-213">Attualmente DinnersController è codificato in modo che il campo "dinnerRepository" è sempre una classe DinnerRepository:</span><span class="sxs-lookup"><span data-stu-id="8ddab-213">Currently DinnersController is hard-coded such that its "dinnerRepository" field is always a DinnerRepository class:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample7.cs)]

<span data-ttu-id="8ddab-214">E verranno modificate in modo che il campo "dinnerRepository" è di tipo IDinnerRepository anziché DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="8ddab-214">We'll change it so that the "dinnerRepository" field is of type IDinnerRepository instead of DinnerRepository.</span></span> <span data-ttu-id="8ddab-215">Verrà quindi aggiunto due costruttori DinnersController pubblici.</span><span class="sxs-lookup"><span data-stu-id="8ddab-215">We'll then add two public DinnersController constructors.</span></span> <span data-ttu-id="8ddab-216">Uno dei costruttori consente un IDinnerRepository deve essere passato come argomento.</span><span class="sxs-lookup"><span data-stu-id="8ddab-216">One of the constructors allows an IDinnerRepository to be passed as an argument.</span></span> <span data-ttu-id="8ddab-217">L'altro è un costruttore predefinito che utilizza l'implementazione di DinnerRepository esistente:</span><span class="sxs-lookup"><span data-stu-id="8ddab-217">The other is a default constructor that uses our existing DinnerRepository implementation:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample8.cs)]

<span data-ttu-id="8ddab-218">Poiché ASP.NET MVC per impostazione predefinita crea classi controller utilizzando i costruttori predefiniti, i nostri DinnersController in fase di esecuzione continuerà a utilizzare la classe DinnerRepository per eseguire l'accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="8ddab-218">Because ASP.NET MVC by default creates controller classes using default constructors, our DinnersController at runtime will continue to use the DinnerRepository class to perform data access.</span></span>

<span data-ttu-id="8ddab-219">È ora possibile aggiornare il nostro unit test, tuttavia, per passare in un'implementazione di repository dinner "fittizio" utilizzando il parametro di costruttore.</span><span class="sxs-lookup"><span data-stu-id="8ddab-219">We can now update our unit tests, though, to pass in a "fake" dinner repository implementation using the parameter constructor.</span></span> <span data-ttu-id="8ddab-220">Questo repository "fittizio" dinner invece utilizzare dati di esempio in memoria non richiedono l'accesso a un database reale.</span><span class="sxs-lookup"><span data-stu-id="8ddab-220">This "fake" dinner repository will not require access to a real database, and instead will use in-memory sample data.</span></span>

#### <a name="creating-the-fakedinnerrepository-class"></a><span data-ttu-id="8ddab-221">Creazione della classe FakeDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="8ddab-221">Creating the FakeDinnerRepository class</span></span>

<span data-ttu-id="8ddab-222">È possibile creare una classe FakeDinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="8ddab-222">Let's create a FakeDinnerRepository class.</span></span>

<span data-ttu-id="8ddab-223">Viene innanzitutto la creazione di una directory "Fakes" all'interno del progetto NerdDinner.Tests e quindi aggiungere una nuova classe FakeDinnerRepository (fare doppio clic sulla cartella e scegliere **Add -&gt;nuova classe**):</span><span class="sxs-lookup"><span data-stu-id="8ddab-223">We'll begin by creating a "Fakes" directory within our NerdDinner.Tests project and then add a new FakeDinnerRepository class to it (right-click on the folder and choose **Add-&gt;New Class**):</span></span>

![](enable-automated-unit-testing/_static/image9.png)

<span data-ttu-id="8ddab-224">Il codice verrà aggiornata in modo che la classe FakeDinnerRepository implementa l'interfaccia IDinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="8ddab-224">We'll update the code so that the FakeDinnerRepository class implements the IDinnerRepository interface.</span></span> <span data-ttu-id="8ddab-225">È quindi possibile fare doppio clic su di esso e scegliere il comando del menu contestuale "Implementa interfaccia IDinnerRepository":</span><span class="sxs-lookup"><span data-stu-id="8ddab-225">We can then right-click on it and choose the "Implement interface IDinnerRepository" context menu command:</span></span>

![](enable-automated-unit-testing/_static/image10.png)

<span data-ttu-id="8ddab-226">In questo modo Visual Studio aggiungere automaticamente tutti i membri di interfaccia IDinnerRepository alla classe FakeDinnerRepository con implementazioni "stub out" predefinite:</span><span class="sxs-lookup"><span data-stu-id="8ddab-226">This will cause Visual Studio to automatically add all of the IDinnerRepository interface members to our FakeDinnerRepository class with default "stub out" implementations:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample9.cs)]

<span data-ttu-id="8ddab-227">È quindi possibile aggiornare l'implementazione di FakeDinnerRepository funzionamento di fuori di un elenco in memoria&lt;Dinner&gt; raccolta passata come argomento costruttore:</span><span class="sxs-lookup"><span data-stu-id="8ddab-227">We can then update the FakeDinnerRepository implementation to work off of an in-memory List&lt;Dinner&gt; collection passed to it as a constructor argument:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample10.cs)]

<span data-ttu-id="8ddab-228">È ora disponibile un'implementazione IDinnerRepository falsa che non richiede un database e può funzionare invece un elenco in memoria degli oggetti Dinner.</span><span class="sxs-lookup"><span data-stu-id="8ddab-228">We now have a fake IDinnerRepository implementation that does not require a database, and can instead work off an in-memory list of Dinner objects.</span></span>

#### <a name="using-the-fakedinnerrepository-with-unit-tests"></a><span data-ttu-id="8ddab-229">Utilizzo di FakeDinnerRepository con Unit test</span><span class="sxs-lookup"><span data-stu-id="8ddab-229">Using the FakeDinnerRepository with Unit Tests</span></span>

<span data-ttu-id="8ddab-230">Torniamo per gli unit test di DinnersController che non è riuscita in precedenza perché il database non era disponibile.</span><span class="sxs-lookup"><span data-stu-id="8ddab-230">Let's return to the DinnersController unit tests that failed earlier because the database wasn't available.</span></span> <span data-ttu-id="8ddab-231">È possibile aggiornare i metodi di test per l'utilizzo di un FakeDinnerRepository popolate con dati cena in memoria per il DinnersController utilizzando il codice riportato di seguito:</span><span class="sxs-lookup"><span data-stu-id="8ddab-231">We can update the test methods to use a FakeDinnerRepository populated with sample in-memory Dinner data to the DinnersController using the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample11.cs)]

<span data-ttu-id="8ddab-232">E, quando si eseguono questi test sono entrambi passare:</span><span class="sxs-lookup"><span data-stu-id="8ddab-232">And now when we run these tests they both pass:</span></span>

![](enable-automated-unit-testing/_static/image11.png)

<span data-ttu-id="8ddab-233">Soprattutto, richiedere solo una frazione di secondo per l'esecuzione e non richiedono alcuna logica di pulizia o l'installazione complessa.</span><span class="sxs-lookup"><span data-stu-id="8ddab-233">Best of all, they take only a fraction of a second to run, and do not require any complicated setup/cleanup logic.</span></span> <span data-ttu-id="8ddab-234">È possibile ora unit test tutto il codice di metodo di azione DinnersController (elenco di inclusa, paging, dettagli, creare, aggiornare ed eliminare) senza dover fare per connettersi a un database reale.</span><span class="sxs-lookup"><span data-stu-id="8ddab-234">We can now unit test all of our DinnersController action method code (including listing, paging, details, create, update and delete) without ever needing to connect to a real database.</span></span>

| <span data-ttu-id="8ddab-235">**Lato dell'argomento: Framework di Injection dipendenza**</span><span class="sxs-lookup"><span data-stu-id="8ddab-235">**Side Topic: Dependency Injection Frameworks**</span></span> |
| --- |
| <span data-ttu-id="8ddab-236">Esegue l'inserimento delle dipendenze manuale (ad esempio, ci sono di sopra) funziona correttamente, ma diventa più difficile da gestire come il numero di dipendenze e componenti in un'applicazione aumenta.</span><span class="sxs-lookup"><span data-stu-id="8ddab-236">Performing manual dependency injection (like we are above) works fine, but does become harder to maintain as the number of dependencies and components in an application increases.</span></span> <span data-ttu-id="8ddab-237">Sono disponibili più Framework di inserimento di dipendenza per .NET che consentono di fornire una maggiore flessibilità di gestione di dipendenza.</span><span class="sxs-lookup"><span data-stu-id="8ddab-237">Several dependency injection frameworks exist for .NET that can help provide even more dependency management flexibility.</span></span> <span data-ttu-id="8ddab-238">Questi Framework, anche detti contenitori "Inversion of Control" (IoC), forniscono meccanismi che consentano di un ulteriore livello di supporto della configurazione per l'impostazione e il passaggio di dipendenze per gli oggetti in fase di esecuzione (in genere tramite inserimento del costruttore ).</span><span class="sxs-lookup"><span data-stu-id="8ddab-238">These frameworks, also sometimes called "Inversion of Control" (IoC) containers, provide mechanisms that enable an additional level of configuration support for specifying and passing dependencies to objects at runtime (most often using constructor injection).</span></span> <span data-ttu-id="8ddab-239">Alcune delle più comuni inserimento di dipendenze di sistemi operativi / Framework di inversione di controllo in .NET: AutoFac, Ninject, Spring.NET, StructureMap e Windsor.</span><span class="sxs-lookup"><span data-stu-id="8ddab-239">Some of the more popular OSS Dependency Injection / IOC frameworks in .NET include: AutoFac, Ninject, Spring.NET, StructureMap, and Windsor.</span></span> <span data-ttu-id="8ddab-240">ASP.NET MVC espone API che consentono agli sviluppatori di partecipare alla risoluzione e la creazione di un'istanza del controller e che consente l'inserimento di dipendenze di estendibilità / Framework IoC integrare correttamente all'interno di questo processo.</span><span class="sxs-lookup"><span data-stu-id="8ddab-240">ASP.NET MVC exposes extensibility APIs that enable developers to participate in the resolution and instantiation of controllers, and which enables Dependency Injection / IoC frameworks to be cleanly integrated within this process.</span></span> <span data-ttu-id="8ddab-241">Utilizzare un framework DI/IOC sarebbe consentono inoltre di rimuovere il costruttore predefinito dal nostro DinnersController – cui verrebbe rimuovere completamente l'accoppiamento tra i file e il DinnerRepositorys.</span><span class="sxs-lookup"><span data-stu-id="8ddab-241">Using a DI/IOC framework would also enable us to remove the default constructor from our DinnersController – which would completely remove the coupling between it and the DinnerRepositorys.</span></span> <span data-ttu-id="8ddab-242">Si prevede di usare un inserimento di dipendenze / framework IOC con l'applicazione NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="8ddab-242">We won't be using a dependency injection / IOC framework with our NerdDinner application.</span></span> <span data-ttu-id="8ddab-243">Ma è un elemento che è stato possibile prendere in considerazione per il futuro se le funzionalità base di codice NerdDinner aumento delle dimensioni.</span><span class="sxs-lookup"><span data-stu-id="8ddab-243">But it is something we could consider for the future if the NerdDinner code-base and capabilities grew.</span></span> |

### <a name="creating-edit-action-unit-tests"></a><span data-ttu-id="8ddab-244">Creazione di Unit test azione di modifica</span><span class="sxs-lookup"><span data-stu-id="8ddab-244">Creating Edit Action Unit Tests</span></span>

<span data-ttu-id="8ddab-245">Creare ora alcuni unit test per verificare la funzionalità di modifica del DinnersController.</span><span class="sxs-lookup"><span data-stu-id="8ddab-245">Let's now create some unit tests that verify the Edit functionality of the DinnersController.</span></span> <span data-ttu-id="8ddab-246">Inizieremo con la versione di HTTP-GET l'azione di modifica di test:</span><span class="sxs-lookup"><span data-stu-id="8ddab-246">We'll start by testing the HTTP-GET version of our Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample12.cs)]

<span data-ttu-id="8ddab-247">Si creerà un test che verifica che una vista supportata da un oggetto DinnerFormViewModel viene eseguito il rendering quando viene richiesto un dinner valido:</span><span class="sxs-lookup"><span data-stu-id="8ddab-247">We'll create a test that verifies that a View backed by a DinnerFormViewModel object is rendered back when a valid dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample13.cs)]

<span data-ttu-id="8ddab-248">Quando si esegue il test, tuttavia, verrà individuato che abbia esito negativo perché viene generata un'eccezione di riferimento null quando il metodo di modifica accede alla proprietà User.Identity.Name per eseguire il controllo Dinner.IsHostedBy().</span><span class="sxs-lookup"><span data-stu-id="8ddab-248">When we run the test, though, we'll find that it fails because a null reference exception is thrown when the Edit method accesses the User.Identity.Name property to perform the Dinner.IsHostedBy() check.</span></span>

<span data-ttu-id="8ddab-249">L'oggetto utente nella classe di base Controller incapsula i dettagli relativi all'utente connesso e viene popolato da MVC ASP.NET quando crea il controller in fase di esecuzione.</span><span class="sxs-lookup"><span data-stu-id="8ddab-249">The User object on the Controller base class encapsulates details about the logged-in user, and is populated by ASP.NET MVC when it creates the controller at runtime.</span></span> <span data-ttu-id="8ddab-250">Poiché il DinnersController all'esterno di un ambiente server web sottoposti a test, non è impostato l'oggetto utente (pertanto l'eccezione riferimento null).</span><span class="sxs-lookup"><span data-stu-id="8ddab-250">Because we are testing the DinnersController outside of a web-server environment, the User object isn't set (hence the null reference exception).</span></span>

### <a name="mocking-the-useridentityname-property"></a><span data-ttu-id="8ddab-251">Tali proprietà User.Identity.Name</span><span class="sxs-lookup"><span data-stu-id="8ddab-251">Mocking the User.Identity.Name property</span></span>

<span data-ttu-id="8ddab-252">Framework di simulazione per facilitare il testing, consentendo di creare dinamicamente false versioni degli oggetti dipendenti che supportano i test.</span><span class="sxs-lookup"><span data-stu-id="8ddab-252">Mocking frameworks make testing easier by enabling us to dynamically create fake versions of dependent objects that support our tests.</span></span> <span data-ttu-id="8ddab-253">Ad esempio, è possibile utilizzare un framework di simulazione al test di azione di modifica per creare dinamicamente un oggetto utente che il nostro DinnersController è possibile utilizzare per cercare un nome utente simulato.</span><span class="sxs-lookup"><span data-stu-id="8ddab-253">For example, we can use a mocking framework in our Edit action test to dynamically create a User object that our DinnersController can use to lookup a simulated username.</span></span> <span data-ttu-id="8ddab-254">Questo modo si evita un riferimento null viene generata quando si esegue il test.</span><span class="sxs-lookup"><span data-stu-id="8ddab-254">This will avoid a null reference from being thrown when we run our test.</span></span>

<span data-ttu-id="8ddab-255">Esistono molti .NET tali Framework che può essere utilizzato con ASP.NET MVC da (è possibile visualizzare un elenco di queste impostazioni qui: [ http://www.mockframeworks.com/ ](http://www.mockframeworks.com/)).</span><span class="sxs-lookup"><span data-stu-id="8ddab-255">There are many .NET mocking frameworks that can be used with ASP.NET MVC (you can see a list of them here: [http://www.mockframeworks.com/](http://www.mockframeworks.com/)).</span></span> <span data-ttu-id="8ddab-256">Per il test dell'applicazione NerdDinner si userà un open-source mocking framework denominato "Moq", che può essere scaricato gratuitamente dal [ http://www.mockframeworks.com/moq ](http://www.mockframeworks.com/moq).</span><span class="sxs-lookup"><span data-stu-id="8ddab-256">For testing our NerdDinner application we'll use an open source mocking framework called "Moq", which can be downloaded for free from [http://www.mockframeworks.com/moq](http://www.mockframeworks.com/moq).</span></span>

<span data-ttu-id="8ddab-257">Una volta scaricato, verrà aggiunto un riferimento nel progetto NerdDinner.Tests all'assembly Moq.dll:</span><span class="sxs-lookup"><span data-stu-id="8ddab-257">Once downloaded, we'll add a reference in our NerdDinner.Tests project to the Moq.dll assembly:</span></span>

![](enable-automated-unit-testing/_static/image12.png)

<span data-ttu-id="8ddab-258">Si aggiungerà quindi un metodo di supporto "CreateDinnersControllerAs(username)" per la classe di test che accetta un nome utente come parametro e che quindi la proprietà User.Identity.Name nell'istanza DinnersController "mocks":</span><span class="sxs-lookup"><span data-stu-id="8ddab-258">We'll then add a "CreateDinnersControllerAs(username)" helper method to our test class that takes a username as a parameter, and which then "mocks" the User.Identity.Name property on the DinnersController instance:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample14.cs)]

<span data-ttu-id="8ddab-259">Moq sopra viene utilizzato per creare un oggetto fittizi che fakes un oggetto ControllerContext (ossia quali ASP.NET MVC passa alle classi Controller per esporre gli oggetti di runtime come utente, richiesta, risposta e sessione).</span><span class="sxs-lookup"><span data-stu-id="8ddab-259">Above we are using Moq to create a Mock object that fakes a ControllerContext object (which is what ASP.NET MVC passes to Controller classes to expose runtime objects like User, Request, Response, and Session).</span></span> <span data-ttu-id="8ddab-260">Si sta chiamando il metodo "SetupGet" per la simulazione per indicare che la proprietà HttpContext.User.Identity.Name ControllerContext deve restituire la stringa del nome utente che è passati al metodo di supporto.</span><span class="sxs-lookup"><span data-stu-id="8ddab-260">We are calling the "SetupGet" method on the Mock to indicate that the HttpContext.User.Identity.Name property on ControllerContext should return the username string we passed to the helper method.</span></span>

<span data-ttu-id="8ddab-261">È possibile simulare un numero qualsiasi di metodi e proprietà ControllerContext.</span><span class="sxs-lookup"><span data-stu-id="8ddab-261">We can mock any number of ControllerContext properties and methods.</span></span> <span data-ttu-id="8ddab-262">Per illustrare questo concetto è stata aggiunta anche una chiamata di SetupGet() per la proprietà Request.IsAuthenticated (che non è effettivamente necessaria per i test seguenti: ma che consente di illustrare come è possibile simulare le proprietà delle richieste).</span><span class="sxs-lookup"><span data-stu-id="8ddab-262">To illustrate this I've also added a SetupGet() call for the Request.IsAuthenticated property (which isn't actually needed for the tests below – but which helps illustrate how you can mock Request properties).</span></span> <span data-ttu-id="8ddab-263">Al termine è assegnare un'istanza della simulazione ControllerContext per il DinnersController restituisce il metodo di supporto.</span><span class="sxs-lookup"><span data-stu-id="8ddab-263">When we are done we assign an instance of the ControllerContext mock to the DinnersController our helper method returns.</span></span>

<span data-ttu-id="8ddab-264">In questo punto, è possibile scrivere unit test che utilizzano questo metodo di supporto per testare gli scenari di modifica che interessa diversi utenti:</span><span class="sxs-lookup"><span data-stu-id="8ddab-264">We can now write unit tests that use this helper method to test Edit scenarios involving different users:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample15.cs)]

<span data-ttu-id="8ddab-265">E ora quando si eseguono i test vengono superati:</span><span class="sxs-lookup"><span data-stu-id="8ddab-265">And now when we run the tests they pass:</span></span>

![](enable-automated-unit-testing/_static/image13.png)

### <a name="testing-updatemodel-scenarios"></a><span data-ttu-id="8ddab-266">Scenari di test UpdateModel()</span><span class="sxs-lookup"><span data-stu-id="8ddab-266">Testing UpdateModel() scenarios</span></span>

<span data-ttu-id="8ddab-267">Abbiamo creato i test che coprono la versione HTTP-GET dell'azione di modifica.</span><span class="sxs-lookup"><span data-stu-id="8ddab-267">We've created tests that cover the HTTP-GET version of the Edit action.</span></span> <span data-ttu-id="8ddab-268">Creare ora alcuni test che verificano la versione HTTP-POST dell'azione di modifica:</span><span class="sxs-lookup"><span data-stu-id="8ddab-268">Let's now create some tests that verify the HTTP-POST version of the Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample16.cs)]

<span data-ttu-id="8ddab-269">Lo scenario di test nuove interessano a Microsoft per supporto con questo metodo di azione è l'utilizzo del metodo UpdateModel() helper nella classe di base Controller.</span><span class="sxs-lookup"><span data-stu-id="8ddab-269">The interesting new testing scenario for us to support with this action method is its usage of the UpdateModel() helper method on the Controller base class.</span></span> <span data-ttu-id="8ddab-270">Si sta usando questo metodo di supporto per associare i valori di post dei form per l'istanza dell'oggetto Dinner.</span><span class="sxs-lookup"><span data-stu-id="8ddab-270">We are using this helper method to bind form-post values to our Dinner object instance.</span></span>

<span data-ttu-id="8ddab-271">Di seguito sono due test che dimostra come sia possibile fornire modulo inviato i valori per il metodo helper UpdateModel() da utilizzare.</span><span class="sxs-lookup"><span data-stu-id="8ddab-271">Below are two tests that demonstrates how we can supply form posted values for the UpdateModel() helper method to use.</span></span> <span data-ttu-id="8ddab-272">È sarà questo scopo, creare e popolare un oggetto FormCollection e quindi assegnarlo alla proprietà "ValueProvider" nel Controller.</span><span class="sxs-lookup"><span data-stu-id="8ddab-272">We'll do this by creating and populating a FormCollection object, and then assign it to the "ValueProvider" property on the Controller.</span></span>

<span data-ttu-id="8ddab-273">Il primo test verifica che in un'operazione di salvataggio il browser viene reindirizzato all'azione di dettagli.</span><span class="sxs-lookup"><span data-stu-id="8ddab-273">The first test verifies that on a successful save the browser is redirected to the details action.</span></span> <span data-ttu-id="8ddab-274">Il secondo test verifica quando l'input non valido viene registrato l'azione visualizzata nuovamente la visualizzazione di modifica nuovamente un messaggio di errore.</span><span class="sxs-lookup"><span data-stu-id="8ddab-274">The second test verifies that when invalid input is posted the action redisplays the edit view again with an error message.</span></span>


[!code-csharp[Main](enable-automated-unit-testing/samples/sample17.cs)]

### <a name="testing-wrap-up"></a><span data-ttu-id="8ddab-275">Test conclusioni</span><span class="sxs-lookup"><span data-stu-id="8ddab-275">Testing Wrap-Up</span></span>

<span data-ttu-id="8ddab-276">Stati trattati i concetti principali coinvolti nelle classi di unit test controller.</span><span class="sxs-lookup"><span data-stu-id="8ddab-276">We've covered the core concepts involved in unit testing controller classes.</span></span> <span data-ttu-id="8ddab-277">È possibile utilizzare queste tecniche per creare facilmente centinaia di semplici test per verificare il comportamento dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="8ddab-277">We can use these techniques to easily create hundreds of simple tests that verify the behavior of our application.</span></span>

<span data-ttu-id="8ddab-278">Poiché il controller e il test del modello non richiedono un database reale, sono molto semplice e veloce per l'esecuzione.</span><span class="sxs-lookup"><span data-stu-id="8ddab-278">Because our controller and model tests do not require a real database, they are extremely fast and easy to run.</span></span> <span data-ttu-id="8ddab-279">È possibile eseguire centinaia di test automatizzati in secondi viene immediatamente visualizzato feedback sulla se ha superato una modifica apportate è un elemento.</span><span class="sxs-lookup"><span data-stu-id="8ddab-279">We'll be able to execute hundreds of automated tests in seconds, and immediately get feedback as to whether a change we made broke something.</span></span> <span data-ttu-id="8ddab-280">Questo consente di fornire il livello di confidenza per migliorare, eseguire il refactoring e ottimizzare l'applicazione continuamente.</span><span class="sxs-lookup"><span data-stu-id="8ddab-280">This will help provide us the confidence to continually improve, refactor, and refine our application.</span></span>

<span data-ttu-id="8ddab-281">Test trattati come ultimo argomento in questo capitolo, ma non perché il test è un elemento alla fine di un processo di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="8ddab-281">We covered testing as the last topic in this chapter – but not because testing is something you should do at the end of a development process!</span></span> <span data-ttu-id="8ddab-282">Al contrario, è consigliabile scrivere test automatizzati più presto nel processo di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="8ddab-282">On the contrary, you should write automated tests as early as possible in your development process.</span></span> <span data-ttu-id="8ddab-283">Ciò consente pertanto ottenere un feedback immediato quando si sviluppa, consente di considerare attentamente scenari di casi di utilizzo dell'applicazione e consente di progettare l'applicazione con pulita disposizione su livelli e accoppiamento presente.</span><span class="sxs-lookup"><span data-stu-id="8ddab-283">Doing so enables you to get immediate feedback as you develop, helps you think thoughtfully about your application's use case scenarios, and guides you to design your application with clean layering and coupling in mind.</span></span>

<span data-ttu-id="8ddab-284">Sviluppo basato su Test (TDD) e come utilizzarla con ASP.NET MVC, si parlerà un capitolo successivo nel libro.</span><span class="sxs-lookup"><span data-stu-id="8ddab-284">A later chapter in the book will discuss Test Driven Development (TDD), and how to use it with ASP.NET MVC.</span></span> <span data-ttu-id="8ddab-285">TDD è una procedura di codifica iterativa, in cui devi innanzitutto scrivere i test che soddisferà il codice risulta.</span><span class="sxs-lookup"><span data-stu-id="8ddab-285">TDD is an iterative coding practice where you first write the tests that your resulting code will satisfy.</span></span> <span data-ttu-id="8ddab-286">Con TDD iniziare creando un test che verifica la funzionalità che si sta per implementare ogni funzionalità.</span><span class="sxs-lookup"><span data-stu-id="8ddab-286">With TDD you begin each feature by creating a test that verifies the functionality you are about to implement.</span></span> <span data-ttu-id="8ddab-287">Scrittura di unit test innanzitutto contribuisce a garantire comprendere chiaramente la funzionalità e come deve operare.</span><span class="sxs-lookup"><span data-stu-id="8ddab-287">Writing the unit test first helps ensure that you clearly understand the feature and how it is supposed to work.</span></span> <span data-ttu-id="8ddab-288">Solo dopo che il test è scritto (e aver verificato che abbia esito negativo) non è, implementare la funzionalità di che test di verifica.</span><span class="sxs-lookup"><span data-stu-id="8ddab-288">Only after the test is written (and you have verified that it fails) do you then implement the actual functionality the test verifies.</span></span> <span data-ttu-id="8ddab-289">Perché è già stato speso pensare di tempo nel caso di utilizzo di presunto per utilizzare la funzionalità, si avrà una migliore comprensione dei requisiti e il modo migliore per implementarli.</span><span class="sxs-lookup"><span data-stu-id="8ddab-289">Because you've already spent time thinking about the use case of how the feature is supposed to work, you will have a better understanding of the requirements and how best to implement them.</span></span> <span data-ttu-id="8ddab-290">Una volta con l'implementazione è possibile eseguire nuovamente il test: e ottenere un feedback immediato come per se la funzionalità funziona correttamente.</span><span class="sxs-lookup"><span data-stu-id="8ddab-290">When you are done with the implementation you can re-run the test – and get immediate feedback as to whether the feature works correctly.</span></span> <span data-ttu-id="8ddab-291">Spiegheremo TDD più nel capitolo 10.</span><span class="sxs-lookup"><span data-stu-id="8ddab-291">We'll cover TDD more in Chapter 10.</span></span>

### <a name="next-step"></a><span data-ttu-id="8ddab-292">Passo successivo</span><span class="sxs-lookup"><span data-stu-id="8ddab-292">Next Step</span></span>

<span data-ttu-id="8ddab-293">Alcuni incapsulamento finale i commenti.</span><span class="sxs-lookup"><span data-stu-id="8ddab-293">Some final wrap up comments.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="8ddab-294">[Precedente](use-ajax-to-implement-mapping-scenarios.md)
> [Successivo](nerddinner-wrap-up.md)</span><span class="sxs-lookup"><span data-stu-id="8ddab-294">[Previous](use-ajax-to-implement-mapping-scenarios.md)
[Next](nerddinner-wrap-up.md)</span></span>
