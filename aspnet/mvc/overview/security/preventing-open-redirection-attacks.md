---
uid: mvc/overview/security/preventing-open-redirection-attacks
title: Prevenzione degli attacchi di reindirizzamento aprire (c#) | Documenti Microsoft
author: jongalloway
description: In questa esercitazione viene illustrato come è possibile impedire gli attacchi di reindirizzamento aperti nelle applicazioni ASP.NET MVC. In questa esercitazione vengono illustrate le modifiche apportate...
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/27/2014
ms.topic: article
ms.assetid: 69fb02e0-f5b7-4c35-878c-fa87164fc785
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/security/preventing-open-redirection-attacks
msc.type: authoredcontent
ms.openlocfilehash: ec1cd1791eb6d32e7c1ea50bc6626929cad2960e
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/06/2018
---
<a name="preventing-open-redirection-attacks-c"></a><span data-ttu-id="78bb9-104">Prevenzione degli attacchi di reindirizzamento aprire (c#)</span><span class="sxs-lookup"><span data-stu-id="78bb9-104">Preventing Open Redirection Attacks (C#)</span></span>
====================
<span data-ttu-id="78bb9-105">da [Jon Galloway](https://github.com/jongalloway)</span><span class="sxs-lookup"><span data-stu-id="78bb9-105">by [Jon Galloway](https://github.com/jongalloway)</span></span>

> <span data-ttu-id="78bb9-106">In questa esercitazione viene illustrato come è possibile impedire gli attacchi di reindirizzamento aperti nelle applicazioni ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="78bb9-106">This tutorial explains how you can prevent open redirection attacks in your ASP.NET MVC applications.</span></span> <span data-ttu-id="78bb9-107">In questa esercitazione vengono illustrate le modifiche apportate in AccountController in ASP.NET MVC 3 e viene illustrato come è possibile applicare queste modifiche nelle 2 applicazioni e la versione 1.0 di MVC ASP.NET esistente.</span><span class="sxs-lookup"><span data-stu-id="78bb9-107">This tutorial discusses the changes that have been made in the AccountController in ASP.NET MVC 3 and demonstrates how you can apply these changes in your existing ASP.NET MVC 1.0 and 2 applications.</span></span>


## <a name="what-is-an-open-redirection-attack"></a><span data-ttu-id="78bb9-108">Che cos'è un attacco di reindirizzamento aprire?</span><span class="sxs-lookup"><span data-stu-id="78bb9-108">What is an Open Redirection Attack?</span></span>

<span data-ttu-id="78bb9-109">Qualsiasi applicazione web che reindirizza a un URL che viene specificato tramite la richiesta, ad esempio i dati di stringa di query o i form può essere alterati potenzialmente per reindirizzare gli utenti a un URL esterno, dannoso.</span><span class="sxs-lookup"><span data-stu-id="78bb9-109">Any web application that redirects to a URL that is specified via the request such as the querystring or form data can potentially be tampered with to redirect users to an external, malicious URL.</span></span> <span data-ttu-id="78bb9-110">Questo tipo di manomissione viene chiamato un attacco di reindirizzamento aperto.</span><span class="sxs-lookup"><span data-stu-id="78bb9-110">This tampering is called an open redirection attack.</span></span>

<span data-ttu-id="78bb9-111">Ogni volta che la logica dell'applicazione reindirizza a un URL specificato, è necessario verificare che l'URL di reindirizzamento non è stato alterato.</span><span class="sxs-lookup"><span data-stu-id="78bb9-111">Whenever your application logic redirects to a specified URL, you must verify that the redirection URL hasn't been tampered with.</span></span> <span data-ttu-id="78bb9-112">L'account di accesso utilizzato nel AccountController predefinito per la versione 1.0 di ASP.NET MVC e ASP.NET MVC 2 è vulnerabile agli attacchi di reindirizzamento di aprire.</span><span class="sxs-lookup"><span data-stu-id="78bb9-112">The login used in the default AccountController for both ASP.NET MVC 1.0 and ASP.NET MVC 2 is vulnerable to open redirection attacks.</span></span> <span data-ttu-id="78bb9-113">Fortunatamente, è facile aggiornare le applicazioni esistenti per utilizzare le correzioni dall'anteprima ASP.NET MVC 3.</span><span class="sxs-lookup"><span data-stu-id="78bb9-113">Fortunately, it is easy to update your existing applications to use the corrections from the ASP.NET MVC 3 Preview.</span></span>

<span data-ttu-id="78bb9-114">Per comprendere la vulnerabilità, esaminiamo il funzionamento del reindirizzamento di account di accesso in un progetto di applicazione Web ASP.NET MVC 2 predefinito.</span><span class="sxs-lookup"><span data-stu-id="78bb9-114">To understand the vulnerability, let's look at how the login redirection works in a default ASP.NET MVC 2 Web Application project.</span></span> <span data-ttu-id="78bb9-115">In questa applicazione, il tentativo di visitare un'azione del controller che ha l'attributo [Authorize] reindirizzerà gli utenti non autorizzati alla visualizzazione /Account/LogOn.</span><span class="sxs-lookup"><span data-stu-id="78bb9-115">In this application, attempting to visit a controller action that has the [Authorize] attribute will redirect unauthorized users to the /Account/LogOn view.</span></span> <span data-ttu-id="78bb9-116">Il reindirizzamento a /Account/LogOn includerà un parametro querystring returnUrl in modo che l'utente può essere restituito all'URL richiesto originariamente dopo che hanno effettuato correttamente l'accesso.</span><span class="sxs-lookup"><span data-stu-id="78bb9-116">This redirect to /Account/LogOn will include a returnUrl querystring parameter so that the user can be returned to the originally requested URL after they have successfully logged in.</span></span>

<span data-ttu-id="78bb9-117">Nella schermata seguente, possiamo vedere che un tentativo di accedere alla visualizzazione /Account/ChangePassword quando non è connesso determina un reindirizzamento per /Account/LogOn? ReturnUrl = % 2fAccount % 2fChangePassword % 2f.</span><span class="sxs-lookup"><span data-stu-id="78bb9-117">In the screenshot below, we can see that an attempt to access the /Account/ChangePassword view when not logged in results in a redirect to /Account/LogOn?ReturnUrl=%2fAccount%2fChangePassword%2f.</span></span>

[![](preventing-open-redirection-attacks/_static/image2.png)](preventing-open-redirection-attacks/_static/image1.png)

<span data-ttu-id="78bb9-118">**Figura 01**: pagina di accesso con un reindirizzamento aperto</span><span class="sxs-lookup"><span data-stu-id="78bb9-118">**Figure 01**: Login page with an open redirection</span></span>

<span data-ttu-id="78bb9-119">Poiché il parametro querystring ReturnUrl non viene convalidato, un utente malintenzionato può modificarlo per inserire tutti gli indirizzi URL nel parametro per eseguire un attacco di reindirizzamento aperto.</span><span class="sxs-lookup"><span data-stu-id="78bb9-119">Since the ReturnUrl querystring parameter is not validated, an attacker can modify it to inject any URL address into the parameter to conduct an open redirection attack.</span></span> <span data-ttu-id="78bb9-120">Per dimostrare questo concetto, che potremo modificare il parametro ReturnUrl [ http://bing.com ](http://bing.com), pertanto l'URL di account di accesso risultante sarà/Account/accesso? ReturnUrl =<http://www.bing.com/>.</span><span class="sxs-lookup"><span data-stu-id="78bb9-120">To demonstrate this, we can modify the ReturnUrl parameter to [http://bing.com](http://bing.com), so the resulting login URL will be /Account/LogOn?ReturnUrl=<http://www.bing.com/>.</span></span> <span data-ttu-id="78bb9-121">Al momento è stato effettuato l'accesso al sito, è in corso reindirizzati alla [ http://bing.com ](http://bing.com). Poiché il reindirizzamento non viene convalidato, potrebbe invece fare riferimento a un sito che è stato eseguito un tentativo di ingannare l'utente.</span><span class="sxs-lookup"><span data-stu-id="78bb9-121">Upon successfully logging in to the site, we are redirected to [http://bing.com](http://bing.com). Since this redirection is not validated, it could instead point to a malicious site that attempts to trick the user.</span></span>

### <a name="a-more-complex-open-redirection-attack"></a><span data-ttu-id="78bb9-122">Un attacco di reindirizzamento aprire più complessi</span><span class="sxs-lookup"><span data-stu-id="78bb9-122">A more complex Open Redirection Attack</span></span>

<span data-ttu-id="78bb9-123">Gli attacchi di reindirizzamento aprire sono particolarmente pericolosi poiché un utente malintenzionato a conoscenza che si sta tentando di accedere a un sito Web specifico, rendendo ci vulnerabile a un [attacco di phishing](https://www.microsoft.com/protect/fraud/phishing/symptoms.aspx).</span><span class="sxs-lookup"><span data-stu-id="78bb9-123">Open redirection attacks are especially dangerous because an attacker knows that we're trying to log into a specific website, which makes us vulnerable to a [phishing attack](https://www.microsoft.com/protect/fraud/phishing/symptoms.aspx).</span></span> <span data-ttu-id="78bb9-124">Ad esempio, un utente malintenzionato potrebbe inviare messaggi di posta elettronica agli utenti del sito Web nel tentativo di acquisire le proprie password.</span><span class="sxs-lookup"><span data-stu-id="78bb9-124">For example, an attacker could send malicious emails to website users in an attempt to capture their passwords.</span></span> <span data-ttu-id="78bb9-125">Si esaminerà questo funzionamento nel sito NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="78bb9-125">Let's look at how this would work on the NerdDinner site.</span></span> <span data-ttu-id="78bb9-126">Si noti che il sito NerdDinner in tempo reale è stato aggiornato per proteggersi da attacchi di reindirizzamento aperto.</span><span class="sxs-lookup"><span data-stu-id="78bb9-126">(Note that the live NerdDinner site has been updated to protect against open redirection attacks.)</span></span>

<span data-ttu-id="78bb9-127">Prima di tutto, un utente malintenzionato invia a un collegamento alla pagina di accesso su NerdDinner che include un reindirizzamento alla pagina contraffatta:</span><span class="sxs-lookup"><span data-stu-id="78bb9-127">First, an attacker sends us a link to the login page on NerdDinner that includes a redirect to their forged page:</span></span>

[http://nerddinner.com/Account/LogOn?returnUrl=http://nerddiner.com/Account/LogOn](http://nerddinner.com/Account/LogOn?returnUrl=http://nerddiner.com/Account/LogOn)

<span data-ttu-id="78bb9-128">Si noti che l'URL restituito punta a nerddiner.com, che non contiene una "n" da dinner di word.</span><span class="sxs-lookup"><span data-stu-id="78bb9-128">Note that the return URL points to nerddiner.com, which is missing an "n" from the word dinner.</span></span> <span data-ttu-id="78bb9-129">In questo esempio, si tratta di un dominio che controlla l'autore dell'attacco.</span><span class="sxs-lookup"><span data-stu-id="78bb9-129">In this example, this is a domain that the attacker controls.</span></span> <span data-ttu-id="78bb9-130">Quando si accede al collegamento riportato sopra, si verrà visualizzate la pagina di account di accesso NerdDinner.com legittima.</span><span class="sxs-lookup"><span data-stu-id="78bb9-130">When we access the above link, we're taken to the legitimate NerdDinner.com login page.</span></span>

[![](preventing-open-redirection-attacks/_static/image4.png)](preventing-open-redirection-attacks/_static/image3.png)

<span data-ttu-id="78bb9-131">**Figura 02**: pagina di accesso NerdDinner con un reindirizzamento aperto</span><span class="sxs-lookup"><span data-stu-id="78bb9-131">**Figure 02**: NerdDinner login page with an open redirection</span></span>

<span data-ttu-id="78bb9-132">Quando verrà eseguito correttamente l'accesso, azione di accesso del AccountController di MVC ASP.NET ci reindirizza all'URL specificato nel parametro querystring returnUrl.</span><span class="sxs-lookup"><span data-stu-id="78bb9-132">When we correctly log in, the ASP.NET MVC AccountController's LogOn action redirects us to the URL specified in the returnUrl querystring parameter.</span></span> <span data-ttu-id="78bb9-133">In questo caso, è l'URL che ha immesso l'autore dell'attacco, ovvero [ http://nerddiner.com/Account/LogOn ](http://nerddiner.com/Account/LogOn).</span><span class="sxs-lookup"><span data-stu-id="78bb9-133">In this case, it's the URL that the attacker has entered, which is [http://nerddiner.com/Account/LogOn](http://nerddiner.com/Account/LogOn).</span></span> <span data-ttu-id="78bb9-134">A meno che non si è estremamente consentono, che è molto probabile che è non sarà possibile notare, soprattutto perché l'autore dell'attacco è stato attenzione per assicurarsi che le pagine manomesse aspetto esattamente la pagina di accesso legittimo.</span><span class="sxs-lookup"><span data-stu-id="78bb9-134">Unless we're extremely watchful, it's very likely we won't notice this, especially because the attacker has been careful to make sure that their forged page looks exactly like the legitimate login page.</span></span> <span data-ttu-id="78bb9-135">Questa pagina di accesso include un messaggio di errore che richiede che è nuovo l'accesso.</span><span class="sxs-lookup"><span data-stu-id="78bb9-135">This login page includes an error message requesting that we login again.</span></span> <span data-ttu-id="78bb9-136">Ingombranti, è necessario avere digitato correttamente la password.</span><span class="sxs-lookup"><span data-stu-id="78bb9-136">Clumsy us, we must have mistyped our password.</span></span>

[![](preventing-open-redirection-attacks/_static/image6.png)](preventing-open-redirection-attacks/_static/image5.png)

<span data-ttu-id="78bb9-137">**Figura 03**: schermata di accesso NerdDinner contraffatte</span><span class="sxs-lookup"><span data-stu-id="78bb9-137">**Figure 03**: Forged NerdDinner Login screen</span></span>

<span data-ttu-id="78bb9-138">Quando si ridigitare il nome utente e password, la pagina di accesso contraffatta Salva le informazioni e ci è stata inviata al sito NerdDinner.com legittimo.</span><span class="sxs-lookup"><span data-stu-id="78bb9-138">When we retype our user name and password, the forged login page saves the information and sends us back to the legitimate NerdDinner.com site.</span></span> <span data-ttu-id="78bb9-139">A questo punto, il sito NerdDinner.com è già autenticato, in modo possibile reindirizzare la pagina di accesso contraffatta direttamente a tale pagina.</span><span class="sxs-lookup"><span data-stu-id="78bb9-139">At this point, the NerdDinner.com site has already authenticated us, so the forged login page can redirect directly to that page.</span></span> <span data-ttu-id="78bb9-140">Il risultato finale è che l'utente malintenzionato ha il nome utente e password e siamo consapevoli che è stato fornito ad essi.</span><span class="sxs-lookup"><span data-stu-id="78bb9-140">The end result is that the attacker has our user name and password, and we are unaware that we've provided it to them.</span></span>

## <a name="looking-at-the-vulnerable-code-in-the-accountcontroller-logon-action"></a><span data-ttu-id="78bb9-141">Esaminando il codice nell'azione accesso AccountController vulnerabile</span><span class="sxs-lookup"><span data-stu-id="78bb9-141">Looking at the vulnerable code in the AccountController LogOn Action</span></span>

<span data-ttu-id="78bb9-142">Il codice per l'azione di accesso in un'applicazione ASP.NET MVC 2 è illustrato di seguito.</span><span class="sxs-lookup"><span data-stu-id="78bb9-142">The code for the LogOn action in an ASP.NET MVC 2 application is shown below.</span></span> <span data-ttu-id="78bb9-143">Si noti che al momento di un account di accesso ha esito positivo, il controller restituisca un reindirizzamento per l'elemento returnUrl.</span><span class="sxs-lookup"><span data-stu-id="78bb9-143">Note that upon a successful login, the controller returns a redirect to the returnUrl.</span></span> <span data-ttu-id="78bb9-144">Si noterà che non viene eseguita alcuna convalida rispetto al parametro returnUrl.</span><span class="sxs-lookup"><span data-stu-id="78bb9-144">You can see that no validation is being performed against the returnUrl parameter.</span></span>

<span data-ttu-id="78bb9-145">**Elenco 1 – azione ASP.NET MVC 2 accesso `AccountController.cs`**</span><span class="sxs-lookup"><span data-stu-id="78bb9-145">**Listing 1 – ASP.NET MVC 2 LogOn action in `AccountController.cs`**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample1.cs)]

<span data-ttu-id="78bb9-146">Ora esaminiamo le modifiche all'azione di accesso di ASP.NET MVC 3.</span><span class="sxs-lookup"><span data-stu-id="78bb9-146">Now let's look at the changes to the ASP.NET MVC 3 LogOn action.</span></span> <span data-ttu-id="78bb9-147">Questo codice è stato modificato per convalidare il parametro returnUrl chiamando un nuovo metodo nella classe helper System.Web.Mvc.Url denominata `IsLocalUrl()`.</span><span class="sxs-lookup"><span data-stu-id="78bb9-147">This code has been changed to validate the returnUrl parameter by calling a new method in the System.Web.Mvc.Url helper class named `IsLocalUrl()`.</span></span>

<span data-ttu-id="78bb9-148">**2: azione di ASP.NET MVC 3 accesso nell'elenco `AccountController.cs`**</span><span class="sxs-lookup"><span data-stu-id="78bb9-148">**Listing 2 – ASP.NET MVC 3 LogOn action in `AccountController.cs`**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample2.cs)]

<span data-ttu-id="78bb9-149">Questo è stato modificato per convalidare il parametro dell'URL restituito chiamando un nuovo metodo nella classe helper System.Web.Mvc.Url `IsLocalUrl()`.</span><span class="sxs-lookup"><span data-stu-id="78bb9-149">This has been changed to validate the return URL parameter by calling a new method in the System.Web.Mvc.Url helper class, `IsLocalUrl()`.</span></span>

## <a name="protecting-your-aspnet-mvc-10-and-mvc-2-applications"></a><span data-ttu-id="78bb9-150">Protezione di MVC 2 ASP.NET MVC 1,0 e applicazioni</span><span class="sxs-lookup"><span data-stu-id="78bb9-150">Protecting Your ASP.NET MVC 1.0 and MVC 2 Applications</span></span>

<span data-ttu-id="78bb9-151">È possibile sfruttare le modifiche di ASP.NET MVC 3 nelle 2 applicazioni e la versione 1.0 di MVC ASP.NET esistente aggiungendo il metodo di supporto IsLocalUrl() e aggiornando l'azione di accesso per convalidare il parametro returnUrl.</span><span class="sxs-lookup"><span data-stu-id="78bb9-151">We can take advantage of the ASP.NET MVC 3 changes in our existing ASP.NET MVC 1.0 and 2 applications by adding the IsLocalUrl() helper method and updating the LogOn action to validate the returnUrl parameter.</span></span>

<span data-ttu-id="78bb9-152">Il metodo UrlHelper IsLocalUrl() semplicemente la chiamata in un metodo in System.Web.WebPages, come la convalida viene utilizzato anche dalle applicazioni ASP.NET Web Pages.</span><span class="sxs-lookup"><span data-stu-id="78bb9-152">The UrlHelper IsLocalUrl() method actually just calling into a method in System.Web.WebPages, as this validation is also used by ASP.NET Web Pages applications.</span></span>

<span data-ttu-id="78bb9-153">**Elenco di 3: il metodo IsLocalUrl() il UrlHelper 3 MVC ASP.NET `class`**</span><span class="sxs-lookup"><span data-stu-id="78bb9-153">**Listing 3 – The IsLocalUrl() method from the ASP.NET MVC 3 UrlHelper `class`**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample3.cs)]

<span data-ttu-id="78bb9-154">Il metodo IsUrlLocalToHost contiene la logica di convalida effettiva, come illustrato nel listato 4.</span><span class="sxs-lookup"><span data-stu-id="78bb9-154">The IsUrlLocalToHost method contains the actual validation logic, as shown in Listing 4.</span></span>

<span data-ttu-id="78bb9-155">**Listato 4-metodo IsUrlLocalToHost() dalla classe System.Web.WebPages RequestExtensions**</span><span class="sxs-lookup"><span data-stu-id="78bb9-155">**Listing 4 – IsUrlLocalToHost() method from the System.Web.WebPages RequestExtensions class**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample4.cs)]

<span data-ttu-id="78bb9-156">La versione 1.0 di ASP.NET MVC o dell'applicazione 2, verrà aggiunto un metodo IsLocalUrl() per il AccountController, ma si consiglia di aggiungerlo a una classe di supporto separato, se possibile.</span><span class="sxs-lookup"><span data-stu-id="78bb9-156">In our ASP.NET MVC 1.0 or 2 application, we'll add a IsLocalUrl() method to the AccountController, but you're encouraged to add it to a separate helper class if possible.</span></span> <span data-ttu-id="78bb9-157">Si renderà due piccole modifiche alla versione ASP.NET MVC 3 di IsLocalUrl() in modo che funzioni all'interno di AccountController.</span><span class="sxs-lookup"><span data-stu-id="78bb9-157">We will make two small changes to the ASP.NET MVC 3 version of IsLocalUrl() so that it will work inside the AccountController.</span></span> <span data-ttu-id="78bb9-158">Prima di tutto, verranno modificate, da un metodo pubblico a un metodo privato, poiché i metodi pubblici nel controller accessibile come azioni del controller.</span><span class="sxs-lookup"><span data-stu-id="78bb9-158">First, we'll change it from a public method to a private method, since public methods in controllers can be accessed as controller actions.</span></span> <span data-ttu-id="78bb9-159">In secondo luogo, verrà modificata la chiamata che controlla l'host dell'URL con l'applicazione host.</span><span class="sxs-lookup"><span data-stu-id="78bb9-159">Second, we'll modify the call that checks the URL host against the application host.</span></span> <span data-ttu-id="78bb9-160">Che chiamata viene utilizzato un RequestContext locale campo nella classe UrlHelper.</span><span class="sxs-lookup"><span data-stu-id="78bb9-160">That call makes use of a local RequestContext field in the UrlHelper class.</span></span> <span data-ttu-id="78bb9-161">Anziché. RequestContext.HttpContext.Request.Url.Host, questa tabella verrà usata. Request.Url.Host.</span><span class="sxs-lookup"><span data-stu-id="78bb9-161">Instead of using this.RequestContext.HttpContext.Request.Url.Host, we will use this.Request.Url.Host.</span></span> <span data-ttu-id="78bb9-162">Il codice seguente è illustrato il metodo di IsLocalUrl() modificato per l'utilizzo con una classe controller in ASP.NET MVC 1.0 e 2 applicazioni.</span><span class="sxs-lookup"><span data-stu-id="78bb9-162">The following code shows the modified IsLocalUrl() method for use with a controller class in ASP.NET MVC 1.0 and 2 applications.</span></span>

<span data-ttu-id="78bb9-163">**Nel listato 5 – IsLocalUrl() (metodo), che viene modificato per l'utilizzo con una classe Controller MVC**</span><span class="sxs-lookup"><span data-stu-id="78bb9-163">**Listing 5 – IsLocalUrl() method, which is modified for use with an MVC Controller class**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample5.cs)]

<span data-ttu-id="78bb9-164">Ora che il metodo IsLocalUrl() è sul posto, è possibile chiamarlo dall'azione di accesso per convalidare il parametro returnUrl, come illustrato nel codice seguente.</span><span class="sxs-lookup"><span data-stu-id="78bb9-164">Now that the IsLocalUrl() method is in place, we can call it from our LogOn action to validate the returnUrl parameter, as shown in the following code.</span></span>

<span data-ttu-id="78bb9-165">**Elenco 6: metodo di accesso aggiornate che convalida il parametro returnUrl**</span><span class="sxs-lookup"><span data-stu-id="78bb9-165">**Listing 6 – Updated LogOn method which validates the returnUrl parameter**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample6.cs)]

<span data-ttu-id="78bb9-166">È ora possibile testare un attacco di reindirizzamento aprire tentando di accedere con un URL esterno restituito.</span><span class="sxs-lookup"><span data-stu-id="78bb9-166">Now we can test an open redirection attack by attempting to log in using an external return URL.</span></span> <span data-ttu-id="78bb9-167">Consente di usare il /Account/LogOn? ReturnUrl =<http://www.bing.com/> nuovamente.</span><span class="sxs-lookup"><span data-stu-id="78bb9-167">Let's use /Account/LogOn?ReturnUrl=<http://www.bing.com/> again.</span></span>

[![](preventing-open-redirection-attacks/_static/image8.png)](preventing-open-redirection-attacks/_static/image7.png)

<span data-ttu-id="78bb9-168">**Figura 04**: verifica l'azione di accesso aggiornate</span><span class="sxs-lookup"><span data-stu-id="78bb9-168">**Figure 04**: Testing the updated LogOn Action</span></span>

<span data-ttu-id="78bb9-169">Dopo aver completato l'accesso, si viene reindirizzati di azione del Controller Home/Index anziché l'URL esterno.</span><span class="sxs-lookup"><span data-stu-id="78bb9-169">After successfully logging in, we are redirected to the Home/Index Controller action rather than the external URL.</span></span>

[![](preventing-open-redirection-attacks/_static/image10.png)](preventing-open-redirection-attacks/_static/image9.png)

<span data-ttu-id="78bb9-170">**Figura 05**: attacco reindirizzamento Open annullato</span><span class="sxs-lookup"><span data-stu-id="78bb9-170">**Figure 05**: Open Redirection attack defeated</span></span>

## <a name="summary"></a><span data-ttu-id="78bb9-171">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="78bb9-171">Summary</span></span>

<span data-ttu-id="78bb9-172">Gli attacchi di reindirizzamento aprire possono verificarsi quando il reindirizzamento URL vengono passati come parametri nell'URL per un'applicazione.</span><span class="sxs-lookup"><span data-stu-id="78bb9-172">Open redirection attacks can occur when redirection URLs are passed as parameters in the URL for an application.</span></span> <span data-ttu-id="78bb9-173">Il modello include il codice per la protezione da ASP.NET MVC 3 aprire gli attacchi di reindirizzamento.</span><span class="sxs-lookup"><span data-stu-id="78bb9-173">The ASP.NET MVC 3 template includes code to protect against open redirection attacks.</span></span> <span data-ttu-id="78bb9-174">È possibile aggiungere questo codice con una modifica 2 applicazioni e MVC ASP.NET 1.0.</span><span class="sxs-lookup"><span data-stu-id="78bb9-174">You can add this code with some modification to ASP.NET MVC 1.0 and 2 applications.</span></span> <span data-ttu-id="78bb9-175">Per proteggere da attacchi di reindirizzamento aperto durante l'accesso a ASP.NET 1.0 e 2 applicazioni, aggiungere un metodo IsLocalUrl() e convalidare il parametro returnUrl nell'azione di accesso.</span><span class="sxs-lookup"><span data-stu-id="78bb9-175">To protect against open redirection attacks when logging into ASP.NET 1.0 and 2 applications, add a IsLocalUrl() method and validate the returnUrl parameter in the LogOn action.</span></span>
