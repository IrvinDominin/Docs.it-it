---
uid: web-forms/overview/data-access/paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs
title: In modo efficiente il Paging grandi quantità di dati (c#) | Documenti Microsoft
author: rick-anderson
description: L'opzione di paging predefinita di un controllo di presentazione di dati non è adatta quando si lavora con grandi quantità di dati, come il retriev di controllo origine dati sottostante...
ms.author: aspnetcontent
manager: wpickett
ms.date: 08/15/2006
ms.topic: article
ms.assetid: 59c01998-9326-4ecb-9392-cb9615962140
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs
msc.type: authoredcontent
ms.openlocfilehash: ea1fd06f8eb7c53c3e9e7fb10c46974eb2af2acd
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/06/2018
---
<a name="efficiently-paging-through-large-amounts-of-data-c"></a><span data-ttu-id="9cc0f-103">In modo efficiente il Paging grandi quantità di dati (c#)</span><span class="sxs-lookup"><span data-stu-id="9cc0f-103">Efficiently Paging Through Large Amounts of Data (C#)</span></span>
====================
<span data-ttu-id="9cc0f-104">da [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="9cc0f-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="9cc0f-105">[Scaricare App di esempio](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_25_CS.exe) o [Scarica il PDF](efficiently-paging-through-large-amounts-of-data-cs/_static/datatutorial25cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="9cc0f-105">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_25_CS.exe) or [Download PDF](efficiently-paging-through-large-amounts-of-data-cs/_static/datatutorial25cs1.pdf)</span></span>

> <span data-ttu-id="9cc0f-106">L'opzione di paging predefinita di un controllo di presentazione di dati non è adatta quando si lavora con grandi quantità di dati, come il controllo origine dati sottostante recupera tutti i record, anche se viene visualizzato solo un subset di dati.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-106">The default paging option of a data presentation control is unsuitable when working with large amounts of data, as its underlying data source control retrieves all records, even though only a subset of data is displayed.</span></span> <span data-ttu-id="9cc0f-107">In tali circostanze, è necessario attivare personalizzati di paging.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-107">In such circumstances, we must turn to custom paging.</span></span>


## <a name="introduction"></a><span data-ttu-id="9cc0f-108">Introduzione</span><span class="sxs-lookup"><span data-stu-id="9cc0f-108">Introduction</span></span>

<span data-ttu-id="9cc0f-109">Come descritto nell'esercitazione precedente, è possibile implementare il paging in uno dei due modi:</span><span class="sxs-lookup"><span data-stu-id="9cc0f-109">As we discussed in the preceding tutorial, paging can be implemented in one of two ways:</span></span>

- <span data-ttu-id="9cc0f-110">**Paging predefinito** possono essere implementati semplicemente selezionando l'opzione Abilita Paging nei dati di controllo Web s smart tag; tuttavia, ogni volta che si visualizza una pagina di dati, ObjectDataSource recupera *tutti* dei record, anche anche se solo un sottoinsieme di essi vengono visualizzati nella pagina</span><span class="sxs-lookup"><span data-stu-id="9cc0f-110">**Default Paging** can be implemented by simply checking the Enable Paging option in the data Web control s smart tag; however, whenever viewing a page of data, the ObjectDataSource retrieves *all* of the records, even though only a subset of them are displayed in the page</span></span>
- <span data-ttu-id="9cc0f-111">**Il Paging personalizzato** migliora le prestazioni di impostazione predefinita, il paging recuperando solo i record dal database che devono essere visualizzati per pagina specifica di dati richiesto dall'utente; tuttavia, il paging personalizzato implica un po' più impegno per implementare rispetto del paging predefinito</span><span class="sxs-lookup"><span data-stu-id="9cc0f-111">**Custom Paging** improves the performance of default paging by retrieving only those records from the database that need to be displayed for the particular page of data requested by the user; however, custom paging involves a bit more effort to implement than default paging</span></span>

<span data-ttu-id="9cc0f-112">Grazie alla facilità di controllo solo implementazione una casella di controllo e si stanno completata.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-112">Due to the ease of implementation just check a checkbox and you re done!</span></span> <span data-ttu-id="9cc0f-113">paging predefinito è un'opzione attraente.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-113">default paging is an attractive option.</span></span> <span data-ttu-id="9cc0f-114">Proprio approccio ve na durante il recupero di tutti i record, tuttavia, rende una scelta inverosimile quando il paging sufficientemente grandi quantità di dati o per i siti con molti utenti simultanei.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-114">Its na�ve approach in retrieving all of the records, though, makes it an implausible choice when paging through sufficiently large amounts of data or for sites with many concurrent users.</span></span> <span data-ttu-id="9cc0f-115">In tali circostanze, è necessario attivare su personalizzato per fornire un sistema di risposta di paging.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-115">In such circumstances, we must turn to custom paging in order to provide a responsive system.</span></span>

<span data-ttu-id="9cc0f-116">La necessità di paging personalizzato è in grado di scrivere una query che restituisce il set di record necessari per una particolare pagina di dati preciso.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-116">The challenge of custom paging is being able to write a query that returns the precise set of records needed for a particular page of data.</span></span> <span data-ttu-id="9cc0f-117">Fortunatamente, Microsoft SQL Server 2005 fornisce una nuova parola chiave per i risultati di classificazione, che consente di scrivere una query che è possibile recuperare in modo efficiente il subset corretto di record.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-117">Fortunately, Microsoft SQL Server 2005 provides a new keyword for ranking results, which enables us to write a query that can efficiently retrieve the proper subset of records.</span></span> <span data-ttu-id="9cc0f-118">In questa esercitazione vedremo come utilizzare la nuova parola chiave SQL Server 2005 per implementare il paging personalizzato in un controllo GridView.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-118">In this tutorial we'll see how to use this new SQL Server 2005 keyword to implement custom paging in a GridView control.</span></span> <span data-ttu-id="9cc0f-119">Mentre l'interfaccia utente per il paging personalizzato è identico a quello per il paging predefinito, l'esecuzione di istruzioni da una pagina al successivo tramite il paging personalizzato può essere più veloce di paging predefinito diversi ordini di grandezza.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-119">While the user interface for custom paging is identical to that for default paging, stepping from one page to the next using custom paging can be several orders of magnitude faster than default paging.</span></span>

> [!NOTE]
> <span data-ttu-id="9cc0f-120">Il miglioramento delle prestazioni esatta esibito dal paging personalizzato dipende dal numero totale di record il paging tramite e il carico sul server di database.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-120">The exact performance gain exhibited by custom paging depends on the total number of records being paged through and the load being placed on the database server.</span></span> <span data-ttu-id="9cc0f-121">Alla fine di questa esercitazione verranno ora esaminate alcune metriche approssimativa che illustrano i vantaggi nelle prestazioni ottenuti mediante il paging personalizzato.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-121">At the end of this tutorial we'll look at some rough metrics that showcase the benefits in performance obtained through custom paging.</span></span>


## <a name="step-1-understanding-the-custom-paging-process"></a><span data-ttu-id="9cc0f-122">Passaggio 1: Comprendere il processo di Paging personalizzata</span><span class="sxs-lookup"><span data-stu-id="9cc0f-122">Step 1: Understanding the Custom Paging Process</span></span>

<span data-ttu-id="9cc0f-123">Quando il paging dei dati, i record precisi visualizzati in una pagina variano a seconda della pagina di dati richiesti e il numero di record visualizzati per pagina.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-123">When paging through data, the precise records displayed in a page depend upon the page of data being requested and the number of records displayed per page.</span></span> <span data-ttu-id="9cc0f-124">Ad esempio, si supponga di voler di spostarsi tra i 81 prodotti, 10 prodotti per ogni pagina di visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-124">For example, imagine that we wanted to page through the 81 products, displaying 10 products per page.</span></span> <span data-ttu-id="9cc0f-125">Quando si visualizza la prima pagina, d vogliamo prodotti 1 e 10. Quando si visualizza la seconda pagina è d esserti 11 20 tramite prodotti e così via.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-125">When viewing the first page, we d want products 1 through 10; when viewing the second page we d be interested in products 11 through 20, and so on.</span></span>

<span data-ttu-id="9cc0f-126">Esistono tre variabili che indicano quali record devono essere recuperati e la modalità di rendering dell'interfaccia di paging:</span><span class="sxs-lookup"><span data-stu-id="9cc0f-126">There are three variables that dictate what records need to be retrieved and how the paging interface should be rendered:</span></span>

- <span data-ttu-id="9cc0f-127">**Indice di riga iniziale** l'indice della prima riga nella pagina di dati da visualizzare; questo può essere calcolato moltiplicando l'indice della pagina per i record da visualizzare per ogni pagina e aggiunta di uno.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-127">**Start Row Index** the index of the first row in the page of data to display; this index can be calculated by multiplying the page index by the records to display per page and adding one.</span></span> <span data-ttu-id="9cc0f-128">Ad esempio, quando il paging i 10 record alla volta, per la prima pagina (il cui indice della pagina è 0), indice di riga iniziale è 0 \* 10 + 1 o 1, per la seconda pagina (il cui indice della pagina è 1), indice di riga iniziale è 1 \* 10 + 1 , o 11.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-128">For example, when paging through records 10 at a time, for the first page (whose page index is 0), the Start Row Index is 0 \* 10 + 1, or 1; for the second page (whose page index is 1), the Start Row Index is 1 \* 10 + 1, or 11.</span></span>
- <span data-ttu-id="9cc0f-129">**Numero massimo di righe** il numero massimo di record da visualizzare per pagina.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-129">**Maximum Rows** the maximum number of records to display per page.</span></span> <span data-ttu-id="9cc0f-130">Questa variabile viene considerata numero massimo di righe perché per l'ultima pagina può essere un numero di record restituito rispetto alle dimensioni di pagina.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-130">This variable is referred to as maximum rows since for the last page there may be fewer records returned than the page size.</span></span> <span data-ttu-id="9cc0f-131">Ad esempio, quando lo scorrimento di record di 81 prodotti 10 per ogni pagina, la pagina nona e finale avrà un solo record.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-131">For example, when paging through the 81 products 10 records per page, the ninth and final page will have just one record.</span></span> <span data-ttu-id="9cc0f-132">Nessuna pagina, tuttavia, verrà visualizzati più record rispetto al valore massimo di righe.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-132">No page, though, will show more records than the Maximum Rows value.</span></span>
- <span data-ttu-id="9cc0f-133">**Totale Record** il numero totale di record mediante il paging.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-133">**Total Record Count** the total number of records being paged through.</span></span> <span data-ttu-id="9cc0f-134">Mentre t questa variabile non è necessario per determinare i record da recuperare per una determinata pagina, definiscono l'interfaccia di paging.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-134">While this variable isn t needed to determine what records to retrieve for a given page, it does dictate the paging interface.</span></span> <span data-ttu-id="9cc0f-135">Ad esempio, se sono presenti 81 prodotti il paging tramite, l'interfaccia di paging in grado di visualizzare i numeri di pagina nove nell'interfaccia di paging.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-135">For example, if there are 81 products being paged through, the paging interface knows to display nine page numbers in the paging UI.</span></span>

<span data-ttu-id="9cc0f-136">Con il paging predefinito, indice di riga iniziale viene calcolata come prodotto tra l'indice della pagina e le dimensioni della pagina più uno, mentre il numero massimo di righe è semplicemente le dimensioni della pagina.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-136">With default paging, the Start Row Index is computed as the product of the page index and the page size plus one, whereas the Maximum Rows is simply the page size.</span></span> <span data-ttu-id="9cc0f-137">Poiché paging predefinito recupera tutti i record dal database durante il rendering di qualsiasi pagina di dati, l'indice per ogni riga è noto, rendendo lo spostamento alla riga di indice di riga iniziale un'attività banale.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-137">Since default paging retrieves all of the records from the database when rendering any page of data, the index for each row is known, thereby making moving to Start Row Index row a trivial task.</span></span> <span data-ttu-id="9cc0f-138">Inoltre, il numero totale di Record è immediatamente disponibile, come s semplicemente il numero di record di DataTable (o qualsiasi oggetto viene utilizzato per archiviare i risultati di database).</span><span class="sxs-lookup"><span data-stu-id="9cc0f-138">Moreover, the Total Record Count is readily available, as it s simply the number of records in the DataTable (or whatever object is being used to hold the database results).</span></span>

<span data-ttu-id="9cc0f-139">Dato le variabili di indice di riga iniziale e massimo di righe, un'implementazione personalizzata di paging deve restituire solo il subset di record a partire dall'indice di riga iniziale e fino a raggiungere il numero massimo di righe di record dopo che preciso.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-139">Given the Start Row Index and Maximum Rows variables, a custom paging implementation must only return the precise subset of records starting at the Start Row Index and up to Maximum Rows number of records after that.</span></span> <span data-ttu-id="9cc0f-140">Il paging personalizzato sono disponibili due sfide:</span><span class="sxs-lookup"><span data-stu-id="9cc0f-140">Custom paging provides two challenges:</span></span>

- <span data-ttu-id="9cc0f-141">È necessario essere in grado di associare in modo efficiente un indice di riga a ogni riga in tutti i dati in modo che è possibile iniziare a restituire i record in corrispondenza dell'indice di riga specificato Start, tramite il paging</span><span class="sxs-lookup"><span data-stu-id="9cc0f-141">We must be able to efficiently associate a row index with each row in the entire data being paged through so that we can start returning records at the specified Start Row Index</span></span>
- <span data-ttu-id="9cc0f-142">È necessario fornire il numero totale di record il paging tramite</span><span class="sxs-lookup"><span data-stu-id="9cc0f-142">We need to provide the total number of records being paged through</span></span>

<span data-ttu-id="9cc0f-143">I due passaggi successivi esamina lo script SQL necessario per rispondere a questi due problemi.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-143">In the next two steps we'll examine the SQL script needed to respond to these two challenges.</span></span> <span data-ttu-id="9cc0f-144">Oltre agli script SQL, è inoltre necessario implementare i metodi nel DAL e BLL.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-144">In addition to the SQL script, we'll also need to implement methods in the DAL and BLL.</span></span>

## <a name="step-2-returning-the-total-number-of-records-being-paged-through"></a><span data-ttu-id="9cc0f-145">Passaggio 2: Restituzione del numero totale di record il paging tramite</span><span class="sxs-lookup"><span data-stu-id="9cc0f-145">Step 2: Returning the Total Number of Records Being Paged Through</span></span>

<span data-ttu-id="9cc0f-146">Prima di esaminare come recuperare il subset di record per la pagina visualizzata preciso, consentire s descrive come restituire il numero totale di record il paging tramite.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-146">Before we examine how to retrieve the precise subset of records for the page being displayed, let s first look at how to return the total number of records being paged through.</span></span> <span data-ttu-id="9cc0f-147">Queste informazioni sono necessarie per configurare correttamente l'interfaccia utente di paging.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-147">This information is needed in order to properly configure the paging user interface.</span></span> <span data-ttu-id="9cc0f-148">Il numero totale di record restituiti da una particolare query SQL può essere ottenuto utilizzando il [ `COUNT` funzione di aggregazione](https://msdn.microsoft.com/library/ms175997.aspx).</span><span class="sxs-lookup"><span data-stu-id="9cc0f-148">The total number of records returned by a particular SQL query can be obtained by using the [`COUNT` aggregate function](https://msdn.microsoft.com/library/ms175997.aspx).</span></span> <span data-ttu-id="9cc0f-149">Ad esempio, per determinare il numero totale di record di `Products` tabella, è possibile utilizzare la query seguente:</span><span class="sxs-lookup"><span data-stu-id="9cc0f-149">For example, to determine the total number of records in the `Products` table, we can use the following query:</span></span>


[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample1.sql)]

<span data-ttu-id="9cc0f-150">Consente di aggiungere un metodo per il nostro DAL che restituisce le informazioni s.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-150">Let s add a method to our DAL that returns this information.</span></span> <span data-ttu-id="9cc0f-151">In particolare, si creerà un metodo DAL chiamato `TotalNumberOfProducts()` che esegue il `SELECT` istruzione illustrato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-151">In particular, we'll create a DAL method called `TotalNumberOfProducts()` that executes the `SELECT` statement shown above.</span></span>

<span data-ttu-id="9cc0f-152">Aprire il `Northwind.xsd` file DataSet tipizzato nel `App_Code/DAL` cartella.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-152">Start by opening the `Northwind.xsd` Typed DataSet file in the `App_Code/DAL` folder.</span></span> <span data-ttu-id="9cc0f-153">Successivamente, fare clic su di `ProductsTableAdapter` nella finestra di progettazione e scegliere Aggiungi Query.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-153">Next, right-click on the `ProductsTableAdapter` in the Designer and choose Add Query.</span></span> <span data-ttu-id="9cc0f-154">Come si ve illustrata nelle esercitazioni precedenti, questo permetterà di aggiungere un nuovo metodo DAL che, quando richiamata, verrà eseguita una particolare istruzione SQL o stored procedure.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-154">As we ve seen in previous tutorials, this will allow us to add a new method to the DAL that, when invoked, will execute a particular SQL statement or stored procedure.</span></span> <span data-ttu-id="9cc0f-155">Come con i metodi TableAdapter esercitazioni precedenti, in questo caso decidere di usare un'istruzione SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-155">As with our TableAdapter methods in previous tutorials, for this one opt to use an ad-hoc SQL statement.</span></span>


![Utilizzare un'istruzione SQL Ad Hoc](efficiently-paging-through-large-amounts-of-data-cs/_static/image1.png)

<span data-ttu-id="9cc0f-157">**Figura 1**: utilizzare un'istruzione SQL Ad Hoc</span><span class="sxs-lookup"><span data-stu-id="9cc0f-157">**Figure 1**: Use an Ad-Hoc SQL Statement</span></span>


<span data-ttu-id="9cc0f-158">Nella schermata successiva è possibile specificare il tipo di query da creare.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-158">On the next screen we can specify what type of query to create.</span></span> <span data-ttu-id="9cc0f-159">Poiché la query restituirà un singolo valore scalare il numero totale di record di `Products` tabella scegliere la `SELECT` che restituisce un'opzione singola.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-159">Since this query will return a single, scalar value the total number of records in the `Products` table choose the `SELECT` which returns a singe value option.</span></span>


![Configurare la Query per l'utilizzo di un'istruzione SELECT che restituisce un valore singolo](efficiently-paging-through-large-amounts-of-data-cs/_static/image2.png)

<span data-ttu-id="9cc0f-161">**Figura 2**: configurare la Query per l'utilizzo di un'istruzione SELECT che restituisce un valore singolo</span><span class="sxs-lookup"><span data-stu-id="9cc0f-161">**Figure 2**: Configure the Query to Use a SELECT Statement that Returns a Single Value</span></span>


<span data-ttu-id="9cc0f-162">Dopo che indica il tipo di query da utilizzare, è quindi necessario specificare la query.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-162">After indicating the type of query to use, we must next specify the query.</span></span>


![Utilizzo di SELECT Count da Query di prodotti](efficiently-paging-through-large-amounts-of-data-cs/_static/image3.png)

<span data-ttu-id="9cc0f-164">**Figura 3**: utilizza il conteggio SELECT (\*) Query prodotti da</span><span class="sxs-lookup"><span data-stu-id="9cc0f-164">**Figure 3**: Use the SELECT COUNT(\*) FROM Products Query</span></span>


<span data-ttu-id="9cc0f-165">Infine, specificare il nome del metodo.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-165">Finally, specify the name for the method.</span></span> <span data-ttu-id="9cc0f-166">Come s menzionati in precedenza, consentono di utilizzare `TotalNumberOfProducts`.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-166">As aforementioned, let s use `TotalNumberOfProducts`.</span></span>


![Nome di TotalNumberOfProducts DAL metodo](efficiently-paging-through-large-amounts-of-data-cs/_static/image4.png)

<span data-ttu-id="9cc0f-168">**Figura 4**: assegnare un nome di TotalNumberOfProducts DAL metodo</span><span class="sxs-lookup"><span data-stu-id="9cc0f-168">**Figure 4**: Name the DAL Method TotalNumberOfProducts</span></span>


<span data-ttu-id="9cc0f-169">Dopo aver fatto clic su Fine, la procedura guidata aggiungerà il `TotalNumberOfProducts` DAL metodo.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-169">After clicking Finish, the wizard will add the `TotalNumberOfProducts` method to the DAL.</span></span> <span data-ttu-id="9cc0f-170">I metodi di restituzione scalari DAL restituiscono tipi nullable, nel caso in cui il risultato della query SQL `NULL`.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-170">The scalar returning methods in the DAL return nullable types, in case the result from the SQL query is `NULL`.</span></span> <span data-ttu-id="9cc0f-171">Il nostro `COUNT` query, tuttavia, restituirà sempre un non -`NULL` valore; in ogni caso, il metodo DAL restituisce un intero che ammette valori null.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-171">Our `COUNT` query, however, will always return a non-`NULL` value; regardless, the DAL method returns a nullable integer.</span></span>

<span data-ttu-id="9cc0f-172">Oltre al metodo DAL, è necessario anche un metodo in BLL.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-172">In addition to the DAL method, we also need a method in the BLL.</span></span> <span data-ttu-id="9cc0f-173">Aprire il `ProductsBLL` file di classe e aggiungere un `TotalNumberOfProducts` metodo che chiama semplicemente verso il basso per i dispositivi DAL `TotalNumberOfProducts` metodo:</span><span class="sxs-lookup"><span data-stu-id="9cc0f-173">Open the `ProductsBLL` class file and add a `TotalNumberOfProducts` method that simply calls down to the DAL s `TotalNumberOfProducts` method:</span></span>


[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample2.cs)]

<span data-ttu-id="9cc0f-174">S DAL `TotalNumberOfProducts` il metodo restituisce un intero che ammette valori null; tuttavia, si viene creato il `ProductsBLL` classe s `TotalNumberOfProducts` metodo in modo che restituisca un numero intero standard.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-174">The DAL s `TotalNumberOfProducts` method returns a nullable integer; however, we ve created the `ProductsBLL` class s `TotalNumberOfProducts` method so that it returns a standard integer.</span></span> <span data-ttu-id="9cc0f-175">Pertanto, è necessario che il `ProductsBLL` classe s `TotalNumberOfProducts` il metodo restituisce la parte del valore dell'intero ammette valori null restituito da dispositivi DAL `TotalNumberOfProducts` metodo.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-175">Therefore, we need to have the `ProductsBLL` class s `TotalNumberOfProducts` method return the value portion of the nullable integer returned by the DAL s `TotalNumberOfProducts` method.</span></span> <span data-ttu-id="9cc0f-176">La chiamata a `GetValueOrDefault()` restituisce il valore dell'intero ammette valori null, se esistente; se l'integer nullable `null`, tuttavia, restituisce il valore intero predefinito, 0.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-176">The call to `GetValueOrDefault()` returns the value of the nullable integer, if it exists; if the nullable integer is `null`, however, it returns the default integer value, 0.</span></span>

## <a name="step-3-returning-the-precise-subset-of-records"></a><span data-ttu-id="9cc0f-177">Passaggio 3: Restituzione preciso Subset di record</span><span class="sxs-lookup"><span data-stu-id="9cc0f-177">Step 3: Returning the Precise Subset of Records</span></span>

<span data-ttu-id="9cc0f-178">L'attività successiva consiste nel creare metodi nel DAL e BLL che accettano l'indice di riga iniziale e variabili di numero massimo di righe descritti in precedenza e restituiscono i record appropriati.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-178">Our next task is to create methods in the DAL and BLL that accept the Start Row Index and Maximum Rows variables discussed earlier and return the appropriate records.</span></span> <span data-ttu-id="9cc0f-179">Prima di procedere è s consentono di esaminare innanzitutto lo script SQL necessario.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-179">Before we do that, let s first look at the needed SQL script.</span></span> <span data-ttu-id="9cc0f-180">La sfida che ci è che è necessario essere in grado di assegnare in modo efficiente un indice per ogni riga in tutti i risultati in modo che è possibile restituire solo i record a partire dall'indice di riga iniziale (e fino al numero di record massimo di record), tramite il paging.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-180">The challenge facing us is that we must be able to efficiently assign an index to each row in the entire results being paged through so that we can return just those records starting at the Start Row Index (and up to the Maximum Records number of records).</span></span>

<span data-ttu-id="9cc0f-181">Questo non è una richiesta di verifica se è già presente una colonna nella tabella di database che funge da un indice di riga.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-181">This is not a challenge if there is already a column in the database table that serves as a row index.</span></span> <span data-ttu-id="9cc0f-182">A prima vista si potrebbe pensare che il `Products` tabella s `ProductID` campo basterebbe, come prima del prodotto ha `ProductID` pari a 1, 2, il secondo e così via.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-182">At first glance we might think that the `Products` table s `ProductID` field would suffice, as the first product has `ProductID` of 1, the second a 2, and so on.</span></span> <span data-ttu-id="9cc0f-183">Tuttavia, l'eliminazione di un prodotto lascia un gap nella sequenza, annullando questo approccio.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-183">However, deleting a product leaves a gap in the sequence, nullifying this approach.</span></span>

<span data-ttu-id="9cc0f-184">Sono disponibili due tecniche generali consente di associare in modo efficiente un indice di riga con i dati per il paging, consentendo il sottoinsieme preciso di record da recuperare:</span><span class="sxs-lookup"><span data-stu-id="9cc0f-184">There are two general techniques used to efficiently associate a row index with the data to page through, thereby enabling the precise subset of records to be retrieved:</span></span>

- <span data-ttu-id="9cc0f-185">**Utilizzo di SQL Server 2005 s `ROW_NUMBER()` parola chiave** familiarità con SQL Server 2005, il `ROW_NUMBER()` parola chiave associa un valore di pertinenza di ogni record restituito basato sull'ordinamento di alcuni.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-185">**Using SQL Server 2005 s `ROW_NUMBER()` Keyword** new to SQL Server 2005, the `ROW_NUMBER()` keyword associates a ranking with each returned record based on some ordering.</span></span> <span data-ttu-id="9cc0f-186">Questa classificazione è utilizzabile come un indice di riga per ogni riga.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-186">This ranking can be used as a row index for each row.</span></span>
- <span data-ttu-id="9cc0f-187">**Utilizzando una variabile di tabella e `SET ROWCOUNT`**  SQL Server s [ `SET ROWCOUNT` istruzione](https://msdn.microsoft.com/library/ms188774.aspx) può essere usato per specificare il numero di record totale deve elaborare una query prima di interrompere; [le variabili di tabella](http://www.sqlteam.com/item.asp?ItemID=9454) sono variabili locali di T-SQL che possono contenere dati tabulari, akin a [tabelle temporanee](http://www.sqlteam.com/item.asp?ItemID=2029).</span><span class="sxs-lookup"><span data-stu-id="9cc0f-187">**Using a Table Variable and `SET ROWCOUNT`** SQL Server s [`SET ROWCOUNT` statement](https://msdn.microsoft.com/library/ms188774.aspx) can be used to specify how many total records a query should process before terminating; [table variables](http://www.sqlteam.com/item.asp?ItemID=9454) are local T-SQL variables that can hold tabular data, akin to [temporary tables](http://www.sqlteam.com/item.asp?ItemID=2029).</span></span> <span data-ttu-id="9cc0f-188">Questo approccio funziona anche con Microsoft SQL Server 2005 e SQL Server 2000 (mentre il `ROW_NUMBER()` approccio funziona solo con SQL Server 2005).</span><span class="sxs-lookup"><span data-stu-id="9cc0f-188">This approach works equally well with both Microsoft SQL Server 2005 and SQL Server 2000 (whereas the `ROW_NUMBER()` approach only works with SQL Server 2005).</span></span>  
  
  <span data-ttu-id="9cc0f-189">L'idea è creare una variabile di tabella con un `IDENTITY` colonna e le colonne per le chiavi primarie della tabella, il paging tramite cui i dati.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-189">The idea here is to create a table variable that has an `IDENTITY` column and columns for the primary keys of the table whose data is being paged through.</span></span> <span data-ttu-id="9cc0f-190">Successivamente, il contenuto della tabella i cui dati il paging tramite viene archiviato nella variabile di tabella, in tal modo associazione di un indice di riga sequenziali (tramite il `IDENTITY` colonna) per ogni record nella tabella.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-190">Next, the contents of the table whose data is being paged through is dumped into the table variable, thereby associating a sequential row index (via the `IDENTITY` column) for each record in the table.</span></span> <span data-ttu-id="9cc0f-191">Dopo aver compilata la variabile di tabella, una `SELECT` istruzione nella variabile di tabella, unito alla tabella sottostante, è possibile eseguire per estrarre i record specifici.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-191">Once the table variable has been populated, a `SELECT` statement on the table variable, joined with the underlying table, can be executed to pull out the particular records.</span></span> <span data-ttu-id="9cc0f-192">Il `SET ROWCOUNT` istruzione viene utilizzata per limitare in modo intelligente il numero di record che devono essere copiate in una variabile di tabella.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-192">The `SET ROWCOUNT` statement is used to intelligently limit the number of records that need to be dumped into the table variable.</span></span>  
  
  <span data-ttu-id="9cc0f-193">Questa efficienza approccio s è in base al numero di pagina richiesto, come il `SET ROWCOUNT` valore viene assegnato il valore di indice di riga iniziale più il numero massimo di righe.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-193">This approach s efficiency is based on the page number being requested, as the `SET ROWCOUNT` value is assigned the value of Start Row Index plus the Maximum Rows.</span></span> <span data-ttu-id="9cc0f-194">Durante la suddivisione tra le pagine numerate basso, ad esempio il primo alcune pagine di dati in questo approccio è molto efficiente.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-194">When paging through low-numbered pages such as the first few pages of data this approach is very efficient.</span></span> <span data-ttu-id="9cc0f-195">Tuttavia, produce prestazioni simili a paging predefinito durante il recupero di una pagina alla fine.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-195">However, it exhibits default paging-like performance when retrieving a page near the end.</span></span>

<span data-ttu-id="9cc0f-196">Questa esercitazione l'implementazione personalizzata tramite paging le `ROW_NUMBER()` (parola chiave).</span><span class="sxs-lookup"><span data-stu-id="9cc0f-196">This tutorial implements custom paging using the `ROW_NUMBER()` keyword.</span></span> <span data-ttu-id="9cc0f-197">Per ulteriori informazioni sull'utilizzo della variabile di tabella e `SET ROWCOUNT` tecnica, vedere [più efficiente metodo per il Paging tramite grandi set di risultati](http://www.4guysfromrolla.com/webtech/042606-1.shtml).</span><span class="sxs-lookup"><span data-stu-id="9cc0f-197">For more information on using the table variable and `SET ROWCOUNT` technique, see [A More Efficient Method for Paging Through Large Result Sets](http://www.4guysfromrolla.com/webtech/042606-1.shtml).</span></span>

<span data-ttu-id="9cc0f-198">Il `ROW_NUMBER()` (parola chiave) associato un valore di pertinenza di ogni record restituito su un particolare ordinamento utilizzando la sintassi seguente:</span><span class="sxs-lookup"><span data-stu-id="9cc0f-198">The `ROW_NUMBER()` keyword associated a ranking with each record returned over a particular ordering using the following syntax:</span></span>


[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample3.sql)]

<span data-ttu-id="9cc0f-199">`ROW_NUMBER()` Restituisce un valore numerico che specifica l'ordine di priorità per ogni record per quanto riguarda l'ordine indicato.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-199">`ROW_NUMBER()` returns a numerical value that specifies the rank for each record with regards to the indicated ordering.</span></span> <span data-ttu-id="9cc0f-200">Ad esempio, per visualizzare il rango per ogni prodotto, ordinata dalle più costosa minimi, è possibile usare la query seguente seguente:</span><span class="sxs-lookup"><span data-stu-id="9cc0f-200">For example, to see the rank for each product, ordered from the most expensive to the least, we could use the following query:</span></span>


[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample4.sql)]

<span data-ttu-id="9cc0f-201">Figura 5 Mostra questa query risultati s quando eseguito tramite la finestra di query in Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-201">Figure 5 shows this query s results when run through the query window in Visual Studio.</span></span> <span data-ttu-id="9cc0f-202">Si noti che i prodotti vengono ordinati in base al prezzo, insieme a una classificazione di prezzo per ogni riga.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-202">Note that the products are ordered by price, along with a price rank for each row.</span></span>


![È incluso il rango di prezzo per ogni Record restituito](efficiently-paging-through-large-amounts-of-data-cs/_static/image5.png)

<span data-ttu-id="9cc0f-204">**Figura 5**: è incluso il rango di prezzo per ogni Record restituito</span><span class="sxs-lookup"><span data-stu-id="9cc0f-204">**Figure 5**: The Price Rank is Included for Each Returned Record</span></span>


> [!NOTE]
> <span data-ttu-id="9cc0f-205">`ROW_NUMBER()` è solo una delle molte nuove funzioni di rango disponibili in SQL Server 2005.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-205">`ROW_NUMBER()` is just one of the many new ranking functions available in SQL Server 2005.</span></span> <span data-ttu-id="9cc0f-206">Per una descrizione più dettagliata di `ROW_NUMBER()`, insieme alle altre funzioni di rango, leggere [restituzione di risultati classificati con Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml).</span><span class="sxs-lookup"><span data-stu-id="9cc0f-206">For a more thorough discussion of `ROW_NUMBER()`, along with the other ranking functions, read [Returning Ranked Results with Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml).</span></span>


<span data-ttu-id="9cc0f-207">Quando i risultati di classificazione da specificato `ORDER BY` colonna il `OVER` clausola (`UnitPrice`, nell'esempio precedente), è necessario ordinare i risultati in SQL Server.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-207">When ranking the results by the specified `ORDER BY` column in the `OVER` clause (`UnitPrice`, in the above example), SQL Server must sort the results.</span></span> <span data-ttu-id="9cc0f-208">Questa è un'operazione rapida se è un indice cluster per le colonne vengono ordinati i risultati da, o se esiste una copertura di indice, ma può essere più costosi da risolvere in caso contrario.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-208">This is a quick operation if there is a clustered index over the column(s) the results are being ordered by, or if there is a covering index, but can be more costly otherwise.</span></span> <span data-ttu-id="9cc0f-209">Per migliorare le prestazioni per le query sufficientemente grande, considerare l'aggiunta di un indice non cluster per la colonna da cui i risultati vengono ordinati in base.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-209">To help improve performance for sufficiently large queries, consider adding a non-clustered index for the column by which the results are ordered by.</span></span> <span data-ttu-id="9cc0f-210">Vedere [funzioni di rango e le prestazioni in SQL Server 2005](http://www.sql-server-performance.com/ak_ranking_functions.asp) per un'analisi più approfondita delle considerazioni sulle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-210">See [Ranking Functions and Performance in SQL Server 2005](http://www.sql-server-performance.com/ak_ranking_functions.asp) for a more detailed look at the performance considerations.</span></span>

<span data-ttu-id="9cc0f-211">Le informazioni di classificazione restituite da `ROW_NUMBER()` non può essere utilizzata direttamente il `WHERE` clausola.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-211">The ranking information returned by `ROW_NUMBER()` cannot directly be used in the `WHERE` clause.</span></span> <span data-ttu-id="9cc0f-212">Tuttavia, una tabella derivata può essere utilizzata per restituire il `ROW_NUMBER()` risultato, che può quindi essere visualizzati nel `WHERE` clausola.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-212">However, a derived table can be used to return the `ROW_NUMBER()` result, which can then appear in the `WHERE` clause.</span></span> <span data-ttu-id="9cc0f-213">Ad esempio, la query seguente utilizza una tabella derivata per restituire le colonne ProductName e UnitPrice, insieme al `ROW_NUMBER()` risultato e quindi viene utilizzato un `WHERE` clausola per restituire solo i prodotti di priorità il cui prezzo è compreso tra 11 e 20:</span><span class="sxs-lookup"><span data-stu-id="9cc0f-213">For example, the following query uses a derived table to return the ProductName and UnitPrice columns, along with the `ROW_NUMBER()` result, and then uses a `WHERE` clause to only return those products whose price rank is between 11 and 20:</span></span>


[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample5.sql)]

<span data-ttu-id="9cc0f-214">Estensione di un bit ulteriormente questo concetto, che possiamo utilizzare questo approccio per recuperare una pagina specifica di dati in base ai valori di indice di riga iniziale e massimo di righe desiderati:</span><span class="sxs-lookup"><span data-stu-id="9cc0f-214">Extending this concept a bit further, we can utilize this approach to retrieve a specific page of data given the desired Start Row Index and Maximum Rows values:</span></span>


[!code-html[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample6.html)]

> [!NOTE]
> <span data-ttu-id="9cc0f-215">Come verrà illustrato più avanti in questa esercitazione, il *`StartRowIndex`* fornito da ObjectDataSource è indicizzato a partire da zero, mentre il `ROW_NUMBER()` valore restituito da SQL Server 2005 viene indicizzato a partire da 1.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-215">As we will see later on in this tutorial, the *`StartRowIndex`* supplied by the ObjectDataSource is indexed starting at zero, whereas the `ROW_NUMBER()` value returned by SQL Server 2005 is indexed starting at 1.</span></span> <span data-ttu-id="9cc0f-216">Pertanto, il `WHERE` clausola restituisce i record in cui `PriceRank` è rigorosamente maggiore *`StartRowIndex`* e minore o uguale a *`StartRowIndex`*  +  *`MaximumRows`*.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-216">Therefore, the `WHERE` clause returns those records where `PriceRank` is strictly greater than *`StartRowIndex`* and less than or equal to *`StartRowIndex`* + *`MaximumRows`*.</span></span>


<span data-ttu-id="9cc0f-217">Ora che vi viene descritto come `ROW_NUMBER()` può essere utilizzato per recuperare una particolare pagina di dati in base ai valori di indice di riga iniziale e massimo di righe, è ora necessario implementare la logica come metodi in DAL e BLL.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-217">Now that we ve discussed how `ROW_NUMBER()` can be used to retrieve a particular page of data given the Start Row Index and Maximum Rows values, we now need to implement this logic as methods in the DAL and BLL.</span></span>

<span data-ttu-id="9cc0f-218">Durante la creazione di questa query che è necessario decidere l'ordine con cui i risultati verranno classificati; Consente di ordinare i prodotti in base al nome in ordine alfabetico s.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-218">When creating this query we must decide the ordering by which the results will be ranked; let s sort the products by their name in alphabetical order.</span></span> <span data-ttu-id="9cc0f-219">Ciò significa che con l'implementazione di paging personalizzata in questa esercitazione è non sarà in grado di creare un report impaginato personalizzati che possono anche essere ordinati.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-219">This means that with the custom paging implementation in this tutorial we will not be able to create a custom paged report than can also be sorted.</span></span> <span data-ttu-id="9cc0f-220">Nella prossima esercitazione, tuttavia, si vedrà come tale funzionalità può essere fornita.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-220">In the next tutorial, though, we'll see how such functionality can be provided.</span></span>

<span data-ttu-id="9cc0f-221">Nella sezione precedente abbiamo creato il metodo DAL come un'istruzione SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-221">In the previous section we created the DAL method as an ad-hoc SQL statement.</span></span> <span data-ttu-id="9cc0f-222">Sfortunatamente, il parser di T-SQL in Visual Studio utilizzato da t guidata TableAdapter come il `OVER` sintassi utilizzata per il `ROW_NUMBER()` (funzione).</span><span class="sxs-lookup"><span data-stu-id="9cc0f-222">Unfortunately, the T-SQL parser in Visual Studio used by the TableAdapter wizard doesn t like the `OVER` syntax used by the `ROW_NUMBER()` function.</span></span> <span data-ttu-id="9cc0f-223">Pertanto, è necessario creare questo metodo DAL come stored procedure.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-223">Therefore, we must create this DAL method as a stored procedure.</span></span> <span data-ttu-id="9cc0f-224">Selezionare Esplora Server dal menu Visualizza (o hit Ctrl + Alt + S) ed espandere il `NORTHWND.MDF` nodo.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-224">Select the Server Explorer from the View menu (or hit Ctrl+Alt+S) and expand the `NORTHWND.MDF` node.</span></span> <span data-ttu-id="9cc0f-225">Per aggiungere una nuova stored procedure, fare clic sul nodo Stored procedure e scegliere Aggiungi nuova Stored Procedure (vedere Figura 6).</span><span class="sxs-lookup"><span data-stu-id="9cc0f-225">To add a new stored procedure, right-click on the Stored Procedures node and choose Add a New Stored Procedure (see Figure 6).</span></span>


![Aggiungere una nuova Stored Procedure per i prodotti di Paging](efficiently-paging-through-large-amounts-of-data-cs/_static/image6.png)

<span data-ttu-id="9cc0f-227">**Figura 6**: aggiungere una nuova Stored Procedure per il Paging con i prodotti</span><span class="sxs-lookup"><span data-stu-id="9cc0f-227">**Figure 6**: Add a New Stored Procedure for Paging Through the Products</span></span>


<span data-ttu-id="9cc0f-228">Questa stored procedure deve accettare due parametri di input di interi - `@startRowIndex` e `@maximumRows` e utilizzare il `ROW_NUMBER()` funzione ordinati di `ProductName` campo, restituendo soltanto le righe maggiore rispetto al `@startRowIndex` e minore di o uguale a `@startRowIndex`  +  `@maximumRow` s.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-228">This stored procedure should accept two integer input parameters - `@startRowIndex` and `@maximumRows` and use the `ROW_NUMBER()` function ordered by the `ProductName` field, returning only those rows greater than the specified `@startRowIndex` and less than or equal to `@startRowIndex` + `@maximumRow` s.</span></span> <span data-ttu-id="9cc0f-229">Immettere il seguente script in nuova stored procedure e quindi fare clic sull'icona Salva per aggiungere la stored procedure nel database.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-229">Enter the following script into the new stored procedure and then click the Save icon to add the stored procedure to the database.</span></span>


[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample7.sql)]

<span data-ttu-id="9cc0f-230">Dopo aver creato la stored procedure, richiedere qualche istante per testarlo. Fare clic su di `GetProductsPaged` stored procedure, assegnare un nome in Esplora Server e scegliere l'opzione di esecuzione.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-230">After creating the stored procedure, take a moment to test it out. Right-click on the `GetProductsPaged` stored procedure name in the Server Explorer and choose the Execute option.</span></span> <span data-ttu-id="9cc0f-231">Visual Studio verrà quindi richiesto per i parametri di input, `@startRowIndex` e `@maximumRow` s (vedere la figura 7).</span><span class="sxs-lookup"><span data-stu-id="9cc0f-231">Visual Studio will then prompt you for the input parameters, `@startRowIndex` and `@maximumRow` s (see Figure 7).</span></span> <span data-ttu-id="9cc0f-232">Provare diversi valori ed esaminare i risultati.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-232">Try different values and examine the results.</span></span>


![Immettere un valore per il @startRowIndex e @maximumRows parametri](efficiently-paging-through-large-amounts-of-data-cs/_static/image7.png)

<span data-ttu-id="9cc0f-234"><strong>Figura 7</strong>: immettere un valore per il @startRowIndex e @maximumRows parametri</span><span class="sxs-lookup"><span data-stu-id="9cc0f-234"><strong>Figure 7</strong>: Enter a Value for the @startRowIndex and @maximumRows Parameters</span></span>


<span data-ttu-id="9cc0f-235">Dopo la scelta di questi valori di parametri di input, la finestra di Output verrà visualizzati i risultati.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-235">After choosing these input parameters values, the Output window will show the results.</span></span> <span data-ttu-id="9cc0f-236">Figura 8 mostra i risultati per il passaggio 10 per entrambi i `@startRowIndex` e `@maximumRows` parametri.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-236">Figure 8 shows the results when passing in 10 for both the `@startRowIndex` and `@maximumRows` parameters.</span></span>


<span data-ttu-id="9cc0f-237">[![Il record che verrebbero visualizzati nella seconda pagina di dati vengono restituiti](efficiently-paging-through-large-amounts-of-data-cs/_static/image9.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="9cc0f-237">[![The Records That Would Appear in the Second Page of Data are Returned](efficiently-paging-through-large-amounts-of-data-cs/_static/image9.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image8.png)</span></span>

<span data-ttu-id="9cc0f-238">**Figura 8**: il record che verrebbero visualizzati nella seconda pagina di dati vengono restituiti ([fare clic per visualizzare l'immagine ingrandita](efficiently-paging-through-large-amounts-of-data-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="9cc0f-238">**Figure 8**: The Records That Would Appear in the Second Page of Data are Returned ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-cs/_static/image10.png))</span></span>


<span data-ttu-id="9cc0f-239">Con questa stored procedure creata, è nuovamente pronto per creare il `ProductsTableAdapter` metodo.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-239">With this stored procedure created, we re ready to create the `ProductsTableAdapter` method.</span></span> <span data-ttu-id="9cc0f-240">Aprire il `Northwind.xsd` DataSet tipizzato, mouse, la `ProductsTableAdapter`e scegliere l'opzione Aggiungi Query.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-240">Open the `Northwind.xsd` Typed DataSet, right-click in the `ProductsTableAdapter`, and choose the Add Query option.</span></span> <span data-ttu-id="9cc0f-241">Invece di creare la query utilizzando un'istruzione SQL ad hoc, crearlo utilizzando una stored procedure esistente.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-241">Instead of creating the query using an ad-hoc SQL statement, create it using an existing stored procedure.</span></span>


![Creare il metodo DAL utilizzando una Stored Procedure esistente](efficiently-paging-through-large-amounts-of-data-cs/_static/image11.png)

<span data-ttu-id="9cc0f-243">**Figura 9**: creare il metodo DAL utilizzando una Stored Procedure esistente</span><span class="sxs-lookup"><span data-stu-id="9cc0f-243">**Figure 9**: Create the DAL Method Using an Existing Stored Procedure</span></span>


<span data-ttu-id="9cc0f-244">Successivamente, si viene richiesto di selezionare la stored procedure da richiamare.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-244">Next, we are prompted to select the stored procedure to invoke.</span></span> <span data-ttu-id="9cc0f-245">Selezionare il `GetProductsPaged` stored procedure dall'elenco a discesa.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-245">Pick the `GetProductsPaged` stored procedure from the drop-down list.</span></span>


![Scegliere il GetProductsPaged Stored Procedure dall'elenco a discesa](efficiently-paging-through-large-amounts-of-data-cs/_static/image12.png)

<span data-ttu-id="9cc0f-247">**Figura 10**: scegliere il GetProductsPaged Stored Procedure dall'elenco a discesa</span><span class="sxs-lookup"><span data-stu-id="9cc0f-247">**Figure 10**: Choose the GetProductsPaged Stored Procedure from the Drop-Down List</span></span>


<span data-ttu-id="9cc0f-248">Nella schermata successiva viene richiesto il tipo di dati viene restituito dalla stored procedure: dati tabulari, un singolo valore o nessun valore.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-248">The next screen then asks you what kind of data is returned by the stored procedure: tabular data, a single value, or no value.</span></span> <span data-ttu-id="9cc0f-249">Poiché il `GetProductsPaged` stored procedure può restituire più record, indicano che vengono restituiti i dati tabulari.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-249">Since the `GetProductsPaged` stored procedure can return multiple records, indicate that it returns tabular data.</span></span>


![Indicare che la Stored Procedure restituisce dati in formato tabulare](efficiently-paging-through-large-amounts-of-data-cs/_static/image13.png)

<span data-ttu-id="9cc0f-251">**Figura 11**: indicare che la Stored Procedure restituisce dati tabulari</span><span class="sxs-lookup"><span data-stu-id="9cc0f-251">**Figure 11**: Indicate that the Stored Procedure Returns Tabular Data</span></span>


<span data-ttu-id="9cc0f-252">Infine, indicare i nomi dei metodi che si desidera avere creato.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-252">Finally, indicate the names of the methods you want to have created.</span></span> <span data-ttu-id="9cc0f-253">Come con le esercitazioni precedenti, proseguo e crea un oggetto DataTable di metodi usando il riempimento di entrambi e Restituisci un DataTable.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-253">As with our previous tutorials, go ahead and create methods using both the Fill a DataTable and Return a DataTable.</span></span> <span data-ttu-id="9cc0f-254">Denominare il primo metodo `FillPaged` e il secondo `GetProductsPaged`.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-254">Name the first method `FillPaged` and the second `GetProductsPaged`.</span></span>


![Nome FillPaged i metodi e GetProductsPaged](efficiently-paging-through-large-amounts-of-data-cs/_static/image14.png)

<span data-ttu-id="9cc0f-256">**Figura 12**: nome FillPaged i metodi e GetProductsPaged</span><span class="sxs-lookup"><span data-stu-id="9cc0f-256">**Figure 12**: Name the Methods FillPaged and GetProductsPaged</span></span>


<span data-ttu-id="9cc0f-257">È inoltre creare un metodo per restituire una pagina specifica di prodotti, è anche necessario fornire la stessa funzionalità in BLL.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-257">In addition to created a DAL method to return a particular page of products, we also need to provide such functionality in the BLL.</span></span> <span data-ttu-id="9cc0f-258">Analogamente al metodo DAL, s BLL GetProductsPaged metodo deve accettare due input di tipo integer per specificare l'indice di riga iniziale e il numero massimo di righe e deve restituire solo i record che rientrano nell'intervallo specificato.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-258">Like the DAL method, the BLL s GetProductsPaged method must accept two integer inputs for specifying the Start Row Index and Maximum Rows, and must return just those records that fall within the specified range.</span></span> <span data-ttu-id="9cc0f-259">Creare un metodo di BLL nella classe ProductsBLL che semplicemente chiamate verso il basso in oggetti DAL metodo GetProductsPaged, ad esempio:</span><span class="sxs-lookup"><span data-stu-id="9cc0f-259">Create such a BLL method in the ProductsBLL class that merely calls down into the DAL s GetProductsPaged method, like so:</span></span>


[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample8.cs)]

<span data-ttu-id="9cc0f-260">È possibile utilizzare qualsiasi nome per i parametri di input BLL metodo s, ma, come verrà illustrato più avanti, la scelta di utilizzare `startRowIndex` e `maximumRows` ci consente di risparmiare da un'ulteriore bit di lavoro quando si configura un ObjectDataSource per utilizzare questo metodo.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-260">You can use any name for the BLL method s input parameters, but, as we will see shortly, choosing to use `startRowIndex` and `maximumRows` saves us from an extra bit of work when configuring an ObjectDataSource to use this method.</span></span>

## <a name="step-4-configuring-the-objectdatasource-to-use-custom-paging"></a><span data-ttu-id="9cc0f-261">Passaggio 4: Configurazione di ObjectDataSource per utilizzare il Paging personalizzato</span><span class="sxs-lookup"><span data-stu-id="9cc0f-261">Step 4: Configuring the ObjectDataSource to Use Custom Paging</span></span>

<span data-ttu-id="9cc0f-262">Con i metodi BLL e per l'accesso a un determinato subset di record completo, è nuovamente pronto per creare un controllo GridView. controllare che scorre il record sottostante mediante il paging personalizzato.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-262">With the BLL and DAL methods for accessing a particular subset of records complete, we re ready to create a GridView control that pages through its underlying records using custom paging.</span></span> <span data-ttu-id="9cc0f-263">Aprire il `EfficientPaging.aspx` nella pagina di `PagingAndSorting` cartella, aggiungere un controllo GridView alla pagina e configurarlo per l'utilizzo di un nuovo controllo ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-263">Start by opening the `EfficientPaging.aspx` page in the `PagingAndSorting` folder, add a GridView to the page, and configure it to use a new ObjectDataSource control.</span></span> <span data-ttu-id="9cc0f-264">Nelle esercitazioni precedenti, abbiamo spesso ObjectDataSource configurato per l'utilizzo di `ProductsBLL` classe s `GetProducts` metodo.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-264">In our past tutorials, we often had the ObjectDataSource configured to use the `ProductsBLL` class s `GetProducts` method.</span></span> <span data-ttu-id="9cc0f-265">Questa volta, tuttavia, si desidera utilizzare il `GetProductsPaged` (metodo), invece, dopo il `GetProducts` restituisce *tutti* dei prodotti nel database mentre `GetProductsPaged` restituisce solo un subset specifico di record.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-265">This time, however, we want to use the `GetProductsPaged` method instead, since the `GetProducts` method returns *all* of the products in the database whereas `GetProductsPaged` returns just a particular subset of records.</span></span>


![Configurare ObjectDataSource per utilizzare il metodo di classe ProductsBLL s GetProductsPaged](efficiently-paging-through-large-amounts-of-data-cs/_static/image15.png)

<span data-ttu-id="9cc0f-267">**Figura 13**: configurare ObjectDataSource per utilizzare il metodo GetProductsPaged ProductsBLL classe s</span><span class="sxs-lookup"><span data-stu-id="9cc0f-267">**Figure 13**: Configure the ObjectDataSource to Use the ProductsBLL Class s GetProductsPaged Method</span></span>


<span data-ttu-id="9cc0f-268">Poiché è nuovamente la creazione di un controllo GridView di sola lettura, dedicare alcuni minuti per impostare l'elenco di riepilogo a discesa metodo nell'istruzione INSERT, UPDATE ed eliminare le schede su (nessuno).</span><span class="sxs-lookup"><span data-stu-id="9cc0f-268">Since we re creating a read-only GridView, take a moment to set the method drop-down list in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>

<span data-ttu-id="9cc0f-269">Successivamente, la procedura guidata ObjectDataSource richiede Microsoft per le origini del `GetProductsPaged` metodo s `startRowIndex` e `maximumRows` valori di parametri di input.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-269">Next, the ObjectDataSource wizard prompts us for the sources of the `GetProductsPaged` method s `startRowIndex` and `maximumRows` input parameters values.</span></span> <span data-ttu-id="9cc0f-270">Questi parametri di input vengono effettivamente impostati da GridView automaticamente, lasciare l'origine non sufficiente e fare clic su Fine.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-270">These input parameters will actually be set by the GridView automatically, so simply leave the source set to None and click Finish.</span></span>


![Lasciare le origini di parametro di Input come nessuno](efficiently-paging-through-large-amounts-of-data-cs/_static/image16.png)

<span data-ttu-id="9cc0f-272">**Figura 14**: lasciare le origini di parametro di Input come nessuno</span><span class="sxs-lookup"><span data-stu-id="9cc0f-272">**Figure 14**: Leave the Input Parameter Sources as None</span></span>


<span data-ttu-id="9cc0f-273">Dopo aver completato la procedura guidata ObjectDataSource, GridView conterrà un BoundField o CheckBoxField per ognuno dei campi dati di prodotto.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-273">After completing the ObjectDataSource wizard, the GridView will contain a BoundField or CheckBoxField for each of the product data fields.</span></span> <span data-ttu-id="9cc0f-274">È possibile personalizzare l'aspetto di GridView s secondo necessità.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-274">Feel free to tailor the GridView s appearance as you see fit.</span></span> <span data-ttu-id="9cc0f-275">Si va scelto per visualizzare solo il `ProductName`, `CategoryName`, `SupplierName`, `QuantityPerUnit`, e `UnitPrice` BoundField.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-275">I ve opted to display only the `ProductName`, `CategoryName`, `SupplierName`, `QuantityPerUnit`, and `UnitPrice` BoundFields.</span></span> <span data-ttu-id="9cc0f-276">Inoltre, configurare GridView per supportare il paging selezionando la casella di controllo Abilita Paging smart tag.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-276">Also, configure the GridView to support paging by checking the Enable Paging checkbox in its smart tag.</span></span> <span data-ttu-id="9cc0f-277">Dopo aver apportato queste modifiche, il markup dichiarativo GridView e ObjectDataSource dovrebbe essere simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="9cc0f-277">After these changes, the GridView and ObjectDataSource declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample9.aspx)]

<span data-ttu-id="9cc0f-278">Se si visita la pagina tramite un browser, tuttavia, GridView non è alcun elemento da cui deve essere trovato.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-278">If you visit the page through a browser, however, the GridView is no where to be found.</span></span>


![GridView non è visualizzato](efficiently-paging-through-large-amounts-of-data-cs/_static/image17.png)

<span data-ttu-id="9cc0f-280">**Figura 15**: GridView non è visualizzati</span><span class="sxs-lookup"><span data-stu-id="9cc0f-280">**Figure 15**: The GridView is Not Displayed</span></span>


<span data-ttu-id="9cc0f-281">GridView non è disponibile perché ObjectDataSource è attualmente in uso 0 come valori per entrambe le `GetProductsPaged` `startRowIndex` e `maximumRows` i parametri di input.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-281">The GridView is missing because the ObjectDataSource is currently using 0 as the values for both of the `GetProductsPaged` `startRowIndex` and `maximumRows` input parameters.</span></span> <span data-ttu-id="9cc0f-282">Di conseguenza, la query SQL risultante non restituisce Nessun record e pertanto non viene visualizzato il controllo GridView.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-282">Hence, the resulting SQL query is returning no records and therefore the GridView is not displayed.</span></span>

<span data-ttu-id="9cc0f-283">Per risolvere questo problema, è necessario configurare ObjectDataSource per utilizzare il paging personalizzato.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-283">To remedy this, we need to configure the ObjectDataSource to use custom paging.</span></span> <span data-ttu-id="9cc0f-284">Questo può essere eseguito nei passaggi seguenti:</span><span class="sxs-lookup"><span data-stu-id="9cc0f-284">This can be accomplished in the following steps:</span></span>

1. <span data-ttu-id="9cc0f-285">**Impostare s ObjectDataSource `EnablePaging` proprietà da `true`**  ciò indica a ObjectDataSource che deve passare per il `SelectMethod` due parametri aggiuntivi: uno per specificare l'indice di riga iniziale ([ `StartRowIndexParameterName` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.startrowindexparametername.aspx)) e uno per specificare il numero massimo di righe ([`MaximumRowsParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.maximumrowsparametername.aspx)).</span><span class="sxs-lookup"><span data-stu-id="9cc0f-285">**Set the ObjectDataSource s `EnablePaging` property to `true`** this indicates to the ObjectDataSource that it must pass to the `SelectMethod` two additional parameters: one to specify the Start Row Index ([`StartRowIndexParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.startrowindexparametername.aspx)), and one to specify the Maximum Rows ([`MaximumRowsParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.maximumrowsparametername.aspx)).</span></span>
2. <span data-ttu-id="9cc0f-286">**Impostare s ObjectDataSource `StartRowIndexParameterName` e `MaximumRowsParameterName` proprietà conseguenza** il `StartRowIndexParameterName` e `MaximumRowsParameterName` proprietà indicano i nomi dei parametri di input passati il `SelectMethod` per scopi di paging personalizzata.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-286">**Set the ObjectDataSource s `StartRowIndexParameterName` and `MaximumRowsParameterName` Properties Accordingly** the `StartRowIndexParameterName` and `MaximumRowsParameterName` properties indicate the names of the input parameters passed into the `SelectMethod` for custom paging purposes.</span></span> <span data-ttu-id="9cc0f-287">Per impostazione predefinita, questi nomi di parametro sono `startIndexRow` e `maximumRows`, per questo motivo, quando si crea il `GetProductsPaged` metodo in BLL, si usa questi valori per i parametri di input.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-287">By default, these parameter names are `startIndexRow` and `maximumRows`, which is why, when creating the `GetProductsPaged` method in the BLL, I used these values for the input parameters.</span></span> <span data-ttu-id="9cc0f-288">Se si sceglie di utilizzare nomi di parametro diversi per s BLL `GetProductsPaged` metodo, ad esempio `startIndex` e `maxRows`, ad esempio, è necessario imposta il s ObjectDataSource `StartRowIndexParameterName` e `MaximumRowsParameterName` proprietà conseguenza (ad esempio startIndex per `StartRowIndexParameterName` e maxRows per `MaximumRowsParameterName`).</span><span class="sxs-lookup"><span data-stu-id="9cc0f-288">If you chose to use different parameter names for the BLL s `GetProductsPaged` method such as `startIndex` and `maxRows`, for example you would need to set the ObjectDataSource s `StartRowIndexParameterName` and `MaximumRowsParameterName` properties accordingly (such as startIndex for `StartRowIndexParameterName` and maxRows for `MaximumRowsParameterName`).</span></span>
3. <span data-ttu-id="9cc0f-289">**Impostare il s ObjectDataSource [ `SelectCountMethod` proprietà](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.selectcountmethod(VS.80).aspx) sul nome del metodo che restituisce il totale numero di record in fase di paging tramite (`TotalNumberOfProducts`)** si tenga presente che la `ProductsBLL` classe s `TotalNumberOfProducts`metodo restituisce il numero totale di record mediante un metodo DAL che viene eseguito il paging una `SELECT COUNT(*) FROM Products` query.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-289">**Set the ObjectDataSource s [`SelectCountMethod` Property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.selectcountmethod(VS.80).aspx) to the Name of the Method that Returns the Total Number of Records Being Paged Through (`TotalNumberOfProducts`)** recall that the `ProductsBLL` class s `TotalNumberOfProducts` method returns the total number of records being paged through using a DAL method that executes a `SELECT COUNT(*) FROM Products` query.</span></span> <span data-ttu-id="9cc0f-290">Queste informazioni sono necessarie da ObjectDataSource per correttamente il rendering dell'interfaccia di paging.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-290">This information is needed by the ObjectDataSource in order to correctly render the paging interface.</span></span>
4. <span data-ttu-id="9cc0f-291">**Rimuovere il `startRowIndex` e `maximumRows` `<asp:Parameter>` elementi da ObjectDataSource s Markup dichiarativo** quando si configura il ObjectDataSource tramite la procedura guidata, Visual Studio aggiunte automaticamente due `<asp:Parameter>` elementi per il `GetProductsPaged` metodo s parametri di input.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-291">**Remove the `startRowIndex` and `maximumRows` `<asp:Parameter>` Elements from the ObjectDataSource s Declarative Markup** when configuring the ObjectDataSource through the wizard, Visual Studio automatically added two `<asp:Parameter>` elements for the `GetProductsPaged` method s input parameters.</span></span> <span data-ttu-id="9cc0f-292">Impostando `EnablePaging` a `true`, questi parametri verranno passati automaticamente; se sono visualizzate anche nella sintassi dichiarativa, un tentativo di passare ObjectDataSource *quattro* parametri per il `GetProductsPaged` (metodo) e due parametri per il `TotalNumberOfProducts` metodo.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-292">By setting `EnablePaging` to `true`, these parameters will be passed automatically; if they also appear in the declarative syntax, the ObjectDataSource will attempt to pass *four* parameters to the `GetProductsPaged` method and two parameters to the `TotalNumberOfProducts` method.</span></span> <span data-ttu-id="9cc0f-293">Se si dimentica di rimuoverli `<asp:Parameter>` elementi, durante la visita la pagina tramite un browser, si otterrà un messaggio di errore: *ObjectDataSource 'ObjectDataSource1' Impossibile trovare un metodo non generico 'TotalNumberOfProducts' con parametri: startRowIndex, maximumRows*.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-293">If you forget to remove these `<asp:Parameter>` elements, when visiting the page through a browser you'll get an error message like: *ObjectDataSource 'ObjectDataSource1' could not find a non-generic method 'TotalNumberOfProducts' that has parameters: startRowIndex, maximumRows*.</span></span>

<span data-ttu-id="9cc0f-294">Dopo aver apportato queste modifiche, la sintassi dichiarativa s ObjectDataSource dovrebbe essere simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="9cc0f-294">After making these changes, the ObjectDataSource s declarative syntax should look like the following:</span></span>


[!code-aspx[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample10.aspx)]

<span data-ttu-id="9cc0f-295">Si noti che il `EnablePaging` e `SelectCountMethod` sono state impostate e `<asp:Parameter>` sono stati rimossi elementi.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-295">Note that the `EnablePaging` and `SelectCountMethod` properties have been set and the `<asp:Parameter>` elements have been removed.</span></span> <span data-ttu-id="9cc0f-296">La figura 16 mostra una cattura di schermata della finestra Proprietà dopo avere apportate queste modifiche.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-296">Figure 16 shows a screen shot of the Properties window after these changes have been made.</span></span>


![Per utilizzare il Paging personalizzato, configurare il controllo ObjectDataSource](efficiently-paging-through-large-amounts-of-data-cs/_static/image18.png)

<span data-ttu-id="9cc0f-298">**Figura 16**: per utilizzare il Paging personalizzato, configurare il controllo ObjectDataSource</span><span class="sxs-lookup"><span data-stu-id="9cc0f-298">**Figure 16**: To Use Custom Paging, Configure the ObjectDataSource Control</span></span>


<span data-ttu-id="9cc0f-299">Dopo aver apportato queste modifiche, visitare la pagina tramite un browser.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-299">After making these changes, visit this page through a browser.</span></span> <span data-ttu-id="9cc0f-300">Dovrebbe essere 10 prodotti nell'elenco, ordinato in ordine alfabetico.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-300">You should see 10 products listed, ordered alphabetically.</span></span> <span data-ttu-id="9cc0f-301">È opportuno esaminare i dati una pagina alla volta.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-301">Take a moment to step through the data one page at a time.</span></span> <span data-ttu-id="9cc0f-302">Anche se non vi è alcuna differenza visual dal punto di vista s dell'utente finale tra paging predefinito e il paging personalizzato, in modo più efficiente il paging personalizzato pagine grandi quantità di dati recupera solo i record che devono essere visualizzati per una determinata pagina.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-302">While there is no visual difference from the end user s perspective between default paging and custom paging, custom paging more efficiently pages through large amounts of data as it only retrieves those records that need to be displayed for a given page.</span></span>


<span data-ttu-id="9cc0f-303">[![I dati, ordinato in base al prodotto s nome, è di paging utilizzando Paging personalizzata](efficiently-paging-through-large-amounts-of-data-cs/_static/image20.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="9cc0f-303">[![The Data, Ordered by the Product s Name, is Paged Using Custom Paging](efficiently-paging-through-large-amounts-of-data-cs/_static/image20.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image19.png)</span></span>

<span data-ttu-id="9cc0f-304">**Figura 17**: dei dati, ordinato in base al prodotto s nome, è di paging utilizzando Paging personalizzata ([fare clic per visualizzare l'immagine ingrandita](efficiently-paging-through-large-amounts-of-data-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="9cc0f-304">**Figure 17**: The Data, Ordered by the Product s Name, is Paged Using Custom Paging ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-cs/_static/image21.png))</span></span>


> [!NOTE]
> <span data-ttu-id="9cc0f-305">Con il paging personalizzato, la pagina conteggio valore restituito da ObjectDataSource s `SelectCountMethod` viene archiviato nello stato di visualizzazione s GridView.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-305">With custom paging, the page count value returned by the ObjectDataSource�s `SelectCountMethod` is stored in the GridView�s view state.</span></span> <span data-ttu-id="9cc0f-306">Altre variabili GridView il `PageIndex`, `EditIndex`, `SelectedIndex`, `DataKeys` insieme e così via vengono archiviati in *lo stato del controllo*, che viene mantenuto indipendentemente dal valore di GridView s `EnableViewState` proprietà.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-306">Other GridView variables the `PageIndex`, `EditIndex`, `SelectedIndex`, `DataKeys` collection, and so on are stored in *control state*, which is persisted regardless of the value of the GridView�s `EnableViewState` property.</span></span> <span data-ttu-id="9cc0f-307">Poiché il `PageCount` valore viene mantenuto durante i postback utilizzando lo stato di visualizzazione, quando si utilizza un'interfaccia di paging che include un collegamento per accedere all'ultima pagina, è necessario che lo stato di visualizzazione GridView s essere abilitato.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-307">Since the `PageCount` value is persisted across postbacks using view state, when using a paging interface that includes a link to take you to the last page, it is imperative that the GridView�s view state be enabled.</span></span> <span data-ttu-id="9cc0f-308">(Se l'interfaccia di paging non è incluso un collegamento diretto all'ultima pagina, quindi è possibile disabilitare lo stato di visualizzazione)</span><span class="sxs-lookup"><span data-stu-id="9cc0f-308">(If your paging interface does not include a direct link to the last page, then you may disable view state.)</span></span>


<span data-ttu-id="9cc0f-309">Facendo clic sull'ultimo collegamento di pagina provoca un postback e indica al controllo GridView. per aggiornare il relativo `PageIndex` proprietà.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-309">Clicking the last page link causes a postback and instructs the GridView to update its `PageIndex` property.</span></span> <span data-ttu-id="9cc0f-310">Se si fa clic sull'ultimo collegamento di pagina, GridView assegna relativo `PageIndex` proprietà su un valore minore di relativo `PageCount` proprietà.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-310">If the last page link is clicked, the GridView assigns its `PageIndex` property to a value one less than its `PageCount` property.</span></span> <span data-ttu-id="9cc0f-311">Lo stato di visualizzazione è disabilitato, il `PageCount` valore viene persa durante i postback e `PageIndex` viene assegnato il valore integer massimo invece.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-311">With view state disabled, the `PageCount` value is lost across postbacks and the `PageIndex` is assigned the maximum integer value instead.</span></span> <span data-ttu-id="9cc0f-312">Successivamente, GridView tenta di determinare l'indice di riga iniziale moltiplicando il `PageSize` e `PageCount` proprietà.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-312">Next, the GridView attempts to determine the starting row index by multiplying the `PageSize` and `PageCount` properties.</span></span> <span data-ttu-id="9cc0f-313">Ciò comporta un `OverflowException` poiché il prodotto supera le dimensioni di numero intero massimo consentito.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-313">This results in an `OverflowException` since the product exceeds the maximum allowed integer size.</span></span>

## <a name="implement-custom-paging-and-sorting"></a><span data-ttu-id="9cc0f-314">Il Paging personalizzato di implementare e ordinamento</span><span class="sxs-lookup"><span data-stu-id="9cc0f-314">Implement Custom Paging and Sorting</span></span>

<span data-ttu-id="9cc0f-315">L'implementazione personalizzata di paging corrente richiede che l'ordine con cui i dati viene eseguito il paging tramite venga specificato in modo statico durante la creazione di `GetProductsPaged` stored procedure.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-315">Our current custom paging implementation requires that the order by which the data is paged through be specified statically when creating the `GetProductsPaged` stored procedure.</span></span> <span data-ttu-id="9cc0f-316">Tuttavia, si potrebbe hanno evidenziato che lo smart tag s di GridView contiene una casella di controllo Abilita ordinamento oltre all'opzione Abilita Paging.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-316">However, you may have noted that the GridView s smart tag contains an Enable Sorting checkbox in addition to the Enable Paging option.</span></span> <span data-ttu-id="9cc0f-317">Purtroppo, aggiungere il supporto dell'ordinamento GridView con l'implementazione personalizzata di paging corrente solo ordinare i record nella pagina visualizzata dei dati.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-317">Unfortunately, adding sorting support to the GridView with our current custom paging implementation will only sort the records on the currently viewed page of data.</span></span> <span data-ttu-id="9cc0f-318">Ad esempio, se si configura il controllo GridView per supportare anche il paging e quindi, quando si visualizzano la prima pagina di dati, ordinare in base al nome di prodotto in ordine decrescente, verrà invertire l'ordine dei prodotti nella pagina 1.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-318">For example, if you configure the GridView to also support paging and then, when viewing the first page of data, sort by product name in descending order, it will reverse the order of the products on page 1.</span></span> <span data-ttu-id="9cc0f-319">Come mostrato nella figura 18, ad esempio Leoni Carnarvon Mostra come prima del prodotto durante l'ordinamento in ordine alfabetico inverso, che ignora i 71 altri prodotti che seguono in ordine alfabetico; Leoni Carnarvon, il tipo di ordinamento vengono considerati solo i record nella prima pagina.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-319">As Figure 18 shows, such shows Carnarvon Tigers as the first product when sorting in reverse alphabetical order, which ignores the 71 other products that come after Carnarvon Tigers, alphabetically; only those records on the first page are considered in the sorting.</span></span>


<span data-ttu-id="9cc0f-320">[![Solo i dati visualizzati nella pagina corrente viene ordinato](efficiently-paging-through-large-amounts-of-data-cs/_static/image23.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="9cc0f-320">[![Only the Data Shown on the Current Page is Sorted](efficiently-paging-through-large-amounts-of-data-cs/_static/image23.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image22.png)</span></span>

<span data-ttu-id="9cc0f-321">**Figura 18**: solo i dati visualizzati nella pagina corrente viene ordinato ([fare clic per visualizzare l'immagine ingrandita](efficiently-paging-through-large-amounts-of-data-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="9cc0f-321">**Figure 18**: Only the Data Shown on the Current Page is Sorted ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-cs/_static/image24.png))</span></span>


<span data-ttu-id="9cc0f-322">L'ordinamento si applica solo alla pagina corrente dei dati perché l'ordinamento avviene dopo i dati sono stati recuperati da s BLL `GetProductsPaged` metodo e questo metodo restituisce solo i record per la pagina specifica.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-322">The sorting only applies to the current page of data because the sorting is occurring after the data has been retrieved from the BLL s `GetProductsPaged` method, and this method only returns those records for the specific page.</span></span> <span data-ttu-id="9cc0f-323">Per implementare l'ordinamento in modo corretto, è necessario passare l'espressione di ordinamento per il `GetProductsPaged` metodo in modo che i dati è possibile classificare in modo appropriato prima di restituire la pagina di dati specifica.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-323">To implement sorting correctly, we need to pass the sort expression to the `GetProductsPaged` method so that the data can be ranked appropriately before returning the specific page of data.</span></span> <span data-ttu-id="9cc0f-324">Vedremo come effettuare questa operazione nell'esercitazione successiva.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-324">We'll see how to accomplish this in our next tutorial.</span></span>

## <a name="implementing-custom-paging-and-deleting"></a><span data-ttu-id="9cc0f-325">Implementazione personalizzata di Paging e l'eliminazione</span><span class="sxs-lookup"><span data-stu-id="9cc0f-325">Implementing Custom Paging and Deleting</span></span>

<span data-ttu-id="9cc0f-326">Se è la funzionalità di eliminazione in un controllo GridView viene eseguito il paging i cui dati utilizzando le tecniche di paging personalizzata, si noterà che durante l'eliminazione dell'ultimo record dall'ultima pagina di attivazione, GridView scompare anziché in modo appropriato il decremento GridView s `PageIndex`.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-326">If you enabling deleting functionality in a GridView whose data is paged using custom paging techniques you will find that when deleting the last record from the last page, the GridView disappears rather than appropriately decrementing the GridView s `PageIndex`.</span></span> <span data-ttu-id="9cc0f-327">Per riprodurre il bug, consente di eliminare per l'esercitazione che appena appena creato.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-327">To reproduce this bug, enable deleting for the tutorial just we just created.</span></span> <span data-ttu-id="9cc0f-328">Passare all'ultima pagina (pagina 9), in cui dovrebbe essere un singolo prodotto poiché ci stiamo paging 81 prodotti, 10 alla volta.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-328">Go to the last page (page 9), where you should see a single product since we are paging through 81 products, 10 products at a time.</span></span> <span data-ttu-id="9cc0f-329">Eliminare questo prodotto.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-329">Delete this product.</span></span>

<span data-ttu-id="9cc0f-330">In seguito all'eliminazione del prodotto ultimo, GridView *deve* automaticamente passare alla pagina ottava e tale funzionalità viene esposto con paging predefinito.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-330">Upon deleting the last product, the GridView *should* automatically go to the eighth page, and such functionality is exhibited with default paging.</span></span> <span data-ttu-id="9cc0f-331">Con il paging personalizzato, tuttavia, dopo aver eliminato l'ultimo prodotto nell'ultima pagina, GridView semplicemente scomparirà dalla schermata completamente.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-331">With custom paging, however, after deleting that last product on the last page, the GridView simply disappears from the screen altogether.</span></span> <span data-ttu-id="9cc0f-332">Il motivo esatto *perché* questo errore si verifica un po' esula dall'ambito di questa esercitazione, vedere [l'eliminazione dell'ultimo Record nell'ultima pagina da un controllo GridView con Paging personalizzata](http://scottonwriting.net/sowblog/posts/7326.aspx) per i dettagli di basso livello per l'origine di Questo problema.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-332">The precise reason *why* this happens is a bit beyond the scope of this tutorial; see [Deleting the Last Record on the Last Page from a GridView with Custom Paging](http://scottonwriting.net/sowblog/posts/7326.aspx) for the low-level details as to the source of this problem.</span></span> <span data-ttu-id="9cc0f-333">In breve, s a causa la sequenza di passaggi che vengono eseguiti dal controllo GridView. quando si fa clic sul pulsante Elimina seguente:</span><span class="sxs-lookup"><span data-stu-id="9cc0f-333">In summary it s due to the following sequence of steps that are performed by the GridView when the Delete button is clicked:</span></span>

1. <span data-ttu-id="9cc0f-334">Eliminare il record</span><span class="sxs-lookup"><span data-stu-id="9cc0f-334">Delete the record</span></span>
2. <span data-ttu-id="9cc0f-335">Ottenere i record da visualizzare per l'oggetto specificato `PageIndex` e `PageSize`</span><span class="sxs-lookup"><span data-stu-id="9cc0f-335">Get the appropriate records to display for the specified `PageIndex` and `PageSize`</span></span>
3. <span data-ttu-id="9cc0f-336">Verificare che il `PageIndex` non superi il numero di pagine di dati nell'origine dati; se, riduce automaticamente s GridView `PageIndex` proprietà</span><span class="sxs-lookup"><span data-stu-id="9cc0f-336">Check to ensure that the `PageIndex` does not exceed the number of pages of data in the data source; if it does, automatically decrement the GridView s `PageIndex` property</span></span>
4. <span data-ttu-id="9cc0f-337">Associare la pagina appropriata di dati a GridView mediante i record ottenuti nel passaggio 2</span><span class="sxs-lookup"><span data-stu-id="9cc0f-337">Bind the appropriate page of data to the GridView using the records obtained in Step 2</span></span>

<span data-ttu-id="9cc0f-338">Il problema deriva dal fatto che in 2 di passaggio di `PageIndex` utilizzato quando l'acquisizione di record da visualizzare è ancora il `PageIndex` dell'ultima pagina il cui unico record è stata eliminata.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-338">The problem stems from the fact that in Step 2 the `PageIndex` used when grabbing the records to display is still the `PageIndex` of the last page whose sole record was just deleted.</span></span> <span data-ttu-id="9cc0f-339">Pertanto, nel passaggio 2, *non* vengono restituiti record, poiché l'ultima pagina di dati non contiene alcun record.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-339">Therefore, in Step 2, *no* records are returned since that last page of data no longer contains any records.</span></span> <span data-ttu-id="9cc0f-340">Quindi, nel passaggio 3, GridView è consapevole del fatto che il relativo `PageIndex` proprietà è maggiore del numero totale di pagine nell'origine dati (poiché è ve eliminato l'ultimo record nell'ultima pagina) e pertanto decrementa il `PageIndex` proprietà.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-340">Then, in Step 3, the GridView realizes that its `PageIndex` property is greater than the total number of pages in the data source (since we ve deleted the last record in the last page) and therefore decrements its `PageIndex` property.</span></span> <span data-ttu-id="9cc0f-341">Nel passaggio 4 GridView tenta di associarsi ai dati recuperati nel passaggio 2. Tuttavia, nel passaggio 2 ha restituito alcun record, generando un GridView vuoto.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-341">In Step 4 the GridView attempts to bind itself to the data retrieved in Step 2; however, in Step 2 no records were returned, therefore resulting in an empty GridView.</span></span> <span data-ttu-id="9cc0f-342">Con il paging predefinito, questo t problema area poiché nel passaggio 2 *tutti* vengono recuperati i record dall'origine dati.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-342">With default paging, this problem doesn t surface because in Step 2 *all* records are retrieved from the data source.</span></span>

<span data-ttu-id="9cc0f-343">Per risolvere questo problema sono disponibili due opzioni.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-343">To fix this we have two options.</span></span> <span data-ttu-id="9cc0f-344">La prima consiste nel creare un gestore eventi per s GridView `RowDeleted` gestore dell'evento che determina il numero di record sono stato visualizzato nella pagina che è stata eliminata.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-344">The first is to create an event handler for the GridView s `RowDeleted` event handler that determines how many records were displayed in the page that was just deleted.</span></span> <span data-ttu-id="9cc0f-345">Se si è verificato un solo record, il record appena eliminato deve essere state ultimo quindi è necessario diminuire il s GridView `PageIndex`.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-345">If there was only one record, then the record just deleted must have been the last one and we need to decrement the GridView s `PageIndex`.</span></span> <span data-ttu-id="9cc0f-346">Naturalmente, si desidera aggiornare solo il `PageIndex` se l'operazione di eliminazione è riuscita in realtà, che è possibile determinare assicurando che il `e.Exception` proprietà `null`.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-346">Of course, we only want to update the `PageIndex` if the delete operation was actually successful, which can be determined by ensuring that the `e.Exception` property is `null`.</span></span>

<span data-ttu-id="9cc0f-347">Questo approccio funziona perché viene aggiornato il `PageIndex` dopo il passaggio 1 ma prima del passaggio 2.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-347">This approach works because it updates the `PageIndex` after Step 1 but before Step 2.</span></span> <span data-ttu-id="9cc0f-348">Pertanto, nel passaggio 2, viene restituito il set di record appropriato.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-348">Therefore, in Step 2, the appropriate set of records is returned.</span></span> <span data-ttu-id="9cc0f-349">A tale scopo, utilizzare codice simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="9cc0f-349">To accomplish this, use code like the following:</span></span>


[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample11.cs)]

<span data-ttu-id="9cc0f-350">Una soluzione alternativa consiste nel creare un gestore eventi per i dispositivi ObjectDataSource `RowDeleted` evento e impostare il `AffectedRows` su un valore pari a 1.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-350">An alternative workaround is to create an event handler for the ObjectDataSource s `RowDeleted` event and to set the `AffectedRows` property to a value of 1.</span></span> <span data-ttu-id="9cc0f-351">Dopo aver eliminato il record nel passaggio 1 (ma prima di recuperare nuovamente i dati nel passaggio 2), Aggiorna GridView relativo `PageIndex` proprietà se una o più righe sono state interessate dall'operazione.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-351">After deleting the record in Step 1 (but before re-retrieving the data in Step 2), the GridView updates its `PageIndex` property if one or more rows were affected by the operation.</span></span> <span data-ttu-id="9cc0f-352">Tuttavia, il `AffectedRows` non è impostata da ObjectDataSource e pertanto questo passaggio viene omesso.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-352">However, the `AffectedRows` property is not set by the ObjectDataSource and therefore this step is omitted.</span></span> <span data-ttu-id="9cc0f-353">Per disporre di questo passaggio eseguito è possibile impostare manualmente la `AffectedRows` proprietà se l'operazione di eliminazione viene completata correttamente.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-353">One way to have this step executed is to manually set the `AffectedRows` property if the delete operation completes successfully.</span></span> <span data-ttu-id="9cc0f-354">Questa può essere eseguita tramite codice simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="9cc0f-354">This can be accomplished using code like the following:</span></span>


[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample12.cs)]

<span data-ttu-id="9cc0f-355">Il codice per entrambi questi gestori eventi, vedere la classe code-behind del `EfficientPaging.aspx` esempio.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-355">The code for both of these events handlers can be found in code-behind class of the `EfficientPaging.aspx` example.</span></span>

## <a name="comparing-the-performance-of-default-and-custom-paging"></a><span data-ttu-id="9cc0f-356">Confronto tra le prestazioni dell'impostazione predefinita e il Paging personalizzato</span><span class="sxs-lookup"><span data-stu-id="9cc0f-356">Comparing the Performance of Default and Custom Paging</span></span>

<span data-ttu-id="9cc0f-357">Poiché il paging personalizzato recupera solo i record necessari, mentre restituisce paging predefinito *tutti* dei record per ogni pagina visualizzata, è s deselezionare che risulta più efficiente del paging predefinito il paging personalizzato.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-357">Since custom paging only retrieves the needed records, whereas default paging returns *all* of the records for each page being viewed, it s clear that custom paging is more efficient than default paging.</span></span> <span data-ttu-id="9cc0f-358">Tuttavia, solo quanto più efficiente, è il paging personalizzato?</span><span class="sxs-lookup"><span data-stu-id="9cc0f-358">But just how much more efficient is custom paging?</span></span> <span data-ttu-id="9cc0f-359">Il tipo di miglioramento delle prestazioni può essere visualizzato mediante lo spostamento da paging predefinito per il paging personalizzato?</span><span class="sxs-lookup"><span data-stu-id="9cc0f-359">What sort of performance gains can be seen by moving from default paging to custom paging?</span></span>

<span data-ttu-id="9cc0f-360">Purtroppo, s non esiste alcuna dimensione non adatta a rispondere a tutti qui.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-360">Unfortunately, there s no one size fits all answer here.</span></span> <span data-ttu-id="9cc0f-361">Il miglioramento delle prestazioni dipende da numerosi fattori, più rilevante due il numero di record, il paging tramite e il carico viene posizionato sui database server e canali di comunicazione tra il server web e il server di database.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-361">The performance gain depends on a number of factors, the most prominent two being the number of records being paged through and the load placed on the database server and communication channels between the web server and database server.</span></span> <span data-ttu-id="9cc0f-362">Per le tabelle di piccole dimensioni con pochi decine record, la differenza di prestazioni può essere ignorabile.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-362">For small tables with just a few dozen records, the performance difference may be negligible.</span></span> <span data-ttu-id="9cc0f-363">Per le tabelle di grandi dimensioni, migliaia a centinaia di migliaia di righe, tuttavia, la differenza di prestazioni è acuta.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-363">For large tables, with thousands to hundreds of thousands of rows, though, the performance difference is acute.</span></span>

<span data-ttu-id="9cc0f-364">Un articolo di essi, [il Paging personalizzato in ASP.NET 2.0 con SQL Server 2005](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx), contiene alcuni test è stata eseguita per mostrare le differenze di prestazioni tra queste due tecniche di paging quando il paging di una tabella di database con 50.000 record.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-364">An article of mine, [Custom Paging in ASP.NET 2.0 with SQL Server 2005](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx), contains some performance tests I ran to exhibit the differences in performance between these two paging techniques when paging through a database table with 50,000 records.</span></span> <span data-ttu-id="9cc0f-365">In questi test è esaminato sia il tempo per eseguire la query a livello di SQL Server (utilizzando [SQL Profiler](https://msdn.microsoft.com/library/ms173757.aspx)) e di pagina ASP.NET utilizzando [funzionalità di traccia di ASP.NET s](https://msdn.microsoft.com/library/y13fw6we.aspx).</span><span class="sxs-lookup"><span data-stu-id="9cc0f-365">In these tests I examined both the time to execute the query at the SQL Server level (using [SQL Profiler](https://msdn.microsoft.com/library/ms173757.aspx)) and at the ASP.NET page using [ASP.NET s tracing features](https://msdn.microsoft.com/library/y13fw6we.aspx).</span></span> <span data-ttu-id="9cc0f-366">Tenere presente che questi test sono stati eseguiti sulla casella di sviluppo con un solo utente attivo, pertanto sono poco e non possono simulare i modelli di carico tipico sito Web.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-366">Keep in mind that these tests were run on my development box with a single active user, and therefore are unscientific and do not mimic typical website load patterns.</span></span> <span data-ttu-id="9cc0f-367">In ogni caso, i risultati illustrano le differenze relative tempo di esecuzione per impostazione predefinita e il paging personalizzato quando si lavora con sufficientemente grandi quantità di dati.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-367">Regardless, the results illustrate the relative differences in execution time for default and custom paging when working with sufficiently large amounts of data.</span></span>


|  | <span data-ttu-id="9cc0f-368">**Avg. Durata (sec)**</span><span class="sxs-lookup"><span data-stu-id="9cc0f-368">**Avg. Duration (sec)**</span></span> | <span data-ttu-id="9cc0f-369">**Letture**</span><span class="sxs-lookup"><span data-stu-id="9cc0f-369">**Reads**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="9cc0f-370">**Paging SQL Profiler predefinito**</span><span class="sxs-lookup"><span data-stu-id="9cc0f-370">**Default Paging SQL Profiler**</span></span> | <span data-ttu-id="9cc0f-371">1.411</span><span class="sxs-lookup"><span data-stu-id="9cc0f-371">1.411</span></span> | <span data-ttu-id="9cc0f-372">383</span><span class="sxs-lookup"><span data-stu-id="9cc0f-372">383</span></span> |
| <span data-ttu-id="9cc0f-373">**Profiler SQL il Paging personalizzato**</span><span class="sxs-lookup"><span data-stu-id="9cc0f-373">**Custom Paging SQL Profiler**</span></span> | <span data-ttu-id="9cc0f-374">0.002</span><span class="sxs-lookup"><span data-stu-id="9cc0f-374">0.002</span></span> | <span data-ttu-id="9cc0f-375">29</span><span class="sxs-lookup"><span data-stu-id="9cc0f-375">29</span></span> |
| <span data-ttu-id="9cc0f-376">**Traccia di ASP.NET Paging predefinita**</span><span class="sxs-lookup"><span data-stu-id="9cc0f-376">**Default Paging ASP.NET Trace**</span></span> | <span data-ttu-id="9cc0f-377">2.379</span><span class="sxs-lookup"><span data-stu-id="9cc0f-377">2.379</span></span> | <span data-ttu-id="9cc0f-378">*N/A*</span><span class="sxs-lookup"><span data-stu-id="9cc0f-378">*N/A*</span></span> |
| <span data-ttu-id="9cc0f-379">**Traccia di ASP.NET il Paging personalizzato**</span><span class="sxs-lookup"><span data-stu-id="9cc0f-379">**Custom Paging ASP.NET Trace**</span></span> | <span data-ttu-id="9cc0f-380">0.029</span><span class="sxs-lookup"><span data-stu-id="9cc0f-380">0.029</span></span> | <span data-ttu-id="9cc0f-381">*N/A*</span><span class="sxs-lookup"><span data-stu-id="9cc0f-381">*N/A*</span></span> |


<span data-ttu-id="9cc0f-382">Come si può notare, il recupero di una particolare pagina di dati necessaria in Media 354 meno operazioni di lettura e completato in una frazione del tempo.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-382">As you can see, retrieving a particular page of data required 354 less reads on average and completed in a fraction of the time.</span></span> <span data-ttu-id="9cc0f-383">Nella pagina ASP.NET personalizzato la pagina è stata in grado di eseguire il rendering nel prossimo a 1/100<sup>th</sup> del tempo impiegato durante l'utilizzo del paging predefinito.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-383">At the ASP.NET page, custom the page was able to render in close to 1/100<sup>th</sup> of the time it took when using default paging.</span></span> <span data-ttu-id="9cc0f-384">Vedere [articolo](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx) per ulteriori informazioni su questi risultati insieme al codice e un database è possibile scaricare per riprodurre i test nel proprio ambiente.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-384">See [my article](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx) for more information on these results along with code and a database you can download to reproduce these tests in your own environment.</span></span>

## <a name="summary"></a><span data-ttu-id="9cc0f-385">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="9cc0f-385">Summary</span></span>

<span data-ttu-id="9cc0f-386">Paging predefinito è facile implementare controllo semplicemente la casella di controllo Abilita Paging in dati Web controllo s smart tag, ma tali semplicità comporta il costo delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-386">Default paging is a cinch to implement just check the Enable Paging checkbox in the data Web control s smart tag but such simplicity comes at the cost of performance.</span></span> <span data-ttu-id="9cc0f-387">Con il paging predefinito, quando un utente richiede una pagina di dati *tutti* vengono restituiti record, anche se potrebbe essere visualizzata solo una piccola frazione di essi.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-387">With default paging, when a user requests any page of data *all* records are returned, even though only a tiny fraction of them may be shown.</span></span> <span data-ttu-id="9cc0f-388">Per contrastare questo sovraccarico delle prestazioni, ObjectDataSource offre un'alternativa paging personalizzato opzione di paging.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-388">To combat this performance overhead, the ObjectDataSource offers an alternative paging option custom paging.</span></span>

<span data-ttu-id="9cc0f-389">Mentre il paging personalizzato migliora l'impostazione predefinita il paging di problemi di prestazioni s recuperando solo i record che devono essere visualizzati, è più necessario per implementare il paging personalizzato s.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-389">While custom paging improves upon default paging s performance issues by retrieving only those records that need to be displayed, it s more involved to implement custom paging.</span></span> <span data-ttu-id="9cc0f-390">In primo luogo, è necessario scrivere una query che correttamente (e in modo efficiente) accede il subset specifico dei record richiesti.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-390">First, a query must be written that correctly (and efficiently) accesses the specific subset of records requested.</span></span> <span data-ttu-id="9cc0f-391">Questa operazione può essere eseguita in diversi modi. quella esaminata in questa esercitazione consiste nell'utilizzare SQL Server 2005 s nuovo `ROW_NUMBER()` i risultati di una funzione di classificazione e quindi per restituire solo i risultati il cui rango è compreso nell'intervallo specificato.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-391">This can be accomplished in a number of ways; the one we examined in this tutorial is to use SQL Server 2005 s new `ROW_NUMBER()` function to rank results, and then to return just those results whose ranking falls within a specified range.</span></span> <span data-ttu-id="9cc0f-392">Inoltre, è necessario aggiungere un modo per determinare il numero totale di record, il paging tramite.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-392">Furthermore, we need to add a means to determine the total number of records being paged through.</span></span> <span data-ttu-id="9cc0f-393">Dopo la creazione di questi metodi DAL e BLL, è necessario anche configurare ObjectDataSource in modo che possa determinare il numero totale di record paging tramite e correttamente passare i valori di indice di riga iniziale e massimo di righe al livello Business Logic.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-393">After creating these DAL and BLL methods, we also need to configure the ObjectDataSource so that it can determine how many total records are being paged through and can correctly pass the Start Row Index and Maximum Rows values to the BLL.</span></span>

<span data-ttu-id="9cc0f-394">Durante l'implementazione di paging personalizzato richiedono un numero di passaggi e non è così semplice come paging predefinito, il paging personalizzato è necessario quando il paging sufficientemente grandi quantità di dati.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-394">While implementing custom paging does require a number of steps and is not nearly as simple as default paging, custom paging is a necessity when paging through sufficiently large amounts of data.</span></span> <span data-ttu-id="9cc0f-395">Come esaminare i risultati delle pagine personalizzati, sono stati possibile lasci secondi all'esterno di tempo di rendering della pagina ASP.NET e possibile alleggerire il carico sul server di database per uno o più ordini di grandezza.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-395">As the results examined showed, custom paging can shed seconds off of the ASP.NET page render time and can lighten the load on the database server by one ore more orders of magnitude.</span></span>

<span data-ttu-id="9cc0f-396">Buona programmazione!</span><span class="sxs-lookup"><span data-stu-id="9cc0f-396">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="9cc0f-397">Informazioni sull'autore</span><span class="sxs-lookup"><span data-stu-id="9cc0f-397">About the Author</span></span>

<span data-ttu-id="9cc0f-398">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), l'autore di sette libri e fondatore di [4GuysFromRolla](http://www.4guysfromrolla.com), ha lavorato con tecnologie Web di Microsoft dal 1998.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-398">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="9cc0f-399">Scott funziona come un consulente trainer e writer.</span><span class="sxs-lookup"><span data-stu-id="9cc0f-399">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="9cc0f-400">Il suo ultimo libro è [ *SAM insegna manualmente ASP.NET 2.0 nelle 24 ore*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="9cc0f-400">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="9cc0f-401">Egli può essere raggiunto al [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) o sul suo blog, cui è reperibile in [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="9cc0f-401">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="9cc0f-402">[Precedente](paging-and-sorting-report-data-cs.md)
> [Successivo](sorting-custom-paged-data-cs.md)</span><span class="sxs-lookup"><span data-stu-id="9cc0f-402">[Previous](paging-and-sorting-report-data-cs.md)
[Next](sorting-custom-paged-data-cs.md)</span></span>
