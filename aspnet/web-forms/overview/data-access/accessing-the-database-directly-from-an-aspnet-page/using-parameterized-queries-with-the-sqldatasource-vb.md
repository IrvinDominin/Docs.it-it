---
uid: web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/using-parameterized-queries-with-the-sqldatasource-vb
title: Utilizzo di query con parametri con SqlDataSource (VB) | Documenti Microsoft
author: rick-anderson
description: In questa esercitazione, si continua il nostro esaminerà il controllo SqlDataSource e informazioni su come definire le query con parametri. I parametri possono essere specificati entrambi decla...
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/20/2007
ms.topic: article
ms.assetid: e322f34c-83b7-41ea-ab65-ab1e0bdcc609
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/using-parameterized-queries-with-the-sqldatasource-vb
msc.type: authoredcontent
ms.openlocfilehash: a7442ef3bebb2742cc36d695914b745aa2dfa721
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/06/2018
ms.locfileid: "30878139"
---
<a name="using-parameterized-queries-with-the-sqldatasource-vb"></a><span data-ttu-id="a5e04-104">Utilizzo di query con parametri con SqlDataSource (VB)</span><span class="sxs-lookup"><span data-stu-id="a5e04-104">Using Parameterized Queries with the SqlDataSource (VB)</span></span>
====================
<span data-ttu-id="a5e04-105">da [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="a5e04-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="a5e04-106">[Scaricare App di esempio](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_48_VB.exe) o [Scarica il PDF](using-parameterized-queries-with-the-sqldatasource-vb/_static/datatutorial48vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="a5e04-106">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_48_VB.exe) or [Download PDF](using-parameterized-queries-with-the-sqldatasource-vb/_static/datatutorial48vb1.pdf)</span></span>

> <span data-ttu-id="a5e04-107">In questa esercitazione, si continua il nostro esaminerà il controllo SqlDataSource e informazioni su come definire le query con parametri.</span><span class="sxs-lookup"><span data-stu-id="a5e04-107">In this tutorial, we continue our look at the SqlDataSource control and learn how to define parameterized queries.</span></span> <span data-ttu-id="a5e04-108">I parametri possono essere specificati in modo dichiarativo e a livello di codice e possono essere estratto da un numero di posizioni, ad esempio la stringa di query, sessione dello stato, altri controlli e altro ancora.</span><span class="sxs-lookup"><span data-stu-id="a5e04-108">The parameters can be specified both declaratively and programmatically, and can be pulled from a number of locations such as the querystring, Session state, other controls, and more.</span></span>


## <a name="introduction"></a><span data-ttu-id="a5e04-109">Introduzione</span><span class="sxs-lookup"><span data-stu-id="a5e04-109">Introduction</span></span>

<span data-ttu-id="a5e04-110">Nell'esercitazione precedente è stato illustrato come utilizzare il controllo SqlDataSource per recuperare i dati direttamente da un database.</span><span class="sxs-lookup"><span data-stu-id="a5e04-110">In the previous tutorial we saw how to use the SqlDataSource control to retrieve data directly from a database.</span></span> <span data-ttu-id="a5e04-111">La procedura guidata Configura origine dati, è possibile utilizzare il database e quindi: selezionare le colonne da restituire da una tabella o visualizzazione. Immettere un'istruzione SQL personalizzata. utilizzare una stored procedure.</span><span class="sxs-lookup"><span data-stu-id="a5e04-111">Using the Configure Data Source wizard, we could choose the database and then either: pick the columns to return from a table or view; enter a custom SQL statement; or use a stored procedure.</span></span> <span data-ttu-id="a5e04-112">Se la selezione delle colonne di una tabella o vista oppure immettendo un'istruzione SQL personalizzata, SqlDataSource controllo s `SelectCommand` proprietà viene assegnato al codice risultante SQL ad hoc `SELECT` istruzione ed è questo `SELECT` istruzione che viene eseguita quando il S SqlDataSource `Select()` metodo viene richiamato (a livello di codice o automaticamente da un controllo Web di dati).</span><span class="sxs-lookup"><span data-stu-id="a5e04-112">Whether selecting columns from a table or view or entering a custom SQL statement, the SqlDataSource control s `SelectCommand` property is assigned the resulting ad-hoc SQL `SELECT` statement and it is this `SELECT` statement that is executed when the SqlDataSource s `Select()` method is invoked (either programmatically or automatically from a data Web control).</span></span>

<span data-ttu-id="a5e04-113">L'istruzione SQL `SELECT` istruzioni utilizzate nella demo esercitazione s precedente mancava `WHERE` clausole.</span><span class="sxs-lookup"><span data-stu-id="a5e04-113">The SQL `SELECT` statements used in the previous tutorial s demos lacked `WHERE` clauses.</span></span> <span data-ttu-id="a5e04-114">In un `SELECT` istruzione, il `WHERE` clausola può essere utilizzata per limitare i risultati restituiti.</span><span class="sxs-lookup"><span data-stu-id="a5e04-114">In a `SELECT` statement, the `WHERE` clause can be used to limit the results returned.</span></span> <span data-ttu-id="a5e04-115">Per visualizzare i nomi dei prodotti di costo maggiore di $50,00, ad esempio, è possibile utilizzare la query seguente:</span><span class="sxs-lookup"><span data-stu-id="a5e04-115">For example, to display the names of products costing more than $50.00, we could use the following query:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample1.sql)]

<span data-ttu-id="a5e04-116">In genere, i valori utilizzati un `WHERE` clausola sono determinare da qualche origine esterna, ad esempio un valore di stringa di query, una variabile di sessione o l'input dell'utente da un controllo Web nella pagina.</span><span class="sxs-lookup"><span data-stu-id="a5e04-116">Typically, the values used in a `WHERE` clause are determine by some external source, such as a querystring value, a session variable, or user input from a Web control on the page.</span></span> <span data-ttu-id="a5e04-117">Idealmente, quale tali input vengono specificati mediante l'utilizzo di *parametri*.</span><span class="sxs-lookup"><span data-stu-id="a5e04-117">Ideally, such inputs are specified through the use of *parameters*.</span></span> <span data-ttu-id="a5e04-118">Con Microsoft SQL Server, i parametri sono contrassegnati con `@parameterName`, come in:</span><span class="sxs-lookup"><span data-stu-id="a5e04-118">With Microsoft SQL Server, parameters are denoted using `@parameterName`, as in:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample2.sql)]

<span data-ttu-id="a5e04-119">SqlDataSource supporta le query con parametri, entrambi per `SELECT` istruzioni e `INSERT`, `UPDATE`, e `DELETE` istruzioni.</span><span class="sxs-lookup"><span data-stu-id="a5e04-119">The SqlDataSource supports parameterized queries, both for `SELECT` statements and `INSERT`, `UPDATE`, and `DELETE` statements.</span></span> <span data-ttu-id="a5e04-120">Inoltre, i valori dei parametri possono automaticamente da un'ampia gamma di origini querystring, lo stato della sessione, controlli della pagina e così via oppure possono essere assegnati a livello di codice.</span><span class="sxs-lookup"><span data-stu-id="a5e04-120">Moreover, the parameter values can be automatically pulled from a variety of sources the querystring, session state, controls on the page, and so on or can be assigned programmatically.</span></span> <span data-ttu-id="a5e04-121">In questa esercitazione, vedremo come definire le query con parametri e come specificare il parametro, i valori in modo dichiarativo e a livello di codice.</span><span class="sxs-lookup"><span data-stu-id="a5e04-121">In this tutorial, we'll see how to define parameterized queries as well as how to specify the parameter values both declaratively and programmatically.</span></span>

> [!NOTE]
> <span data-ttu-id="a5e04-122">Nell'esercitazione precedente abbiamo confrontato ObjectDataSource che è stata scelta strumenti tramite le esercitazioni prima 46 con SqlDataSource, notare le analogie concettuale.</span><span class="sxs-lookup"><span data-stu-id="a5e04-122">In the previous tutorial we compared the ObjectDataSource which has been our tool of choice over the first 46 tutorials with the SqlDataSource, noting their conceptual similarities.</span></span> <span data-ttu-id="a5e04-123">Queste analogie estenderanno anche a parametri.</span><span class="sxs-lookup"><span data-stu-id="a5e04-123">These similarities also extend to parameters.</span></span> <span data-ttu-id="a5e04-124">I parametri di s ObjectDataSource mappati ai parametri di input per i metodi nel livello di logica di Business.</span><span class="sxs-lookup"><span data-stu-id="a5e04-124">The ObjectDataSource s parameters mapped to the input parameters for the methods in the Business Logic Layer.</span></span> <span data-ttu-id="a5e04-125">Con SqlDataSource, i parametri vengono definiti direttamente all'interno di query SQL.</span><span class="sxs-lookup"><span data-stu-id="a5e04-125">With the SqlDataSource, the parameters are defined directly within the SQL query.</span></span> <span data-ttu-id="a5e04-126">Entrambi i controlli sono raccolte di parametri per i relativi `Select()`, `Insert()`, `Update()`, e `Delete()` metodi ed entrambe possono avere valori di questi parametri popolati da origini predefinite (i valori di stringa di query, variabili di sessione e così via ) o assegnato a livello di codice.</span><span class="sxs-lookup"><span data-stu-id="a5e04-126">Both controls have collections of parameters for their `Select()`, `Insert()`, `Update()`, and `Delete()` methods, and both can have these parameter values populated from pre-defined sources (querystring values, session variables, and so on) or assigned programmatically.</span></span>


## <a name="creating-a-parameterized-query"></a><span data-ttu-id="a5e04-127">Creazione di una query con parametri</span><span class="sxs-lookup"><span data-stu-id="a5e04-127">Creating a Parameterized Query</span></span>

<span data-ttu-id="a5e04-128">La procedura guidata Configura origine dati di s controllo SqlDataSource offre tre modi per la definizione di comando da eseguire per recuperare i record di database:</span><span class="sxs-lookup"><span data-stu-id="a5e04-128">The SqlDataSource control s Configure Data Source wizard offers three avenues for defining the command to execute to retrieve database records:</span></span>

- <span data-ttu-id="a5e04-129">Selezionando le colonne da una tabella o vista esistente,</span><span class="sxs-lookup"><span data-stu-id="a5e04-129">By picking the columns from an existing table or view,</span></span>
- <span data-ttu-id="a5e04-130">Immettendo un'istruzione SQL personalizzata, o</span><span class="sxs-lookup"><span data-stu-id="a5e04-130">By entering a custom SQL statement, or</span></span>
- <span data-ttu-id="a5e04-131">Scegliendo una stored procedure</span><span class="sxs-lookup"><span data-stu-id="a5e04-131">By choosing a stored procedure</span></span>

<span data-ttu-id="a5e04-132">Durante la selezione di colonne da una tabella esistente o visualizzazione, i parametri per il `WHERE` clausola deve essere specificata tramite l'aggiunta `WHERE` la finestra di dialogo clausola.</span><span class="sxs-lookup"><span data-stu-id="a5e04-132">When picking columns from an existing table or view, the parameters for the `WHERE` clause must be specified through the Add `WHERE` Clause dialog box.</span></span> <span data-ttu-id="a5e04-133">Quando si crea un'istruzione SQL personalizzata, è tuttavia possibile immettere i parametri direttamente nel `WHERE` clausola (utilizzando `@parameterName` per identificare ogni parametro).</span><span class="sxs-lookup"><span data-stu-id="a5e04-133">When creating a custom SQL statement, however, you can enter the parameters directly into the `WHERE` clause (using `@parameterName` to denote each parameter).</span></span> <span data-ttu-id="a5e04-134">Oggetto [stored procedure di](http://www.awprofessional.com/articles/article.asp?p=25288&amp;rl=1) è costituito da uno o più istruzioni SQL, e possono essere parametrizzate queste istruzioni.</span><span class="sxs-lookup"><span data-stu-id="a5e04-134">A [stored procedure](http://www.awprofessional.com/articles/article.asp?p=25288&amp;rl=1) consists of one or more SQL statements, and these statements can be parameterized.</span></span> <span data-ttu-id="a5e04-135">I parametri utilizzati nelle istruzioni SQL, tuttavia, devono essere passati come parametri di input alla stored procedure.</span><span class="sxs-lookup"><span data-stu-id="a5e04-135">The parameters used in the SQL statements, however, must be passed in as input parameters to the stored procedure.</span></span>

<span data-ttu-id="a5e04-136">Poiché la creazione di una query con parametri dipende da come s SqlDataSource `SelectCommand` è specificato, consentono s esaminare i tre approcci.</span><span class="sxs-lookup"><span data-stu-id="a5e04-136">Since creating a parameterized query depends on how the SqlDataSource s `SelectCommand` is specified, let s take a look at all three approaches.</span></span> <span data-ttu-id="a5e04-137">Per iniziare, aprire il `ParameterizedQueries.aspx` nella pagina di `SqlDataSource` cartella, trascinare un controllo SqlDataSource dalla casella degli strumenti nella finestra di progettazione e impostare il relativo `ID` per `Products25BucksAndUnderDataSource`.</span><span class="sxs-lookup"><span data-stu-id="a5e04-137">To get started, open the `ParameterizedQueries.aspx` page in the `SqlDataSource` folder, drag a SqlDataSource control from the Toolbox onto the Designer, and set its `ID` to `Products25BucksAndUnderDataSource`.</span></span> <span data-ttu-id="a5e04-138">Fare clic sul collegamento Configura origine dati dallo smart tag s di controllo.</span><span class="sxs-lookup"><span data-stu-id="a5e04-138">Next, click the Configure Data Source link from the control s smart tag.</span></span> <span data-ttu-id="a5e04-139">Selezionare il database da utilizzare (`NORTHWINDConnectionString`) e fare clic su Avanti.</span><span class="sxs-lookup"><span data-stu-id="a5e04-139">Select the database to use (`NORTHWINDConnectionString`) and click Next.</span></span>

## <a name="step-1-adding-awhereclause-when-picking-the-columns-from-a-table-or-view"></a><span data-ttu-id="a5e04-140">Passaggio 1: Aggiunta di un`WHERE`clausola durante la selezione delle colonne di una tabella o vista</span><span class="sxs-lookup"><span data-stu-id="a5e04-140">Step 1: Adding a`WHERE`Clause When Picking the Columns from a Table or View</span></span>

<span data-ttu-id="a5e04-141">Quando si selezionano i dati da restituire dal database con il controllo SqlDataSource, la configurazione guidata origine dati consente di selezionare semplicemente le colonne da restituire da una tabella esistente o visualizzare (vedere la figura 1).</span><span class="sxs-lookup"><span data-stu-id="a5e04-141">When selecting the data to return from the database with the SqlDataSource control, the Configure Data Source wizard allows us to simply pick the columns to return from an existing table or view (see Figure 1).</span></span> <span data-ttu-id="a5e04-142">In questo modo automatico crea un database SQL `SELECT` istruzione, viene inviato al database quando il s SqlDataSource `Select()` metodo viene richiamato.</span><span class="sxs-lookup"><span data-stu-id="a5e04-142">Doing so automatically builds up a SQL `SELECT` statement, which is what is sent to the database when the SqlDataSource s `Select()` method is invoked.</span></span> <span data-ttu-id="a5e04-143">Come è stato fatto nell'esercitazione precedente, selezionare la tabella di prodotti nell'elenco a discesa e selezionare il `ProductID`, `ProductName`, e `UnitPrice` colonne.</span><span class="sxs-lookup"><span data-stu-id="a5e04-143">As we did in the previous tutorial, select the Products table from the drop-down list and check the `ProductID`, `ProductName`, and `UnitPrice` columns.</span></span>


<span data-ttu-id="a5e04-144">[![Selezionare le colonne da restituire da una tabella o vista](using-parameterized-queries-with-the-sqldatasource-vb/_static/image1.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="a5e04-144">[![Pick the Columns to Return from a Table or View](using-parameterized-queries-with-the-sqldatasource-vb/_static/image1.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image1.png)</span></span>

<span data-ttu-id="a5e04-145">**Figura 1**: scegliere le colonne per restituito da una tabella o vista ([fare clic per visualizzare l'immagine ingrandita](using-parameterized-queries-with-the-sqldatasource-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="a5e04-145">**Figure 1**: Pick the Columns to Return from a Table or View ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image2.png))</span></span>


<span data-ttu-id="a5e04-146">Per includere un `WHERE` clausola il `SELECT` istruzione, fare clic sul `WHERE` pulsante, viene visualizzata Aggiungi `WHERE` clausola dialogo (figura 2).</span><span class="sxs-lookup"><span data-stu-id="a5e04-146">To include a `WHERE` clause in the `SELECT` statement, click the `WHERE` button, which brings up the Add `WHERE` Clause dialog box (see Figure 2).</span></span> <span data-ttu-id="a5e04-147">Per aggiungere un parametro per limitare i risultati restituiti dal `SELECT` di query, scegliere la colonna per filtrare i dati da.</span><span class="sxs-lookup"><span data-stu-id="a5e04-147">To add a parameter to limit the results returned by the `SELECT` query, first choose the column to filter the data by.</span></span> <span data-ttu-id="a5e04-148">Successivamente, scegliere l'operatore da utilizzare per il filtro (=, &lt;, &lt;=, &gt;e così via).</span><span class="sxs-lookup"><span data-stu-id="a5e04-148">Next, choose the operator to use for filtering (=, &lt;, &lt;=, &gt;, and so on).</span></span> <span data-ttu-id="a5e04-149">Infine, scegliere l'origine del valore del parametro s, ad esempio dallo stato sessione o di stringa di query.</span><span class="sxs-lookup"><span data-stu-id="a5e04-149">Finally, choose the source of the parameter s value, such as from the querystring or session state.</span></span> <span data-ttu-id="a5e04-150">Dopo aver configurato il parametro, fare clic sul pulsante Aggiungi per includerlo nella `SELECT` query.</span><span class="sxs-lookup"><span data-stu-id="a5e04-150">After configuring the parameter, click the Add button to include it in the `SELECT` query.</span></span>

<span data-ttu-id="a5e04-151">Per questo esempio, s consentono di restituire solo i risultati in cui il `UnitPrice` valore è minore o uguale a $25.00.</span><span class="sxs-lookup"><span data-stu-id="a5e04-151">For this example, let s only return those results where the `UnitPrice` value is less than or equal to $25.00.</span></span> <span data-ttu-id="a5e04-152">Pertanto, selezionare `UnitPrice` dall'elenco a discesa di colonne e &lt;= dall'elenco a discesa operatore.</span><span class="sxs-lookup"><span data-stu-id="a5e04-152">Therefore, pick `UnitPrice` from the Column drop-down list and &lt;= from the Operator drop-down list.</span></span> <span data-ttu-id="a5e04-153">Quando si utilizza un valore di parametro a livello di codice (ad esempio $25.00) o se il valore del parametro deve essere specificato a livello di codice, selezionare Nessuno dall'elenco a discesa di origine.</span><span class="sxs-lookup"><span data-stu-id="a5e04-153">When using a hard-coded parameter value (such as $25.00) or if the parameter value is to be specified programmatically, select None from the Source drop-down list.</span></span> <span data-ttu-id="a5e04-154">Successivamente, immettere il valore del parametro hardcoded nella casella di testo valore 25,00 e completare il processo facendo clic sul pulsante Aggiungi.</span><span class="sxs-lookup"><span data-stu-id="a5e04-154">Next, enter the hard-coded parameter value in the Value textbox 25.00 and complete the process by clicking the Add button.</span></span>


<span data-ttu-id="a5e04-155">[![Limitare i risultati restituiti dall'aggiungere dove clausola finestra di dialogo](using-parameterized-queries-with-the-sqldatasource-vb/_static/image2.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="a5e04-155">[![Limit the Results Returned from the Add WHERE Clause Dialog Box](using-parameterized-queries-with-the-sqldatasource-vb/_static/image2.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image3.png)</span></span>

<span data-ttu-id="a5e04-156">**Figura 2**: limitare i risultati restituiti dalla procedura di aggiunta `WHERE` finestra di dialogo clausola ([fare clic per visualizzare l'immagine ingrandita](using-parameterized-queries-with-the-sqldatasource-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="a5e04-156">**Figure 2**: Limit the Results Returned from the Add `WHERE` Clause Dialog Box ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image4.png))</span></span>


<span data-ttu-id="a5e04-157">Dopo aver aggiunto il parametro, fare clic su OK per tornare alla procedura guidata Configura origine dati.</span><span class="sxs-lookup"><span data-stu-id="a5e04-157">After adding the parameter, click OK to return to the Configure Data Source wizard.</span></span> <span data-ttu-id="a5e04-158">Il `SELECT` istruzione nella parte inferiore della procedura guidata deve ora includere un `WHERE` clausola con un parametro denominato `@UnitPrice`:</span><span class="sxs-lookup"><span data-stu-id="a5e04-158">The `SELECT` statement at the bottom of the wizard should now include a `WHERE` clause with a parameter named `@UnitPrice`:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample3.sql)]

> [!NOTE]
> <span data-ttu-id="a5e04-159">Se si specificano più condizioni nel `WHERE` clausola da Aggiungi `WHERE` clausola della finestra di dialogo la procedura guidata li unisce con il `AND` operatore.</span><span class="sxs-lookup"><span data-stu-id="a5e04-159">If you specify multiple conditions in the `WHERE` clause from the Add `WHERE` Clause dialog box, the wizard joins them with the `AND` operator.</span></span> <span data-ttu-id="a5e04-160">Se è necessario includere un `OR` nel `WHERE` clausola (ad esempio `WHERE UnitPrice <= @UnitPrice OR Discontinued = 1`), quindi è necessario compilare il `SELECT` istruzione tramite la schermata di istruzione SQL personalizzata.</span><span class="sxs-lookup"><span data-stu-id="a5e04-160">If you need to include an `OR` in the `WHERE` clause (such as `WHERE UnitPrice <= @UnitPrice OR Discontinued = 1`) then you have to build the `SELECT` statement through the custom SQL statement screen.</span></span>


<span data-ttu-id="a5e04-161">Completare la configurazione SqlDataSource (fare clic su Avanti, quindi completare) e quindi verificare il markup dichiarativo SqlDataSource s.</span><span class="sxs-lookup"><span data-stu-id="a5e04-161">Complete configuring the SqlDataSource (click Next, then Finish) and then inspect the SqlDataSource s declarative markup.</span></span> <span data-ttu-id="a5e04-162">Il codice include ora un `<SelectParameters>` insieme, definiscono le origini per i parametri in di `SelectCommand`.</span><span class="sxs-lookup"><span data-stu-id="a5e04-162">The markup now includes a `<SelectParameters>` collection, which spells out the sources for the parameters in the `SelectCommand`.</span></span>


[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample4.aspx)]

<span data-ttu-id="a5e04-163">Quando s SqlDataSource `Select()` metodo viene richiamato, il `UnitPrice` valore del parametro (25,00) viene applicato al `@UnitPrice` parametro il `SelectCommand` prima dell'invio al database.</span><span class="sxs-lookup"><span data-stu-id="a5e04-163">When the SqlDataSource s `Select()` method is invoked, the `UnitPrice` parameter value (25.00) is applied to the `@UnitPrice` parameter in the `SelectCommand` before being sent to the database.</span></span> <span data-ttu-id="a5e04-164">Il risultato finale è che solo i prodotti dai minore o uguale a $25.00 vengono restituiti il `Products` tabella.</span><span class="sxs-lookup"><span data-stu-id="a5e04-164">The net result is that only those products less than or equal to $25.00 are returned from the `Products` table.</span></span> <span data-ttu-id="a5e04-165">Per verificarlo, aggiungere un controllo GridView alla pagina, associarlo a questa origine dati e quindi visualizzare la pagina tramite un browser.</span><span class="sxs-lookup"><span data-stu-id="a5e04-165">To confirm this, add a GridView to the page, bind it to this data source, and then view the page through a browser.</span></span> <span data-ttu-id="a5e04-166">Si dovrebbero visualizzare solo i prodotti elencati sono minore o uguale a $25.00, come nella figura 3 viene confermata.</span><span class="sxs-lookup"><span data-stu-id="a5e04-166">You should only see those products listed that are less than or equal to $25.00, as Figure 3 confirms.</span></span>


<span data-ttu-id="a5e04-167">[![Vengono visualizzati solo quelli prodotti minore o uguale a $25.00](using-parameterized-queries-with-the-sqldatasource-vb/_static/image3.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="a5e04-167">[![Only Those Products Less Than or Equal to $25.00 are Displayed](using-parameterized-queries-with-the-sqldatasource-vb/_static/image3.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image5.png)</span></span>

<span data-ttu-id="a5e04-168">**Figura 3**: vengono visualizzati solo quelli prodotti minore o uguale a $25.00 ([fare clic per visualizzare l'immagine ingrandita](using-parameterized-queries-with-the-sqldatasource-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="a5e04-168">**Figure 3**: Only Those Products Less Than or Equal to $25.00 are Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image6.png))</span></span>


## <a name="step-2-adding-parameters-to-a-custom-sql-statement"></a><span data-ttu-id="a5e04-169">Passaggio 2: Aggiunta di parametri a un'istruzione SQL personalizzata</span><span class="sxs-lookup"><span data-stu-id="a5e04-169">Step 2: Adding Parameters to a Custom SQL Statement</span></span>

<span data-ttu-id="a5e04-170">Quando si aggiunge un'istruzione SQL personalizzata è possibile immettere il `WHERE` clausola in modo esplicito oppure specificare un valore nella cella dei filtri del generatore di Query.</span><span class="sxs-lookup"><span data-stu-id="a5e04-170">When adding a custom SQL statement you can enter the `WHERE` clause explicitly or specify a value in the Filter cell of the Query Builder.</span></span> <span data-ttu-id="a5e04-171">Per dimostrare questo concetto, consentire s visualizzare solo i prodotti in un controllo GridView il cui prezzo è inferiore a una determinata soglia.</span><span class="sxs-lookup"><span data-stu-id="a5e04-171">To demonstrate this, let s display just those products in a GridView whose prices are less than a certain threshold.</span></span> <span data-ttu-id="a5e04-172">Per iniziare, aggiungere una casella di testo di `ParameterizedQueries.aspx` pagina per raccogliere il valore di soglia da parte dell'utente.</span><span class="sxs-lookup"><span data-stu-id="a5e04-172">Start by adding a TextBox to the `ParameterizedQueries.aspx` page to collect this threshold value from the user.</span></span> <span data-ttu-id="a5e04-173">Impostare la casella di testo s `ID` proprietà `MaxPrice`.</span><span class="sxs-lookup"><span data-stu-id="a5e04-173">Set the TextBox s `ID` property to `MaxPrice`.</span></span> <span data-ttu-id="a5e04-174">Aggiungere un controllo pulsante Web e impostare il relativo `Text` proprietà per i prodotti di visualizzazione corrispondente.</span><span class="sxs-lookup"><span data-stu-id="a5e04-174">Add a Button Web control and set its `Text` property to Display Matching Products .</span></span>

<span data-ttu-id="a5e04-175">Successivamente, trascinare un controllo GridView nella pagina e dal suo smart tag scegliere di creare un nuovo SqlDataSource denominato `ProductsFilteredByPriceDataSource`.</span><span class="sxs-lookup"><span data-stu-id="a5e04-175">Next, drag a GridView onto the page and from its smart tag choose to create a new SqlDataSource named `ProductsFilteredByPriceDataSource`.</span></span> <span data-ttu-id="a5e04-176">Dalla procedura guidata Configura origine dati, procedere per specificare una schermata di stored procedure o un'istruzione SQL personalizzata (vedere la figura 4) e immettere la query seguente:</span><span class="sxs-lookup"><span data-stu-id="a5e04-176">From the Configure Data Source wizard, proceed to the Specify a custom SQL statement or stored procedure screen (see Figure 4) and enter the following query:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample5.sql)]

<span data-ttu-id="a5e04-177">Dopo aver immesso la query (manualmente o tramite il generatore di Query), fare clic su Avanti.</span><span class="sxs-lookup"><span data-stu-id="a5e04-177">After entering the query (either manually or through the Query Builder), click Next.</span></span>


<span data-ttu-id="a5e04-178">[![Restituire solo i prodotti minore o uguale al valore di parametro](using-parameterized-queries-with-the-sqldatasource-vb/_static/image4.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="a5e04-178">[![Return Only Those Products Less Than or Equal to a Parameter Value](using-parameterized-queries-with-the-sqldatasource-vb/_static/image4.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image7.png)</span></span>

<span data-ttu-id="a5e04-179">**Figura 4**: restituisce solo quelli prodotti minore o uguale al valore del parametro ([fare clic per visualizzare l'immagine ingrandita](using-parameterized-queries-with-the-sqldatasource-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="a5e04-179">**Figure 4**: Return Only Those Products Less Than or Equal to a Parameter Value ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image8.png))</span></span>


<span data-ttu-id="a5e04-180">Poiché la query include parametri, la schermata successiva della procedura guidata richiede Microsoft per l'origine dei valori di parametri.</span><span class="sxs-lookup"><span data-stu-id="a5e04-180">Since the query includes parameters, the next screen in the wizard prompts us for the source of the parameters values.</span></span> <span data-ttu-id="a5e04-181">Scegliere controllo dall'elenco a discesa Origine parametro e `MaxPrice` (il controllo TextBox s `ID` valore) dall'elenco a discesa ControlID.</span><span class="sxs-lookup"><span data-stu-id="a5e04-181">Choose Control from the Parameter source drop-down list and `MaxPrice` (the TextBox control s `ID` value) from the ControlID drop-down list.</span></span> <span data-ttu-id="a5e04-182">È inoltre possibile immettere un valore predefinito facoltativo da utilizzare nel caso in cui l'utente non ha immesso il testo nel `MaxPrice` casella di testo.</span><span class="sxs-lookup"><span data-stu-id="a5e04-182">You can also enter an optional default value to use in the case where the user has not entered any text into the `MaxPrice` TextBox.</span></span> <span data-ttu-id="a5e04-183">Per il momento, non immettere un valore predefinito.</span><span class="sxs-lookup"><span data-stu-id="a5e04-183">For the time being, do not enter a default value.</span></span>


<span data-ttu-id="a5e04-184">[![Il MaxPrice TextBox Text (proprietà) viene usato come origine del parametro](using-parameterized-queries-with-the-sqldatasource-vb/_static/image5.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="a5e04-184">[![The MaxPrice TextBox s Text Property is Used as the Parameter Source](using-parameterized-queries-with-the-sqldatasource-vb/_static/image5.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image9.png)</span></span>

<span data-ttu-id="a5e04-185">**Figura 5**: il `MaxPrice` casella di testo s `Text` proprietà viene utilizzata come origine del parametro ([fare clic per visualizzare l'immagine ingrandita](using-parameterized-queries-with-the-sqldatasource-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="a5e04-185">**Figure 5**: The `MaxPrice` TextBox s `Text` Property is Used as the Parameter Source ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image10.png))</span></span>


<span data-ttu-id="a5e04-186">Completare la configurazione guidata origine dati facendo clic su Avanti, quindi Fine.</span><span class="sxs-lookup"><span data-stu-id="a5e04-186">Complete the Configure Data Source wizard by clicking Next, then Finish.</span></span> <span data-ttu-id="a5e04-187">Il markup dichiarativo per GridView, casella di testo il pulsante SqlDataSource seguente:</span><span class="sxs-lookup"><span data-stu-id="a5e04-187">The declarative markup for the GridView, TextBox, Button, and SqlDataSource follows:</span></span>


[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample6.aspx)]

<span data-ttu-id="a5e04-188">Si noti che il parametro all'interno di s SqlDataSource `<SelectParameters>` sezione è un `ControlParameter`, che include proprietà aggiuntive, ad esempio `ControlID` e `PropertyName`.</span><span class="sxs-lookup"><span data-stu-id="a5e04-188">Note that the parameter within the SqlDataSource s `<SelectParameters>` section is a `ControlParameter`, which includes additional properties like `ControlID` and `PropertyName`.</span></span> <span data-ttu-id="a5e04-189">Quando i dispositivi SqlDataSource `Select()` metodo viene richiamato, il `ControlParameter` acquisisce il valore della proprietà di controllo Web specificato e lo assegna al parametro corrispondente nel `SelectCommand`.</span><span class="sxs-lookup"><span data-stu-id="a5e04-189">When the SqlDataSource s `Select()` method is invoked, the `ControlParameter` grabs the value from the specified Web control property and assigns it to the corresponding parameter in the `SelectCommand`.</span></span> <span data-ttu-id="a5e04-190">In questo esempio, il `MaxPrice` s proprietà Text viene utilizzato come il `@MaxPrice` valore del parametro.</span><span class="sxs-lookup"><span data-stu-id="a5e04-190">In this example, the `MaxPrice` s Text property is used as the `@MaxPrice` parameter value.</span></span>

<span data-ttu-id="a5e04-191">Richiedere un minuto, per visualizzare questa pagina tramite un browser.</span><span class="sxs-lookup"><span data-stu-id="a5e04-191">Take a minute to view this page through a browser.</span></span> <span data-ttu-id="a5e04-192">Durante la prima visita la pagina o ogni volta che il `MaxPrice` casella di testo non è presente un valore viene visualizzato alcun record in GridView.</span><span class="sxs-lookup"><span data-stu-id="a5e04-192">When first visiting the page or whenever the `MaxPrice` TextBox lacks a value no records are displayed in the GridView.</span></span>


<span data-ttu-id="a5e04-193">[![Nessun record viene che visualizzati quando il MaxPrice casella di testo è vuoto](using-parameterized-queries-with-the-sqldatasource-vb/_static/image6.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="a5e04-193">[![No Records are Displayed When the MaxPrice TextBox is Empty](using-parameterized-queries-with-the-sqldatasource-vb/_static/image6.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image11.png)</span></span>

<span data-ttu-id="a5e04-194">**Figura 6**: nessun record vengono visualizzati quando il `MaxPrice` casella di testo è vuoto ([fare clic per visualizzare l'immagine ingrandita](using-parameterized-queries-with-the-sqldatasource-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="a5e04-194">**Figure 6**: No Records are Displayed When the `MaxPrice` TextBox is Empty ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image12.png))</span></span>


<span data-ttu-id="a5e04-195">Nessun prodotto viene visualizzato, infatti, in quanto, per impostazione predefinita, una stringa vuota per un valore del parametro viene convertita in un database `NULL` valore.</span><span class="sxs-lookup"><span data-stu-id="a5e04-195">The reason no products are shown is because, by default, an empty string for a parameter value is converted into a database `NULL` value.</span></span> <span data-ttu-id="a5e04-196">Poiché il confronto di `[UnitPrice] <= NULL` restituisce sempre false, viene restituito alcun risultato.</span><span class="sxs-lookup"><span data-stu-id="a5e04-196">Since the comparison of `[UnitPrice] <= NULL` always evaluates as False, no results are returned.</span></span>

<span data-ttu-id="a5e04-197">Immettere un valore nella casella di testo, ad esempio 5,00 e fare clic sul pulsante di visualizzazione corrispondenti prodotti.</span><span class="sxs-lookup"><span data-stu-id="a5e04-197">Enter a value into the textbox, like 5.00, and click the Display Matching Products button.</span></span> <span data-ttu-id="a5e04-198">Durante il postback, SqlDataSource informa che una delle sue origini parametro GridView è stato modificato.</span><span class="sxs-lookup"><span data-stu-id="a5e04-198">On postback, the SqlDataSource informs the GridView that one of its parameter sources has changed.</span></span> <span data-ttu-id="a5e04-199">Di conseguenza, il controllo GridView riassocia per SqlDataSource, visualizzazione di tali prodotti minore o uguale a $5.00.</span><span class="sxs-lookup"><span data-stu-id="a5e04-199">Consequently, the GridView rebinds to the SqlDataSource, displaying those products less than or equal to $5.00.</span></span>


<span data-ttu-id="a5e04-200">[![Vengono visualizzati i prodotti minore o uguale a 5,00](using-parameterized-queries-with-the-sqldatasource-vb/_static/image7.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="a5e04-200">[![Products Less Than or Equal to $5.00 are Displayed](using-parameterized-queries-with-the-sqldatasource-vb/_static/image7.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image13.png)</span></span>

<span data-ttu-id="a5e04-201">**Figura 7**: vengono visualizzati i prodotti minore o uguale a 5,00 ([fare clic per visualizzare l'immagine ingrandita](using-parameterized-queries-with-the-sqldatasource-vb/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="a5e04-201">**Figure 7**: Products Less Than or Equal to $5.00 are Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image14.png))</span></span>


## <a name="initially-displaying-all-products"></a><span data-ttu-id="a5e04-202">Inizialmente la visualizzazione di tutti i prodotti</span><span class="sxs-lookup"><span data-stu-id="a5e04-202">Initially Displaying All Products</span></span>

<span data-ttu-id="a5e04-203">Anziché non visualizzare alcun prodotti quando la pagina viene caricata, potrebbe essere necessario visualizzare *tutti* prodotti.</span><span class="sxs-lookup"><span data-stu-id="a5e04-203">Rather than displaying no products when the page is first loaded, we may want to display *all* products.</span></span> <span data-ttu-id="a5e04-204">Un modo per visualizzare l'elenco di tutti i prodotti ogni volta che il `MaxPrice` casella di testo è vuoto consiste nell'impostare il valore predefinito di s parametri su un valore elevato insanely, ad esempio 1000000, perché s improbabile che Northwind Traders mai avere inventario il cui prezzo unitario supera 1.000.000.</span><span class="sxs-lookup"><span data-stu-id="a5e04-204">One way to list all products whenever the `MaxPrice` TextBox is empty is to set the parameter s default value to some insanely high value, like 1000000, since it s unlikely that Northwind Traders will ever have inventory whose unit price exceeds $1,000,000.</span></span> <span data-ttu-id="a5e04-205">Tuttavia, questo approccio è superficiale e potrebbe non funzionare in altre situazioni.</span><span class="sxs-lookup"><span data-stu-id="a5e04-205">However, this approach is shortsighted and might not work in other situations.</span></span>

<span data-ttu-id="a5e04-206">Nelle esercitazioni precedenti - [parametri dichiarativi](../basic-reporting/declarative-parameters-vb.md) e [Master-Details filtro con un DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-vb.md) si stava affrontare un problema analogo.</span><span class="sxs-lookup"><span data-stu-id="a5e04-206">In previous tutorials - [Declarative Parameters](../basic-reporting/declarative-parameters-vb.md) and [Master/Detail Filtering With a DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-vb.md) we were faced with a similar problem.</span></span> <span data-ttu-id="a5e04-207">Sono la soluzione era quello di inserire la logica nel livello di logica di Business.</span><span class="sxs-lookup"><span data-stu-id="a5e04-207">Our solution there was to put this logic in the Business Logic Layer.</span></span> <span data-ttu-id="a5e04-208">In particolare, il livello Business LOGIC esaminato il valore in ingresso e, se si trattasse di `NULL` o alcuni riservati valore, è stata indirizzata la chiamata al metodo DAL che tutti i record restituiti.</span><span class="sxs-lookup"><span data-stu-id="a5e04-208">Specifically, the BLL examined the incoming value and, if it was `NULL` or some reserved value, the call was routed to the DAL method that returned all records.</span></span> <span data-ttu-id="a5e04-209">Se il valore in ingresso è un valore di filtro normale, è stata effettuata una chiamata al metodo che ha eseguito un'istruzione SQL utilizzata con un parametri DAL `WHERE` clausola con il valore fornito.</span><span class="sxs-lookup"><span data-stu-id="a5e04-209">If the incoming value was a normal filtering value, a call was made to the DAL method that executed a SQL statement that used a parameterized `WHERE` clause with the supplied value.</span></span>

<span data-ttu-id="a5e04-210">Purtroppo, l'architettura è ignorare quando si utilizza SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="a5e04-210">Unfortunately, we bypass the architecture when using the SqlDataSource.</span></span> <span data-ttu-id="a5e04-211">In alternativa, è necessario personalizzare l'istruzione SQL per acquisire in modo intelligente tutti i record se il `@MaximumPrice` parametro `NULL` o un valore riservato.</span><span class="sxs-lookup"><span data-stu-id="a5e04-211">Instead, we need to customize the SQL statement to intelligently grab all records if the `@MaximumPrice` parameter is `NULL` or some reserved value.</span></span> <span data-ttu-id="a5e04-212">Per questo esercizio, consentono di s è in modo che se il `@MaximumPrice` parametro è uguale a `-1.0`, quindi *tutti* i record devono essere restituiti (`-1.0` funziona come un valore riservato poiché nessun prodotto può avere un valore negativo `UnitPrice`valore).</span><span class="sxs-lookup"><span data-stu-id="a5e04-212">For this exercise, let s have it so that if the `@MaximumPrice` parameter is equal to `-1.0`, then *all* of the records are to be returned (`-1.0` works as a reserved value since no product can have a negative `UnitPrice` value).</span></span> <span data-ttu-id="a5e04-213">A tale scopo che è possibile utilizzare l'istruzione SQL seguente:</span><span class="sxs-lookup"><span data-stu-id="a5e04-213">To accomplish this we can use the following SQL statement:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample7.sql)]

<span data-ttu-id="a5e04-214">Questo `WHERE` clausola restituisce *tutti* registra se il `@MaximumPrice` parametro è uguale a `-1.0`.</span><span class="sxs-lookup"><span data-stu-id="a5e04-214">This `WHERE` clause returns *all* records if the `@MaximumPrice` parameter equals `-1.0`.</span></span> <span data-ttu-id="a5e04-215">Se il valore del parametro non è `-1.0`, solo i prodotti il cui `UnitPrice` è minore o uguale al `@MaximumPrice` viene restituito il valore di parametro.</span><span class="sxs-lookup"><span data-stu-id="a5e04-215">If the parameter value is not `-1.0`, only those products whose `UnitPrice` is less than or equal to the `@MaximumPrice` parameter value are returned.</span></span> <span data-ttu-id="a5e04-216">Impostando il valore predefinito il `@MaximumPrice` parametro `-1.0`, il primo caricamento della pagina (o ogni volta che il `MaxPrice` casella di testo è vuoto), `@MaximumPrice` avrà un valore di `-1.0` e tutti i prodotti verranno visualizzati.</span><span class="sxs-lookup"><span data-stu-id="a5e04-216">By setting the default value of the `@MaximumPrice` parameter to `-1.0`, on the first page load (or whenever the `MaxPrice` TextBox is empty), `@MaximumPrice` will have a value of `-1.0` and all products will be displayed.</span></span>


<span data-ttu-id="a5e04-217">[![A questo punto tutti i prodotti vengono visualizzati quando il MaxPrice casella di testo è vuoto](using-parameterized-queries-with-the-sqldatasource-vb/_static/image8.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="a5e04-217">[![Now All Products are Displayed When the MaxPrice TextBox is Empty](using-parameterized-queries-with-the-sqldatasource-vb/_static/image8.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image15.png)</span></span>

<span data-ttu-id="a5e04-218">**Figura 8**: ora tutti i prodotti vengono visualizzati quando il `MaxPrice` casella di testo è vuoto ([fare clic per visualizzare l'immagine ingrandita](using-parameterized-queries-with-the-sqldatasource-vb/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="a5e04-218">**Figure 8**: Now All Products are Displayed When the `MaxPrice` TextBox is Empty ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image16.png))</span></span>


<span data-ttu-id="a5e04-219">Esistono un paio di aspetti da notare con questo approccio.</span><span class="sxs-lookup"><span data-stu-id="a5e04-219">There are a couple of caveats to note with this approach.</span></span> <span data-ttu-id="a5e04-220">In primo luogo, tenere presente che il tipo di dati di parametro s viene dedotto dall'utilizzo di s nella query SQL.</span><span class="sxs-lookup"><span data-stu-id="a5e04-220">First, realize that the parameter s data type is inferred by it s usage in the SQL query.</span></span> <span data-ttu-id="a5e04-221">Se si modifica il `WHERE` clausola da `@MaximumPrice = -1.0` a `@MaximumPrice = -1`, il runtime utilizza il parametro come un numero intero.</span><span class="sxs-lookup"><span data-stu-id="a5e04-221">If you change the `WHERE` clause from `@MaximumPrice = -1.0` to `@MaximumPrice = -1`, the runtime treats the parameter as an integer.</span></span> <span data-ttu-id="a5e04-222">Se quindi si tenta di assegnare il `MaxPrice` casella di testo di un valore decimale (ad esempio 5,00), verrà generato un errore perché non è possibile convertire 5,00 in un numero intero.</span><span class="sxs-lookup"><span data-stu-id="a5e04-222">If you then attempt to assign the `MaxPrice` TextBox to a decimal value (like 5.00 ), an error will occur because it cannot convert 5.00 to an integer.</span></span> <span data-ttu-id="a5e04-223">Per risolvere questo problema, assicurarsi di utilizzare `@MaximumPrice = -1.0` nel `WHERE` clausola o, meglio ancora, imposta il `ControlParameter` oggetto s `Type` proprietà Decimal.</span><span class="sxs-lookup"><span data-stu-id="a5e04-223">To remedy this, either make sure that you use `@MaximumPrice = -1.0` in the `WHERE` clause or, better yet, set the `ControlParameter` object s `Type` property to Decimal .</span></span>

<span data-ttu-id="a5e04-224">In secondo luogo, aggiungendo il `OR @MaximumPrice = -1.0` per il `WHERE` clausola, il motore di query non è possibile utilizzare un indice per `UnitPrice` (se ne esiste uno), determinando in tal modo una scansione di tabella.</span><span class="sxs-lookup"><span data-stu-id="a5e04-224">Secondly, by adding the `OR @MaximumPrice = -1.0` to the `WHERE` clause, the query engine cannot use an index on `UnitPrice` (assuming one exists), thereby resulting in a table scan.</span></span> <span data-ttu-id="a5e04-225">Questo può influire sulle prestazioni sono un numero sufficiente di record di `Products` tabella.</span><span class="sxs-lookup"><span data-stu-id="a5e04-225">This can impact performance if there are a sufficiently large number of records in the `Products` table.</span></span> <span data-ttu-id="a5e04-226">Un approccio migliore, è possibile spostare questa logica a una stored procedure in cui un `IF` istruzione potrebbe eseguire un `SELECT` query dal `Products` tabella senza un `WHERE` clausola quando tutti i record devono essere restituiti o uno cui `WHERE` clausola contiene solo il `UnitPrice` criteri, in modo che un indice può essere utilizzato.</span><span class="sxs-lookup"><span data-stu-id="a5e04-226">A better approach would be to move this logic to a stored procedure where an `IF` statement would either perform a `SELECT` query from the `Products` table without a `WHERE` clause when all records need to be returned or one whose `WHERE` clause contains just the `UnitPrice` criteria, so that an index can be used.</span></span>

## <a name="step-3-creating-and-using-parameterized-stored-procedures"></a><span data-ttu-id="a5e04-227">Passaggio 3: Creazione e utilizzo di Stored procedure con parametri</span><span class="sxs-lookup"><span data-stu-id="a5e04-227">Step 3: Creating and Using Parameterized Stored Procedures</span></span>

<span data-ttu-id="a5e04-228">Stored procedure possono includere un set di parametri di input che può quindi essere usato nelle istruzioni SQL definite all'interno della stored procedure.</span><span class="sxs-lookup"><span data-stu-id="a5e04-228">Stored procedures can include a set of input parameters that can then be used in the SQL statement(s) defined within the stored procedure.</span></span> <span data-ttu-id="a5e04-229">Quando si configura SqlDataSource per l'utilizzo di una stored procedure che accetta parametri di input, questi valori di parametro possono essere specificati con le stesse tecniche come istruzioni SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="a5e04-229">When configuring the SqlDataSource to use a stored procedure that accepts input parameters, these parameter values can be specified using the same techniques as with ad-hoc SQL statements.</span></span>

<span data-ttu-id="a5e04-230">Per illustrare l'utilizzo di stored procedure in SqlDataSource, s consentono di creare una nuova stored procedure nel database Northwind denominato `GetProductsByCategory`, che accetta un parametro denominato `@CategoryID` e restituisce tutte le colonne dei prodotti il cui `CategoryID` la colonna corrisponde a `@CategoryID`.</span><span class="sxs-lookup"><span data-stu-id="a5e04-230">To illustrate using stored procedures in the SqlDataSource, let s create a new stored procedure in the Northwind database named `GetProductsByCategory`, which accepts a parameter named `@CategoryID` and returns all of the columns of the products whose `CategoryID` column matches `@CategoryID`.</span></span> <span data-ttu-id="a5e04-231">Per creare una stored procedure, accedere a Esplora Server e drill-down di `NORTHWND.MDF` database.</span><span class="sxs-lookup"><span data-stu-id="a5e04-231">To create a stored procedure, go to the Server Explorer and drill down into the `NORTHWND.MDF` database.</span></span> <span data-ttu-id="a5e04-232">(Se non si t Esplora Server, attivare la modalità passare al menu Visualizza e selezionando l'opzione di Esplora Server.)</span><span class="sxs-lookup"><span data-stu-id="a5e04-232">(If you don t see the Server Explorer, bring it up by going to the View menu and selecting the Server Explorer option.)</span></span>

<span data-ttu-id="a5e04-233">Dal `NORTHWND.MDF` del database, fare doppio clic sulla cartella Stored procedure, scegliere Aggiungi nuova Stored Procedure e immettere la sintassi seguente:</span><span class="sxs-lookup"><span data-stu-id="a5e04-233">From the `NORTHWND.MDF` database, right-click on the Stored Procedures folder, choose Add New Stored Procedure, and enter the following syntax:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample8.sql)]

<span data-ttu-id="a5e04-234">Fare clic su Salva icona (o Ctrl + S) per salvare la stored procedure.</span><span class="sxs-lookup"><span data-stu-id="a5e04-234">Click the Save icon (or Ctrl+S) to save the stored procedure.</span></span> <span data-ttu-id="a5e04-235">È possibile testare la stored procedure facendovi dalla cartella Stored procedure e scegliendo Esegui.</span><span class="sxs-lookup"><span data-stu-id="a5e04-235">You can test the stored procedure by right-clicking it from the Stored Procedures folder and choosing Execute.</span></span> <span data-ttu-id="a5e04-236">Questo richiederà i parametri delle stored procedure s (`@CategoryID`, in questa istanza), dopo che i risultati, viene visualizzati nella finestra di Output.</span><span class="sxs-lookup"><span data-stu-id="a5e04-236">This will prompt you for the stored procedure s parameters (`@CategoryID`, in this instance), after which the results will be displayed in the Output window.</span></span>


<span data-ttu-id="a5e04-237">[![Il GetProductsByCategory Stored Procedure quando viene eseguito con un @CategoryID pari a 1](using-parameterized-queries-with-the-sqldatasource-vb/_static/image9.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="a5e04-237">[![The GetProductsByCategory Stored Procedure when Executed with a @CategoryID of 1](using-parameterized-queries-with-the-sqldatasource-vb/_static/image9.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image17.png)</span></span>

<span data-ttu-id="a5e04-238">**Figura 9**: il `GetProductsByCategory` Stored Procedure quando viene eseguito con un `@CategoryID` pari a 1 ([fare clic per visualizzare l'immagine ingrandita](using-parameterized-queries-with-the-sqldatasource-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="a5e04-238">**Figure 9**: The `GetProductsByCategory` Stored Procedure when Executed with a `@CategoryID` of 1 ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image18.png))</span></span>


<span data-ttu-id="a5e04-239">Consente di utilizzare questa stored procedure per visualizzare tutti i prodotti della categoria Beverages in GridView s.</span><span class="sxs-lookup"><span data-stu-id="a5e04-239">Let s use this stored procedure to display all products in the Beverages category in a GridView.</span></span> <span data-ttu-id="a5e04-240">Aggiungere un nuovo GridView alla pagina e associarlo a un nuovo SqlDataSource denominato `BeverageProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="a5e04-240">Add a new GridView to the page and bind it to a new SqlDataSource named `BeverageProductsDataSource`.</span></span> <span data-ttu-id="a5e04-241">Continuare per specificare una schermata di stored procedure o un'istruzione SQL personalizzata, selezionare il pulsante di opzione di Stored procedure e selezionare il `GetProductsByCategory` stored procedure dall'elenco a discesa.</span><span class="sxs-lookup"><span data-stu-id="a5e04-241">Continue to the Specify a custom SQL statement or stored procedure screen, select the Stored procedure radio button, and pick the `GetProductsByCategory` stored procedure from the drop-down list.</span></span>


<span data-ttu-id="a5e04-242">[![Selezionare il GetProductsByCategory Stored Procedure dall'elenco a discesa](using-parameterized-queries-with-the-sqldatasource-vb/_static/image10.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="a5e04-242">[![Select the GetProductsByCategory Stored Procedure from the Drop-Down List](using-parameterized-queries-with-the-sqldatasource-vb/_static/image10.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image19.png)</span></span>

<span data-ttu-id="a5e04-243">**Figura 10**: selezionare il `GetProductsByCategory` Stored Procedure dall'elenco a discesa ([fare clic per visualizzare l'immagine ingrandita](using-parameterized-queries-with-the-sqldatasource-vb/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="a5e04-243">**Figure 10**: Select the `GetProductsByCategory` Stored Procedure from the Drop-Down List ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image20.png))</span></span>


<span data-ttu-id="a5e04-244">Poiché la stored procedure accetta un parametro di input (`@CategoryID`), fare clic su Avanti, viene richiesto di specificare l'origine per il valore del parametro s.</span><span class="sxs-lookup"><span data-stu-id="a5e04-244">Since the stored procedure accepts an input parameter (`@CategoryID`), clicking Next prompts us to specify the source for this parameter s value.</span></span> <span data-ttu-id="a5e04-245">Le bibite `CategoryID` è 1, pertanto lasciare l'elenco di riepilogo a discesa Origine parametro None e immettere 1 nella casella di testo DefaultValue.</span><span class="sxs-lookup"><span data-stu-id="a5e04-245">The Beverages `CategoryID` is 1, so leave the Parameter source drop-down list at None and enter 1 into the DefaultValue textbox.</span></span>


<span data-ttu-id="a5e04-246">[![Utilizzare un Hard-Coded pari a 1 per restituire i prodotti della categoria Beverages](using-parameterized-queries-with-the-sqldatasource-vb/_static/image11.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="a5e04-246">[![Use a Hard-Coded Value of 1 to Return the Products in the Beverages Category](using-parameterized-queries-with-the-sqldatasource-vb/_static/image11.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image21.png)</span></span>

<span data-ttu-id="a5e04-247">**Figura 11**: utilizzare un Hard-Coded pari a 1 per restituire i prodotti della categoria Beverages ([fare clic per visualizzare l'immagine ingrandita](using-parameterized-queries-with-the-sqldatasource-vb/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="a5e04-247">**Figure 11**: Use a Hard-Coded Value of 1 to Return the Products in the Beverages Category ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image22.png))</span></span>


<span data-ttu-id="a5e04-248">Come illustrato nel codice dichiarativo seguente, quando si utilizza una stored procedure, s SqlDataSource `SelectCommand` proprietà è impostata sul nome della stored procedure e [ `SelectCommandType` proprietà](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.selectcommandtype.aspx) è impostato su `StoredProcedure`, che indica che il `SelectCommand` è il nome di una stored procedure anziché un'istruzione SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="a5e04-248">As the following declarative markup shows, when using a stored procedure, the SqlDataSource s `SelectCommand` property is set to the name of the stored procedure and the [`SelectCommandType` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.selectcommandtype.aspx) is set to `StoredProcedure`, indicating that the `SelectCommand` is the name of a stored procedure rather than an ad-hoc SQL statement.</span></span>


[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample9.aspx)]

<span data-ttu-id="a5e04-249">Testare la pagina in un browser.</span><span class="sxs-lookup"><span data-stu-id="a5e04-249">Test out the page in a browser.</span></span> <span data-ttu-id="a5e04-250">Vengono visualizzati solo i prodotti che appartengono alla categoria Beverages, anche se *tutti* del prodotto vengono visualizzati i campi, poiché il `GetProductsByCategory` stored procedure restituisce tutte le colonne dal `Products` tabella.</span><span class="sxs-lookup"><span data-stu-id="a5e04-250">Only those products that belong to the Beverages category are displayed, although *all* of the product fields are displayed since the `GetProductsByCategory` stored procedure returns all of the columns from the `Products` table.</span></span> <span data-ttu-id="a5e04-251">È possibile, naturalmente, limitare o personalizzare i campi visualizzati in GridView nella finestra di dialogo Modifica colonne s GridView.</span><span class="sxs-lookup"><span data-stu-id="a5e04-251">We could, of course, limit or customize the fields displayed in the GridView from the GridView s Edit Columns dialog box.</span></span>


<span data-ttu-id="a5e04-252">[![Vengono visualizzati tutti delle bevande](using-parameterized-queries-with-the-sqldatasource-vb/_static/image12.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="a5e04-252">[![All of the Beverages are Displayed](using-parameterized-queries-with-the-sqldatasource-vb/_static/image12.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image23.png)</span></span>

<span data-ttu-id="a5e04-253">**Figura 12**: vengono visualizzate tutte le bibite ([fare clic per visualizzare l'immagine ingrandita](using-parameterized-queries-with-the-sqldatasource-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="a5e04-253">**Figure 12**: All of the Beverages are Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image24.png))</span></span>


## <a name="step-4-programmatically-invoking-a-sqldatasource-sselectstatement"></a><span data-ttu-id="a5e04-254">Passaggio 4: Richiamare a livello di programmazione s SqlDataSource`Select()`istruzione</span><span class="sxs-lookup"><span data-stu-id="a5e04-254">Step 4: Programmatically Invoking a SqlDataSource s`Select()`Statement</span></span>

<span data-ttu-id="a5e04-255">Negli esempi è ve descritte nell'esercitazione precedente e in questa esercitazione sono associati a controlli SqlDataSource direttamente a un controllo GridView.</span><span class="sxs-lookup"><span data-stu-id="a5e04-255">The examples we ve seen in the previous tutorial and this tutorial so far have bound SqlDataSource controls directly to a GridView.</span></span> <span data-ttu-id="a5e04-256">I dati del controllo s SqlDataSource, tuttavia, a livello di programmazione accessibili ed enumerati nel codice.</span><span class="sxs-lookup"><span data-stu-id="a5e04-256">The SqlDataSource control s data, however, can be programmatically accessed and enumerated in code.</span></span> <span data-ttu-id="a5e04-257">Può essere particolarmente utile quando è necessario eseguire query sui dati per verificarlo, ma tenere sempre necessario per visualizzarlo.</span><span class="sxs-lookup"><span data-stu-id="a5e04-257">This can be particularly useful when you need to query data to inspect it, but don t need to display it.</span></span> <span data-ttu-id="a5e04-258">Anziché dover scrivere tutti i commenti di codice ADO.NET per connettersi al database, specificare il comando e recuperare i risultati, è possibile consentire SqlDataSource gestire questo codice monotono.</span><span class="sxs-lookup"><span data-stu-id="a5e04-258">Rather than having to write all of the boilerplate ADO.NET code to connect to the database, specify the command, and retrieve the results, you can let the SqlDataSource handle this monotonous code.</span></span>

<span data-ttu-id="a5e04-259">Per illustrare l'uso di s SqlDataSource dati a livello di codice, si supponga che un determinato mittente ha affrontato si con una richiesta per creare una pagina web che visualizza il nome di una categoria selezionata in modo casuale e i relativi prodotti associati.</span><span class="sxs-lookup"><span data-stu-id="a5e04-259">To illustrate working with the SqlDataSource s data programmatically, imagine that your boss has approached you with a request to create a web page that displays the name of a randomly selected category and its associated products.</span></span> <span data-ttu-id="a5e04-260">Vale a dire quando un utente visita questa pagina, si desidera scegliere casualmente una categoria di `Categories` tabella, visualizzare il nome della categoria e quindi elencati i prodotti appartenenti alla categoria selezionata.</span><span class="sxs-lookup"><span data-stu-id="a5e04-260">That is, when a user visits this page, we want to randomly choose a category from the `Categories` table, display the category name, and then list the products belonging to that category.</span></span>

<span data-ttu-id="a5e04-261">A tale scopo è necessario avere due controlli SqlDataSource uno per selezionare una categoria casuale dal `Categories` tabella e un altro per ottenere la categoria di prodotti.</span><span class="sxs-lookup"><span data-stu-id="a5e04-261">To accomplish this we need two SqlDataSource controls one to grab a random category from the `Categories` table and another to get the category s products.</span></span> <span data-ttu-id="a5e04-262">Creeremo SqlDataSource che recupera un record di categoria casuali in questo passaggio. Passaggio 5 esamina crea SqlDataSource che recupera i prodotti s categoria.</span><span class="sxs-lookup"><span data-stu-id="a5e04-262">We'll build the SqlDataSource that retrieves a random category record in this step; Step 5 looks at crafting the SqlDataSource that retrieves the category s products.</span></span>

<span data-ttu-id="a5e04-263">Per iniziare, aggiungere un SqlDataSource per `ParameterizedQueries.aspx` e impostare il relativo `ID` a `RandomCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="a5e04-263">Start by adding a SqlDataSource to `ParameterizedQueries.aspx` and set its `ID` to `RandomCategoryDataSource`.</span></span> <span data-ttu-id="a5e04-264">Configurarlo in modo che utilizzi la query SQL seguente:</span><span class="sxs-lookup"><span data-stu-id="a5e04-264">Configure it so that it uses the following SQL query:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample10.sql)]

<span data-ttu-id="a5e04-265">`ORDER BY NEWID()` Restituisce i record ordinati in ordine casuale (vedere [Using `NEWID()` per ordinare in modo casuale i record](http://www.sqlteam.com/item.asp?ItemID=8747)).</span><span class="sxs-lookup"><span data-stu-id="a5e04-265">`ORDER BY NEWID()` returns the records sorted in random order (see [Using `NEWID()` to Randomly Sort Records](http://www.sqlteam.com/item.asp?ItemID=8747)).</span></span> <span data-ttu-id="a5e04-266">`SELECT TOP 1` Restituisce il primo record dal set di risultati.</span><span class="sxs-lookup"><span data-stu-id="a5e04-266">`SELECT TOP 1` returns the first record from the result set.</span></span> <span data-ttu-id="a5e04-267">Mettere insieme, la query seguente restituisce il `CategoryID` e `CategoryName` valori della colonna da una categoria singolo, selezionato in modo casuale.</span><span class="sxs-lookup"><span data-stu-id="a5e04-267">Put together, this query returns the `CategoryID` and `CategoryName` column values from a single, randomly selected category.</span></span>

<span data-ttu-id="a5e04-268">Per visualizzare la categoria s `CategoryName` valore, aggiungere un controllo etichetta Web alla pagina, impostare il relativo `ID` proprietà `CategoryNameLabel`e cancellare la `Text` proprietà.</span><span class="sxs-lookup"><span data-stu-id="a5e04-268">To display the category s `CategoryName` value, add a Label Web control to the page, set its `ID` property to `CategoryNameLabel`, and clear out its `Text` property.</span></span> <span data-ttu-id="a5e04-269">Per recuperare a livello di programmazione i dati da un controllo SqlDataSource, è necessario richiamare il `Select()` metodo.</span><span class="sxs-lookup"><span data-stu-id="a5e04-269">To programmatically retrieve the data from a SqlDataSource control, we need to invoke its `Select()` method.</span></span> <span data-ttu-id="a5e04-270">Il [ `Select()` metodo](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.select.aspx) prevede un solo parametro di input di tipo [ `DataSourceSelectArguments` ](https://msdn.microsoft.com/library/system.web.ui.datasourceselectarguments.aspx), che specifica come i dati devono essere messaggi prima della restituzione.</span><span class="sxs-lookup"><span data-stu-id="a5e04-270">The [`Select()` method](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.select.aspx) expects a single input parameter of type [`DataSourceSelectArguments`](https://msdn.microsoft.com/library/system.web.ui.datasourceselectarguments.aspx), which specifies how the data should be messaged before being returned.</span></span> <span data-ttu-id="a5e04-271">Può includere istruzioni sull'ordinamento e filtro dei dati e viene utilizzato dai dati di che controlli Web durante l'ordinamento o paging dei dati da un controllo SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="a5e04-271">This can include instructions on sorting and filtering the data, and is used by the data Web controls when sorting or paging through the data from a SqlDataSource control.</span></span> <span data-ttu-id="a5e04-272">Per questo esempio, tuttavia, è si necessità di t i dati di essere modificato prima della restituzione e pertanto verrà passato il `DataSourceSelectArguments.Empty` oggetto.</span><span class="sxs-lookup"><span data-stu-id="a5e04-272">For our example, though, we don t need the data to be modified before being returned, and therefore will pass in the `DataSourceSelectArguments.Empty` object.</span></span>

<span data-ttu-id="a5e04-273">Il `Select()` metodo restituisce un oggetto che implementa `IEnumerable`.</span><span class="sxs-lookup"><span data-stu-id="a5e04-273">The `Select()` method returns an object that implements `IEnumerable`.</span></span> <span data-ttu-id="a5e04-274">Il tipo preciso restituito dipende dal valore del controllo SqlDataSource s [ `DataSourceMode` proprietà](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.datasourcemode.aspx).</span><span class="sxs-lookup"><span data-stu-id="a5e04-274">The precise type returned depends on the value of the SqlDataSource control s [`DataSourceMode` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.datasourcemode.aspx).</span></span> <span data-ttu-id="a5e04-275">Come descritto nell'esercitazione precedente, questa proprietà può essere impostata su un valore di `DataSet` o `DataReader`.</span><span class="sxs-lookup"><span data-stu-id="a5e04-275">As discussed in the previous tutorial, this property can be set to a value of either `DataSet` or `DataReader`.</span></span> <span data-ttu-id="a5e04-276">Se impostato su `DataSet`, `Select()` metodo restituisce un [DataView](https://msdn.microsoft.com/library/01s96x0z.aspx) oggetto; se impostata su `DataReader`, restituisce un oggetto che implementa [ `IDataReader` ](https://msdn.microsoft.com/library/system.data.idatareader.aspx).</span><span class="sxs-lookup"><span data-stu-id="a5e04-276">If set to `DataSet`, the `Select()` method returns a [DataView](https://msdn.microsoft.com/library/01s96x0z.aspx) object; if set to `DataReader`, it returns an object that implements [`IDataReader`](https://msdn.microsoft.com/library/system.data.idatareader.aspx).</span></span> <span data-ttu-id="a5e04-277">Poiché il `RandomCategoryDataSource` SqlDataSource è relativo `DataSourceMode` proprietà impostata su `DataSet` (impostazione predefinita), verrà utilizzato con un oggetto DataView.</span><span class="sxs-lookup"><span data-stu-id="a5e04-277">Since the `RandomCategoryDataSource` SqlDataSource has its `DataSourceMode` property set to `DataSet` (the default), we will be working with a DataView object.</span></span>

<span data-ttu-id="a5e04-278">Il codice seguente viene illustrato come recuperare i record di `RandomCategoryDataSource` SqlDataSource come un oggetto DataView e come leggere il `CategoryName` valore della colonna della prima riga di DataView:</span><span class="sxs-lookup"><span data-stu-id="a5e04-278">The following code illustrates how to retrieve the records from the `RandomCategoryDataSource` SqlDataSource as a DataView as well as how to read the `CategoryName` column value from the first DataView row:</span></span>


[!code-vb[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample11.vb)]

<span data-ttu-id="a5e04-279">`randomCategoryView(0)` Restituisce il primo `DataRowView` nella vista dati.</span><span class="sxs-lookup"><span data-stu-id="a5e04-279">`randomCategoryView(0)` returns the first `DataRowView` in the DataView.</span></span> <span data-ttu-id="a5e04-280">`randomCategoryView(0)("CategoryName")` Restituisce il valore della `CategoryName` colonna nella prima riga.</span><span class="sxs-lookup"><span data-stu-id="a5e04-280">`randomCategoryView(0)("CategoryName")` returns the value of the `CategoryName` column in this first row.</span></span> <span data-ttu-id="a5e04-281">Si noti che la vista dati fortemente tipizzato.</span><span class="sxs-lookup"><span data-stu-id="a5e04-281">Note that the DataView is loosely-typed.</span></span> <span data-ttu-id="a5e04-282">Per fare riferimento a un valore di colonna specifica è necessario passare il nome della colonna come una stringa (CategoryName, in questo caso).</span><span class="sxs-lookup"><span data-stu-id="a5e04-282">To reference a particular column value we need to pass in the name of the column as a string ( CategoryName, in this case).</span></span> <span data-ttu-id="a5e04-283">Figura 13 illustra il messaggio visualizzato nel `CategoryNameLabel` la visualizzazione della pagina.</span><span class="sxs-lookup"><span data-stu-id="a5e04-283">Figure 13 shows the message displayed in the `CategoryNameLabel` when viewing the page.</span></span> <span data-ttu-id="a5e04-284">Naturalmente, il nome di categoria effettiva visualizzato viene selezionato casualmente dal `RandomCategoryDataSource` SqlDataSource su ogni visita la pagina (inclusi i postback).</span><span class="sxs-lookup"><span data-stu-id="a5e04-284">Of course, the actual category name displayed is randomly selected by the `RandomCategoryDataSource` SqlDataSource on each visit to the page (including postbacks).</span></span>


<span data-ttu-id="a5e04-285">[![Gli oggetti selezionati in modo casuale categoria che nome viene visualizzato](using-parameterized-queries-with-the-sqldatasource-vb/_static/image13.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="a5e04-285">[![The Randomly Selected Category s Name is Displayed](using-parameterized-queries-with-the-sqldatasource-vb/_static/image13.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image25.png)</span></span>

<span data-ttu-id="a5e04-286">**Figura 13**: s il in modo casuale categoria selezionata viene visualizzato nome ([fare clic per visualizzare l'immagine ingrandita](using-parameterized-queries-with-the-sqldatasource-vb/_static/image26.png))</span><span class="sxs-lookup"><span data-stu-id="a5e04-286">**Figure 13**: The Randomly Selected Category s Name is Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image26.png))</span></span>


> [!NOTE]
> <span data-ttu-id="a5e04-287">Se il controllo SqlDataSource s `DataSourceMode` era impostata su `DataReader`, il valore restituito dal `Select()` metodo sarebbe stato necessario eseguire il cast a `IDataReader`.</span><span class="sxs-lookup"><span data-stu-id="a5e04-287">If the SqlDataSource control s `DataSourceMode` property had been set to `DataReader`, the return value from the `Select()` method would have needed to be cast to `IDataReader`.</span></span> <span data-ttu-id="a5e04-288">Per leggere il `CategoryName` valore della colonna della prima riga è d usare codice simile:</span><span class="sxs-lookup"><span data-stu-id="a5e04-288">To read the `CategoryName` column value from the first row, we d use code like:</span></span>


[!code-vb[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample12.vb)]

<span data-ttu-id="a5e04-289">Con SqlDataSource seleziona casualmente una categoria, è nuovamente pronto per aggiungere il controllo GridView in cui sono elencati i prodotti della categoria s.</span><span class="sxs-lookup"><span data-stu-id="a5e04-289">With the SqlDataSource randomly selecting a category, we re ready to add the GridView that lists the category s products.</span></span>

> [!NOTE]
> <span data-ttu-id="a5e04-290">Anziché utilizzare un controllo etichetta Web per visualizzare il nome di categoria s, avremmo potuto aggiungere un controllo FormView o DetailsView alla pagina, associazione a SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="a5e04-290">Rather than using a Label Web control to display the category s name, we could have added a FormView or DetailsView to the page, binding it to the SqlDataSource.</span></span> <span data-ttu-id="a5e04-291">Con l'etichetta, tuttavia, consente di esplorare come richiamare a livello di programmazione s SqlDataSource `Select()` istruzione e lavorare con i dati risultanti nel codice.</span><span class="sxs-lookup"><span data-stu-id="a5e04-291">Using the Label, however, allowed us to explore how to programmatically invoke the SqlDataSource s `Select()` statement and work with its resulting data in code.</span></span>


## <a name="step-5-assigning-parameter-values-programmatically"></a><span data-ttu-id="a5e04-292">Passaggio 5: Assegnare i valori dei parametri a livello di codice</span><span class="sxs-lookup"><span data-stu-id="a5e04-292">Step 5: Assigning Parameter Values Programmatically</span></span>

<span data-ttu-id="a5e04-293">Tutti gli esempi si ve descritte in questa esercitazione è stato utilizzato un valore di parametro hardcoded o quello eseguito da una delle origini di parametro predefiniti (un valore di stringa di query, un controllo Web nella pagina e così via).</span><span class="sxs-lookup"><span data-stu-id="a5e04-293">All of the examples we ve seen so far in this tutorial have used either a hard-coded parameter value or one taken from one of the pre-defined parameter sources (a querystring value, a Web control on the page, and so on).</span></span> <span data-ttu-id="a5e04-294">Tuttavia, i parametri di s controllo SqlDataSource possono anche essere impostati a livello di codice.</span><span class="sxs-lookup"><span data-stu-id="a5e04-294">However, the SqlDataSource control s parameters can also be set programmatically.</span></span> <span data-ttu-id="a5e04-295">Per completare l'esempio corrente, è necessario un SqlDataSource che restituisce tutti i prodotti appartenenti a una categoria specificata.</span><span class="sxs-lookup"><span data-stu-id="a5e04-295">To complete our current example, we need a SqlDataSource that returns all of the products belonging to a specified category.</span></span> <span data-ttu-id="a5e04-296">Questo SqlDataSource avrà un `CategoryID` parametro il cui valore deve essere impostata in base il `CategoryID` valore della colonna restituito dal `RandomCategoryDataSource` SqlDataSource nel `Page_Load` gestore dell'evento.</span><span class="sxs-lookup"><span data-stu-id="a5e04-296">This SqlDataSource will have a `CategoryID` parameter whose value needs to be set based on the `CategoryID` column value returned by the `RandomCategoryDataSource` SqlDataSource in the `Page_Load` event handler.</span></span>

<span data-ttu-id="a5e04-297">Per iniziare, aggiungere un controllo GridView alla pagina e associarlo a un nuovo SqlDataSource denominato `ProductsByCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="a5e04-297">Start by adding a GridView to the page and bind it to a new SqlDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="a5e04-298">Proprio come abbiamo visto nel passaggio 3, configurare SqlDataSource in modo che richiama la `GetProductsByCategory` stored procedure.</span><span class="sxs-lookup"><span data-stu-id="a5e04-298">Much like we did in Step 3, configure the SqlDataSource so that it invokes the `GetProductsByCategory` stored procedure.</span></span> <span data-ttu-id="a5e04-299">Lasciare il parametro origine riepilogo impostato su None, ma si immette un valore predefinito, come si imposterà il valore predefinito a livello di codice.</span><span class="sxs-lookup"><span data-stu-id="a5e04-299">Leave the Parameter source drop-down list set to None, but do not enter a default value, as we will set this default value programmatically.</span></span>


<span data-ttu-id="a5e04-300">[![Non si specifica un'origine di parametro o valore predefinito](using-parameterized-queries-with-the-sqldatasource-vb/_static/image14.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="a5e04-300">[![Do Not Specify a Parameter Source or Default Value](using-parameterized-queries-with-the-sqldatasource-vb/_static/image14.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image27.png)</span></span>

<span data-ttu-id="a5e04-301">**Figura 14**: non si specifica un parametro di origine o un valore predefinito ([fare clic per visualizzare l'immagine ingrandita](using-parameterized-queries-with-the-sqldatasource-vb/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="a5e04-301">**Figure 14**: Do Not Specify a Parameter Source or Default Value ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image28.png))</span></span>


<span data-ttu-id="a5e04-302">Dopo aver completato la procedura guidata SqlDataSource, markup dichiarativo risultante dovrebbe essere simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="a5e04-302">After completing the SqlDataSource wizard, the resulting declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample13.aspx)]

<span data-ttu-id="a5e04-303">È possibile assegnare il `DefaultValue` del `CategoryID` parametro livello di programmazione il `Page_Load` gestore eventi:</span><span class="sxs-lookup"><span data-stu-id="a5e04-303">We can assign the `DefaultValue` of the `CategoryID` parameter programmatically in the `Page_Load` event handler:</span></span>


[!code-vb[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample14.vb)]

<span data-ttu-id="a5e04-304">Con l'aggiunta, la pagina include un controllo GridView che mostra i prodotti associati alla categoria selezionata in modo casuale.</span><span class="sxs-lookup"><span data-stu-id="a5e04-304">With this addition, the page includes a GridView that shows the products associated with the randomly selected category.</span></span>


<span data-ttu-id="a5e04-305">[![Non si specifica un'origine di parametro o valore predefinito](using-parameterized-queries-with-the-sqldatasource-vb/_static/image15.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="a5e04-305">[![Do Not Specify a Parameter Source or Default Value](using-parameterized-queries-with-the-sqldatasource-vb/_static/image15.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image29.png)</span></span>

<span data-ttu-id="a5e04-306">**Figura 15**: non si specifica un parametro di origine o un valore predefinito ([fare clic per visualizzare l'immagine ingrandita](using-parameterized-queries-with-the-sqldatasource-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="a5e04-306">**Figure 15**: Do Not Specify a Parameter Source or Default Value ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image30.png))</span></span>


## <a name="summary"></a><span data-ttu-id="a5e04-307">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="a5e04-307">Summary</span></span>

<span data-ttu-id="a5e04-308">SqlDataSource consente agli sviluppatori di pagina definire le query con parametri i cui valori di parametro possono essere hardcoded, il pull da origini di parametro predefiniti o assegnati a livello di codice.</span><span class="sxs-lookup"><span data-stu-id="a5e04-308">The SqlDataSource enables page developers to define parameterized queries whose parameter values can be hard-coded, pulled from pre-defined parameter sources, or assigned programmatically.</span></span> <span data-ttu-id="a5e04-309">In questa esercitazione è stato illustrato come creare una query con parametri dalla procedura guidata Configura origine dati per le query SQL ad hoc e stored procedure.</span><span class="sxs-lookup"><span data-stu-id="a5e04-309">In this tutorial we saw how to craft a parameterized query from the Configure Data Source wizard for both ad-hoc SQL queries and stored procedures.</span></span> <span data-ttu-id="a5e04-310">È inoltre esaminato l'utilizzo di origini di parametro a livello di codice, un controllo Web come origine, parametro e a livello di codice che specifica il valore del parametro.</span><span class="sxs-lookup"><span data-stu-id="a5e04-310">We also looked at using hard-coded parameter sources, a Web control as a parameter source, and programmatically specifying the parameter value.</span></span>

<span data-ttu-id="a5e04-311">Ad esempio con ObjectDataSource, SqlDataSource offre inoltre funzionalità per modificare i dati sottostanti.</span><span class="sxs-lookup"><span data-stu-id="a5e04-311">Like with the ObjectDataSource, the SqlDataSource also provides capabilities to modify its underlying data.</span></span> <span data-ttu-id="a5e04-312">Nella prossima esercitazione verrà esaminato come definire `INSERT`, `UPDATE`, e `DELETE` istruzioni con SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="a5e04-312">In the next tutorial we'll look at how to define `INSERT`, `UPDATE`, and `DELETE` statements with the SqlDataSource.</span></span> <span data-ttu-id="a5e04-313">Dopo aver aggiunto queste istruzioni, che possiamo utilizzare predefiniti di inserimento, modifica ed eliminazione di funzioni intrinseche ai controlli GridView, DetailsView e FormView.</span><span class="sxs-lookup"><span data-stu-id="a5e04-313">Once these statements have been added, we can utilize the built-in inserting, editing, and deleting features inherent to the GridView, DetailsView, and FormView controls.</span></span>

<span data-ttu-id="a5e04-314">Buona programmazione!</span><span class="sxs-lookup"><span data-stu-id="a5e04-314">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="a5e04-315">Informazioni sull'autore</span><span class="sxs-lookup"><span data-stu-id="a5e04-315">About the Author</span></span>

<span data-ttu-id="a5e04-316">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), l'autore di sette libri e fondatore di [4GuysFromRolla](http://www.4guysfromrolla.com), ha lavorato con tecnologie Web di Microsoft dal 1998.</span><span class="sxs-lookup"><span data-stu-id="a5e04-316">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="a5e04-317">Scott funziona come un consulente trainer e writer.</span><span class="sxs-lookup"><span data-stu-id="a5e04-317">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="a5e04-318">Il suo ultimo libro è [ *SAM insegna manualmente ASP.NET 2.0 nelle 24 ore*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="a5e04-318">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="a5e04-319">Egli può essere raggiunto al [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) o sul suo blog, cui è reperibile in [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="a5e04-319">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="a5e04-320">Ringraziamenti speciali</span><span class="sxs-lookup"><span data-stu-id="a5e04-320">Special Thanks To</span></span>

<span data-ttu-id="a5e04-321">Questa serie di esercitazioni è stata esaminata da diversi validi revisori.</span><span class="sxs-lookup"><span data-stu-id="a5e04-321">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="a5e04-322">Lead revisori per questa esercitazione sono stati Scott Clyde Randell Schmidt e Ken Pespisa.</span><span class="sxs-lookup"><span data-stu-id="a5e04-322">Lead reviewers for this tutorial were Scott Clyde, Randell Schmidt, and Ken Pespisa.</span></span> <span data-ttu-id="a5e04-323">Se si è interessati my prossimi articoli MSDN?</span><span class="sxs-lookup"><span data-stu-id="a5e04-323">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="a5e04-324">In caso affermativo, Inviami una riga alla [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="a5e04-324">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="a5e04-325">[Precedente](querying-data-with-the-sqldatasource-control-vb.md)
> [Successivo](inserting-updating-and-deleting-data-with-the-sqldatasource-vb.md)</span><span class="sxs-lookup"><span data-stu-id="a5e04-325">[Previous](querying-data-with-the-sqldatasource-control-vb.md)
[Next](inserting-updating-and-deleting-data-with-the-sqldatasource-vb.md)</span></span>
