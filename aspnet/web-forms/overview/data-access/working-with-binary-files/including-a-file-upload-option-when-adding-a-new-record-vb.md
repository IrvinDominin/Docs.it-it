---
uid: web-forms/overview/data-access/working-with-binary-files/including-a-file-upload-option-when-adding-a-new-record-vb
title: Incluso un File di caricare l'opzione quando si aggiunge un nuovo Record (VB) | Documenti Microsoft
author: rick-anderson
description: In questa esercitazione viene illustrato come creare un'interfaccia Web che consente all'utente di immettere i dati di testo e caricare file binari. Per illustrare le opzioni disponibili t...
ms.author: aspnetcontent
manager: wpickett
ms.date: 03/27/2007
ms.topic: article
ms.assetid: 5776281d-4637-4d1e-a65b-2621d2cade44
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/working-with-binary-files/including-a-file-upload-option-when-adding-a-new-record-vb
msc.type: authoredcontent
ms.openlocfilehash: 39608eef7cc88be56ef6e21820e4afcfaa4ffd8d
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/06/2018
ms.locfileid: "30888653"
---
<a name="including-a-file-upload-option-when-adding-a-new-record-vb"></a><span data-ttu-id="29e40-104">Tra cui un'opzione di caricamento di File quando si aggiunge un nuovo Record (VB)</span><span class="sxs-lookup"><span data-stu-id="29e40-104">Including a File Upload Option When Adding a New Record (VB)</span></span>
====================
<span data-ttu-id="29e40-105">da [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="29e40-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="29e40-106">[Scaricare App di esempio](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_56_VB.exe) o [Scarica il PDF](including-a-file-upload-option-when-adding-a-new-record-vb/_static/datatutorial56vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="29e40-106">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_56_VB.exe) or [Download PDF](including-a-file-upload-option-when-adding-a-new-record-vb/_static/datatutorial56vb1.pdf)</span></span>

> <span data-ttu-id="29e40-107">In questa esercitazione viene illustrato come creare un'interfaccia Web che consente all'utente di immettere i dati di testo e caricare file binari.</span><span class="sxs-lookup"><span data-stu-id="29e40-107">This tutorial shows how to create a Web interface that allows the user to both enter text data and upload binary files.</span></span> <span data-ttu-id="29e40-108">Per illustrare le opzioni disponibili per archiviare i dati binari, un file verrà salvato nel database mentre l'altra viene archiviata nel file system.</span><span class="sxs-lookup"><span data-stu-id="29e40-108">To illustrate the options available to store binary data, one file will be saved in the database while the other is stored in the file system.</span></span>


## <a name="introduction"></a><span data-ttu-id="29e40-109">Introduzione</span><span class="sxs-lookup"><span data-stu-id="29e40-109">Introduction</span></span>

<span data-ttu-id="29e40-110">Nelle due esercitazioni precedenti abbiamo esplorato tecniche per l'archiviazione dei dati binari che sono associati al modello di dati applicazione s, esaminato come utilizzare il controllo FileUpload per inviare file dal client al server web e visto come presentare i dati binari in una data W controllo EB.</span><span class="sxs-lookup"><span data-stu-id="29e40-110">In the previous two tutorials we explored techniques for storing binary data that is associated with the application s data model, looked at how to use the FileUpload control to send files from the client to the web server, and saw how to present this binary data in a data Web control.</span></span> <span data-ttu-id="29e40-111">Si sposta ancora da trattare come associare i dati caricati con il modello di dati, tuttavia.</span><span class="sxs-lookup"><span data-stu-id="29e40-111">We ve yet to talk about how to associate uploaded data with the data model, though.</span></span>

<span data-ttu-id="29e40-112">In questa esercitazione si creerà una pagina web per aggiungere una nuova categoria.</span><span class="sxs-lookup"><span data-stu-id="29e40-112">In this tutorial we will create a web page to add a new category.</span></span> <span data-ttu-id="29e40-113">Oltre alle caselle di testo per il nome della categoria s e la descrizione, questa pagina sarà necessario includere due controlli FileUpload uno per la nuova immagine di categoria s e uno per brochure.</span><span class="sxs-lookup"><span data-stu-id="29e40-113">In addition to TextBoxes for the category s name and description, this page will need to include two FileUpload controls one for the new category s picture and one for the brochure.</span></span> <span data-ttu-id="29e40-114">L'immagine caricata verrà archiviato direttamente nel nuovo record s `Picture` colonna, mentre la brochure verrà salvata la `~/Brochures` cartella con il percorso al file salvato nel nuovo record s `BrochurePath` colonna.</span><span class="sxs-lookup"><span data-stu-id="29e40-114">The uploaded picture will be stored directly in the new record s `Picture` column, whereas the brochure will be saved to the `~/Brochures` folder with the path to the file saved in the new record s `BrochurePath` column.</span></span>

<span data-ttu-id="29e40-115">Prima di creare la nuova pagina web, sarà necessario aggiornare l'architettura.</span><span class="sxs-lookup"><span data-stu-id="29e40-115">Before creating this new web page, we'll need to update the architecture.</span></span> <span data-ttu-id="29e40-116">Il `CategoriesTableAdapter` query principale s non recupera il `Picture` colonna.</span><span class="sxs-lookup"><span data-stu-id="29e40-116">The `CategoriesTableAdapter` s main query does not retrieve the `Picture` column.</span></span> <span data-ttu-id="29e40-117">Di conseguenza, generata automaticamente `Insert` dispone solo di input per il `CategoryName`, `Description`, e `BrochurePath` campi.</span><span class="sxs-lookup"><span data-stu-id="29e40-117">Consequently, the auto-generated `Insert` method only has inputs for the `CategoryName`, `Description`, and `BrochurePath` fields.</span></span> <span data-ttu-id="29e40-118">Pertanto, è necessario creare un metodo aggiuntivo in TableAdapter che richiede di tutti e quattro `Categories` campi.</span><span class="sxs-lookup"><span data-stu-id="29e40-118">Therefore, we need to create an additional method in the TableAdapter that prompts for all four `Categories` fields.</span></span> <span data-ttu-id="29e40-119">La `CategoriesBLL` classe nel livello di logica di Business anche dovrà essere aggiornata.</span><span class="sxs-lookup"><span data-stu-id="29e40-119">The `CategoriesBLL` class in the Business Logic Layer will also need to be updated.</span></span>

## <a name="step-1-adding-aninsertwithpicturemethod-to-thecategoriestableadapter"></a><span data-ttu-id="29e40-120">Passaggio 1: Aggiunta di un`InsertWithPicture`metodo per il`CategoriesTableAdapter`</span><span class="sxs-lookup"><span data-stu-id="29e40-120">Step 1: Adding an`InsertWithPicture`Method to the`CategoriesTableAdapter`</span></span>

<span data-ttu-id="29e40-121">Quando abbiamo creato il `CategoriesTableAdapter` nuovamente il [la creazione di un livello di accesso ai dati](../introduction/creating-a-data-access-layer-vb.md) esercitazione, è configurata in modo da generare automaticamente `INSERT`, `UPDATE`, e `DELETE` istruzioni in base alla query principale.</span><span class="sxs-lookup"><span data-stu-id="29e40-121">When we created the `CategoriesTableAdapter` back in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md) tutorial, we configured it to automatically generate `INSERT`, `UPDATE`, and `DELETE` statements based on the main query.</span></span> <span data-ttu-id="29e40-122">Inoltre, è richiesto da adottare l'approccio diretto DB, che ha creato i metodi TableAdapter `Insert`, `Update`, e `Delete`.</span><span class="sxs-lookup"><span data-stu-id="29e40-122">Moreover, we instructed the TableAdapter to employ the DB Direct approach, which created the methods `Insert`, `Update`, and `Delete`.</span></span> <span data-ttu-id="29e40-123">Questi metodi eseguire generata automaticamente `INSERT`, `UPDATE`, e `DELETE` istruzioni e, di conseguenza, accettare i parametri di input basati sulle colonne restituite dalla query principale.</span><span class="sxs-lookup"><span data-stu-id="29e40-123">These methods execute the auto-generated `INSERT`, `UPDATE`, and `DELETE` statements and, consequently, accept input parameters based on the columns returned by the main query.</span></span> <span data-ttu-id="29e40-124">Nel [caricamento di file](uploading-files-vb.md) esercitazione è aumentate la `CategoriesTableAdapter` per utilizzare query principale s il `BrochurePath` colonna.</span><span class="sxs-lookup"><span data-stu-id="29e40-124">In the [Uploading Files](uploading-files-vb.md) tutorial we augmented the `CategoriesTableAdapter` s main query to use the `BrochurePath` column.</span></span>

<span data-ttu-id="29e40-125">Poiché il `CategoriesTableAdapter` non fa riferimento la query principale s il `Picture` colonna, è possibile aggiungere un nuovo record né aggiornare un record esistente con un valore per il `Picture` colonna.</span><span class="sxs-lookup"><span data-stu-id="29e40-125">Since the `CategoriesTableAdapter` s main query does not reference the `Picture` column, we can neither add a new record nor update an existing record with a value for the `Picture` column.</span></span> <span data-ttu-id="29e40-126">Per acquisire queste informazioni, è possibile creare un nuovo metodo nella TableAdapter in cui viene utilizzato in particolare per inserire un record con dati binari oppure ci occupiamo della personalizzazione generata automaticamente `INSERT` istruzione.</span><span class="sxs-lookup"><span data-stu-id="29e40-126">In order to capture this information, we can either create a new method in the TableAdapter that is used specifically to insert a record with binary data or we can customize the auto-generated `INSERT` statement.</span></span> <span data-ttu-id="29e40-127">Il problema con la personalizzazione generata automaticamente `INSERT` istruzione è che si corre il rischio che il nostro personalizzazioni sovrascritte dalla procedura guidata.</span><span class="sxs-lookup"><span data-stu-id="29e40-127">The problem with customizing the auto-generated `INSERT` statement is that we risk having our customizations overwritten by the wizard.</span></span> <span data-ttu-id="29e40-128">Ad esempio, si supponga che è stato personalizzato il `INSERT` includono l'utilizzo dell'istruzione il `Picture` colonna.</span><span class="sxs-lookup"><span data-stu-id="29e40-128">For example, imagine that we customized the `INSERT` statement to include use of the `Picture` column.</span></span> <span data-ttu-id="29e40-129">In questo modo verrà aggiornato i TableAdapter `Insert` metodo per includere un parametro di input aggiuntivo per i dati di categoria s s immagine binari.</span><span class="sxs-lookup"><span data-stu-id="29e40-129">This would update the TableAdapter s `Insert` method to include an additional input parameter for the category s picture s binary data.</span></span> <span data-ttu-id="29e40-130">È quindi possibile creare un metodo nel livello di logica di Business di utilizzare questo metodo DAL e richiamare questo metodo BLL attraverso il livello di presentazione e funzioni meravigliosa.</span><span class="sxs-lookup"><span data-stu-id="29e40-130">We could then create a method in the Business Logic Layer to use this DAL method and invoke this BLL method through the Presentation Layer, and everything would work wonderfully.</span></span> <span data-ttu-id="29e40-131">Vale a dire, fino al successivo è stato configurato il TableAdapter mediante la configurazione guidata TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="29e40-131">That is, until the next time we configured the TableAdapter through the TableAdapter Configuration wizard.</span></span> <span data-ttu-id="29e40-132">Non appena completato la procedura guidata, il nostro personalizzazioni il `INSERT` verrebbe sovrascritto istruzione, il `Insert` metodo ripristinata la forma precedente e il codice potrebbe non venire più compilato!</span><span class="sxs-lookup"><span data-stu-id="29e40-132">As soon as the wizard completed, our customizations to the `INSERT` statement would be overwritten, the `Insert` method would revert to its old form, and our code would no longer compile!</span></span>

> [!NOTE]
> <span data-ttu-id="29e40-133">Questo fastidio è il problema quando si utilizzano stored procedure anziché istruzioni SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="29e40-133">This annoyance is a non-issue when using stored procedures instead of ad-hoc SQL statements.</span></span> <span data-ttu-id="29e40-134">Un'esercitazione in futura verrà illustrato l'utilizzo di stored procedure anziché istruzioni SQL ad hoc nel livello di accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="29e40-134">A future tutorial will explore using stored procedures in lieu of ad-hoc SQL statements in the Data Access Layer.</span></span>


<span data-ttu-id="29e40-135">Per evitare questo rischio cefalea, anziché le istruzioni SQL generate automaticamente di personalizzazione consentono s invece di creare un nuovo metodo per l'oggetto TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="29e40-135">To avoid this potential headache, rather than customizing the auto-generated SQL statements let s instead create a new method for the TableAdapter.</span></span> <span data-ttu-id="29e40-136">Questo metodo, denominato `InsertWithPicture`, accetterà i valori per il `CategoryName`, `Description`, `BrochurePath`, e `Picture` colonne ed eseguire un `INSERT` istruzione che archivia tutti i quattro valori in un nuovo record.</span><span class="sxs-lookup"><span data-stu-id="29e40-136">This method, named `InsertWithPicture`, will accept values for the `CategoryName`, `Description`, `BrochurePath`, and `Picture` columns and execute an `INSERT` statement that stores all four values in a new record.</span></span>

<span data-ttu-id="29e40-137">Aprire il DataSet tipizzato e, dalla finestra di progettazione, fare clic su di `CategoriesTableAdapter` intestazione s e scegliere Aggiungi Query dal menu di scelta rapida.</span><span class="sxs-lookup"><span data-stu-id="29e40-137">Open the Typed DataSet and, from the Designer, right-click on the `CategoriesTableAdapter` s header and choose Add Query from the context menu.</span></span> <span data-ttu-id="29e40-138">Verrà avviata la configurazione guidata Query TableAdapter che inizia con richiede la modalità della query TableAdapter deve accedere al database.</span><span class="sxs-lookup"><span data-stu-id="29e40-138">This launches the TableAdapter Query Configuration Wizard, which begins by asking us how the TableAdapter query should access the database.</span></span> <span data-ttu-id="29e40-139">Scegliere Usa istruzioni SQL e fare clic su Avanti.</span><span class="sxs-lookup"><span data-stu-id="29e40-139">Choose Use SQL statements and click Next.</span></span> <span data-ttu-id="29e40-140">Il passaggio successivo viene richiesto per il tipo di query da generare.</span><span class="sxs-lookup"><span data-stu-id="29e40-140">The next step prompts for the type of query to be generated.</span></span> <span data-ttu-id="29e40-141">Poiché è nuovamente la creazione di una query per aggiungere un nuovo record per il `Categories` tabella, scegliere l'inserimento e fare clic su Avanti.</span><span class="sxs-lookup"><span data-stu-id="29e40-141">Since we re creating a query to add a new record to the `Categories` table, choose INSERT and click Next.</span></span>


<span data-ttu-id="29e40-142">[![Selezionare l'opzione di inserimento](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image1.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="29e40-142">[![Select the INSERT Option](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image1.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image1.png)</span></span>

<span data-ttu-id="29e40-143">**Figura 1**: selezionare l'opzione di inserimento ([fare clic per visualizzare l'immagine ingrandita](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="29e40-143">**Figure 1**: Select the INSERT Option ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image2.png))</span></span>


<span data-ttu-id="29e40-144">È ora necessario specificare il `INSERT` istruzione SQL.</span><span class="sxs-lookup"><span data-stu-id="29e40-144">We now need to specify the `INSERT` SQL statement.</span></span> <span data-ttu-id="29e40-145">La procedura guidata suggerisce automaticamente un `INSERT` istruzione corrisponde alla query principale s di TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="29e40-145">The wizard automatically suggests an `INSERT` statement corresponding to the TableAdapter s main query.</span></span> <span data-ttu-id="29e40-146">In questo caso, è s un `INSERT` istruzione che inserisce il `CategoryName`, `Description`, e `BrochurePath` valori.</span><span class="sxs-lookup"><span data-stu-id="29e40-146">In this case, it s an `INSERT` statement that inserts the `CategoryName`, `Description`, and `BrochurePath` values.</span></span> <span data-ttu-id="29e40-147">L'istruzione Update in modo che il `Picture` colonna è inclusa insieme a un `@Picture` parametro, come illustrato di seguito:</span><span class="sxs-lookup"><span data-stu-id="29e40-147">Update the statement so that the `Picture` column is included along with a `@Picture` parameter, like so:</span></span>


[!code-sql[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample1.sql)]

<span data-ttu-id="29e40-148">Nella schermata finale della procedura guidata viene chiesto di specificare un nome al nuovo metodo di TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="29e40-148">The final screen of the wizard asks us to name the new TableAdapter method.</span></span> <span data-ttu-id="29e40-149">Immettere `InsertWithPicture` e fare clic su Fine.</span><span class="sxs-lookup"><span data-stu-id="29e40-149">Enter `InsertWithPicture` and click Finish.</span></span>


<span data-ttu-id="29e40-150">[![Denominare il nuovo InsertWithPicture TableAdapter (metodo)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image2.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="29e40-150">[![Name the New TableAdapter Method InsertWithPicture](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image2.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image3.png)</span></span>

<span data-ttu-id="29e40-151">**Figura 2**: nome del nuovo metodo TableAdapter `InsertWithPicture` ([fare clic per visualizzare l'immagine ingrandita](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="29e40-151">**Figure 2**: Name the New TableAdapter Method `InsertWithPicture` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image4.png))</span></span>


## <a name="step-2-updating-the-business-logic-layer"></a><span data-ttu-id="29e40-152">Passaggio 2: Aggiornare il livello di logica di Business</span><span class="sxs-lookup"><span data-stu-id="29e40-152">Step 2: Updating the Business Logic Layer</span></span>

<span data-ttu-id="29e40-153">Poiché il livello di presentazione deve solo interfacciarsi con il livello di logica di Business anziché ignorando per passare direttamente a livello di accesso ai dati, è necessario creare un metodo BLL che richiama il metodo DAL appena creato (`InsertWithPicture`).</span><span class="sxs-lookup"><span data-stu-id="29e40-153">Since the Presentation Layer should only interface with the Business Logic Layer rather than bypassing it to go directly to the Data Access Layer, we need to create a BLL method that invokes the DAL method we just created (`InsertWithPicture`).</span></span> <span data-ttu-id="29e40-154">Per questa esercitazione, creare un metodo di `CategoriesBLL` classe denominata `InsertWithPicture` che accetta come input tre `String` s e un `Byte` matrice.</span><span class="sxs-lookup"><span data-stu-id="29e40-154">For this tutorial, create a method in the `CategoriesBLL` class named `InsertWithPicture` that accepts as input three `String` s and a `Byte` array.</span></span> <span data-ttu-id="29e40-155">Il `String` sono parametri di input per il nome della categoria s, la descrizione e percorso del file brochure, mentre il `Byte` matrice è per il contenuto binario dell'immagine categoria s.</span><span class="sxs-lookup"><span data-stu-id="29e40-155">The `String` input parameters are for the category s name, description, and brochure file path, while the `Byte` array is for the binary contents of the category s picture.</span></span> <span data-ttu-id="29e40-156">Come mostrato nel codice seguente, questo metodo BLL richiama il metodo DAL corrispondente:</span><span class="sxs-lookup"><span data-stu-id="29e40-156">As the following code shows, this BLL method invokes the corresponding DAL method:</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample2.vb)]

> [!NOTE]
> <span data-ttu-id="29e40-157">Assicurarsi di aver salvato il set di dati tipizzato prima di aggiungere il `InsertWithPicture` metodo al livello Business Logic.</span><span class="sxs-lookup"><span data-stu-id="29e40-157">Make sure that you have saved the Typed DataSet before adding the `InsertWithPicture` method to the BLL.</span></span> <span data-ttu-id="29e40-158">Poiché il `CategoriesTableAdapter` codice della classe viene generato automaticamente in base al set di dati tipizzato, se non si t prima di salvare le modifiche al set di dati tipizzati di `Adapter` proprietà vinto t conoscere il `InsertWithPicture` (metodo).</span><span class="sxs-lookup"><span data-stu-id="29e40-158">Since the `CategoriesTableAdapter` class code is auto-generated based on the Typed DataSet, if you don t first save your changes to the Typed DataSet the `Adapter` property won t know about the `InsertWithPicture` method.</span></span>


## <a name="step-3-listing-the-existing-categories-and-their-binary-data"></a><span data-ttu-id="29e40-159">Passaggio 3: Elenco di categorie esistenti e i relativi dati binari</span><span class="sxs-lookup"><span data-stu-id="29e40-159">Step 3: Listing the Existing Categories and their Binary Data</span></span>

<span data-ttu-id="29e40-160">In questa esercitazione si creerà una pagina che consente agli utenti finali di aggiungere una nuova categoria per il sistema, fornendo un'immagine e brochure per la nuova categoria.</span><span class="sxs-lookup"><span data-stu-id="29e40-160">In this tutorial we will create a page that allows an end user to add a new category to the system, providing a picture and brochure for the new category.</span></span> <span data-ttu-id="29e40-161">Nel [esercitazione precedente](displaying-binary-data-in-the-data-web-controls-vb.md) è utilizzato un GridView con un TemplateField e ImageField per visualizzare il nome di ogni categoria s, descrizione, immagine e un collegamento per scaricare la brochure.</span><span class="sxs-lookup"><span data-stu-id="29e40-161">In the [preceding tutorial](displaying-binary-data-in-the-data-web-controls-vb.md) we used a GridView with a TemplateField and ImageField to display each category s name, description, picture, and a link to download its brochure.</span></span> <span data-ttu-id="29e40-162">Consente di replicare la funzionalità per questa esercitazione, creazione di una pagina che elenca tutte le categorie esistenti e consente ai nuovi da creare s.</span><span class="sxs-lookup"><span data-stu-id="29e40-162">Let s replicate that functionality for this tutorial, creating a page that both lists all existing categories and allows for new ones to be created.</span></span>

<span data-ttu-id="29e40-163">Aprire il `DisplayOrDownload.aspx` pagina dal `BinaryData` cartella.</span><span class="sxs-lookup"><span data-stu-id="29e40-163">Start by opening the `DisplayOrDownload.aspx` page from the `BinaryData` folder.</span></span> <span data-ttu-id="29e40-164">Passare alla visualizzazione origine e copiare GridView e ObjectDataSource s sintassi dichiarativa, incollandoli all'interno di `<asp:Content>` elemento `UploadInDetailsView.aspx`.</span><span class="sxs-lookup"><span data-stu-id="29e40-164">Go to the Source view and copy the GridView and ObjectDataSource s declarative syntax, pasting it within the `<asp:Content>` element in `UploadInDetailsView.aspx`.</span></span> <span data-ttu-id="29e40-165">Inoltre, tenere sempre dimenticare copiare il `GenerateBrochureLink` metodo della classe code-behind di `DisplayOrDownload.aspx` a `UploadInDetailsView.aspx`.</span><span class="sxs-lookup"><span data-stu-id="29e40-165">Also, don t forget to copy over the `GenerateBrochureLink` method from the code-behind class of `DisplayOrDownload.aspx` to `UploadInDetailsView.aspx`.</span></span>


<span data-ttu-id="29e40-166">[![Copiare e incollare la sintassi dichiarativa da DisplayOrDownload.aspx a UploadInDetailsView.aspx](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image3.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="29e40-166">[![Copy and Paste the Declarative Syntax from DisplayOrDownload.aspx to UploadInDetailsView.aspx](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image3.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image5.png)</span></span>

<span data-ttu-id="29e40-167">**Figura 3**: copiare e incollare la sintassi dichiarativa dal `DisplayOrDownload.aspx` alla `UploadInDetailsView.aspx` ([fare clic per visualizzare l'immagine ingrandita](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="29e40-167">**Figure 3**: Copy and Paste the Declarative Syntax from `DisplayOrDownload.aspx` to `UploadInDetailsView.aspx` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image6.png))</span></span>


<span data-ttu-id="29e40-168">Dopo aver copiato la sintassi dichiarativa e `GenerateBrochureLink` metodo tramite il `UploadInDetailsView.aspx` pagina, visualizzare la pagina tramite un browser per verificare che tutto ciò che è stato copiato correttamente.</span><span class="sxs-lookup"><span data-stu-id="29e40-168">After copying the declarative syntax and `GenerateBrochureLink` method over to the `UploadInDetailsView.aspx` page, view the page through a browser to ensure that everything was copied over correctly.</span></span> <span data-ttu-id="29e40-169">Dovrebbe essere GridView otto categorie di elenco che include un collegamento per scaricare la brochure, nonché l'immagine di categoria s.</span><span class="sxs-lookup"><span data-stu-id="29e40-169">You should see a GridView listing the eight categories that includes a link to download the brochure as well as the category s picture.</span></span>


<span data-ttu-id="29e40-170">[![Dovrebbe essere visualizzato ogni categoria insieme ai relativi dati binari](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image4.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="29e40-170">[![You Should Now See Each Category Along with Its Binary Data](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image4.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image7.png)</span></span>

<span data-ttu-id="29e40-171">**Figura 4**: si dovrebbe ora vedere ogni categoria insieme con i relativi dati binari ([fare clic per visualizzare l'immagine ingrandita](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="29e40-171">**Figure 4**: You Should Now See Each Category Along with Its Binary Data ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image8.png))</span></span>


## <a name="step-4-configuring-thecategoriesdatasourceto-support-inserting"></a><span data-ttu-id="29e40-172">Passaggio 4: Configurazione di`CategoriesDataSource`all'inserimento di supporto</span><span class="sxs-lookup"><span data-stu-id="29e40-172">Step 4: Configuring the`CategoriesDataSource`to Support Inserting</span></span>

<span data-ttu-id="29e40-173">Il `CategoriesDataSource` ObjectDataSource viene utilizzato il `Categories` GridView attualmente non fornisce la possibilità di inserire i dati.</span><span class="sxs-lookup"><span data-stu-id="29e40-173">The `CategoriesDataSource` ObjectDataSource used by the `Categories` GridView currently does not provide the ability to insert data.</span></span> <span data-ttu-id="29e40-174">Per supportare l'inserimento di questo controllo dell'origine dati, è necessario eseguire il mapping relativo `Insert` metodo a un metodo in un oggetto sottostante, `CategoriesBLL`.</span><span class="sxs-lookup"><span data-stu-id="29e40-174">In order to support inserting through this data source control, we need to map its `Insert` method to a method in its underlying object, `CategoriesBLL`.</span></span> <span data-ttu-id="29e40-175">In particolare, si desidera eseguire il mapping per il `CategoriesBLL` metodo abbiamo aggiunto nel passaggio 2, `InsertWithPicture`.</span><span class="sxs-lookup"><span data-stu-id="29e40-175">In particular, we want to map it to the `CategoriesBLL` method we added back in Step 2, `InsertWithPicture`.</span></span>

<span data-ttu-id="29e40-176">Avviare facendo clic sul collegamento Configura origine dati da smart tag ObjectDataSource s.</span><span class="sxs-lookup"><span data-stu-id="29e40-176">Start by clicking the Configure Data Source link from the ObjectDataSource s smart tag.</span></span> <span data-ttu-id="29e40-177">La prima schermata mostra l'oggetto origine dati è configurato per funzionare con, `CategoriesBLL`.</span><span class="sxs-lookup"><span data-stu-id="29e40-177">The first screen shows the object the data source is configured to work with, `CategoriesBLL`.</span></span> <span data-ttu-id="29e40-178">Lasciare l'impostazione- e fare clic su Avanti per passare alla schermata di definire i metodi di dati.</span><span class="sxs-lookup"><span data-stu-id="29e40-178">Leave this setting as-is and click Next to advance to the Define Data Methods screen.</span></span> <span data-ttu-id="29e40-179">Passare alla scheda Inserisci e selezionare il `InsertWithPicture` metodo dall'elenco a discesa.</span><span class="sxs-lookup"><span data-stu-id="29e40-179">Move to the INSERT tab and pick the `InsertWithPicture` method from the drop-down list.</span></span> <span data-ttu-id="29e40-180">Fare clic su Fine per completare la procedura guidata.</span><span class="sxs-lookup"><span data-stu-id="29e40-180">Click Finish to complete the wizard.</span></span>


<span data-ttu-id="29e40-181">[![Configurare ObjectDataSource per utilizzare il metodo InsertWithPicture](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image5.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="29e40-181">[![Configure the ObjectDataSource to use the InsertWithPicture Method](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image5.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image9.png)</span></span>

<span data-ttu-id="29e40-182">**Figura 5**: configurare ObjectDataSource per usare il `InsertWithPicture` metodo ([fare clic per visualizzare l'immagine ingrandita](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="29e40-182">**Figure 5**: Configure the ObjectDataSource to use the `InsertWithPicture` Method ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image10.png))</span></span>


> [!NOTE]
> <span data-ttu-id="29e40-183">Dopo avere completato la procedura guidata, Visual Studio potrebbe chiedere se si desidera aggiornare i campi e le chiavi, che verrà rigenerata dati Web controlla i campi.</span><span class="sxs-lookup"><span data-stu-id="29e40-183">Upon completing the wizard, Visual Studio may ask if you want to Refresh Fields and Keys, which will regenerate the data Web controls fields.</span></span> <span data-ttu-id="29e40-184">Scegliere No, perché se si sceglie Sì, eventuali personalizzazioni campo apportate verranno sovrascritte.</span><span class="sxs-lookup"><span data-stu-id="29e40-184">Choose No, because choosing Yes will overwrite any field customizations you may have made.</span></span>


<span data-ttu-id="29e40-185">Dopo aver completato la procedura guidata, ObjectDataSource ora includere un valore per il relativo `InsertMethod` proprietà così come `InsertParameters` per le colonne di quattro categoria, come il seguente markup dichiarativo illustra:</span><span class="sxs-lookup"><span data-stu-id="29e40-185">After completing the wizard, the ObjectDataSource will now include a value for its `InsertMethod` property as well as `InsertParameters` for the four category columns, as the following declarative markup illustrates:</span></span>


[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample3.aspx)]

## <a name="step-5-creating-the-inserting-interface"></a><span data-ttu-id="29e40-186">Passaggio 5: Creazione dell'interfaccia di inserimento</span><span class="sxs-lookup"><span data-stu-id="29e40-186">Step 5: Creating the Inserting Interface</span></span>

<span data-ttu-id="29e40-187">Come primo analizzate nel [una panoramica di inserimento, aggiornamento ed eliminazione di dati](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md), il controllo DetailsView fornisce un'interfaccia di inserimento predefinita che può essere utilizzata quando si lavora con un controllo origine dati che supporta l'inserimento.</span><span class="sxs-lookup"><span data-stu-id="29e40-187">As first covered in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md), the DetailsView control provides a built-in inserting interface that can be utilized when working with a data source control that supports inserting.</span></span> <span data-ttu-id="29e40-188">Consente di aggiungere un controllo DetailsView a questa pagina di sopra di GridView che vengono visualizzati in modo permanente l'interfaccia di inserimento, consentendo all'utente di aggiungere rapidamente una nuova categoria s.</span><span class="sxs-lookup"><span data-stu-id="29e40-188">Let s add a DetailsView control to this page above the GridView that will permanently render its inserting interface, allowing a user to quickly add a new category.</span></span> <span data-ttu-id="29e40-189">Dopo l'aggiunta di una nuova categoria nel controllo DetailsView, GridView sottostanti automaticamente Aggiorna e verrà visualizzato la nuova categoria.</span><span class="sxs-lookup"><span data-stu-id="29e40-189">Upon adding a new category in the DetailsView, the GridView beneath it will automatically refresh and display the new category.</span></span>

<span data-ttu-id="29e40-190">Avvio mediante il trascinamento di un controllo DetailsView dalla casella degli strumenti nella finestra di progettazione sopra GridView, impostare il relativo `ID` proprietà `NewCategory` e cancellare il `Height` e `Width` i valori delle proprietà.</span><span class="sxs-lookup"><span data-stu-id="29e40-190">Start by dragging a DetailsView from the Toolbox onto the Designer above the GridView, setting its `ID` property to `NewCategory` and clearing out the `Height` and `Width` property values.</span></span> <span data-ttu-id="29e40-191">Da DetailsView s smart tag, associarlo a esistente `CategoriesDataSource` e quindi selezionare la casella di controllo Abilita inserimento.</span><span class="sxs-lookup"><span data-stu-id="29e40-191">From the DetailsView s smart tag, bind it to the existing `CategoriesDataSource` and then check the Enable Inserting checkbox.</span></span>


<span data-ttu-id="29e40-192">[![Associare il controllo DetailsView il CategoriesDataSource e Abilita inserimento](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image6.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="29e40-192">[![Bind the DetailsView to the CategoriesDataSource and Enable Inserting](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image6.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image11.png)</span></span>

<span data-ttu-id="29e40-193">**Figura 6**: eseguire il binding di DetailsView per il `CategoriesDataSource` e Abilita inserimento ([fare clic per visualizzare l'immagine ingrandita](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="29e40-193">**Figure 6**: Bind the DetailsView to the `CategoriesDataSource` and Enable Inserting ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image12.png))</span></span>


<span data-ttu-id="29e40-194">Per eseguire il rendering in modo permanente di DetailsView nella relativa interfaccia di inserimento, impostare il relativo `DefaultMode` proprietà `Insert`.</span><span class="sxs-lookup"><span data-stu-id="29e40-194">To permanently render the DetailsView in its inserting interface, set its `DefaultMode` property to `Insert`.</span></span>

<span data-ttu-id="29e40-195">Si noti che il controllo DetailsView ha cinque BoundField `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, e `BrochurePath` anche se il `CategoryID` BoundField non viene eseguito nell'interfaccia inserimento perché il relativo `InsertVisible` proprietà è impostata su `False`.</span><span class="sxs-lookup"><span data-stu-id="29e40-195">Note that the DetailsView has five BoundFields `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath` although the `CategoryID` BoundField is not rendered in the inserting interface because its `InsertVisible` property is set to `False`.</span></span> <span data-ttu-id="29e40-196">Questi BoundField esiste perché sono le colonne restituite dal `GetCategories()` metodo, ovvero cosa ObjectDataSource richiama per recuperare i dati.</span><span class="sxs-lookup"><span data-stu-id="29e40-196">These BoundFields exists because they are the columns returned by the `GetCategories()` method, which is what the ObjectDataSource invokes to retrieve its data.</span></span> <span data-ttu-id="29e40-197">Per l'inserimento, tuttavia, non abbiamo desidera consentire all'utente di specificare un valore per t `NumberOfProducts`.</span><span class="sxs-lookup"><span data-stu-id="29e40-197">For inserting, however, we don t want to let the user specify a value for `NumberOfProducts`.</span></span> <span data-ttu-id="29e40-198">Inoltre, è necessario consentire loro di caricare un'immagine per la nuova categoria, nonché di caricare un file PDF per brochure.</span><span class="sxs-lookup"><span data-stu-id="29e40-198">Moreover, we need to allow them to upload a picture for the new category as well as upload a PDF for the brochure.</span></span>

<span data-ttu-id="29e40-199">Rimuovere il `NumberOfProducts` BoundField dal controllo DetailsView completamente e quindi aggiornare il `HeaderText` le proprietà del `CategoryName` e `BrochurePath` BoundField per categoria e Brochure, rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="29e40-199">Remove the `NumberOfProducts` BoundField from the DetailsView altogether and then update the `HeaderText` properties of the `CategoryName` and `BrochurePath` BoundFields to Category and Brochure, respectively.</span></span> <span data-ttu-id="29e40-200">Successivamente, convertire il `BrochurePath` BoundField in un TemplateField e aggiungere un nuovo TemplateField per l'immagine di questo nuovo TemplateField fornendo un `HeaderText` valore dell'immagine.</span><span class="sxs-lookup"><span data-stu-id="29e40-200">Next, convert the `BrochurePath` BoundField into a TemplateField and add a new TemplateField for the picture, giving this new TemplateField a `HeaderText` value of Picture.</span></span> <span data-ttu-id="29e40-201">Spostare il `Picture` TemplateField in modo che sia compreso tra il `BrochurePath` TemplateField e CommandField.</span><span class="sxs-lookup"><span data-stu-id="29e40-201">Move the `Picture` TemplateField so that it is between the `BrochurePath` TemplateField and CommandField.</span></span>


![Associare il controllo DetailsView il CategoriesDataSource e Abilita inserimento](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image7.gif)

<span data-ttu-id="29e40-203">**Figura 7**: controllo DetailsView per associare il `CategoriesDataSource` e Abilita inserimento</span><span class="sxs-lookup"><span data-stu-id="29e40-203">**Figure 7**: Bind the DetailsView to the `CategoriesDataSource` and Enable Inserting</span></span>


<span data-ttu-id="29e40-204">Se è stato convertito il `BrochurePath` BoundField in un TemplateField tramite la finestra di dialogo Modifica campi, il TemplateField include un `ItemTemplate`, `EditItemTemplate`, e `InsertItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="29e40-204">If you converted the `BrochurePath` BoundField into a TemplateField through the Edit Fields dialog box, the TemplateField includes an `ItemTemplate`, `EditItemTemplate`, and `InsertItemTemplate`.</span></span> <span data-ttu-id="29e40-205">Solo il `InsertItemTemplate` è necessario, tuttavia, quindi è possibile rimuovere i due modelli.</span><span class="sxs-lookup"><span data-stu-id="29e40-205">Only the `InsertItemTemplate` is needed, however, so feel free to remove the other two templates.</span></span> <span data-ttu-id="29e40-206">La sintassi dichiarativa di DetailsView s a questo punto dovrebbe essere simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="29e40-206">At this point your DetailsView s declarative syntax should look like the following:</span></span>


[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample4.aspx)]

## <a name="adding-fileupload-controls-for-the-brochure-and-picture-fields"></a><span data-ttu-id="29e40-207">Aggiunta di controlli FileUpload per Brochure e i campi di immagine</span><span class="sxs-lookup"><span data-stu-id="29e40-207">Adding FileUpload Controls for the Brochure and Picture Fields</span></span>

<span data-ttu-id="29e40-208">Attualmente, il `BrochurePath` TemplateField s `InsertItemTemplate` contiene una casella di testo, mentre il `Picture` TemplateField non contiene alcun modello.</span><span class="sxs-lookup"><span data-stu-id="29e40-208">Presently, the `BrochurePath` TemplateField s `InsertItemTemplate` contains a TextBox, while the `Picture` TemplateField does not contain any templates.</span></span> <span data-ttu-id="29e40-209">È necessario aggiornare questi due s TemplateField `InsertItemTemplate` per usare i controlli FileUpload.</span><span class="sxs-lookup"><span data-stu-id="29e40-209">We need to update these two TemplateField s `InsertItemTemplate` s to use FileUpload controls.</span></span>

<span data-ttu-id="29e40-210">Dal controllo DetailsView s smart tag, scegliere l'opzione di modifica modelli, quindi selezionare il `BrochurePath` TemplateField s `InsertItemTemplate` dall'elenco a discesa.</span><span class="sxs-lookup"><span data-stu-id="29e40-210">From the DetailsView s smart tag, choose the Edit Templates option and then select the `BrochurePath` TemplateField s `InsertItemTemplate` from the drop-down list.</span></span> <span data-ttu-id="29e40-211">Rimuovere la casella di testo e quindi trascinare un controllo FileUpload dalla casella degli strumenti nel modello.</span><span class="sxs-lookup"><span data-stu-id="29e40-211">Remove the TextBox and then drag a FileUpload control from the Toolbox into the template.</span></span> <span data-ttu-id="29e40-212">Impostare il controllo FileUpload s `ID` a `BrochureUpload`.</span><span class="sxs-lookup"><span data-stu-id="29e40-212">Set the FileUpload control s `ID` to `BrochureUpload`.</span></span> <span data-ttu-id="29e40-213">Analogamente, aggiungere un controllo FileUpload al `Picture` TemplateField s `InsertItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="29e40-213">Similarly, add a FileUpload control to the `Picture` TemplateField s `InsertItemTemplate`.</span></span> <span data-ttu-id="29e40-214">Impostare questo controllo FileUpload s `ID` a `PictureUpload`.</span><span class="sxs-lookup"><span data-stu-id="29e40-214">Set this FileUpload control s `ID` to `PictureUpload`.</span></span>


<span data-ttu-id="29e40-215">[![Aggiungere un controllo FileUpload il InsertItemTemplate](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image8.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="29e40-215">[![Add a FileUpload Control to the InsertItemTemplate](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image8.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image13.png)</span></span>

<span data-ttu-id="29e40-216">**Figura 8**: aggiungere un controllo con caricamento dei file per il `InsertItemTemplate` ([fare clic per visualizzare l'immagine ingrandita](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="29e40-216">**Figure 8**: Add a FileUpload Control to the `InsertItemTemplate` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image14.png))</span></span>


<span data-ttu-id="29e40-217">Dopo aver apportato queste aggiunte, saranno due sintassi dichiarativa TemplateField s:</span><span class="sxs-lookup"><span data-stu-id="29e40-217">After making these additions, the two TemplateField s declarative syntax will be:</span></span>


[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample5.aspx)]

<span data-ttu-id="29e40-218">Quando un utente aggiunge una nuova categoria, si desidera assicurarsi che le brochure siano del tipo di file corretti.</span><span class="sxs-lookup"><span data-stu-id="29e40-218">When a user adds a new category, we want to ensure that the brochure and picture are of the correct file type.</span></span> <span data-ttu-id="29e40-219">Per brochure, l'utente deve specificare un file PDF.</span><span class="sxs-lookup"><span data-stu-id="29e40-219">For the brochure, the user must supply a PDF.</span></span> <span data-ttu-id="29e40-220">Per l'immagine, è necessario caricare un file di immagine all'utente, ma è consentito *qualsiasi* solo i file di immagine di un determinato tipo, ad esempio file GIF o jpg o di file di immagine?</span><span class="sxs-lookup"><span data-stu-id="29e40-220">For the picture, we need the user to upload an image file, but do we allow *any* image file or only image files of a particular type, such as GIFs or JPGs?</span></span> <span data-ttu-id="29e40-221">Per consentire diversi tipi di file, d è necessario estendere il `Categories` dello schema per includere una colonna che acquisisce il tipo di file in modo che questo tipo può essere inviato al client tramite `Response.ContentType` in `DisplayCategoryPicture.aspx`.</span><span class="sxs-lookup"><span data-stu-id="29e40-221">In order to allow for different file types, we d need to extend the `Categories` schema to include a column that captures the file type so that this type can be sent to the client through `Response.ContentType` in `DisplayCategoryPicture.aspx`.</span></span> <span data-ttu-id="29e40-222">Poiché non abbiamo t dispone di una colonna di questo tipo, sarebbe opportuno limitare gli utenti a fornire solo un tipo di file di immagine specifico.</span><span class="sxs-lookup"><span data-stu-id="29e40-222">Since we don t have such a column, it would be prudent to restrict users to only providing a specific image file type.</span></span> <span data-ttu-id="29e40-223">Il `Categories` immagini esistenti nella tabella s sono mappe di bit, ma jpg sono un formato di file più appropriato per le immagini servita sul web.</span><span class="sxs-lookup"><span data-stu-id="29e40-223">The `Categories` table s existing images are bitmaps, but JPGs are a more appropriate file format for images served over the web.</span></span>

<span data-ttu-id="29e40-224">Se un utente carica un tipo di file non corretto, è necessario annullare l'inserimento e viene visualizzato un messaggio che indica il problema.</span><span class="sxs-lookup"><span data-stu-id="29e40-224">If a user uploads an incorrect file type, we need to cancel the insert and display a message indicating the problem.</span></span> <span data-ttu-id="29e40-225">Aggiungere un controllo etichetta Web sotto il controllo DetailsView.</span><span class="sxs-lookup"><span data-stu-id="29e40-225">Add a Label Web control beneath the DetailsView.</span></span> <span data-ttu-id="29e40-226">Impostare relativo `ID` proprietà `UploadWarning`, deselezionare le relativo `Text` impostata, il `CssClass` proprietà avviso e `Visible` e `EnableViewState` proprietà `False`.</span><span class="sxs-lookup"><span data-stu-id="29e40-226">Set its `ID` property to `UploadWarning`, clear out its `Text` property, set the `CssClass` property to Warning, and the `Visible` and `EnableViewState` properties to `False`.</span></span> <span data-ttu-id="29e40-227">Il `Warning` classe CSS è definita in `Styles.css` ed esegue il rendering di testo in un tipo di carattere di grandi dimensioni, rosso, corsivo e grassetto.</span><span class="sxs-lookup"><span data-stu-id="29e40-227">The `Warning` CSS class is defined in `Styles.css` and renders the text in a large, red, italicized, bold font.</span></span>

> [!NOTE]
> <span data-ttu-id="29e40-228">In teoria, il `CategoryName` e `Description` BoundField viene convertito in TemplateFields e le relative interfacce inserimento personalizzati.</span><span class="sxs-lookup"><span data-stu-id="29e40-228">Ideally, the `CategoryName` and `Description` BoundFields would be converted to TemplateFields and their inserting interfaces customized.</span></span> <span data-ttu-id="29e40-229">Il `Description` inserimento di interfaccia, ad esempio, sarebbe probabilmente essere adeguato tramite una casella di testo su più righe.</span><span class="sxs-lookup"><span data-stu-id="29e40-229">The `Description` inserting interface, for example, would likely be better suited through a multi-line textbox.</span></span> <span data-ttu-id="29e40-230">E, poiché il `CategoryName` colonna non accetta `NULL` valori, RequiredFieldValidator deve essere aggiunto per verificare che l'utente fornisce un valore per il nuovo nome di categoria s.</span><span class="sxs-lookup"><span data-stu-id="29e40-230">And since the `CategoryName` column does not accept `NULL` values, a RequiredFieldValidator should be added to ensure the user provides a value for the new category s name.</span></span> <span data-ttu-id="29e40-231">Questi passaggi vengono lasciati come un esercizio al lettore.</span><span class="sxs-lookup"><span data-stu-id="29e40-231">These steps are left as an exercise to the reader.</span></span> <span data-ttu-id="29e40-232">Fare riferimento al [personalizzazione dell'interfaccia di modifica dati](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) per approfondimenti aumento le interfacce di modifica dei dati.</span><span class="sxs-lookup"><span data-stu-id="29e40-232">Refer back to [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) for an in-depth look at augmenting the data modification interfaces.</span></span>


## <a name="step-6-saving-the-uploaded-brochure-to-the-web-server-s-file-system"></a><span data-ttu-id="29e40-233">Passaggio 6: Salvataggio Brochure caricata nel File System di Web Server s</span><span class="sxs-lookup"><span data-stu-id="29e40-233">Step 6: Saving the Uploaded Brochure to the Web Server s File System</span></span>

<span data-ttu-id="29e40-234">Quando l'utente immette i valori per una nuova categoria e fa clic sul pulsante Inserisci, espande il flusso di lavoro di inserimento si verifica un postback.</span><span class="sxs-lookup"><span data-stu-id="29e40-234">When the user enters the values for a new category and clicks the Insert button, a postback occurs and the inserting workflow unfolds.</span></span> <span data-ttu-id="29e40-235">Innanzitutto, i dispositivi di DetailsView [ `ItemInserting` evento](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserting.aspx) generato.</span><span class="sxs-lookup"><span data-stu-id="29e40-235">First, the DetailsView s [`ItemInserting` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserting.aspx) fires.</span></span> <span data-ttu-id="29e40-236">Successivamente, s ObjectDataSource `Insert()` metodo viene richiamato, dando luogo a un nuovo record, l'aggiunta di `Categories` tabella.</span><span class="sxs-lookup"><span data-stu-id="29e40-236">Next, the ObjectDataSource s `Insert()` method is invoked, which results in a new record being added to the `Categories` table.</span></span> <span data-ttu-id="29e40-237">Dopo che i dispositivi di DetailsView [ `ItemInserted` evento](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserted.aspx) generato.</span><span class="sxs-lookup"><span data-stu-id="29e40-237">After that, the DetailsView s [`ItemInserted` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserted.aspx) fires.</span></span>

<span data-ttu-id="29e40-238">Prima di s ObjectDataSource `Insert()` metodo viene richiamato, è necessario innanzitutto assicurarsi che i tipi di file appropriato sono stati caricati dall'utente e quindi salvare la brochure PDF nel file System s server web.</span><span class="sxs-lookup"><span data-stu-id="29e40-238">Before the ObjectDataSource s `Insert()` method is invoked, we must first ensure that the appropriate file types were uploaded by the user and then save the brochure PDF to the web server s file system.</span></span> <span data-ttu-id="29e40-239">Creare un gestore eventi per s DetailsView `ItemInserting` eventi e aggiungere il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="29e40-239">Create an event handler for the DetailsView s `ItemInserting` event and add the following code:</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample6.vb)]

<span data-ttu-id="29e40-240">Il gestore dell'evento viene avviato facendo riferimento al `BrochureUpload` controllo FileUpload dai modelli s DetailsView.</span><span class="sxs-lookup"><span data-stu-id="29e40-240">The event handler starts by referencing the `BrochureUpload` FileUpload control from the DetailsView s templates.</span></span> <span data-ttu-id="29e40-241">Quindi, se è stata caricata una brochure, viene esaminato l'estensione di file caricato s.</span><span class="sxs-lookup"><span data-stu-id="29e40-241">Then, if a brochure has been uploaded, the uploaded file s extension is examined.</span></span> <span data-ttu-id="29e40-242">Se non è l'estensione. PDF, quindi un messaggio di avviso è visualizzato, l'istruzione insert è stata annullata e termina l'esecuzione del gestore dell'evento.</span><span class="sxs-lookup"><span data-stu-id="29e40-242">If the extension is not .PDF, then a warning is displayed, the insert is cancelled, and the execution of the event handler ends.</span></span>

> [!NOTE]
> <span data-ttu-id="29e40-243">Non basarsi sull'estensione file caricato s è una tecnica più efficiente per garantire che il file caricato sia un documento PDF.</span><span class="sxs-lookup"><span data-stu-id="29e40-243">Relying on the uploaded file s extension is not a sure-fire technique for ensuring that the uploaded file is a PDF document.</span></span> <span data-ttu-id="29e40-244">L'utente potrebbe avere un documento PDF valido con estensione `.Brochure`, o Impossibile effettuato un documento non PDF e assegnare un `.pdf` estensione.</span><span class="sxs-lookup"><span data-stu-id="29e40-244">The user could have a valid PDF document with the extension `.Brochure`, or could have taken a non-PDF document and given it a `.pdf` extension.</span></span> <span data-ttu-id="29e40-245">Il contenuto binario del file s dovranno essere esaminati a livello di codice per più di concludere il tipo di file.</span><span class="sxs-lookup"><span data-stu-id="29e40-245">The file s binary content would need to be programmatically examined in order to more conclusively verify the file type.</span></span> <span data-ttu-id="29e40-246">Questi approcci completo, tuttavia, sono spesso eccessivi; l'estensione di controllo è sufficiente per la maggior parte degli scenari.</span><span class="sxs-lookup"><span data-stu-id="29e40-246">Such thorough approaches, though, are often overkill; checking the extension is sufficient for most scenarios.</span></span>


<span data-ttu-id="29e40-247">Come descritto nel [caricamento di file](uploading-files-vb.md) esercitazione, è necessario prestare attenzione durante il salvataggio dei file nel file System, in modo che il caricamento di un utente s non implica la sovrascrittura s un'altra.</span><span class="sxs-lookup"><span data-stu-id="29e40-247">As discussed in the [Uploading Files](uploading-files-vb.md) tutorial, care must be taken when saving files to the file system so that one user s upload does not overwrite another s.</span></span> <span data-ttu-id="29e40-248">Per questa esercitazione si tenterà di utilizzare lo stesso nome del file caricato.</span><span class="sxs-lookup"><span data-stu-id="29e40-248">For this tutorial we will attempt to use the same name as the uploaded file.</span></span> <span data-ttu-id="29e40-249">Se esiste già un file di `~/Brochures` directory con lo stesso nome file, tuttavia, si sarà accodare un numero alla fine fino a quando non viene trovato un nome univoco.</span><span class="sxs-lookup"><span data-stu-id="29e40-249">If there already exists a file in the `~/Brochures` directory with that same file name, however, we'll append a number at the end until a unique name is found.</span></span> <span data-ttu-id="29e40-250">Ad esempio, se l'utente carica un file brochure denominato `Meats.pdf`, ma esiste già un file denominato `Meats.pdf` nel `~/Brochures` cartella, si modificherà il nome del file salvato per `Meats-1.pdf`.</span><span class="sxs-lookup"><span data-stu-id="29e40-250">For example, if the user uploads a brochure file named `Meats.pdf`, but there is already a file named `Meats.pdf` in the `~/Brochures` folder, we'll change the saved file name to `Meats-1.pdf`.</span></span> <span data-ttu-id="29e40-251">Se presenti, email `Meats-2.pdf`e così via, fino a quando non viene trovato un nome file univoco.</span><span class="sxs-lookup"><span data-stu-id="29e40-251">If that exists, we'll try `Meats-2.pdf`, and so on, until a unique file name is found.</span></span>

<span data-ttu-id="29e40-252">Il codice seguente usa il [ `File.Exists(path)` metodo](https://msdn.microsoft.com/library/system.io.file.exists.aspx) per determinare se esiste già un file con il nome file specificato.</span><span class="sxs-lookup"><span data-stu-id="29e40-252">The following code uses the [`File.Exists(path)` method](https://msdn.microsoft.com/library/system.io.file.exists.aspx) to determine if a file already exists with the specified file name.</span></span> <span data-ttu-id="29e40-253">In questo caso, continuerà a tentare di nuovi nomi di file per brochure fino a quando non viene trovato alcun conflitto.</span><span class="sxs-lookup"><span data-stu-id="29e40-253">If so, it continues to try new file names for the brochure until no conflict is found.</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample7.vb)]

<span data-ttu-id="29e40-254">Dopo aver individuato un nome file valido, il file deve essere salvato nel file system e s ObjectDataSource `brochurePath``InsertParameter` valore deve essere aggiornato in modo che il nome del file viene scritto nel database.</span><span class="sxs-lookup"><span data-stu-id="29e40-254">Once a valid file name has been found, the file needs to be saved to the file system and the ObjectDataSource s `brochurePath``InsertParameter` value needs to be updated so that this file name is written to the database.</span></span> <span data-ttu-id="29e40-255">Come abbiamo visto nuovamente il *caricamento di file* esercitazione, il file può essere salvato utilizzando il controllo FileUpload s `SaveAs(path)` metodo.</span><span class="sxs-lookup"><span data-stu-id="29e40-255">As we saw back in the *Uploading Files* tutorial, the file can be saved using the FileUpload control s `SaveAs(path)` method.</span></span> <span data-ttu-id="29e40-256">Per aggiornare i dispositivi ObjectDataSource `brochurePath` parametro, utilizzare il `e.Values` insieme.</span><span class="sxs-lookup"><span data-stu-id="29e40-256">To update the ObjectDataSource s `brochurePath` parameter, use the `e.Values` collection.</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample8.vb)]

## <a name="step-7-saving-the-uploaded-picture-to-the-database"></a><span data-ttu-id="29e40-257">Passaggio 7: Il salvataggio dell'immagine caricata nel database</span><span class="sxs-lookup"><span data-stu-id="29e40-257">Step 7: Saving the Uploaded Picture to the Database</span></span>

<span data-ttu-id="29e40-258">Per archiviare l'immagine caricata nel nuovo `Categories` record, è necessario assegnare il contenuto binario caricato s ObjectDataSource `picture` parametro in s DetailsView `ItemInserting` evento.</span><span class="sxs-lookup"><span data-stu-id="29e40-258">To store the uploaded picture in the new `Categories` record, we need to assign the uploaded binary content to the ObjectDataSource s `picture` parameter in the DetailsView s `ItemInserting` event.</span></span> <span data-ttu-id="29e40-259">Prima dell'assegnazione, tuttavia, è necessario innanzitutto assicurarsi che l'immagine caricata è in formato JPG e non un altro tipo di immagine.</span><span class="sxs-lookup"><span data-stu-id="29e40-259">Before we make this assignment, however, we need to first make sure that the uploaded picture is a JPG and not some other image type.</span></span> <span data-ttu-id="29e40-260">Come passaggio 6, consentire s di utilizzare l'estensione di file di immagine caricata s per verificare il tipo.</span><span class="sxs-lookup"><span data-stu-id="29e40-260">As in Step 6, let s use the uploaded picture s file extension to ascertain its type.</span></span>

<span data-ttu-id="29e40-261">Mentre il `Categories` tabella consente `NULL` valori per il `Picture` colonna, tutte le categorie attualmente dispone di un'immagine.</span><span class="sxs-lookup"><span data-stu-id="29e40-261">While the `Categories` table allows `NULL` values for the `Picture` column, all categories currently have a picture.</span></span> <span data-ttu-id="29e40-262">Consente di forzare all'utente di specificare un'immagine quando si aggiunge una nuova categoria tramite questa pagina s.</span><span class="sxs-lookup"><span data-stu-id="29e40-262">Let s force the user to provide a picture when adding a new category through this page.</span></span> <span data-ttu-id="29e40-263">Il codice seguente controlla per verificare che sia stata caricata un'immagine e che abbia un'estensione appropriata.</span><span class="sxs-lookup"><span data-stu-id="29e40-263">The following code checks to ensure that a picture has been uploaded and that it has an appropriate extension.</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample9.vb)]

<span data-ttu-id="29e40-264">Questo codice deve essere inserito *prima* il codice del passaggio 6 in modo che se si verifica un problema con il caricamento dell'immagine, il gestore dell'evento termina prima brochure viene salvato nel file System.</span><span class="sxs-lookup"><span data-stu-id="29e40-264">This code should be placed *before* the code from Step 6 so that if there is a problem with the picture upload, the event handler will terminate before the brochure file is saved to the file system.</span></span>

<span data-ttu-id="29e40-265">Supponendo che è stato caricato un file appropriato, assegnare il contenuto binario caricato per il valore di s parametri immagine con la riga di codice seguente:</span><span class="sxs-lookup"><span data-stu-id="29e40-265">Assuming that an appropriate file has been uploaded, assign the uploaded binary content to the picture parameter s value with the following line of code:</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample10.vb)]

## <a name="the-completeiteminsertingevent-handler"></a><span data-ttu-id="29e40-266">L'intero`ItemInserting`gestore dell'evento</span><span class="sxs-lookup"><span data-stu-id="29e40-266">The Complete`ItemInserting`Event Handler</span></span>

<span data-ttu-id="29e40-267">Per motivi di completezza, ecco la `ItemInserting` gestore dell'evento nella sua interezza:</span><span class="sxs-lookup"><span data-stu-id="29e40-267">For completeness, here is the `ItemInserting` event handler in its entirety:</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample11.vb)]

## <a name="step-8-fixing-thedisplaycategorypictureaspxpage"></a><span data-ttu-id="29e40-268">Passaggio 8: Correzione di`DisplayCategoryPicture.aspx`pagina</span><span class="sxs-lookup"><span data-stu-id="29e40-268">Step 8: Fixing the`DisplayCategoryPicture.aspx`Page</span></span>

<span data-ttu-id="29e40-269">Consentono di s richiedere qualche istante il test dell'interfaccia di inserimento e `ItemInserting` gestore eventi che è stato creato negli ultimi passaggi successivi.</span><span class="sxs-lookup"><span data-stu-id="29e40-269">Let s take a moment to test out the inserting interface and `ItemInserting` event handler that was created over the last few steps.</span></span> <span data-ttu-id="29e40-270">Visitare il `UploadInDetailsView.aspx` pagina tramite un browser e il tentativo di aggiungere una categoria, ma si omette l'immagine o specificare un'immagine non JPG o brochure non PDF.</span><span class="sxs-lookup"><span data-stu-id="29e40-270">Visit the `UploadInDetailsView.aspx` page through a browser and attempt to add a category, but omit the picture, or specify a non-JPG picture or a non-PDF brochure.</span></span> <span data-ttu-id="29e40-271">In ognuno di questi casi, verrà visualizzato un messaggio di errore e il flusso di lavoro di inserimento annullata.</span><span class="sxs-lookup"><span data-stu-id="29e40-271">In any of these cases, an error message will be displayed and the insert workflow cancelled.</span></span>


<span data-ttu-id="29e40-272">[![Un messaggio di avviso viene visualizzato se viene caricato un tipo di File non valido](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image9.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="29e40-272">[![A Warning Message is Displayed If an Invalid File Type is Uploaded](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image9.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image15.png)</span></span>

<span data-ttu-id="29e40-273">**Figura 9**: un messaggio di avviso viene visualizzato se viene caricato un tipo di File non valido ([fare clic per visualizzare l'immagine ingrandita](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="29e40-273">**Figure 9**: A Warning Message is Displayed If an Invalid File Type is Uploaded ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image16.png))</span></span>


<span data-ttu-id="29e40-274">Dopo avere verificato che la pagina richiede un'immagine da caricare e t acquisite accettare i file non PDF o non JPG, aggiungere una nuova categoria con un'immagine JPG valida, se si lascia vuoto il campo Brochure.</span><span class="sxs-lookup"><span data-stu-id="29e40-274">Once you have verified that the page requires a picture to be uploaded and won t accept non-PDF or non-JPG files, add a new category with a valid JPG picture, leaving the Brochure field empty.</span></span> <span data-ttu-id="29e40-275">Dopo aver fatto clic sul pulsante Inserisci, verrà postback della pagina e verrà aggiunto un nuovo record per il `Categories` tabella con il contenuto binario immagine caricata s archiviate direttamente nel database.</span><span class="sxs-lookup"><span data-stu-id="29e40-275">After clicking the Insert button, the page will postback and a new record will be added to the `Categories` table with the uploaded image s binary contents stored directly in the database.</span></span> <span data-ttu-id="29e40-276">GridView viene aggiornato e viene visualizzata una riga per la categoria appena aggiunta, ma, come mostrato nella figura 10, la nuova immagine s categoria non viene eseguita correttamente.</span><span class="sxs-lookup"><span data-stu-id="29e40-276">The GridView is updated and shows a row for the newly added category, but, as Figure 10 shows, the new category s picture is not rendered correctly.</span></span>


<span data-ttu-id="29e40-277">[![La nuova categoria s che immagine non viene visualizzata](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image10.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="29e40-277">[![The New Category s Picture is not Displayed](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image10.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image17.png)</span></span>

<span data-ttu-id="29e40-278">**Figura 10**: la nuova categoria s immagine non viene visualizzata ([fare clic per visualizzare l'immagine ingrandita](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="29e40-278">**Figure 10**: The New Category s Picture is not Displayed ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image18.png))</span></span>


<span data-ttu-id="29e40-279">Il non motivo viene visualizzata la nuova immagine di `DisplayCategoryPicture.aspx` pagina che restituisce un'immagine di categoria specificata s è configurato per elaborare le bitmap con un'intestazione OLE.</span><span class="sxs-lookup"><span data-stu-id="29e40-279">The reason the new picture is not displayed is because the `DisplayCategoryPicture.aspx` page that returns a specified category s picture is configured to process bitmaps that have an OLE header.</span></span> <span data-ttu-id="29e40-280">Questa intestazione 78 byte viene rimossa dal `Picture` s binario del contenuto delle colonne prima che vengano inviati al client.</span><span class="sxs-lookup"><span data-stu-id="29e40-280">This 78 byte header is stripped from the `Picture` column s binary contents before they are sent back to the client.</span></span> <span data-ttu-id="29e40-281">Ma il file JPG che è appena caricati per la nuova categoria non ha questa intestazione OLE. Pertanto, byte validi, è necessari vengono revocate dai dati binari s immagine.</span><span class="sxs-lookup"><span data-stu-id="29e40-281">But the JPG file we just uploaded for the new category does not have this OLE header; therefore, valid, necessary bytes are being removed from the image s binary data.</span></span>

<span data-ttu-id="29e40-282">Poiché sono ora disponibili entrambe le bitmap con intestazioni OLE e jpg nel `Categories` tabella, è necessario aggiornare `DisplayCategoryPicture.aspx` in modo che non l'intestazione OLE rimozione per le categorie di otto originale e consente di ignorare questa rimozione per il record più recente di categoria.</span><span class="sxs-lookup"><span data-stu-id="29e40-282">Since there are now both bitmaps with OLE headers and JPGs in the `Categories` table, we need to update `DisplayCategoryPicture.aspx` so that it does the OLE header stripping for the original eight categories and bypasses this stripping for the newer category records.</span></span> <span data-ttu-id="29e40-283">Nell'esercitazione successiva verrà esaminato come aggiornare un'immagine di record s esistente e verrà aggiornata tutte le immagini di categoria precedente in modo che siano jpg.</span><span class="sxs-lookup"><span data-stu-id="29e40-283">In our next tutorial we'll examine how to update an existing record s image, and we'll update all of the old category pictures so that they are JPGs.</span></span> <span data-ttu-id="29e40-284">Per il momento, tuttavia, il codice seguente in `DisplayCategoryPicture.aspx` per rimuovere le intestazioni OLE solo per quelle categorie di otto originale:</span><span class="sxs-lookup"><span data-stu-id="29e40-284">For now, though, use the following code in `DisplayCategoryPicture.aspx` to strip the OLE headers only for those original eight categories:</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample12.vb)]

<span data-ttu-id="29e40-285">Con questa modifica, l'immagine JPG viene ora eseguito il rendering correttamente in GridView.</span><span class="sxs-lookup"><span data-stu-id="29e40-285">With this change, the JPG image is now rendered correctly in the GridView.</span></span>


<span data-ttu-id="29e40-286">[![Le immagini JPG per nuove categorie sono correttamente eseguito il rendering](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image11.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="29e40-286">[![The JPG Images for New Categories are Correctly Rendered](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image11.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image19.png)</span></span>

<span data-ttu-id="29e40-287">**Figura 11**: il immagini JPG per nuove categorie sono correttamente eseguito il rendering ([fare clic per visualizzare l'immagine ingrandita](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="29e40-287">**Figure 11**: The JPG Images for New Categories are Correctly Rendered ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image20.png))</span></span>


## <a name="step-9-deleting-the-brochure-in-the-face-of-an-exception"></a><span data-ttu-id="29e40-288">Passaggio 9: Eliminazione Brochure in caso di un'eccezione</span><span class="sxs-lookup"><span data-stu-id="29e40-288">Step 9: Deleting the Brochure in the Face of an Exception</span></span>

<span data-ttu-id="29e40-289">Uno dei problemi di archiviazione di dati binari nel file system s server web è l'introduzione di una disconnessione tra il modello di dati e i relativi dati binari.</span><span class="sxs-lookup"><span data-stu-id="29e40-289">One of the challenges of storing binary data on the web server s file system is that it introduces a disconnect between the data model and its binary data.</span></span> <span data-ttu-id="29e40-290">Pertanto, ogni volta che viene eliminato un record, i dati binari corrispondenti nel file system devono inoltre essere rimossi.</span><span class="sxs-lookup"><span data-stu-id="29e40-290">Therefore, whenever a record is deleted, the corresponding binary data on the file system must also be removed.</span></span> <span data-ttu-id="29e40-291">Questo può tenere conto durante l'inserimento, nonché.</span><span class="sxs-lookup"><span data-stu-id="29e40-291">This can come into play when inserting, as well.</span></span> <span data-ttu-id="29e40-292">Si consideri lo scenario seguente: un utente aggiunge una nuova categoria specifica di un'immagine valida e brochure.</span><span class="sxs-lookup"><span data-stu-id="29e40-292">Consider the following scenario: a user adds a new category, specifying a valid picture and brochure.</span></span> <span data-ttu-id="29e40-293">Al momento facendo clic sul pulsante Inserisci, si verifica un postback e s DetailsView `ItemInserting` viene generato l'evento, il salvataggio delle brochure nel file System s server web.</span><span class="sxs-lookup"><span data-stu-id="29e40-293">Upon clicking the Insert button, a postback occurs and the DetailsView s `ItemInserting` event fires, saving the brochure to the web server s file system.</span></span> <span data-ttu-id="29e40-294">Successivamente, s ObjectDataSource `Insert()` metodo viene richiamato, che chiama il `CategoriesBLL` classe s `InsertWithPicture` metodo che chiama il `CategoriesTableAdapter` s `InsertWithPicture` metodo.</span><span class="sxs-lookup"><span data-stu-id="29e40-294">Next, the ObjectDataSource s `Insert()` method is invoked, which calls the `CategoriesBLL` class s `InsertWithPicture` method, which calls the `CategoriesTableAdapter` s `InsertWithPicture` method.</span></span>

<span data-ttu-id="29e40-295">Ora, cosa accade se il database è offline o se si verifica un errore nel `INSERT` istruzione SQL?</span><span class="sxs-lookup"><span data-stu-id="29e40-295">Now, what happens if the database is offline, or if there is an error in the `INSERT` SQL statement?</span></span> <span data-ttu-id="29e40-296">Chiaramente l'inserimento avrà esito negativo, pertanto nessuna nuova riga category verrà aggiunto al database.</span><span class="sxs-lookup"><span data-stu-id="29e40-296">Clearly the INSERT will fail, so no new category row will be added to the database.</span></span> <span data-ttu-id="29e40-297">Ma è ancora stato del file caricato brochure posto nel file system s server web.</span><span class="sxs-lookup"><span data-stu-id="29e40-297">But we still have the uploaded brochure file sitting on the web server s file system!</span></span> <span data-ttu-id="29e40-298">Questo file deve essere eliminata in caso di un'eccezione durante l'inserimento del flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="29e40-298">This file needs to be deleted in the face of an exception during the inserting workflow.</span></span>

<span data-ttu-id="29e40-299">Come descritto in precedenza nel [BLL - gestione e le eccezioni DAL livello in una pagina ASP.NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) esercitazione, quando viene generata un'eccezione all'interno di efficacia dell'architettura viene passata attraverso i vari livelli.</span><span class="sxs-lookup"><span data-stu-id="29e40-299">As discussed previously in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) tutorial, when an exception is thrown from within the depths of the architecture it is bubbled up through the various layers.</span></span> <span data-ttu-id="29e40-300">A livello di presentazione, è possibile determinare se un'eccezione da DetailsView s `ItemInserted` evento.</span><span class="sxs-lookup"><span data-stu-id="29e40-300">At the Presentation Layer, we can determine if an exception has occurred from the DetailsView s `ItemInserted` event.</span></span> <span data-ttu-id="29e40-301">Questo gestore fornisce anche i valori di s ObjectDataSource `InsertParameters`.</span><span class="sxs-lookup"><span data-stu-id="29e40-301">This event handler also provides the values of the ObjectDataSource s `InsertParameters`.</span></span> <span data-ttu-id="29e40-302">Pertanto, è possibile creare un gestore eventi per il `ItemInserted` evento che verifica se si è verificata un'eccezione e, in tal caso, Elimina il file specificato da ObjectDataSource s `brochurePath` parametro:</span><span class="sxs-lookup"><span data-stu-id="29e40-302">Therefore, we can create an event handler for the `ItemInserted` event that checks if there was an exception and, if so, deletes the file specified by the ObjectDataSource s `brochurePath` parameter:</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample13.vb)]

## <a name="summary"></a><span data-ttu-id="29e40-303">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="29e40-303">Summary</span></span>

<span data-ttu-id="29e40-304">Esistono una serie di passaggi che devono essere eseguiti per fornire un'interfaccia basata sul web per l'aggiunta di record che includono dati binari.</span><span class="sxs-lookup"><span data-stu-id="29e40-304">There are a number of steps that must be performed in order to provide a web-based interface for adding records that include binary data.</span></span> <span data-ttu-id="29e40-305">Se i dati binari vengono archiviati direttamente nel database, probabilità sono che sarà necessario aggiornare l'architettura, aggiunta di metodi specifici per gestire il caso in cui l'inserimento dei dati binari.</span><span class="sxs-lookup"><span data-stu-id="29e40-305">If the binary data is being stored directly into the database, chances are you'll need to update the architecture, adding specific methods to handle the case where binary data is being inserted.</span></span> <span data-ttu-id="29e40-306">Una volta l'architettura è stata aggiornata, è necessario creare l'interfaccia di inserimento, che può essere eseguita tramite un controllo DetailsView che è stato personalizzato per includere un controllo FileUpload per ogni campo di dati binari.</span><span class="sxs-lookup"><span data-stu-id="29e40-306">Once the architecture has been updated, the next step is creating the inserting interface, which can be accomplished using a DetailsView that has been customized to include a FileUpload control for each binary data field.</span></span> <span data-ttu-id="29e40-307">I dati caricati quindi possono essere salvati nel file System s server web o assegnati a un parametro di origine dati nel controllo DetailsView s `ItemInserting` gestore dell'evento.</span><span class="sxs-lookup"><span data-stu-id="29e40-307">The uploaded data can then be saved to the web server s file system or assigned to a data source parameter in the DetailsView s `ItemInserting` event handler.</span></span>

<span data-ttu-id="29e40-308">Salvataggio di dati binari nel file System richiede una pianificazione più del salvataggio dei dati direttamente nel database.</span><span class="sxs-lookup"><span data-stu-id="29e40-308">Saving binary data to the file system requires more planning than saving data directly into the database.</span></span> <span data-ttu-id="29e40-309">Per evitare la sovrascrittura di un altro s un caricamento di utente s, è necessario scegliere uno schema di denominazione.</span><span class="sxs-lookup"><span data-stu-id="29e40-309">A naming scheme must be chosen in order to avoid one user s upload overwriting another s.</span></span> <span data-ttu-id="29e40-310">Inoltre, è necessario eseguire passaggi aggiuntivi per eliminare il file caricato, se l'inserimento del database ha esito negativo.</span><span class="sxs-lookup"><span data-stu-id="29e40-310">Also, extra steps must be taken to delete the uploaded file if the database insert fails.</span></span>

<span data-ttu-id="29e40-311">È ora disponibile la possibilità di aggiungere nuove categorie per il sistema con una brochure e immagine, ma è ve ancora per esaminare come aggiornare i dati binari s categoria esistenti o rimuovere correttamente i dati binari per una categoria eliminata.</span><span class="sxs-lookup"><span data-stu-id="29e40-311">We now have the ability to add new categories to the system with a brochure and picture, but we ve yet to look at how to update an existing category s binary data or how to correctly remove the binary data for a deleted category.</span></span> <span data-ttu-id="29e40-312">Nella prossima esercitazione verrà illustrato in questi due argomenti.</span><span class="sxs-lookup"><span data-stu-id="29e40-312">We'll explore these two topics in the next tutorial.</span></span>

<span data-ttu-id="29e40-313">Buona programmazione!</span><span class="sxs-lookup"><span data-stu-id="29e40-313">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="29e40-314">Informazioni sull'autore</span><span class="sxs-lookup"><span data-stu-id="29e40-314">About the Author</span></span>

<span data-ttu-id="29e40-315">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), l'autore di sette libri e fondatore di [4GuysFromRolla](http://www.4guysfromrolla.com), ha lavorato con tecnologie Web di Microsoft dal 1998.</span><span class="sxs-lookup"><span data-stu-id="29e40-315">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="29e40-316">Scott funziona come un consulente trainer e writer.</span><span class="sxs-lookup"><span data-stu-id="29e40-316">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="29e40-317">Il suo ultimo libro è [ *SAM insegna manualmente ASP.NET 2.0 nelle 24 ore*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="29e40-317">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="29e40-318">Egli può essere raggiunto al [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) o sul suo blog, cui è reperibile in [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="29e40-318">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="29e40-319">Ringraziamenti speciali</span><span class="sxs-lookup"><span data-stu-id="29e40-319">Special Thanks To</span></span>

<span data-ttu-id="29e40-320">Questa serie di esercitazioni è stata esaminata da diversi validi revisori.</span><span class="sxs-lookup"><span data-stu-id="29e40-320">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="29e40-321">Lead revisori per questa esercitazione sono stati Dave Gardner Teresa Murphy e Bernadette Leigh.</span><span class="sxs-lookup"><span data-stu-id="29e40-321">Lead reviewers for this tutorial were Dave Gardner, Teresa Murphy, and Bernadette Leigh.</span></span> <span data-ttu-id="29e40-322">Se si è interessati my prossimi articoli MSDN?</span><span class="sxs-lookup"><span data-stu-id="29e40-322">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="29e40-323">In caso affermativo, Inviami una riga alla [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="29e40-323">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="29e40-324">[Precedente](displaying-binary-data-in-the-data-web-controls-vb.md)
> [Successivo](updating-and-deleting-existing-binary-data-vb.md)</span><span class="sxs-lookup"><span data-stu-id="29e40-324">[Previous](displaying-binary-data-in-the-data-web-controls-vb.md)
[Next](updating-and-deleting-existing-binary-data-vb.md)</span></span>
