---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs
title: Usando Stored procedure per gli oggetti TableAdapter del DataSet tipizzato (c#) | Documenti Microsoft
author: rick-anderson
description: Nell'esercitazione precedente è stato descritto come utilizzare la configurazione guidata TableAdapter per generare nuove stored procedure. In questa esercitazione viene illustrato come stesso TableAdapter...
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/18/2007
ms.topic: article
ms.assetid: 440bef2a-1641-4238-99e3-8e2d44e7d94c
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs
msc.type: authoredcontent
ms.openlocfilehash: df8a714325ce99db615eddc3d457da5c926919ba
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/06/2018
ms.locfileid: "30877073"
---
<a name="using-existing-stored-procedures-for-the-typed-datasets-tableadapters-c"></a><span data-ttu-id="52df3-104">Usando Stored procedure per gli oggetti TableAdapter del DataSet tipizzato (c#)</span><span class="sxs-lookup"><span data-stu-id="52df3-104">Using Existing Stored Procedures for the Typed DataSet's TableAdapters (C#)</span></span>
====================
<span data-ttu-id="52df3-105">da [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="52df3-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="52df3-106">[Scaricare codice](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_68_CS.zip) o [Scarica il PDF](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/datatutorial68cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="52df3-106">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_68_CS.zip) or [Download PDF](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/datatutorial68cs1.pdf)</span></span>

> <span data-ttu-id="52df3-107">Nell'esercitazione precedente è stato descritto come utilizzare la configurazione guidata TableAdapter per generare nuove stored procedure.</span><span class="sxs-lookup"><span data-stu-id="52df3-107">In the previous tutorial we learned how to use the TableAdapter Wizard to generate new stored procedures.</span></span> <span data-ttu-id="52df3-108">In questa esercitazione è illustrato l'utilizzo di stored procedure esistenti la configurazione guidata TableAdapter stesso.</span><span class="sxs-lookup"><span data-stu-id="52df3-108">In this tutorial we learn how the same TableAdapter Wizard can work with existing stored procedures.</span></span> <span data-ttu-id="52df3-109">È inoltre illustrato come aggiungere manualmente le nuove stored procedure per il database.</span><span class="sxs-lookup"><span data-stu-id="52df3-109">We also learn how to manually add new stored procedures to our database.</span></span>


## <a name="introduction"></a><span data-ttu-id="52df3-110">Introduzione</span><span class="sxs-lookup"><span data-stu-id="52df3-110">Introduction</span></span>

<span data-ttu-id="52df3-111">Nel [esercitazione precedente](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) è stato illustrato come è stato possibile configurare TableAdapter s DataSet tipizzato per l'utilizzo di stored procedure in istruzioni SQL dati anziché ad hoc di accesso.</span><span class="sxs-lookup"><span data-stu-id="52df3-111">In the [preceding tutorial](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) we saw how the Typed DataSet s TableAdapters could be configured to use stored procedures to access data rather than ad-hoc SQL statements.</span></span> <span data-ttu-id="52df3-112">In particolare, abbiamo esaminato come disporre la configurazione guidata TableAdapter di creare automaticamente le stored procedure.</span><span class="sxs-lookup"><span data-stu-id="52df3-112">In particular, we examined how to have the TableAdapter wizard automatically create these stored procedures.</span></span> <span data-ttu-id="52df3-113">Durante il porting di un'applicazione legacy a ASP.NET 2.0 o durante la compilazione di un sito Web di ASP.NET 2.0 intorno a un modello di dati esistente, probabilità sono che il database contiene già le stored procedure che è necessario.</span><span class="sxs-lookup"><span data-stu-id="52df3-113">When porting a legacy application to ASP.NET 2.0 or when building an ASP.NET 2.0 website around an existing data model, chances are that the database already contains the stored procedures we need.</span></span> <span data-ttu-id="52df3-114">In alternativa, è preferibile creare le stored procedure manualmente o tramite uno strumento diverso dalla configurazione guidata TableAdapter che genera automaticamente le stored procedure.</span><span class="sxs-lookup"><span data-stu-id="52df3-114">Alternatively, you may prefer to create your stored procedures by hand or through some tool other than the TableAdapter wizard that auto-generates your stored procedures.</span></span>

<span data-ttu-id="52df3-115">In questa esercitazione verranno esaminati come configurare il TableAdapter per l'utilizzo di stored procedure esistenti.</span><span class="sxs-lookup"><span data-stu-id="52df3-115">In this tutorial we will look at how to configure the TableAdapter to use existing stored procedures.</span></span> <span data-ttu-id="52df3-116">Poiché il database Northwind ha solo un piccolo set di stored procedure incorporate, verranno inoltre esaminati i passaggi necessari per aggiungere manualmente le nuove stored procedure nel database tramite l'ambiente di Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="52df3-116">Since the Northwind database only has a small set of built-in stored procedures, we will also look at the steps needed to manually add new stored procedures to the database through the Visual Studio environment.</span></span> <span data-ttu-id="52df3-117">Let s iniziare!</span><span class="sxs-lookup"><span data-stu-id="52df3-117">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="52df3-118">Nel [di wrapping delle modifiche del Database all'interno di una transazione](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-cs.md) esercitazione metodi è stato aggiunto all'oggetto TableAdapter per supportare le transazioni (`BeginTransaction`, `CommitTransaction`e così via).</span><span class="sxs-lookup"><span data-stu-id="52df3-118">In the [Wrapping Database Modifications within a Transaction](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-cs.md) tutorial we added methods to the TableAdapter to support transactions (`BeginTransaction`, `CommitTransaction`, and so on).</span></span> <span data-ttu-id="52df3-119">In alternativa, è possibile gestire le transazioni completamente all'interno di una stored procedure, che non richiede modifiche al codice a livello di accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="52df3-119">Alternatively, transactions can be managed entirely within a stored procedure, which requires no modifications to the Data Access Layer code.</span></span> <span data-ttu-id="52df3-120">In questa esercitazione si esamineranno i comandi T-SQL utilizzati per eseguire istruzioni di s una stored procedure all'interno dell'ambito di una transazione.</span><span class="sxs-lookup"><span data-stu-id="52df3-120">In this tutorial we'll explore the T-SQL commands used to execute a stored procedure s statements within the scope of a transaction.</span></span>


## <a name="step-1-adding-stored-procedures-to-the-northwind-database"></a><span data-ttu-id="52df3-121">Passaggio 1: Aggiunta di Stored procedure nel database Northwind</span><span class="sxs-lookup"><span data-stu-id="52df3-121">Step 1: Adding Stored Procedures to the Northwind Database</span></span>

<span data-ttu-id="52df3-122">Visual Studio è facile aggiungere nuove stored procedure a un database.</span><span class="sxs-lookup"><span data-stu-id="52df3-122">Visual Studio makes it easy to add new stored procedures to a database.</span></span> <span data-ttu-id="52df3-123">S consentono di aggiungere una nuova stored procedure al database Northwind che restituisce tutte le colonne di `Products` tabella per quelli che dispongono di un particolare `CategoryID` valore.</span><span class="sxs-lookup"><span data-stu-id="52df3-123">Let s add a new stored procedure to the Northwind database that returns all columns from the `Products` table for those that have a particular `CategoryID` value.</span></span> <span data-ttu-id="52df3-124">Dalla finestra di Esplora Server, espandere il database Northwind in modo che le cartelle - diagrammi di Database, tabelle, viste e così via, vengono visualizzate.</span><span class="sxs-lookup"><span data-stu-id="52df3-124">From the Server Explorer window, expand the Northwind database so that its folders - Database Diagrams, Tables, Views, and so forth - are displayed.</span></span> <span data-ttu-id="52df3-125">Come illustrato nell'esercitazione precedente, la cartella di Stored procedure contiene il database s stored procedure esistenti.</span><span class="sxs-lookup"><span data-stu-id="52df3-125">As we saw in the preceding tutorial, the Stored Procedures folder contains the database s existing stored procedures.</span></span> <span data-ttu-id="52df3-126">Per aggiungere una nuova stored procedure, fare clic sulla cartella la Stored procedure e scegliere l'opzione Aggiungi nuova Stored Procedure dal menu di scelta rapida.</span><span class="sxs-lookup"><span data-stu-id="52df3-126">To add a new stored procedure, simply right-click the Stored Procedures folder and choose the Add New Stored Procedure option from the context menu.</span></span>


<span data-ttu-id="52df3-127">[![Fare clic sulla cartella la Stored procedure e aggiungere una nuova Stored Procedure](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image2.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="52df3-127">[![Right-Click the Stored Procedures Folder and Add a New Stored Procedure](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image2.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image1.png)</span></span>

<span data-ttu-id="52df3-128">**Figura 1**: scelta della cartella Stored Procedures e aggiungere una nuova Stored Procedure ([fare clic per visualizzare l'immagine ingrandita](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="52df3-128">**Figure 1**: Right-Click the Stored Procedures Folder and Add a New Stored Procedure ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image3.png))</span></span>


<span data-ttu-id="52df3-129">Come illustrato nella figura 1, si seleziona l'opzione Aggiungi nuova Stored Procedure Visualizza una finestra di script in Visual Studio con la struttura dello script SQL necessari per creare la stored procedure.</span><span class="sxs-lookup"><span data-stu-id="52df3-129">As Figure 1 shows, selecting the Add New Stored Procedure option opens a script window in Visual Studio with the outline of the SQL script needed to create the stored procedure.</span></span> <span data-ttu-id="52df3-130">È il processo per approfondire questo script ed eseguirlo, a quel punto verrà aggiunto al database della stored procedure.</span><span class="sxs-lookup"><span data-stu-id="52df3-130">It is our job to flesh out this script and execute it, at which point the stored procedure will be added to the database.</span></span>

<span data-ttu-id="52df3-131">Immettere lo script seguente:</span><span class="sxs-lookup"><span data-stu-id="52df3-131">Enter the following script:</span></span>


[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample1.sql)]

<span data-ttu-id="52df3-132">Questo script, quando eseguita, verrà aggiunta automaticamente una nuova stored procedure del database Northwind denominato `Products_SelectByCategoryID`.</span><span class="sxs-lookup"><span data-stu-id="52df3-132">This script, when executed, will add a new stored procedure to the Northwind database named `Products_SelectByCategoryID`.</span></span> <span data-ttu-id="52df3-133">Questa stored procedure accetta un singolo parametro di input (`@CategoryID`, di tipo `int`) e restituisce tutti i campi per i prodotti con un corrispondente `CategoryID` valore.</span><span class="sxs-lookup"><span data-stu-id="52df3-133">This stored procedure accepts a single input parameter (`@CategoryID`, of type `int`) and it returns all of the fields for those products with a matching `CategoryID` value.</span></span>

<span data-ttu-id="52df3-134">Per eseguire questa applicazione `CREATE PROCEDURE` script e aggiungere la stored procedure nel database, fare clic sull'icona Salva nella barra degli strumenti o premere Ctrl + S.</span><span class="sxs-lookup"><span data-stu-id="52df3-134">To execute this `CREATE PROCEDURE` script and add the stored procedure to the database, click the Save icon in the toolbar or hit Ctrl+S.</span></span> <span data-ttu-id="52df3-135">Al termine dell'operazione, aggiornare la cartella Stored procedure che mostra l'oggetto appena creato di stored procedure.</span><span class="sxs-lookup"><span data-stu-id="52df3-135">After doing so, the Stored Procedures folder refreshes, showing the newly created stored procedure.</span></span> <span data-ttu-id="52df3-136">Inoltre, lo script nella finestra viene modificata abbastanza particolare da `CREATE PROCEDURE dbo.Products_SelectProductByCategoryID` a `ALTER PROCEDURE` `dbo.Products_SelectProductByCategoryID`.</span><span class="sxs-lookup"><span data-stu-id="52df3-136">Also, the script in the window will change subtlety from `CREATE PROCEDURE dbo.Products_SelectProductByCategoryID` to `ALTER PROCEDURE` `dbo.Products_SelectProductByCategoryID`.</span></span> <span data-ttu-id="52df3-137">`CREATE PROCEDURE` Aggiunge una nuova stored procedure nel database, mentre `ALTER PROCEDURE` aggiorna uno esistente.</span><span class="sxs-lookup"><span data-stu-id="52df3-137">`CREATE PROCEDURE` adds a new stored procedure to the database, while `ALTER PROCEDURE` updates an existing one.</span></span> <span data-ttu-id="52df3-138">Poiché l'inizio dello script è stato modificato in `ALTER PROCEDURE`, modificare le stored procedure immettere parametri o istruzioni SQL e facendo clic sull'icona Salva aggiornerà la stored procedure con queste modifiche.</span><span class="sxs-lookup"><span data-stu-id="52df3-138">Since the start of the script has changed to `ALTER PROCEDURE`, changing the stored procedures input parameters or SQL statements and clicking the Save icon will update the stored procedure with these changes.</span></span>

<span data-ttu-id="52df3-139">La figura 2 mostra Visual Studio dopo la `Products_SelectByCategoryID` stored procedure è stata salvata.</span><span class="sxs-lookup"><span data-stu-id="52df3-139">Figure 2 shows Visual Studio after the `Products_SelectByCategoryID` stored procedure has been saved.</span></span>


<span data-ttu-id="52df3-140">[![La Stored Procedure Products_SelectByCategoryID è stato aggiunto al Database](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image5.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="52df3-140">[![The Stored Procedure Products_SelectByCategoryID Has Been Added to the Database](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image5.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image4.png)</span></span>

<span data-ttu-id="52df3-141">**Figura 2**: la Stored Procedure `Products_SelectByCategoryID` è stato aggiunto al Database ([fare clic per visualizzare l'immagine ingrandita](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="52df3-141">**Figure 2**: The Stored Procedure `Products_SelectByCategoryID` Has Been Added to the Database ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image6.png))</span></span>


## <a name="step-2-configuring-the-tableadapter-to-use-an-existing-stored-procedure"></a><span data-ttu-id="52df3-142">Passaggio 2: Configurazione del TableAdapter per l'utilizzo di una Stored Procedure esistente</span><span class="sxs-lookup"><span data-stu-id="52df3-142">Step 2: Configuring the TableAdapter to Use an Existing Stored Procedure</span></span>

<span data-ttu-id="52df3-143">Ora che il `Products_SelectByCategoryID` stored procedure è stato aggiunto al database, è possibile concigure il livello di accesso ai dati per utilizzare questa stored procedure quando viene richiamato uno dei relativi metodi.</span><span class="sxs-lookup"><span data-stu-id="52df3-143">Now that the `Products_SelectByCategoryID` stored procedure has been added to the database, we can concigure our Data Access Layer to use this stored procedure when one of its methods is invoked.</span></span> <span data-ttu-id="52df3-144">In particolare, verrà aggiunto un `GetProducstByCategoryID(categoryID)` metodo il `ProductsTableAdapter` nel `NorthwindWithSprocs` DataSet tipizzato che chiama il `Products_SelectByCategoryID` stored procedure che abbiamo appena creato.</span><span class="sxs-lookup"><span data-stu-id="52df3-144">In particular, we will add a `GetProducstByCategoryID(categoryID)` method to the `ProductsTableAdapter` in the `NorthwindWithSprocs` Typed DataSet that calls the `Products_SelectByCategoryID` stored procedure we just created.</span></span>

<span data-ttu-id="52df3-145">Aprire il `NorthwindWithSprocs` set di dati.</span><span class="sxs-lookup"><span data-stu-id="52df3-145">Start by opening the `NorthwindWithSprocs` DataSet.</span></span> <span data-ttu-id="52df3-146">Fare clic su di `ProductsTableAdapter` e scegliere Aggiungi Query per avviare la configurazione guidata Query TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="52df3-146">Right-click on the `ProductsTableAdapter` and choose Add Query to launch the TableAdapter Query Configuration wizard.</span></span> <span data-ttu-id="52df3-147">Nel [esercitazione precedente](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) è optato per creare una nuova stored procedure per noi TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="52df3-147">In the [preceding tutorial](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) we opted to have the TableAdapter create a new stored procedure for us.</span></span> <span data-ttu-id="52df3-148">Per questa esercitazione, tuttavia, è necessario collegare il nuovo metodo TableAdapter esistente `Products_SelectByCategoryID` stored procedure.</span><span class="sxs-lookup"><span data-stu-id="52df3-148">For this tutorial, however, we want to wire the new TableAdapter method to the existing `Products_SelectByCategoryID` stored procedure.</span></span> <span data-ttu-id="52df3-149">Pertanto, scegliere l'opzione Usa stored procedure esistenti tra il primo passaggio s di procedura guidata e quindi fare clic su Avanti.</span><span class="sxs-lookup"><span data-stu-id="52df3-149">Therefore, choose the Use existing stored procedure option from the wizard s first step and then click Next.</span></span>


<span data-ttu-id="52df3-150">[![Scegliere l'utilizzo di stored procedure opzione esistente](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image8.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="52df3-150">[![Choose the Use existing stored procedure Option](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image8.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image7.png)</span></span>

<span data-ttu-id="52df3-151">**Figura 3**: scegliere Usa esistente store procedure opzione ([fare clic per visualizzare l'immagine ingrandita](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="52df3-151">**Figure 3**: Choose the Use existing stored procedure Option ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image9.png))</span></span>


<span data-ttu-id="52df3-152">La schermata seguente fornisce che un elenco a discesa popolato con il database s stored procedure.</span><span class="sxs-lookup"><span data-stu-id="52df3-152">The following screen provides a drop-down list populated with the database s stored procedures.</span></span> <span data-ttu-id="52df3-153">Selezione di una stored procedure sono elencati i parametri di input a sinistra e i campi di dati restituiti (se presente) a destra.</span><span class="sxs-lookup"><span data-stu-id="52df3-153">Selecting a stored procedure lists its input parameters on the left and the data fields returned (if any) on the right.</span></span> <span data-ttu-id="52df3-154">Scegliere il `Products_SelectByCategoryID` stored procedure dall'elenco e fare clic su Avanti.</span><span class="sxs-lookup"><span data-stu-id="52df3-154">Choose the `Products_SelectByCategoryID` stored procedure from the list and click Next.</span></span>


<span data-ttu-id="52df3-155">[![Selezionare il Products_SelectByCategoryID Stored Procedure](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image11.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="52df3-155">[![Pick the Products_SelectByCategoryID Stored Procedure](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image11.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image10.png)</span></span>

<span data-ttu-id="52df3-156">**Figura 4**: selezionare il `Products_SelectByCategoryID` Stored Procedure ([fare clic per visualizzare l'immagine ingrandita](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="52df3-156">**Figure 4**: Pick the `Products_SelectByCategoryID` Stored Procedure ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image12.png))</span></span>


<span data-ttu-id="52df3-157">Nella schermata successiva viene chiesto di specificare il tipo di dati viene restituito dalla stored procedure e la risposta qui determina il tipo restituito dal metodo s TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="52df3-157">The next screen asks us what kind of data is returned by the stored procedure and our answer here determines the type returned by the TableAdapter s method.</span></span> <span data-ttu-id="52df3-158">Ad esempio, se si indicano che i dati in formato tabulare viene restituiti, il metodo restituirà un `ProductsDataTable` istanza popolata con i record restituiti dalla stored procedure.</span><span class="sxs-lookup"><span data-stu-id="52df3-158">For example, if we indicate that tabular data is returned, the method will return a `ProductsDataTable` instance populated with the records returned by the stored procedure.</span></span> <span data-ttu-id="52df3-159">Al contrario, se si indica che questa stored procedure restituisce un valore singolo TableAdapter verrà restituito un `object` che viene assegnato il valore nella prima colonna del primo record restituito dalla stored procedure.</span><span class="sxs-lookup"><span data-stu-id="52df3-159">In contrast, if we indicate that this stored procedure returns a single value the TableAdapter will return an `object` that is assigned the value in the first column of the first record returned by the stored procedure.</span></span>

<span data-ttu-id="52df3-160">Poiché il `Products_SelectByCategoryID` stored procedure restituisce tutti i prodotti che appartengono a una particolare categoria, scegliere la prima risposta - dati tabulari - e fare clic su Avanti.</span><span class="sxs-lookup"><span data-stu-id="52df3-160">Since the `Products_SelectByCategoryID` stored procedure returns all products that belong to a particular category, choose the first answer - Tabular data - and click Next.</span></span>


<span data-ttu-id="52df3-161">[![Indicare che la Stored Procedure restituisce dati in formato tabulare](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image14.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="52df3-161">[![Indicate that the Stored Procedure Returns Tabular Data](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image14.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image13.png)</span></span>

<span data-ttu-id="52df3-162">**Figura 5**: indica che la Stored Procedure restituisce dati tabellari ([fare clic per visualizzare l'immagine ingrandita](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="52df3-162">**Figure 5**: Indicate that the Stored Procedure Returns Tabular Data ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image15.png))</span></span>


<span data-ttu-id="52df3-163">È comunque per indicare quali modelli di metodo da utilizzare seguita dai nomi per questi metodi.</span><span class="sxs-lookup"><span data-stu-id="52df3-163">All that remains is to indicate what method patterns to use followed by the names for these methods.</span></span> <span data-ttu-id="52df3-164">Lasciare il riempimento di entrambi, DataTable e restituire un oggetto DataTable di opzioni è selezionata, ma rinominare i metodi per `FillByCategoryID` e `GetProductsByCategoryID`.</span><span class="sxs-lookup"><span data-stu-id="52df3-164">Leave both the Fill a DataTable and Return a DataTable options checked, but rename the methods to `FillByCategoryID` and `GetProductsByCategoryID`.</span></span> <span data-ttu-id="52df3-165">Fare clic su Avanti per esaminare un riepilogo delle attività che verrà eseguita la procedura guidata.</span><span class="sxs-lookup"><span data-stu-id="52df3-165">Then click Next to review a summary of the tasks the wizard will perform.</span></span> <span data-ttu-id="52df3-166">Se tutto sembra corretto, fare clic su Fine.</span><span class="sxs-lookup"><span data-stu-id="52df3-166">If everything looks correct, click Finish.</span></span>


<span data-ttu-id="52df3-167">[![Nome FillByCategoryID i metodi e GetProductsByCategoryID](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image17.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="52df3-167">[![Name the Methods FillByCategoryID and GetProductsByCategoryID](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image17.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image16.png)</span></span>

<span data-ttu-id="52df3-168">**Figura 6**: nome i metodi `FillByCategoryID` e `GetProductsByCategoryID` ([fare clic per visualizzare l'immagine ingrandita](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="52df3-168">**Figure 6**: Name the Methods `FillByCategoryID` and `GetProductsByCategoryID` ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image18.png))</span></span>


> [!NOTE]
> <span data-ttu-id="52df3-169">I metodi TableAdapter appena creato, `FillByCategoryID` e `GetProductsByCategoryID`, prevede un parametro di input di tipo `int`.</span><span class="sxs-lookup"><span data-stu-id="52df3-169">The TableAdapter methods we just created, `FillByCategoryID` and `GetProductsByCategoryID`, expect an input parameter of type `int`.</span></span> <span data-ttu-id="52df3-170">Il valore di parametro di input viene passato alla stored procedure tramite il relativo `@CategoryID` parametro.</span><span class="sxs-lookup"><span data-stu-id="52df3-170">This input parameter value is passed into the stored procedure via its `@CategoryID` parameter.</span></span> <span data-ttu-id="52df3-171">Se si modifica il `Products_SelectByCategory` parametri di stored procedure s, è necessario aggiornare anche i parametri per i metodi TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="52df3-171">If you modify the `Products_SelectByCategory` stored procedure s parameters, you'll need to also update the parameters for these TableAdapter methods.</span></span> <span data-ttu-id="52df3-172">Come descritto nel [esercitazione precedente](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md), questa operazione può essere eseguita in uno dei due modi: manualmente aggiungendo o rimuovendo i parametri dalla raccolta di parametri o rieseguendo la configurazione guidata TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="52df3-172">As discussed in the [previous tutorial](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md), this can be done in one of two ways: by manually adding or removing parameters from the parameters collection or by rerunning the TableAdapter wizard.</span></span>


## <a name="step-3-adding-agetproductsbycategoryidcategoryidmethod-to-the-bll"></a><span data-ttu-id="52df3-173">Passaggio 3: Aggiunta di un`GetProductsByCategoryID(categoryID)`al livello Business Logic (metodo)</span><span class="sxs-lookup"><span data-stu-id="52df3-173">Step 3: Adding a`GetProductsByCategoryID(categoryID)`Method to the BLL</span></span>

<span data-ttu-id="52df3-174">Con la `GetProductsByCategoryID` DAL completo, il passaggio successivo è per fornire l'accesso a questo metodo nel livello di logica di Business.</span><span class="sxs-lookup"><span data-stu-id="52df3-174">With the `GetProductsByCategoryID` DAL method complete, the next step is to provide access to this method in the Business Logic Layer.</span></span> <span data-ttu-id="52df3-175">Aprire il `ProductsBLLWithSprocs` file di classe e aggiungere il metodo seguente:</span><span class="sxs-lookup"><span data-stu-id="52df3-175">Open the `ProductsBLLWithSprocs` class file and add the following method:</span></span>


[!code-csharp[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample2.cs)]

<span data-ttu-id="52df3-176">Questo metodo BLL restituisce semplicemente il `ProductsDataTable` restituito dal `ProductsTableAdapter` s `GetProductsByCategoryID` metodo.</span><span class="sxs-lookup"><span data-stu-id="52df3-176">This BLL method simply returns the `ProductsDataTable` returned from the `ProductsTableAdapter` s `GetProductsByCategoryID` method.</span></span> <span data-ttu-id="52df3-177">Il `DataObjectMethodAttribute` attributo fornisce metadati utilizzati dalla procedura guidata ObjectDataSource s Configura origine dati.</span><span class="sxs-lookup"><span data-stu-id="52df3-177">The `DataObjectMethodAttribute` attribute provides metadata used by the ObjectDataSource s Configure Data Source wizard.</span></span> <span data-ttu-id="52df3-178">In particolare, questo metodo verrà visualizzato nell'elenco scegliere scheda s elenco a discesa.</span><span class="sxs-lookup"><span data-stu-id="52df3-178">In particular, this method will appear in the SELECT tab s drop-down list.</span></span>

## <a name="step-4-displaying-products-by-category"></a><span data-ttu-id="52df3-179">Passaggio 4: Visualizzare i prodotti per categoria</span><span class="sxs-lookup"><span data-stu-id="52df3-179">Step 4: Displaying Products by Category</span></span>

<span data-ttu-id="52df3-180">Per eseguire il test appena aggiunta `Products_SelectByCategoryID` stored procedure e i metodi DAL e BLL corrispondenti, consente di creare una pagina ASP.NET che contiene un controllo DropDownList e un controllo GridView s.</span><span class="sxs-lookup"><span data-stu-id="52df3-180">To test the newly added `Products_SelectByCategoryID` stored procedure and the corresponding DAL and BLL methods, let s create an ASP.NET page that contains a DropDownList and a GridView.</span></span> <span data-ttu-id="52df3-181">DropDownList elencherà tutte le categorie nel database durante il controllo GridView visualizzerà i prodotti appartenenti alla categoria selezionata.</span><span class="sxs-lookup"><span data-stu-id="52df3-181">The DropDownList will list all of the categories in the database while the GridView will display the products belonging to the selected category.</span></span>

> [!NOTE]
> <span data-ttu-id="52df3-182">È interfacce master-details ve create utilizzando controlli DropDownList nelle esercitazioni precedenti.</span><span class="sxs-lookup"><span data-stu-id="52df3-182">We ve created master/detail interfaces using DropDownLists in previous tutorials.</span></span> <span data-ttu-id="52df3-183">Per una descrizione più approfondita di tale una relazione master/dettaglio di implementazione, vedere il [Master-Details filtro con un DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-cs.md) esercitazione.</span><span class="sxs-lookup"><span data-stu-id="52df3-183">For a more in-depth look at implementing such a master/detail report, refer to the [Master/Detail Filtering With a DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-cs.md) tutorial.</span></span>


<span data-ttu-id="52df3-184">Aprire il `ExistingSprocs.aspx` nella pagina di `AdvancedDAL` cartelle e trascinare un controllo DropDownList dalla casella degli strumenti nella finestra di progettazione.</span><span class="sxs-lookup"><span data-stu-id="52df3-184">Open the `ExistingSprocs.aspx` page in the `AdvancedDAL` folder and drag a DropDownList from the Toolbox onto the Designer.</span></span> <span data-ttu-id="52df3-185">Impostare il s DropDownList `ID` proprietà `Categories` e il relativo `AutoPostBack` proprietà `true`.</span><span class="sxs-lookup"><span data-stu-id="52df3-185">Set the DropDownList s `ID` property to `Categories` and its `AutoPostBack` property to `true`.</span></span> <span data-ttu-id="52df3-186">Successivamente, smart tag, di associare DropDownList a un nuovo oggetto ObjectDataSource denominato `CategoriesDataSource`.</span><span class="sxs-lookup"><span data-stu-id="52df3-186">Next, from its smart tag, bind the DropDownList to a new ObjectDataSource named `CategoriesDataSource`.</span></span> <span data-ttu-id="52df3-187">Configurare ObjectDataSource in modo che recuperi i dati di `CategoriesBLL` classe s `GetCategories` metodo.</span><span class="sxs-lookup"><span data-stu-id="52df3-187">Configure the ObjectDataSource so that it retrieves its data from the `CategoriesBLL` class s `GetCategories` method.</span></span> <span data-ttu-id="52df3-188">Impostare gli elenchi a discesa nell'aggiornamento, inserimento ed eliminare le schede su (nessuno).</span><span class="sxs-lookup"><span data-stu-id="52df3-188">Set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>


<span data-ttu-id="52df3-189">[![Recuperare i dati dal metodo GetCategories CategoriesBLL classe s](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image20.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="52df3-189">[![Retrieve Data from the CategoriesBLL Class s GetCategories Method](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image20.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image19.png)</span></span>

<span data-ttu-id="52df3-190">**Figura 7**: recupera i dati dal `CategoriesBLL` classe s `GetCategories` metodo ([fare clic per visualizzare l'immagine ingrandita](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="52df3-190">**Figure 7**: Retrieve Data from the `CategoriesBLL` Class s `GetCategories` Method ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image21.png))</span></span>


<span data-ttu-id="52df3-191">[![Impostare gli elenchi a discesa in UPDATE, INSERT ed eliminare le tabulazioni su (nessuno)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image23.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="52df3-191">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image23.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image22.png)</span></span>

<span data-ttu-id="52df3-192">**Figura 8**: impostare l'elenco a discesa sono elencati nelle schede DELETE, INSERT e UPDATE (nessuno) ([fare clic per visualizzare l'immagine ingrandita](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="52df3-192">**Figure 8**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image24.png))</span></span>


<span data-ttu-id="52df3-193">Dopo aver completato la procedura guidata ObjectDataSource, configurare DropDownList per visualizzare il `CategoryName` campo dei dati e di utilizzare il `CategoryID` campo come il `Value` per ogni `ListItem`.</span><span class="sxs-lookup"><span data-stu-id="52df3-193">After completing the ObjectDataSource wizard, configure the DropDownList to display the `CategoryName` data field and to use the `CategoryID` field as the `Value` for each `ListItem`.</span></span>

<span data-ttu-id="52df3-194">A questo punto, il markup dichiarativo s DropDownList e ObjectDataSource deve simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="52df3-194">At this point, the DropDownList and ObjectDataSource s declarative markup should similar to the following:</span></span>


[!code-aspx[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample3.aspx)]

<span data-ttu-id="52df3-195">Successivamente, trascinare un controllo GridView nella finestra di progettazione, posizionarlo sotto DropDownList.</span><span class="sxs-lookup"><span data-stu-id="52df3-195">Next, drag a GridView onto the Designer, placing it beneath the DropDownList.</span></span> <span data-ttu-id="52df3-196">Impostare i dispositivi di GridView `ID` a `ProductsByCategory` e dal suo smart tag, associarlo a un nuovo oggetto ObjectDataSource denominato `ProductsByCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="52df3-196">Set the GridView s `ID` to `ProductsByCategory` and, from its smart tag, bind it to a new ObjectDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="52df3-197">Configurare il `ProductsByCategoryDataSource` ObjectDataSource per utilizzare il `ProductsBLLWithSprocs` (classe), avendolo recuperare relativi dati tramite il `GetProductsByCategoryID(categoryID)` metodo.</span><span class="sxs-lookup"><span data-stu-id="52df3-197">Configure the `ProductsByCategoryDataSource` ObjectDataSource to use the `ProductsBLLWithSprocs` class, having it retrieve its data using the `GetProductsByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="52df3-198">Poiché questo GridView verrà utilizzato solo per visualizzare i dati, impostare gli elenchi a discesa nell'aggiornamento, inserimento, eliminare le tabulazioni su (nessuno) e fare clic su Avanti.</span><span class="sxs-lookup"><span data-stu-id="52df3-198">Since this GridView will only be used to display data, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) and click Next.</span></span>


<span data-ttu-id="52df3-199">[![Configurare ObjectDataSource per utilizzare la classe ProductsBLLWithSprocs](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image26.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="52df3-199">[![Configure the ObjectDataSource to Use the ProductsBLLWithSprocs Class](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image26.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image25.png)</span></span>

<span data-ttu-id="52df3-200">**Figura 9**: configurare ObjectDataSource per usare il `ProductsBLLWithSprocs` classe ([fare clic per visualizzare l'immagine ingrandita](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="52df3-200">**Figure 9**: Configure the ObjectDataSource to Use the `ProductsBLLWithSprocs` Class ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image27.png))</span></span>


<span data-ttu-id="52df3-201">[![Recuperare i dati dal metodo GetProductsByCategoryID(categoryID)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image29.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="52df3-201">[![Retrieve Data from the GetProductsByCategoryID(categoryID) Method](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image29.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image28.png)</span></span>

<span data-ttu-id="52df3-202">**Figura 10**: recupera i dati dal `GetProductsByCategoryID(categoryID)` metodo ([fare clic per visualizzare l'immagine ingrandita](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="52df3-202">**Figure 10**: Retrieve Data from the `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image30.png))</span></span>


<span data-ttu-id="52df3-203">Il metodo selezionato nella scheda Seleziona prevede un parametro, pertanto il passaggio finale della procedura guidata richiede Microsoft per l'origine di s parametri.</span><span class="sxs-lookup"><span data-stu-id="52df3-203">The method chosen in the SELECT tab expects a parameter, so the final step of the wizard prompts us for the parameter s source.</span></span> <span data-ttu-id="52df3-204">Impostare l'elenco di riepilogo a discesa Origine parametro al controllo e scegliere il `Categories` controllo dall'elenco a discesa ControlID.</span><span class="sxs-lookup"><span data-stu-id="52df3-204">Set the Parameter source drop-down list to Control and choose the `Categories` control from the ControlID drop-down list.</span></span> <span data-ttu-id="52df3-205">Fare clic su Fine per completare la procedura guidata.</span><span class="sxs-lookup"><span data-stu-id="52df3-205">Click Finish to complete the wizard.</span></span>


<span data-ttu-id="52df3-206">[![Utilizzare DropDownList categorie come origine di categoryID parametro](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image32.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="52df3-206">[![Use the Categories DropDownList as the Source of the categoryID Parameter](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image32.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image31.png)</span></span>

<span data-ttu-id="52df3-207">**Figura 11**: usare il `Categories` DropDownList come origine del `categoryID` parametro ([fare clic per visualizzare l'immagine ingrandita](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="52df3-207">**Figure 11**: Use the `Categories` DropDownList as the Source of the `categoryID` Parameter ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image33.png))</span></span>


<span data-ttu-id="52df3-208">Dopo avere completato la procedura guidata ObjectDataSource, Visual Studio aggiungerà BoundField e un CheckBoxField per ognuno dei campi dati di prodotto.</span><span class="sxs-lookup"><span data-stu-id="52df3-208">Upon completing the ObjectDataSource wizard, Visual Studio will add BoundFields and a CheckBoxField for each of the product data fields.</span></span> <span data-ttu-id="52df3-209">È possibile personalizzare questi campi in base alle esigenze.</span><span class="sxs-lookup"><span data-stu-id="52df3-209">Feel free to customize these fields as you see fit.</span></span>

<span data-ttu-id="52df3-210">Visitare la pagina tramite un browser.</span><span class="sxs-lookup"><span data-stu-id="52df3-210">Visit the page through a browser.</span></span> <span data-ttu-id="52df3-211">Quando si visita la pagina che è selezionata la categoria delle bevande e i prodotti corrispondenti elencati nella griglia.</span><span class="sxs-lookup"><span data-stu-id="52df3-211">When visiting the page the Beverages category is selected and the corresponding products listed in the grid.</span></span> <span data-ttu-id="52df3-212">Modifica dell'elenco di riepilogo a discesa a una categoria alternativa, come nella figura 12 illustra, provoca un postback e ricarica la griglia con i prodotti della categoria selezionata.</span><span class="sxs-lookup"><span data-stu-id="52df3-212">Changing the drop-down list to an alternative category, as Figure 12 shows, causes a postback and reloads the grid with the products of the newly selected category.</span></span>


<span data-ttu-id="52df3-213">[![Vengono visualizzati i prodotti nella categoria produrre](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image35.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="52df3-213">[![The Products in the Produce Category are Displayed](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image35.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image34.png)</span></span>

<span data-ttu-id="52df3-214">**Figura 12**: vengono visualizzati di prodotti nella categoria produrre ([fare clic per visualizzare l'immagine ingrandita](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="52df3-214">**Figure 12**: The Products in the Produce Category are Displayed ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image36.png))</span></span>


## <a name="step-5-wrapping-a-stored-procedure-s-statements-within-the-scope-of-a-transaction"></a><span data-ttu-id="52df3-215">Passaggio 5: Disposizione testo per le istruzioni s una Stored Procedure all'interno dell'ambito di una transazione</span><span class="sxs-lookup"><span data-stu-id="52df3-215">Step 5: Wrapping a Stored Procedure s Statements Within the Scope of a Transaction</span></span>

<span data-ttu-id="52df3-216">Nel [di wrapping delle modifiche del Database all'interno di una transazione](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-cs.md) esercitazione sono illustrate le tecniche per eseguire una serie di istruzioni di modifica dei database all'interno dell'ambito di una transazione.</span><span class="sxs-lookup"><span data-stu-id="52df3-216">In the [Wrapping Database Modifications within a Transaction](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-cs.md) tutorial we discussed techniques for performing a series of database modification statements within the scope of a transaction.</span></span> <span data-ttu-id="52df3-217">Tenere presente che le modifiche eseguite nel generico di una transazione, ovvero tutti esito positivo o negativo tutti, garantire l'atomicità.</span><span class="sxs-lookup"><span data-stu-id="52df3-217">Recall that the modifications performed under the umbrella of a transaction either all succeed or all fail, guaranteeing atomicity.</span></span> <span data-ttu-id="52df3-218">Tecniche per l'utilizzo di transazioni includono:</span><span class="sxs-lookup"><span data-stu-id="52df3-218">Techniques for using transactions include:</span></span>

- <span data-ttu-id="52df3-219">Utilizzando le classi di `System.Transactions` dello spazio dei nomi,</span><span class="sxs-lookup"><span data-stu-id="52df3-219">Using the classes in the `System.Transactions` namespace,</span></span>
- <span data-ttu-id="52df3-220">Con il livello di accesso ai dati di utilizzare le classi di ADO.NET come `SqlTransaction`, e</span><span class="sxs-lookup"><span data-stu-id="52df3-220">Having the Data Access Layer use ADO.NET classes like `SqlTransaction`, and</span></span>
- <span data-ttu-id="52df3-221">Aggiungere i comandi di transazione T-SQL direttamente all'interno di stored procedure</span><span class="sxs-lookup"><span data-stu-id="52df3-221">Adding the T-SQL transaction commands directly within the stored procedure</span></span>

<span data-ttu-id="52df3-222">Il *di wrapping delle modifiche del Database all'interno di una transazione* esercitazione utilizzate le classi ADO.NET in DAL.</span><span class="sxs-lookup"><span data-stu-id="52df3-222">The *Wrapping Database Modifications within a Transaction* tutorial used the ADO.NET classes in the DAL.</span></span> <span data-ttu-id="52df3-223">Il resto di questa esercitazione viene illustrato come gestire una transazione utilizzando i comandi T-SQL all'interno di una stored procedure.</span><span class="sxs-lookup"><span data-stu-id="52df3-223">The remainder of this tutorial examines how to manage a transaction using T-SQL commands from within a stored procedure.</span></span>

<span data-ttu-id="52df3-224">I tre comandi SQL chiavi per l'avvio manuale, eseguire il commit e rollback di una transazione sono `BEGIN TRANSACTION`, `COMMIT TRANSACTION`, e `ROLLBACK TRANSACTION`, rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="52df3-224">The three key SQL commands for manually starting, committing, and rolling back a transaction are `BEGIN TRANSACTION`, `COMMIT TRANSACTION`, and `ROLLBACK TRANSACTION`, respectively.</span></span> <span data-ttu-id="52df3-225">Come con l'approccio ADO.NET, quando si utilizzano transazioni all'interno di una stored procedure è necessario applicare il modello seguente:</span><span class="sxs-lookup"><span data-stu-id="52df3-225">Like with the ADO.NET approach, when using transactions from within a stored procedure we need to apply the following pattern:</span></span>

1. <span data-ttu-id="52df3-226">Indicare l'inizio di una transazione.</span><span class="sxs-lookup"><span data-stu-id="52df3-226">Indicate the start of a transaction.</span></span>
2. <span data-ttu-id="52df3-227">Eseguire le istruzioni SQL che costituiscono la transazione.</span><span class="sxs-lookup"><span data-stu-id="52df3-227">Execute the SQL statements that comprise the transaction.</span></span>
3. <span data-ttu-id="52df3-228">Se si verifica un errore in una delle istruzioni nel passaggio 2, il rollback della transazione</span><span class="sxs-lookup"><span data-stu-id="52df3-228">If there is an error in any one of the statements from Step 2, rollback the transaction</span></span>
4. <span data-ttu-id="52df3-229">Se tutte le istruzioni nel passaggio 2 viene completata senza errori, eseguire il commit della transazione.</span><span class="sxs-lookup"><span data-stu-id="52df3-229">If all of the statements from Step 2 complete without error, commit the transaction.</span></span>

<span data-ttu-id="52df3-230">Questo modello può essere implementato nella sintassi T-SQL utilizzando il modello seguente:</span><span class="sxs-lookup"><span data-stu-id="52df3-230">This pattern can be implemented in T-SQL syntax using the following template:</span></span>


[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample4.sql)]

<span data-ttu-id="52df3-231">Il modello di avvio definendo un `TRY...CATCH` blocco, un costrutto di nuovo a SQL Server 2005.</span><span class="sxs-lookup"><span data-stu-id="52df3-231">The template starts by defining a `TRY...CATCH` block, a construct new to SQL Server 2005.</span></span> <span data-ttu-id="52df3-232">Come con `try...catch` blocchi in c#, l'istruzione SQL `TRY...CATCH` blocco esegue le istruzioni nel `TRY` blocco.</span><span class="sxs-lookup"><span data-stu-id="52df3-232">Like with `try...catch` blocks in C#, the SQL `TRY...CATCH` block executes the statements in the `TRY` block.</span></span> <span data-ttu-id="52df3-233">Se qualsiasi istruzione genera un errore, il controllo viene trasferito a immediatamente il `CATCH` blocco.</span><span class="sxs-lookup"><span data-stu-id="52df3-233">If any statement raises an error, control is immediately transferred to the `CATCH` block.</span></span>

<span data-ttu-id="52df3-234">Se non sono presenti errori di esecuzione delle istruzioni SQL che composizione della transazione, il `COMMIT TRANSACTION` istruzione esegue il commit delle modifiche e completa la transazione.</span><span class="sxs-lookup"><span data-stu-id="52df3-234">If there are no errors executing the SQL statements that makeup the transaction, the `COMMIT TRANSACTION` statement commits the changes and completes the transaction.</span></span> <span data-ttu-id="52df3-235">Se, tuttavia, una delle istruzioni genera un errore, il `ROLLBACK TRANSACTION` nel `CATCH` blocco restituisce il database allo stato precedente l'inizio della transazione.</span><span class="sxs-lookup"><span data-stu-id="52df3-235">If, however, one of the statements results in an error, the `ROLLBACK TRANSACTION` in the `CATCH` block returns the database to its state prior to the start of the transaction.</span></span> <span data-ttu-id="52df3-236">La stored procedure genera anche un errore usando il [comando RAISERROR](https://msdn.microsoft.com/library/ms178592.aspx), causando un `SqlException` per essere generati nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="52df3-236">The stored procedure also raises an error using the [RAISERROR command](https://msdn.microsoft.com/library/ms178592.aspx), which causes a `SqlException` to be raised in the application.</span></span>

> [!NOTE]
> <span data-ttu-id="52df3-237">Poiché il `TRY...CATCH` blocco è una novità di SQL Server 2005, il modello riportato sopra non funziona se si utilizzano versioni precedenti di Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="52df3-237">Since the `TRY...CATCH` block is new to SQL Server 2005, the above template will not work if you are using older versions of Microsoft SQL Server.</span></span> <span data-ttu-id="52df3-238">Se non si utilizza SQL Server 2005, consultare [gestione delle transazioni in Stored procedure di SQL Server](http://www.4guysfromrolla.com/webtech/080305-1.shtml) per un modello che funzionerà con altre versioni di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="52df3-238">If you are not using SQL Server 2005, consult [Managing Transactions in SQL Server Stored Procedures](http://www.4guysfromrolla.com/webtech/080305-1.shtml) for a template that will work with other versions of SQL Server.</span></span>


<span data-ttu-id="52df3-239">Consente di esaminare un esempio concreto s.</span><span class="sxs-lookup"><span data-stu-id="52df3-239">Let s look at a concrete example.</span></span> <span data-ttu-id="52df3-240">Esiste un vincolo di chiave esterno tra la `Categories` e `Products` tabelle, vale a dire che ogni `CategoryID` campo il `Products` tabella deve essere associato a un `CategoryID` valore il `Categories` tabella.</span><span class="sxs-lookup"><span data-stu-id="52df3-240">A foreign key constraint exists between the `Categories` and `Products` tables, meaning that each `CategoryID` field in the `Products` table must map to a `CategoryID` value in the `Categories` table.</span></span> <span data-ttu-id="52df3-241">Qualsiasi operazione che violi il vincolo, ad esempio il tentativo di eliminare una categoria di cui è associati i prodotti, comporta una violazione di vincolo di chiave esterna.</span><span class="sxs-lookup"><span data-stu-id="52df3-241">Any action that would violate this constraint, such as attempting to delete a category that has associated products, results in a foreign key constraint violation.</span></span> <span data-ttu-id="52df3-242">Per effettuare questa verifica, rivedere l'esempio di aggiornamento ed eliminazione di dati binari esistenti nella sezione Utilizzo di dati binari (`~/BinaryData/UpdatingAndDeleting.aspx`).</span><span class="sxs-lookup"><span data-stu-id="52df3-242">To verify this, revisit the Updating and Deleting Existing Binary Data example in the Working with Binary Data section (`~/BinaryData/UpdatingAndDeleting.aspx`).</span></span> <span data-ttu-id="52df3-243">Questa pagina elenca ogni categoria nel sistema insieme ai pulsanti Modifica e l'eliminazione (vedere Figura 13), ma se si tenta di eliminare una categoria di prodotti, ad esempio bevande - associata l'eliminazione ha esito negativo a causa di una violazione di vincolo di chiave esterna (vedere Figura 14).</span><span class="sxs-lookup"><span data-stu-id="52df3-243">This page lists each category in the system along with Edit and Delete buttons (see Figure 13), but if you attempt to delete a category that has associated products - such as Beverages - the delete fails due to a foreign key constraint violation (see Figure 14).</span></span>


<span data-ttu-id="52df3-244">[![Ogni categoria viene visualizzata in un controllo GridView con i pulsanti Elimina e modifica](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image38.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="52df3-244">[![Each Category is Displayed in a GridView with Edit and Delete Buttons](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image38.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image37.png)</span></span>

<span data-ttu-id="52df3-245">**Figura 13**: ogni categoria viene visualizzata in un controllo GridView con i pulsanti Elimina e modifica ([fare clic per visualizzare l'immagine ingrandita](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="52df3-245">**Figure 13**: Each Category is Displayed in a GridView with Edit and Delete Buttons ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image39.png))</span></span>


<span data-ttu-id="52df3-246">[![Non è possibile eliminare una categoria con i prodotti esistenti](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image41.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="52df3-246">[![You Cannot Delete a Category that has Existing Products](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image41.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image40.png)</span></span>

<span data-ttu-id="52df3-247">**Figura 14**: non è possibile eliminare una categoria con i prodotti esistenti ([fare clic per visualizzare l'immagine ingrandita](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="52df3-247">**Figure 14**: You Cannot Delete a Category that has Existing Products ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image42.png))</span></span>


<span data-ttu-id="52df3-248">Si supponga, tuttavia, che si desidera consentire le categorie da eliminare indipendentemente dal fatto che essi prodotti associati.</span><span class="sxs-lookup"><span data-stu-id="52df3-248">Imagine, though, that we want to allow categories to be deleted regardless of whether they have associated products.</span></span> <span data-ttu-id="52df3-249">Eliminare una categoria di prodotti, si supponga che si desidera eliminare anche i relativi prodotti esistenti (anche se un'altra opzione, è possibile impostare semplicemente i propri prodotti `CategoryID` valori `NULL`).</span><span class="sxs-lookup"><span data-stu-id="52df3-249">Should a category with products be deleted, imagine that we want to also delete its existing products (although another option would be to simply set its products `CategoryID` values to `NULL`).</span></span> <span data-ttu-id="52df3-250">Questa funzionalità può essere implementata tramite le regole cascade del vincolo di chiave esterna.</span><span class="sxs-lookup"><span data-stu-id="52df3-250">This functionality could be implemented through the cascade rules of the foreign key constraint.</span></span> <span data-ttu-id="52df3-251">In alternativa, è possibile creare una stored procedure che accetta un `@CategoryID` parametro di input e, quando richiamata, Elimina in modo esplicito tutti i prodotti associati e quindi la categoria specificata.</span><span class="sxs-lookup"><span data-stu-id="52df3-251">Alternatively, we could create a stored procedure that accepts a `@CategoryID` input parameter and, when invoked, explicitly deletes all of the associated products and then the specified category.</span></span>

<span data-ttu-id="52df3-252">Il primo tentativo di una stored procedure potrebbe essere simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="52df3-252">Our first attempt at such a stored procedure might look like the following:</span></span>


[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample5.sql)]

<span data-ttu-id="52df3-253">Mentre la categoria di prodotti associati verranno eliminati definitivamente, non esegue questa operazione in generico di una transazione.</span><span class="sxs-lookup"><span data-stu-id="52df3-253">While this will definitely delete the associated products and category, it does not do so under the umbrella of a transaction.</span></span> <span data-ttu-id="52df3-254">Si supponga che vi sia un vincolo di chiave esterno nel `Categories` che potrebbe impedire l'eliminazione di un determinato `@CategoryID` valore.</span><span class="sxs-lookup"><span data-stu-id="52df3-254">Imagine that there is some other foreign key constraint on `Categories` that would prohibit the deletion of a particular `@CategoryID` value.</span></span> <span data-ttu-id="52df3-255">Il problema è che in questo caso tutti i prodotti verranno eliminati prima di tentare di eliminare la categoria.</span><span class="sxs-lookup"><span data-stu-id="52df3-255">The problem is that in such a case all of the products will be deleted before we attempt to delete the category.</span></span> <span data-ttu-id="52df3-256">Il risultato è che per una categoria, questa stored procedure potrebbe rimuovere tutti i prodotti mentre la categoria è rimasta poiché ancora dispone di record correlati in un'altra tabella.</span><span class="sxs-lookup"><span data-stu-id="52df3-256">The net result is that for such a category, this stored procedure would remove all of its products while the category remained since it still has related records in some other table.</span></span>

<span data-ttu-id="52df3-257">Se la stored procedure sono state mandato a capo all'interno dell'ambito di una transazione, tuttavia, le operazioni di eliminazione per il `Products` tabella sarebbe possibile eseguire il rollback in caso di un'operazione di eliminazione non riuscita `Categories`.</span><span class="sxs-lookup"><span data-stu-id="52df3-257">If the stored procedure were wrapped within the scope of a transaction, however, the deletes to the `Products` table would be rolled back in the face of a failed delete on `Categories`.</span></span> <span data-ttu-id="52df3-258">Lo script di stored procedure seguente utilizza una transazione per garantire l'atomicità tra i due `DELETE` istruzioni:</span><span class="sxs-lookup"><span data-stu-id="52df3-258">The following stored procedure script uses a transaction to assure atomicity between the two `DELETE` statements:</span></span>


[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample6.sql)]

<span data-ttu-id="52df3-259">È opportuno aggiungere il `Categories_Delete` stored procedure per il database Northwind.</span><span class="sxs-lookup"><span data-stu-id="52df3-259">Take a moment to add the `Categories_Delete` stored procedure to the Northwind database.</span></span> <span data-ttu-id="52df3-260">Fare riferimento al passaggio 1 per istruzioni sull'aggiunta di stored procedure a un database.</span><span class="sxs-lookup"><span data-stu-id="52df3-260">Refer back to Step 1 for instructions on adding stored procedures to a database.</span></span>

## <a name="step-6-updating-thecategoriestableadapter"></a><span data-ttu-id="52df3-261">Passaggio 6: Aggiornamento di`CategoriesTableAdapter`</span><span class="sxs-lookup"><span data-stu-id="52df3-261">Step 6: Updating the`CategoriesTableAdapter`</span></span>

<span data-ttu-id="52df3-262">Mentre si va aggiunto il `Categories_Delete` stored procedure DAL database, è attualmente configurata per utilizzare istruzioni SQL ad hoc per eseguire l'eliminazione.</span><span class="sxs-lookup"><span data-stu-id="52df3-262">While we ve added the `Categories_Delete` stored procedure to the database, the DAL is currently configured to use ad-hoc SQL statements to perform the delete.</span></span> <span data-ttu-id="52df3-263">È necessario aggiornare il `CategoriesTableAdapter` e indicare l'utilizzo di `Categories_Delete` stored procedure di invece.</span><span class="sxs-lookup"><span data-stu-id="52df3-263">We need to update the `CategoriesTableAdapter` and instruct it to use the `Categories_Delete` stored procedure instead.</span></span>

> [!NOTE]
> <span data-ttu-id="52df3-264">In precedenza in questa esercitazione si lavora con la `NorthwindWithSprocs` set di dati.</span><span class="sxs-lookup"><span data-stu-id="52df3-264">Earlier in this tutorial we were working with the `NorthwindWithSprocs` DataSet.</span></span> <span data-ttu-id="52df3-265">Ma tale set di dati include solo una singola entità, `ProductsDataTable`, è necessario utilizzare le categorie.</span><span class="sxs-lookup"><span data-stu-id="52df3-265">But that DataSet only has a single entity, `ProductsDataTable`, and we need to work with categories.</span></span> <span data-ttu-id="52df3-266">Pertanto, per il resto di questa esercitazione, quando parla di riferimento a m Data Access Layer I il `Northwind` set di dati, quello creato nel primo il [la creazione di un livello di accesso ai dati](../introduction/creating-a-data-access-layer-cs.md) esercitazione.</span><span class="sxs-lookup"><span data-stu-id="52df3-266">Therefore, for the remainder of this tutorial when I talk about the Data Access Layer I m referring to the `Northwind` DataSet, the one that we first created in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-cs.md) tutorial.</span></span>


<span data-ttu-id="52df3-267">Aprire il Northwind DataSet, selezionare il `CategoriesTableAdapter`e passare alla finestra Proprietà.</span><span class="sxs-lookup"><span data-stu-id="52df3-267">Open the Northwind DataSet, select the `CategoriesTableAdapter`, and go to the Properties window.</span></span> <span data-ttu-id="52df3-268">Gli elenchi di finestra delle proprietà di `InsertCommand`, `UpdateCommand`, `DeleteCommand`, e `SelectCommand` utilizzata dal TableAdapter, nonché informazioni relative a nome e connessione.</span><span class="sxs-lookup"><span data-stu-id="52df3-268">The Properties window lists the `InsertCommand`, `UpdateCommand`, `DeleteCommand`, and `SelectCommand` used by the TableAdapter, as well as its name and connection information.</span></span> <span data-ttu-id="52df3-269">Espandere il `DeleteCommand` proprietà per visualizzarne i dettagli.</span><span class="sxs-lookup"><span data-stu-id="52df3-269">Expand the `DeleteCommand` property to see its details.</span></span> <span data-ttu-id="52df3-270">Come illustrato nella figura 15, il `DeleteCommand` s `ComamndType` è impostata su testo, che indica di inviare il testo `CommandText` proprietà come query SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="52df3-270">As Figure 15 shows, the `DeleteCommand` s `ComamndType` property is set to Text, which instructs it to send the text in the `CommandText` property as an ad-hoc SQL query.</span></span>


![Selezionare il CategoriesTableAdapter nella finestra di progettazione per visualizzarne le proprietà nella finestra proprietà](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image43.png)

<span data-ttu-id="52df3-272">**Figura 15**: selezionare il `CategoriesTableAdapter` nella finestra di progettazione per visualizzarne le proprietà nella finestra proprietà</span><span class="sxs-lookup"><span data-stu-id="52df3-272">**Figure 15**: Select the `CategoriesTableAdapter` in the Designer to View Its Properties in the Properties Window</span></span>


<span data-ttu-id="52df3-273">Per modificare queste impostazioni, selezionare il testo (DeleteCommand) nella finestra proprietà e scegliere (nuova) dall'elenco a discesa.</span><span class="sxs-lookup"><span data-stu-id="52df3-273">To change these settings, select the (DeleteCommand) text in the Properties window and choose (New) from the drop-down list.</span></span> <span data-ttu-id="52df3-274">Ciò consente di correggere le impostazioni per il `CommandText`, `CommandType`, e `Parameters` proprietà.</span><span class="sxs-lookup"><span data-stu-id="52df3-274">This will clear out the settings for the `CommandText`, `CommandType`, and `Parameters` properties.</span></span> <span data-ttu-id="52df3-275">Successivamente, impostare il `CommandType` proprietà `StoredProcedure` e quindi digitare il nome di stored procedure per la `CommandText` (`dbo.Categories_Delete`).</span><span class="sxs-lookup"><span data-stu-id="52df3-275">Next, set the `CommandType` property to `StoredProcedure` and then type in the name of the stored procedure for the `CommandText` (`dbo.Categories_Delete`).</span></span> <span data-ttu-id="52df3-276">Se è assicurarsi di immettere le proprietà nell'ordine seguente: prima di `CommandType` e quindi la `CommandText` -Visual Studio popola automaticamente la raccolta di parametri.</span><span class="sxs-lookup"><span data-stu-id="52df3-276">If you make sure to enter the properties in this order - first the `CommandType` and then the `CommandText` - Visual Studio will automatically populate the Parameters collection.</span></span> <span data-ttu-id="52df3-277">Se non si immette queste proprietà in questo ordine, è necessario aggiungere manualmente i parametri tramite l'Editor della raccolta Parameters.</span><span class="sxs-lookup"><span data-stu-id="52df3-277">If you do not enter these properties in this order, you will have to manually add the parameters through the Parameters Collection Editor.</span></span> <span data-ttu-id="52df3-278">In entrambi i casi, è consigliabile fare clic sui puntini di sospensione nella proprietà di parametri per visualizzare Editor raccolta di parametri per verificare che sono state apportate le modifiche alle impostazioni di parametro corretti (vedere Figura 16) s.</span><span class="sxs-lookup"><span data-stu-id="52df3-278">In either case, it s prudent to click on the ellipses in the Parameters property to bring up the Parameters Collection Editor to verify that the correct parameter settings changes have been made (see Figure 16).</span></span> <span data-ttu-id="52df3-279">Se non è possibile visualizzare tutti i parametri nella finestra di dialogo, aggiungere il `@CategoryID` parametro manualmente (non è necessario aggiungere il `@RETURN_VALUE` parametro).</span><span class="sxs-lookup"><span data-stu-id="52df3-279">If you do not see any parameters in the dialog box, add the `@CategoryID` parameter manually (you do not need to add the `@RETURN_VALUE` parameter).</span></span>


![Verificare che le impostazioni di parametri siano corretti](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image44.png)

<span data-ttu-id="52df3-281">**Figura 16**: verificare che le impostazioni di parametri siano corretti</span><span class="sxs-lookup"><span data-stu-id="52df3-281">**Figure 16**: Ensure That the Parameters Settings are Correct</span></span>


<span data-ttu-id="52df3-282">Una volta DAL è stato aggiornato, l'eliminazione di una categoria verrà eliminare tutti i prodotti associati automaticamente e sensi generico di una transazione.</span><span class="sxs-lookup"><span data-stu-id="52df3-282">Once the DAL has been updated, deleting a category will automatically delete all of its associated products and do so under the umbrella of a transaction.</span></span> <span data-ttu-id="52df3-283">Per verificarlo, tornare alla pagina di aggiornamento ed eliminazione di dati binari esistente e fare clic sul pulsante di eliminazione per una delle categorie.</span><span class="sxs-lookup"><span data-stu-id="52df3-283">To verify this, return to the Updating and Deleting Existing Binary Data page and click the Delete button for one of the categories.</span></span> <span data-ttu-id="52df3-284">Con un solo clic del mouse, la categoria e tutti i prodotti associati verranno eliminati.</span><span class="sxs-lookup"><span data-stu-id="52df3-284">With one single click of the mouse, the category and all of its associated products will be deleted.</span></span>

> [!NOTE]
> <span data-ttu-id="52df3-285">Prima di testare il `Categories_Delete` stored procedure, che verrà eliminato il numero di prodotti insieme alla categoria selezionata, potrebbe essere opportuno creare una copia di backup del database.</span><span class="sxs-lookup"><span data-stu-id="52df3-285">Before testing the `Categories_Delete` stored procedure, which will delete a number of products along with the selected category, it might be prudent to make a backup copy of your database.</span></span> <span data-ttu-id="52df3-286">Se si utilizza il `NORTHWND.MDF` database `App_Data`, semplicemente chiudere Visual Studio e copiare i file MDF e LDF in `App_Data` in un'altra cartella.</span><span class="sxs-lookup"><span data-stu-id="52df3-286">If you are using the `NORTHWND.MDF` database in `App_Data`, simply close Visual Studio and copy the MDF and LDF files in `App_Data` to some other folder.</span></span> <span data-ttu-id="52df3-287">Dopo avere testato le funzionalità, è possibile ripristinare il database, chiudere Visual Studio e sostituendo corrente MDF e LDF file `App_Data` con le copie di backup.</span><span class="sxs-lookup"><span data-stu-id="52df3-287">After testing the functionality, you can restore the database by closing Visual Studio and replacing the current MDF and LDF files in `App_Data` with the backup copies.</span></span>


## <a name="summary"></a><span data-ttu-id="52df3-288">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="52df3-288">Summary</span></span>

<span data-ttu-id="52df3-289">Durante la configurazione guidata TableAdapter s genererà automaticamente le stored procedure per noi, vi sono casi quando si potrebbe essere già dispongono di tali stored procedure create o desidera crearli manualmente oppure con altri strumenti invece.</span><span class="sxs-lookup"><span data-stu-id="52df3-289">While the TableAdapter s wizard will automatically generate stored procedures for us, there are times when we might already have such stored procedures created or want to create them manually or with other tools instead.</span></span> <span data-ttu-id="52df3-290">Per gestire tali scenari, TableAdapter può anche essere configurato per puntare a una stored procedure esistente.</span><span class="sxs-lookup"><span data-stu-id="52df3-290">To accommodate such scenarios, the TableAdapter can also be configured to point to an existing stored procedure.</span></span> <span data-ttu-id="52df3-291">In questa esercitazione è stato esaminato come aggiungere manualmente le stored procedure a un database tramite l'ambiente di Visual Studio e come associare i metodi s TableAdapter per queste stored procedure.</span><span class="sxs-lookup"><span data-stu-id="52df3-291">In this tutorial we looked at how to manually add stored procedures to a database through the Visual Studio environment and how to wire the TableAdapter s methods to these stored procedures.</span></span> <span data-ttu-id="52df3-292">È inoltre esaminato il modello di script utilizzato per avviare, eseguire il commit e rollback delle transazioni all'interno di una stored procedure e i comandi T-SQL.</span><span class="sxs-lookup"><span data-stu-id="52df3-292">We also examined the T-SQL commands and script pattern used for starting, committing, and rolling back transactions from within a stored procedure.</span></span>

<span data-ttu-id="52df3-293">Buona programmazione!</span><span class="sxs-lookup"><span data-stu-id="52df3-293">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="52df3-294">Informazioni sull'autore</span><span class="sxs-lookup"><span data-stu-id="52df3-294">About the Author</span></span>

<span data-ttu-id="52df3-295">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), l'autore di sette libri e fondatore di [4GuysFromRolla](http://www.4guysfromrolla.com), ha lavorato con tecnologie Web di Microsoft dal 1998.</span><span class="sxs-lookup"><span data-stu-id="52df3-295">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="52df3-296">Scott funziona come un consulente trainer e writer.</span><span class="sxs-lookup"><span data-stu-id="52df3-296">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="52df3-297">Il suo ultimo libro è [ *SAM insegna manualmente ASP.NET 2.0 nelle 24 ore*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="52df3-297">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="52df3-298">Egli può essere raggiunto al [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) o sul suo blog, cui è reperibile in [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="52df3-298">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="52df3-299">Ringraziamenti speciali</span><span class="sxs-lookup"><span data-stu-id="52df3-299">Special Thanks To</span></span>

<span data-ttu-id="52df3-300">Questa serie di esercitazioni è stata esaminata da diversi validi revisori.</span><span class="sxs-lookup"><span data-stu-id="52df3-300">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="52df3-301">Lead revisori per questa esercitazione sono stati Geisenow Hilton S ren Lauritsen Bonaldi e Teresa Murphy.</span><span class="sxs-lookup"><span data-stu-id="52df3-301">Lead reviewers for this tutorial were Hilton Geisenow, S ren Jacob Lauritsen, and Teresa Murphy.</span></span> <span data-ttu-id="52df3-302">Se si è interessati my prossimi articoli MSDN?</span><span class="sxs-lookup"><span data-stu-id="52df3-302">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="52df3-303">In caso affermativo, Inviami una riga alla [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="52df3-303">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="52df3-304">[Precedente](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md)
> [Successivo](updating-the-tableadapter-to-use-joins-cs.md)</span><span class="sxs-lookup"><span data-stu-id="52df3-304">[Previous](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md)
[Next](updating-the-tableadapter-to-use-joins-cs.md)</span></span>
