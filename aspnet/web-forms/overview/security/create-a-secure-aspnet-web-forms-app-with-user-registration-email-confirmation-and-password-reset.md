---
uid: web-forms/overview/security/create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset
title: Creare un'app Web Form ASP.NET protetta con la registrazione utente, inviare tramite posta elettronica di conferma e reimpostazione della password (c#) | Documenti Microsoft
author: Erikre
description: In questa esercitazione viene illustrato come compilare un'app Web Form ASP.NET con la registrazione utente, conferma tramite posta elettronica e password reimpostata utilizzando il membro di identità di ASP.NET...
ms.author: aspnetcontent
manager: wpickett
ms.date: 10/02/2014
ms.topic: article
ms.assetid: 0a8d6044-5fab-4213-82d6-5618d5601358
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/security/create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset
msc.type: authoredcontent
ms.openlocfilehash: 1dc7ace69473b45432fd942b9cf1ba32332cb707
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/06/2018
ms.locfileid: "30892699"
---
<a name="create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset-c"></a><span data-ttu-id="9c4bf-103">Creare un'app Web Form ASP.NET protetta con la registrazione utente, inviare tramite posta elettronica di conferma e reimpostazione della password (c#)</span><span class="sxs-lookup"><span data-stu-id="9c4bf-103">Create a secure ASP.NET Web Forms app with user registration, email confirmation and password reset (C#)</span></span>
====================
<span data-ttu-id="9c4bf-104">da [Erik Reitan](https://github.com/Erikre)</span><span class="sxs-lookup"><span data-stu-id="9c4bf-104">by [Erik Reitan](https://github.com/Erikre)</span></span>

> <span data-ttu-id="9c4bf-105">In questa esercitazione viene illustrato come compilare un'app Web Form ASP.NET con la registrazione utente, conferma tramite posta elettronica e password reimpostata utilizzando il sistema di appartenenze di ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-105">This tutorial shows you how to build an ASP.NET Web Forms app with user registration, email confirmation and password reset using the ASP.NET Identity membership system.</span></span> <span data-ttu-id="9c4bf-106">In questa esercitazione è basata sul di Rick Anderson [esercitazione MVC](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).</span><span class="sxs-lookup"><span data-stu-id="9c4bf-106">This tutorial was based on Rick Anderson's [MVC tutorial](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).</span></span>


## <a name="introduction"></a><span data-ttu-id="9c4bf-107">Introduzione</span><span class="sxs-lookup"><span data-stu-id="9c4bf-107">Introduction</span></span>

<span data-ttu-id="9c4bf-108">In questa esercitazione modo semplificato i passaggi necessari per creare un'applicazione Web Form ASP.NET utilizzando Visual Studio e ASP.NET 4.5 per creare un'app Web Form protetta con la registrazione utente, inviare tramite posta elettronica di conferma e reimpostazione della password.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-108">This tutorial guides you through the steps required to create an ASP.NET Web Forms application using Visual Studio and ASP.NET 4.5 to create a secure Web Forms app with user registration, email confirmation and password reset.</span></span>

### <a name="tutorial-tasks-and-information"></a><span data-ttu-id="9c4bf-109">Attività dell'esercitazione e le informazioni:</span><span class="sxs-lookup"><span data-stu-id="9c4bf-109">Tutorial Tasks and Information:</span></span>

- [<span data-ttu-id="9c4bf-110">Creare un Web ASP.NET form app</span><span class="sxs-lookup"><span data-stu-id="9c4bf-110">Create an ASP.NET Web Forms app</span></span>](#createWebForms)
- [<span data-ttu-id="9c4bf-111">Collegare SendGrid</span><span class="sxs-lookup"><span data-stu-id="9c4bf-111">Hook Up SendGrid</span></span>](#SG)
- [<span data-ttu-id="9c4bf-112">Richiedi conferma tramite posta elettronica prima dell'accesso In</span><span class="sxs-lookup"><span data-stu-id="9c4bf-112">Require Email Confirmation Before Log In</span></span>](#require)
- [<span data-ttu-id="9c4bf-113">Reimpostazione e il recupero della password</span><span class="sxs-lookup"><span data-stu-id="9c4bf-113">Password Recovery and Reset</span></span>](#reset)
- [<span data-ttu-id="9c4bf-114">Inviare di nuovo il collegamento di conferma tramite posta elettronica</span><span class="sxs-lookup"><span data-stu-id="9c4bf-114">Resend Email Confirmation Link</span></span>](#rsend)
- [<span data-ttu-id="9c4bf-115">Risoluzione dei problemi relativi all'App</span><span class="sxs-lookup"><span data-stu-id="9c4bf-115">Troubleshooting the App</span></span>](#dbg)
- [<span data-ttu-id="9c4bf-116">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="9c4bf-116">Additional Resources</span></span>](#addRes)

<a id="createWebForms"></a>
## <a name="create-an-aspnet-web-forms-app"></a><span data-ttu-id="9c4bf-117">Creare un'App di ASP.NET Web Form</span><span class="sxs-lookup"><span data-stu-id="9c4bf-117">Create an ASP.NET Web Forms App</span></span>

<span data-ttu-id="9c4bf-118">Avviare l'installazione ed eseguendo [Visual Studio Express 2013 per Web](https://go.microsoft.com/fwlink/?LinkId=299058) o [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span><span class="sxs-lookup"><span data-stu-id="9c4bf-118">Start by installing and running [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span></span> <span data-ttu-id="9c4bf-119">Installare [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) o versione successiva anche.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-119">Install [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) or higher as well.</span></span>

> [!NOTE]
> <span data-ttu-id="9c4bf-120">Avviso: È necessario installare [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) o versione successiva per completare questa esercitazione.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-120">Warning: You must install [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) or higher to complete this tutorial.</span></span>


1. <span data-ttu-id="9c4bf-121">Creare un nuovo progetto (**File**  - &gt; **nuovo progetto**) e selezionare il **applicazione Web ASP.NET** modello e la versione più recente di .NET Framework versione dal **nuovo progetto** la finestra di dialogo.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-121">Create a new project (**File** -&gt; **New Project**) and select the **ASP.NET Web Application** template and the latest .NET Framework version from the **New Project** dialog box.</span></span>
2. <span data-ttu-id="9c4bf-122">Dal **nuovo progetto ASP.NET** la finestra di dialogo, seleziona il **Web Form** modello.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-122">From the **New ASP.NET Project** dialog box, select the **Web Forms** template.</span></span> <span data-ttu-id="9c4bf-123">Lasciare l'autenticazione predefinita come **singoli account utente di**.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-123">Leave the default authentication as **Individual User Accounts**.</span></span> <span data-ttu-id="9c4bf-124">Se si desidera ospitare l'applicazione in Azure, lasciare il **Host nel cloud** la casella di controllo.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-124">If you'd like to host the app in Azure, leave the **Host in the cloud** check box checked.</span></span>   
 <span data-ttu-id="9c4bf-125">Quindi, fare clic su **OK** per creare il nuovo progetto.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-125">Then, click **OK** to create the new project.</span></span>  
    <span data-ttu-id="9c4bf-126">![Finestra di dialogo Nuovo progetto ASP.NET](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="9c4bf-126">![New ASP.NET Project dialog box](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image1.png)</span></span>
3. <span data-ttu-id="9c4bf-127">Abilitare Secure Sockets Layer (SSL) per il progetto.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-127">Enable Secure Sockets Layer (SSL) for the project.</span></span> <span data-ttu-id="9c4bf-128">Seguire le istruzioni disponibili nel **abilita SSL per il progetto** sezione la [Introduzione a una serie di esercitazioni di Web Form](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms).</span><span class="sxs-lookup"><span data-stu-id="9c4bf-128">Follow the steps available in the **Enable SSL for the Project** section of the [Getting Started with Web Forms tutorial series](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms).</span></span>
4. <span data-ttu-id="9c4bf-129">Eseguire l'app, fare clic su di **registrare** collegare e registrare un nuovo utente.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-129">Run the app, click the **Register** link and register a new user.</span></span> <span data-ttu-id="9c4bf-130">A questo punto, la convalida sola nel messaggio di posta elettronica è basata sul [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) attributo per verificare l'indirizzo di posta elettronica sia corretto.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-130">At this point, the only validation on the email is based on the [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) attribute to ensure the email address is well-formed.</span></span> <span data-ttu-id="9c4bf-131">Si modificherà il codice per aggiungere una conferma tramite posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-131">You will modify the code to add email confirmation.</span></span> <span data-ttu-id="9c4bf-132">Chiudere la finestra del browser.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-132">Close the browser window.</span></span>
5. <span data-ttu-id="9c4bf-133">In **Esplora Server** di Visual Studio (**vista**  - &gt; **Esplora Server**), passare a **Connections\ dati DefaultConnection\Tables\AspNetUsers**fare clic destro del mouse e selezionare **Apri definizione tabella**.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-133">In **Server Explorer** of Visual Studio (**View** -&gt; **Server Explorer**), navigate to **Data Connections\DefaultConnection\Tables\AspNetUsers**, right click and select **Open table definition**.</span></span> 

    <span data-ttu-id="9c4bf-134">La figura seguente mostra il `AspNetUsers` schema della tabella:</span><span class="sxs-lookup"><span data-stu-id="9c4bf-134">The following image shows the `AspNetUsers` table schema:</span></span>

    ![Schema della tabella AspNetUsers](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image2.png)
6. <span data-ttu-id="9c4bf-136">In **Esplora Server**, fare clic su di **AspNetUsers** tabella e selezionare **Mostra dati tabella**.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-136">In **Server Explorer**, right-click on the **AspNetUsers** table and select **Show Table Data**.</span></span>  
  
    ![Dati della tabella AspNetUsers](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image3.png)  
 <span data-ttu-id="9c4bf-138">A questo punto non è stata confermata la posta elettronica per l'utente registrato.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-138">At this point the email for the registered user has not been confirmed.</span></span>
7. <span data-ttu-id="9c4bf-139">Fare clic sulla riga e selezionare Elimina per eliminare l'utente.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-139">Click on the row and select delete to delete the user.</span></span> <span data-ttu-id="9c4bf-140">Si sarà aggiungere di nuovo questo messaggio di posta elettronica nel passaggio successivo e inviare un messaggio di conferma per l'indirizzo di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-140">You'll add this email again in the next step and send a confirmation message to the email address.</span></span>

## <a name="email-confirmation"></a><span data-ttu-id="9c4bf-141">Conferma tramite posta elettronica</span><span class="sxs-lookup"><span data-stu-id="9c4bf-141">Email Confirmation</span></span>

<span data-ttu-id="9c4bf-142">È consigliabile verificare il messaggio di posta elettronica durante la registrazione di un nuovo utente per verificare che non rappresentano un altro utente (vale a dire, è ancora stato registrato con un altro messaggio di posta elettronica).</span><span class="sxs-lookup"><span data-stu-id="9c4bf-142">It's a best practice to confirm the email during the registration of a new user to verify they are not impersonating someone else (that is, they haven't registered with someone else's email).</span></span> <span data-ttu-id="9c4bf-143">Si supponga di un forum di discussione, si desidera impedire `"bob@cpandl.com"` tramite la registrazione come `"joe@contoso.com"`.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-143">Suppose you had a discussion forum, you would want to prevent `"bob@cpandl.com"` from registering as `"joe@contoso.com"`.</span></span> <span data-ttu-id="9c4bf-144">Senza conferma tramite posta elettronica, `"joe@contoso.com"` Impossibile ricevere la posta elettronica indesiderato dall'app.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-144">Without email confirmation, `"joe@contoso.com"` could get unwanted email from your app.</span></span> <span data-ttu-id="9c4bf-145">Si supponga che Bob accidentalmente registrato come `"bib@cpandl.com"` e non veniva notare, ha non sarebbe in grado di utilizzare il recupero della password, perché l'app non ha il suo messaggio di posta elettronica corretto.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-145">Suppose Bob accidently registered as `"bib@cpandl.com"` and hadn't noticed it, he wouldn't be able to use password recovery because the app doesn't have his correct email.</span></span> <span data-ttu-id="9c4bf-146">Conferma tramite posta elettronica fornisce a livello di protezione limitato da BOT e non offre protezione da spamming determinato.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-146">Email confirmation provides only limited protection from bots and doesn't provide protection from determined spammers.</span></span>

<span data-ttu-id="9c4bf-147">In genere si desidera impedire la registrazione di tutti i dati per il sito Web prima di avere confermate da un messaggio di posta elettronica, un messaggio SMS o un altro meccanismo di nuovi utenti.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-147">You generally want to prevent new users from posting any data to your website before they have been confirmed by either email, an SMS text message or another mechanism.</span></span> <span data-ttu-id="9c4bf-148">Nelle sezioni riportate di seguito, si consentirà conferma tramite posta elettronica e modificare il codice per impedire l'accesso fino a quando non è stato confermato l'accesso alla posta elettronica di utenti appena registrati.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-148">In the sections below, we will enable email confirmation and modify the code to prevent newly registered users from logging in until their email has been confirmed.</span></span> <span data-ttu-id="9c4bf-149">In questa esercitazione, si userà il servizio di posta elettronica SendGrid.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-149">You'll use the email service SendGrid in this tutorial.</span></span>

<a id="SG"></a>
## <a name="hook-up-sendgrid"></a><span data-ttu-id="9c4bf-150">Collegare SendGrid</span><span class="sxs-lookup"><span data-stu-id="9c4bf-150">Hook up SendGrid</span></span>

<span data-ttu-id="9c4bf-151">Sebbene questa esercitazione viene illustrato solo come aggiungere una notifica tramite posta elettronica tramite [SendGrid](http://sendgrid.com/), è possibile inviare tramite posta elettronica tramite SMTP e altri meccanismi (vedere [risorse aggiuntive](#addRes)).</span><span class="sxs-lookup"><span data-stu-id="9c4bf-151">Although this tutorial only shows how to add email notification through [SendGrid](http://sendgrid.com/), you can send email using SMTP and other mechanisms (see [additional resources](#addRes)).</span></span>

1. <span data-ttu-id="9c4bf-152">In Visual Studio, aprire il **Package Manager Console** (**strumenti**  - &gt; **Gestione pacchetti NuGet**  - &gt; **Package Manager Console**), quindi immettere il comando seguente:</span><span class="sxs-lookup"><span data-stu-id="9c4bf-152">In Visual Studio, open the **Package Manager Console** (**Tools** -&gt; **NuGet Package Manger** -&gt; **Package Manager Console**), and enter the following command:</span></span>  
    `Install-Package SendGrid`
2. <span data-ttu-id="9c4bf-153">Passare al [pagina di iscrizione Azure SendGrid](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) e registrare gratuitamente account SendGrid.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-153">Go to the [Azure SendGrid sign-up page](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) and register for free SendGrid account.</span></span> <span data-ttu-id="9c4bf-154">È possibile anche registrarsi a un account gratuito di SendGrid direttamente su [sito del SendGrid](http://www.sendgrid.com).</span><span class="sxs-lookup"><span data-stu-id="9c4bf-154">You can also sign-up for a free SendGrid account directly on [SendGrid's site](http://www.sendgrid.com).</span></span>
3. <span data-ttu-id="9c4bf-155">Da **Esplora** aprire il *IdentityConfig.cs* file nel *App\_avviare* cartella e aggiungere il seguente codice evidenziato in giallo per il `EmailService` classe per la configurazione **SendGrid**:</span><span class="sxs-lookup"><span data-stu-id="9c4bf-155">From **Solution Explorer** open the *IdentityConfig.cs* file in the *App\_Start* folder and add the following code highlighted in yellow to the `EmailService` class to configure **SendGrid**:</span></span>

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample1.cs?highlight=3,5,8-37)]
4. <span data-ttu-id="9c4bf-156">Inoltre, aggiungere le seguenti `using` istruzioni all'inizio del *IdentityConfig.cs* file:</span><span class="sxs-lookup"><span data-stu-id="9c4bf-156">Also, add the following `using` statements to the beginning of the *IdentityConfig.cs* file:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample2.cs?highlight=1-4)]
5. <span data-ttu-id="9c4bf-157">Per semplificare questo esempio, archiviare i valori di account del servizio di posta elettronica nel `appSettings` sezione la *Web. config* file.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-157">To keep this sample simple, you'll store the email service account values in the `appSettings` section of the *web.config* file.</span></span> <span data-ttu-id="9c4bf-158">Aggiungere il seguente codice XML evidenziati in giallo per il *Web. config* file alla radice del progetto:</span><span class="sxs-lookup"><span data-stu-id="9c4bf-158">Add the following XML highlighted in yellow to the *web.config* file at the root of your project:</span></span>

    [!code-xml[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample3.xml?highlight=2-5)]

    > [!WARNING]
    > <span data-ttu-id="9c4bf-159">Sicurezza - archivio mai i dati sensibili nel codice sorgente.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-159">Security - Never store sensitive data in your source code.</span></span> <span data-ttu-id="9c4bf-160">In questo esempio, l'account e le credenziali vengono archiviate nel **appSetting** sezione la *Web. config* file.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-160">In this example, the account and credentials are stored in the **appSetting** section of the *Web.config* file.</span></span> <span data-ttu-id="9c4bf-161">In Azure, è possibile archiviare questi valori in modo sicuro nel **[configura](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** scheda nel portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-161">On Azure, you can securely store these values on the **[Configure](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** tab in the Azure portal.</span></span> <span data-ttu-id="9c4bf-162">Per ulteriori informazioni vedere l'argomento di Rick Anderson [procedure consigliate per la distribuzione delle password e altri dati sensibili su ASP.NET e in Azure](https://go.microsoft.com/fwlink/?LinkId=513141).</span><span class="sxs-lookup"><span data-stu-id="9c4bf-162">For related information see Rick Anderson's topic titled [Best practices for deploying passwords and other sensitive data to ASP.NET and Azure](https://go.microsoft.com/fwlink/?LinkId=513141).</span></span>
6. <span data-ttu-id="9c4bf-163">Aggiungere i valori di servizio di posta elettronica in modo da riflettere i valori di autenticazione SendGrid (nome utente e Password) in modo che sia possibile corretta inviare posta elettronica dalla tua app.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-163">Add the email service values to reflect your SendGrid authentication values (User Name and Password) so that you can successful send email from your app.</span></span> <span data-ttu-id="9c4bf-164">Assicurarsi di utilizzare il nome di account di SendGrid, anziché l'indirizzo di posta elettronica è fornito SendGrid.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-164">Be sure to use your SendGrid account name rather than the email address you provided SendGrid.</span></span>

### <a name="enable-email-confirmation"></a><span data-ttu-id="9c4bf-165">Abilitare la conferma tramite posta elettronica</span><span class="sxs-lookup"><span data-stu-id="9c4bf-165">Enable Email Confirmation</span></span>

 <span data-ttu-id="9c4bf-166">Per abilitare la conferma tramite posta elettronica, si verrà modificato il codice di registrazione usando la procedura seguente.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-166">To enable email confirmation, you'll modify the registration code using the following steps.</span></span>  
 

1. <span data-ttu-id="9c4bf-167">Nel *Account* cartella, aprire il *Register.aspx.cs* code-behind e aggiornare il `CreateUser_Click` metodo per abilitare le seguenti modifiche evidenziate:</span><span class="sxs-lookup"><span data-stu-id="9c4bf-167">In the *Account* folder, open the *Register.aspx.cs* code-behind and update the `CreateUser_Click` method to enable the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample4.cs?highlight=9-11)]
2. <span data-ttu-id="9c4bf-168">In **Esplora**, fare doppio clic su *Default.aspx* e selezionare **imposta come pagina iniziale**.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-168">In **Solution Explorer**, right-click *Default.aspx* and select **Set As Start Page**.</span></span>
3. <span data-ttu-id="9c4bf-169">Eseguire l'app premendo **F5.**</span><span class="sxs-lookup"><span data-stu-id="9c4bf-169">Run the app by pressing **F5.**</span></span> <span data-ttu-id="9c4bf-170">Dopo la pagina viene visualizzata, fare clic su di **registrare** link per visualizzare la pagina di registrazione.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-170">After the page is displayed, click the **Register** link to display the Register page.</span></span>
4. <span data-ttu-id="9c4bf-171">Immettere il messaggio di posta elettronica e la password, quindi scegliere il **registrare** pulsante per inviare un messaggio di posta elettronica tramite SendGrid.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-171">Enter your email and password, then click the **Register** button to send an email message via SendGrid.</span></span>  
   <span data-ttu-id="9c4bf-172">Lo stato corrente del progetto e codice consentirà all'utente di accedere dopo il completamento del modulo di registrazione, anche se essi non sono stati confermato il proprio account.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-172">The current state of your project and code will allow the user to log in once they complete the registration form, even though they haven't confirmed their account.</span></span>
5. <span data-ttu-id="9c4bf-173">Verificare l'account di posta elettronica e fare clic sul collegamento per confermare la posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-173">Check your email account and click on the link to confirm your email.</span></span>  
   <span data-ttu-id="9c4bf-174">Dopo aver inviato il modulo di registrazione, verrà registrato.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-174">Once you submit the registration form, you will be logged in.</span></span>  
    ![Sito Web di esempio - connesso](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image4.png)

<a id="require"></a>
## <a name="require-email-confirmation-before-log-in"></a><span data-ttu-id="9c4bf-176">Richiedi conferma tramite posta elettronica prima dell'accesso In</span><span class="sxs-lookup"><span data-stu-id="9c4bf-176">Require Email Confirmation Before Log In</span></span>

<span data-ttu-id="9c4bf-177">Anche se hai confermato l'account di posta elettronica, a questo punto non si deve fare clic sul collegamento nel messaggio di posta elettronica verifica completamente firmato in.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-177">Although you have confirmed the email account, at this point you would not need to click on the link contained in the verification email to be fully signed-in.</span></span> <span data-ttu-id="9c4bf-178">Nella sezione seguente, si modificherà il codice che richiede di nuovi utenti per disporre di un messaggio di posta elettronica di conferma vengono registrate nel (autenticato).</span><span class="sxs-lookup"><span data-stu-id="9c4bf-178">In the following section, you will modify the code requiring new users to have a confirmed email before they are logged in (authenticated).</span></span>

1. <span data-ttu-id="9c4bf-179">In **Esplora soluzioni** di Visual Studio, è possibile aggiornare il `CreateUser_Click` evento nel *Register.aspx.cs* contenute nel codice il *account* cartella con il modifiche evidenziate seguente:</span><span class="sxs-lookup"><span data-stu-id="9c4bf-179">In **Solution Explorer** of Visual Studio, update the `CreateUser_Click` event in the *Register.aspx.cs* code-behind contained in the *Accounts* folder with the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample5.cs?highlight=13-14,17-21)]
2. <span data-ttu-id="9c4bf-180">Aggiornamento di `LogIn` metodo il *Login.aspx.cs* codice con le seguenti modifiche evidenziate:</span><span class="sxs-lookup"><span data-stu-id="9c4bf-180">Update the `LogIn` method in the *Login.aspx.cs* code-behind with the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample6.cs?highlight=9-19,45-46)]

### <a name="run-the-application"></a><span data-ttu-id="9c4bf-181">Esecuzione dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="9c4bf-181">Run the Application</span></span>

 <span data-ttu-id="9c4bf-182">Ora che è stato implementato il codice per verificare se è stato confermato l'indirizzo di posta elettronica dell'utente, è possibile controllare la funzionalità sia il **registrare** e **accesso** pagine.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-182">Now that you have implemented the code to check whether a user's email address has been confirmed, you can check the functionality on both the **Register** and **Login** pages.</span></span> 

1. <span data-ttu-id="9c4bf-183">Eliminare gli account nel **AspNetUsers** la tabella contenente l'alias di posta elettronica che si desidera verificare.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-183">Delete any accounts in the **AspNetUsers** table that contain the email alias you wish to test.</span></span>
2. <span data-ttu-id="9c4bf-184">Eseguire l'app (**F5**) e verificare fino a quando non è confermato l'indirizzo di posta elettronica non è possibile registrare un utente.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-184">Run the app (**F5**) and verify you cannot register as a user until you have confirmed your email address.</span></span>
3. <span data-ttu-id="9c4bf-185">Prima di confermare il nuovo account tramite la posta elettronica che è appena stata inviata, tentare di accedere con il nuovo account.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-185">Before confirming your new account via the email that was just sent, attempt to log in with the new account.</span></span>  
 <span data-ttu-id="9c4bf-186">Si noterà che non si riesce ad accedere e che è necessario disporre di un account di posta elettronica di conferma.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-186">You'll see that you are unable to log in and that you must have a confirmed email account.</span></span>
4. <span data-ttu-id="9c4bf-187">Dopo aver confermato l'indirizzo di posta elettronica, accedere all'app.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-187">Once you confirm your email address, log in to the app.</span></span>

<a id="reset"></a>
## <a name="password-recovery-and-reset"></a><span data-ttu-id="9c4bf-188">Reimpostazione e il recupero della password</span><span class="sxs-lookup"><span data-stu-id="9c4bf-188">Password Recovery and Reset</span></span>

1. <span data-ttu-id="9c4bf-189">In Visual Studio, rimuovere i caratteri di commento dal `Forgot` metodo il *Forgot.aspx.cs* contenute nel codice il *Account* cartella, in modo che il metodo viene visualizzato come segue:</span><span class="sxs-lookup"><span data-stu-id="9c4bf-189">In Visual Studio, remove the comment characters from the `Forgot` method in the *Forgot.aspx.cs* code-behind contained in the *Account* folder, so that the method appears as follows:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample7.cs?highlight=16-18)]
2. <span data-ttu-id="9c4bf-190">Aprire il *Login.aspx* pagina.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-190">Open the *Login.aspx* page.</span></span> <span data-ttu-id="9c4bf-191">Sostituire il markup verso la fine del **loginForm** sezione come evidenziato qui sotto:</span><span class="sxs-lookup"><span data-stu-id="9c4bf-191">Replace the markup near the end of the **loginForm** section as highlighted below:</span></span> 

    [!code-aspx[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample8.aspx?highlight=52-53)]
3. <span data-ttu-id="9c4bf-192">Aprire il *Login.aspx.cs* code-behind e rimuovere il commento la riga seguente di codice evidenziata in giallo dal `Page_Load` gestore eventi:</span><span class="sxs-lookup"><span data-stu-id="9c4bf-192">Open the *Login.aspx.cs* code-behind and uncomment the following line of code highlighted in yellow from the `Page_Load` event handler:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample9.cs?highlight=5)]
4. <span data-ttu-id="9c4bf-193">Eseguire l'app premendo **F5.**</span><span class="sxs-lookup"><span data-stu-id="9c4bf-193">Run the app by pressing **F5.**</span></span> <span data-ttu-id="9c4bf-194">Dopo la pagina viene visualizzata, fare clic su di **Accedi** collegamento.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-194">After the page is displayed, click the **Log in** link.</span></span>
5. <span data-ttu-id="9c4bf-195">Fare clic su di **password dimenticata?** link per visualizzare il **Password dimenticata** pagina.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-195">Click the **Forgot your password?** link to display the **Forgot Password** page.</span></span>
6. <span data-ttu-id="9c4bf-196">Immettere l'indirizzo di posta elettronica e fare clic su di **Invia** pulsante per inviare un messaggio di posta elettronica all'indirizzo che consentirà di reimpostare la password.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-196">Enter your email address and click the **Submit** button to send an email to your address which will allow you to reset your password.</span></span>   
   <span data-ttu-id="9c4bf-197">Verificare l'account di posta elettronica e fare clic sul collegamento per visualizzare il **Reimposta Password** pagina.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-197">Check your email account and click on the link to display the **Reset Password** page.</span></span>
7. <span data-ttu-id="9c4bf-198">Nel **Reimposta Password** pagina, immettere il messaggio di posta elettronica, password e password di conferma.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-198">On the **Reset Password** page, enter your email, password, and confirmed password.</span></span> <span data-ttu-id="9c4bf-199">Premere quindi il **reimpostare** pulsante.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-199">Then, press the **Reset** button.</span></span>  
   <span data-ttu-id="9c4bf-200">Quando è stata reimpostata la password, il **Password modificata** verrà visualizzata la pagina.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-200">When you successfully reset your password, the **Password Changed** page will be displayed.</span></span> <span data-ttu-id="9c4bf-201">È ora possibile registrare con la nuova password.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-201">Now you can log in with your new password.</span></span>

<a id="rsend"></a>
## <a name="resend-email-confirmation-link"></a><span data-ttu-id="9c4bf-202">Inviare di nuovo il collegamento di conferma tramite posta elettronica</span><span class="sxs-lookup"><span data-stu-id="9c4bf-202">Resend Email Confirmation Link</span></span>

<span data-ttu-id="9c4bf-203">Una volta che un utente crea un nuovo account locale, essi vengono inviati tramite posta elettronica un collegamento di conferma che devono utilizzare prima di poter accedere.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-203">Once a user creates a new local account, they are emailed a confirmation link they are required to use before they can log on.</span></span> <span data-ttu-id="9c4bf-204">Se l'utente accidentalmente Elimina il messaggio di posta elettronica di conferma o messaggio di posta elettronica non arriva mai, sarà necessario il collegamento di conferma inviato nuovamente.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-204">If the user accidently deletes the confirmation email, or the email never arrives, they will need the confirmation link sent again.</span></span> <span data-ttu-id="9c4bf-205">Le modifiche al codice seguente viene illustrato come abilitare questa opzione.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-205">The following code changes show how to enable this.</span></span>

1. <span data-ttu-id="9c4bf-206">In Visual Studio, aprire il **Login.aspx.cs** code-behind e aggiungere il seguente gestore eventi dopo il `LogIn` gestore eventi:</span><span class="sxs-lookup"><span data-stu-id="9c4bf-206">In Visual Studio, open the **Login.aspx.cs** code-behind and add the following event handler after the `LogIn` event handler:</span></span>   

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample10.cs)]
2. <span data-ttu-id="9c4bf-207">Modificare il `LogIn` nel gestore dell'evento di *Login.aspx.cs* codice modificando il codice evidenziato in giallo, come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="9c4bf-207">Modify the `LogIn` event handler in the *Login.aspx.cs* code-behind by changing the code highlighted in yellow as follows:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample11.cs?highlight=15-17)]
3. <span data-ttu-id="9c4bf-208">Aggiornamento di *Login.aspx* pagina aggiungendo il codice evidenziato in giallo, come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="9c4bf-208">Update the *Login.aspx* page by adding the code highlighted in yellow as follows:</span></span> 

    [!code-aspx[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample12.aspx?highlight=45-46)]
4. <span data-ttu-id="9c4bf-209">Eliminare gli account nel **AspNetUsers** la tabella contenente l'alias di posta elettronica che si desidera verificare.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-209">Delete any accounts in the **AspNetUsers** table that contain the email alias you wish to test.</span></span>
5. <span data-ttu-id="9c4bf-210">Eseguire l'app (**F5**) e registrare l'indirizzo di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-210">Run the app (**F5**) and register your email address.</span></span>
6. <span data-ttu-id="9c4bf-211">Prima di confermare il nuovo account tramite la posta elettronica che è appena stata inviata, tentare di accedere con il nuovo account.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-211">Before confirming your new account via the email that was just sent, attempt to log in with the new account.</span></span>  
   <span data-ttu-id="9c4bf-212">Si noterà che non si riesce ad accedere e che è necessario disporre di un account di posta elettronica di conferma.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-212">You'll see that you are unable to log in and that you must have a confirmed email account.</span></span> <span data-ttu-id="9c4bf-213">Inoltre, è ora possibile rinviare un messaggio di conferma al proprio account di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-213">In addition, you can now resend a confirmation message to your email account.</span></span>
7. <span data-ttu-id="9c4bf-214">Immettere l'indirizzo di posta elettronica e una password, quindi premere il **inviare di nuovo conferma** pulsante.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-214">Enter your email address and password, then press the **Resend confirmation** button.</span></span>
8. <span data-ttu-id="9c4bf-215">Dopo aver confermato l'indirizzo di posta elettronica in base al messaggio di posta elettronica appena inviato, accedere all'app.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-215">Once you confirm your email address based on the newly sent email message, log in to the app.</span></span>

<a id="dbg"></a>
## <a name="troubleshooting-the-app"></a><span data-ttu-id="9c4bf-216">Risoluzione dei problemi relativi all'App</span><span class="sxs-lookup"><span data-stu-id="9c4bf-216">Troubleshooting the App</span></span>

<span data-ttu-id="9c4bf-217">Se non si riceve un messaggio di posta elettronica contenente il collegamento per verificare le credenziali:</span><span class="sxs-lookup"><span data-stu-id="9c4bf-217">If you don't receive an email containing the link to verify your credentials:</span></span>

- <span data-ttu-id="9c4bf-218">Controllare la cartella della posta indesiderata o posta indesiderata.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-218">Check your junk or spam folder.</span></span>
- <span data-ttu-id="9c4bf-219">Accedere al proprio account di SendGrid e fare clic su di [collegamento dell'attività di posta elettronica](https://sendgrid.com/logs/index).</span><span class="sxs-lookup"><span data-stu-id="9c4bf-219">Log into your SendGrid account and click on the [Email Activity link](https://sendgrid.com/logs/index).</span></span>
- <span data-ttu-id="9c4bf-220">Essere utilizzato il nome dell'account utente SendGrid come un *Web. config* valore anziché l'indirizzo di posta elettronica di account di SendGrid.</span><span class="sxs-lookup"><span data-stu-id="9c4bf-220">Be certain you used your SendGrid user account name as a *Web.config* value rather than your SendGrid account email address.</span></span>

<a id="addRes"></a>
## <a name="additional-resources"></a><span data-ttu-id="9c4bf-221">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="9c4bf-221">Additional Resources</span></span>

- [<span data-ttu-id="9c4bf-222">Collegamenti a ASP.NET Identity consigliato risorse</span><span class="sxs-lookup"><span data-stu-id="9c4bf-222">Links to ASP.NET Identity Recommended Resources</span></span>](../../../identity/overview/getting-started/aspnet-identity-recommended-resources.md)
- [<span data-ttu-id="9c4bf-223">La conferma dell'account e il recupero della Password con identità di ASP.NET</span><span class="sxs-lookup"><span data-stu-id="9c4bf-223">Account Confirmation and Password Recovery with ASP.NET Identity</span></span>](../../../identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity.md)
- [<span data-ttu-id="9c4bf-224">Serie di esercitazioni Web Form ASP.NET - aggiungere un Provider di OAuth 2.0</span><span class="sxs-lookup"><span data-stu-id="9c4bf-224">ASP.NET Web Forms tutorial series - Add an OAuth 2.0 Provider</span></span>](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#OAuthWebForms)
- [<span data-ttu-id="9c4bf-225">Distribuire un'App di moduli Web ASP.NET in modo sicuro con l'appartenenza, OAuth e il Database SQL al servizio App di Azure</span><span class="sxs-lookup"><span data-stu-id="9c4bf-225">Deploy a Secure ASP.NET Web Forms App with Membership, OAuth, and SQL Database to Azure App Service</span></span>](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/)
- [<span data-ttu-id="9c4bf-226">ASP.NET Web Forms serie di esercitazioni - abilita SSL per il progetto</span><span class="sxs-lookup"><span data-stu-id="9c4bf-226">ASP.NET Web Forms tutorial series - Enable SSL for the Project</span></span>](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms)
