---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/taking-web-applications-offline-with-web-deploy
title: Acquisire le applicazioni Web non in linea con Web distribuire | Documenti Microsoft
author: jrjlee
description: In questo argomento viene descritto come eseguire un'applicazione web in modalità offline per tutta la durata della distribuzione automatica usando l'Avvis Web Internet Information Services (IIS)...
ms.author: aspnetcontent
manager: wpickett
ms.date: 05/04/2012
ms.topic: article
ms.assetid: 3e9f6e7d-8967-4586-94d5-d3a122f12529
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/taking-web-applications-offline-with-web-deploy
msc.type: authoredcontent
ms.openlocfilehash: 511201dc5646340b21023430fa319417f2b53ae2
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/06/2018
---
<a name="taking-web-applications-offline-with-web-deploy"></a><span data-ttu-id="b7e00-103">Creazione di applicazioni Web Offline con Web distribuire</span><span class="sxs-lookup"><span data-stu-id="b7e00-103">Taking Web Applications Offline with Web Deploy</span></span>
====================
<span data-ttu-id="b7e00-104">da [Jason Lee](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="b7e00-104">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="b7e00-105">Scarica il PDF</span><span class="sxs-lookup"><span data-stu-id="b7e00-105">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> <span data-ttu-id="b7e00-106">In questo argomento viene descritto come eseguire un'applicazione web in modalità offline per tutta la durata della distribuzione automatica tramite lo strumento di distribuzione Web di Internet Information Services (IIS) (distribuzione Web).</span><span class="sxs-lookup"><span data-stu-id="b7e00-106">This topic describes how to take a web application offline for the duration of an automated deployment using the Internet Information Services (IIS) Web Deployment Tool (Web Deploy).</span></span> <span data-ttu-id="b7e00-107">Gli utenti che esplorano all'applicazione web vengono reindirizzati a un *App\_offline.htm* file fino al completamento della distribuzione.</span><span class="sxs-lookup"><span data-stu-id="b7e00-107">Users who browse to the web application are redirected to an *App\_offline.htm* file until the deployment is complete.</span></span>


<span data-ttu-id="b7e00-108">In questo argomento fa parte di una serie di esercitazioni basate su requisiti di distribuzione dell'organizzazione di una società fittizia denominata Fabrikam, Inc. Questa serie di esercitazioni Usa una soluzione di esempio&#x2014;il [Contact Manager soluzione](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;per rappresentare un'applicazione web con un livello di complessità, tra cui un'applicazione ASP.NET MVC 3, una comunicazione Windows realistico Servizio Foundation (WCF) e un progetto di database.</span><span class="sxs-lookup"><span data-stu-id="b7e00-108">This topic forms part of a series of tutorials based around the enterprise deployment requirements of a fictional company named Fabrikam, Inc. This tutorial series uses a sample solution&#x2014;the [Contact Manager solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;to represent a web application with a realistic level of complexity, including an ASP.NET MVC 3 application, a Windows Communication Foundation (WCF) service, and a database project.</span></span>

<span data-ttu-id="b7e00-109">Il metodo di distribuzione il fulcro di queste esercitazioni si basa sul progetto file split approccio descritto in [informazioni sui File di progetto](../web-deployment-in-the-enterprise/understanding-the-project-file.md), in cui il processo di compilazione è controllato da due file di progetto&#x2014;contenente uno istruzioni che si applicano a ogni ambiente di destinazione e quella che contiene le impostazioni di compilazione e distribuzione specifici dell'ambiente di compilazione.</span><span class="sxs-lookup"><span data-stu-id="b7e00-109">The deployment method at the heart of these tutorials is based on the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), in which the build process is controlled by two project files&#x2014;one containing build instructions that apply to every destination environment, and one containing environment-specific build and deployment settings.</span></span> <span data-ttu-id="b7e00-110">In fase di compilazione, il file di progetto specifici dell'ambiente viene unito nel file di progetto indipendenti dall'ambiente in modo da formare un set completo di istruzioni di compilazione.</span><span class="sxs-lookup"><span data-stu-id="b7e00-110">At build time, the environment-specific project file is merged into the environment-agnostic project file to form a complete set of build instructions.</span></span>

## <a name="task-overview"></a><span data-ttu-id="b7e00-111">Panoramica di Task</span><span class="sxs-lookup"><span data-stu-id="b7e00-111">Task Overview</span></span>

<span data-ttu-id="b7e00-112">In molti scenari, si desidera disconnettere un'applicazione web mentre si apportano modifiche ai componenti correlati, ad esempio database o i servizi web.</span><span class="sxs-lookup"><span data-stu-id="b7e00-112">In a lot of scenarios, you'll want to take a web application offline while you make changes to related components, like databases or web services.</span></span> <span data-ttu-id="b7e00-113">In genere, in IIS e ASP.NET, tale scopo, inserire un file denominato *App\_offline.htm* nella cartella radice dell'applicazione web o sito Web IIS.</span><span class="sxs-lookup"><span data-stu-id="b7e00-113">Typically, in IIS and ASP.NET, you accomplish this by placing a file named *App\_offline.htm* in the root folder of the IIS website or web application.</span></span> <span data-ttu-id="b7e00-114">Il *App\_offline.htm* file è un file HTML standard e in genere contiene un semplice messaggio che informa l'utente che il sito è temporaneamente non disponibile per interventi di manutenzione.</span><span class="sxs-lookup"><span data-stu-id="b7e00-114">The *App\_offline.htm* file is a standard HTML file and will usually contain a simple message advising the user that the site is temporarily unavailable due to maintenance.</span></span> <span data-ttu-id="b7e00-115">Mentre il *App\_offline.htm* file esistente nella cartella radice del sito Web, IIS verrà reindirizzata automaticamente tutte le richieste per il file.</span><span class="sxs-lookup"><span data-stu-id="b7e00-115">While the *App\_offline.htm* file exists in the root folder of the website, IIS will automatically redirect any requests to the file.</span></span> <span data-ttu-id="b7e00-116">Una volta terminata l'esecuzione di aggiornamenti, si rimuove il *App\_offline.htm* file e il sito Web riprende normalmente le risposte alle richieste.</span><span class="sxs-lookup"><span data-stu-id="b7e00-116">When you've finished making updates, you remove the *App\_offline.htm* file and the website resumes serving requests as usual.</span></span>

<span data-ttu-id="b7e00-117">Quando si utilizza distribuzione Web per eseguire le distribuzioni automatica o passo-passo per un ambiente di destinazione, si desidera incorporare l'aggiunta e rimozione di *App\_offline.htm* file nel processo di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="b7e00-117">When you use Web Deploy to perform automated or single-step deployments to a target environment, you may want to incorporate adding and removing the *App\_offline.htm* file into your deployment process.</span></span> <span data-ttu-id="b7e00-118">A tale scopo, è necessario completare queste attività di alto livello:</span><span class="sxs-lookup"><span data-stu-id="b7e00-118">To do this, you'll need to complete these high-level tasks:</span></span>

- <span data-ttu-id="b7e00-119">Nel file di progetto di Microsoft Build Engine (MSBuild) utilizzato per controllare il processo di distribuzione, creare una destinazione di MSBuild che viene copiato un *App\_offline.htm* file nel server di destinazione prima di qualsiasi attività di distribuzione iniziare.</span><span class="sxs-lookup"><span data-stu-id="b7e00-119">In the Microsoft Build Engine (MSBuild) project file that you use to control the deployment process, create an MSBuild target that copies an *App\_offline.htm* file to the destination server before any deployment tasks begin.</span></span>
- <span data-ttu-id="b7e00-120">Aggiungere un'altra destinazione di MSBuild che rimuove il *App\_offline.htm* file dal server di destinazione una volta completate tutte le attività di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="b7e00-120">Add another MSBuild target that removes the *App\_offline.htm* file from the destination server when all deployment tasks are complete.</span></span>
- <span data-ttu-id="b7e00-121">Nel progetto di applicazione web, creare un *. wpp.targets* file che assicura che un *App\_offline.htm* file viene aggiunto al pacchetto di distribuzione quando viene richiamata distribuzione Web.</span><span class="sxs-lookup"><span data-stu-id="b7e00-121">In the web application project, create a *.wpp.targets* file that ensures that an *App\_offline.htm* file is added to the deployment package when Web Deploy is invoked.</span></span>

<span data-ttu-id="b7e00-122">Questo argomento viene illustrato come eseguire queste procedure.</span><span class="sxs-lookup"><span data-stu-id="b7e00-122">This topic will show you how to perform these procedures.</span></span> <span data-ttu-id="b7e00-123">Le attività e procedure dettagliate in questo argomento si presuppongono di aver già creato una soluzione che contiene almeno un progetto di applicazione web e l'uso di un file di progetto personalizzati per controllare il processo di distribuzione come descritto in [distribuzione Web nel Enterprise](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md).</span><span class="sxs-lookup"><span data-stu-id="b7e00-123">The tasks and walkthroughs in this topic assume that you've already created a solution that contains at least one web application project, and that you use a custom project file to control the deployment process as described in [Web Deployment in the Enterprise](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md).</span></span> <span data-ttu-id="b7e00-124">In alternativa, è possibile utilizzare il [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) soluzione per seguire gli esempi nella sezione di esempio.</span><span class="sxs-lookup"><span data-stu-id="b7e00-124">Alternatively, you can use the [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) sample solution to follow the examples in the topic.</span></span>

## <a name="adding-an-appoffline-file-to-a-web-application-project"></a><span data-ttu-id="b7e00-125">Aggiunta di un'App\_File Offline per un progetto di applicazione Web</span><span class="sxs-lookup"><span data-stu-id="b7e00-125">Adding an App\_Offline File to a Web Application Project</span></span>

<span data-ttu-id="b7e00-126">È necessario completare la prima attività consiste nell'aggiungere un *App\_offline* file al progetto di applicazione web:</span><span class="sxs-lookup"><span data-stu-id="b7e00-126">The first task you need to complete is to add an *App\_offline* file to your web application project:</span></span>

- <span data-ttu-id="b7e00-127">Per impedire che il file di interferire con il processo di sviluppo (non si desidera impostare in modo permanente non in linea dell'applicazione), è necessario chiamare questo metodo un elemento diverso da *App\_offline.htm*.</span><span class="sxs-lookup"><span data-stu-id="b7e00-127">To prevent the file from interfering with the development process (you don't want your application to be permanently offline), you should call it something other than *App\_offline.htm*.</span></span> <span data-ttu-id="b7e00-128">Ad esempio, è possibile specificare il nome del file *App\_offline di Microsoft Dynamics*.</span><span class="sxs-lookup"><span data-stu-id="b7e00-128">For example, you could name the file *App\_offline-template.htm*.</span></span>
- <span data-ttu-id="b7e00-129">Per impedire che il file verrà distribuito come-è, è necessario impostare l'azione di compilazione su **Nessuno**.</span><span class="sxs-lookup"><span data-stu-id="b7e00-129">To prevent the file from being deployed as-is, you should set the build action to **None**.</span></span>

<span data-ttu-id="b7e00-130">**Per aggiungere un'App\_file offline per un progetto di applicazione web**</span><span class="sxs-lookup"><span data-stu-id="b7e00-130">**To add an App\_offline file to a web application project**</span></span>

1. <span data-ttu-id="b7e00-131">Aprire la soluzione in Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="b7e00-131">Open your solution in Visual Studio 2010.</span></span>
2. <span data-ttu-id="b7e00-132">Nel **Esplora** finestra del mouse sul progetto di applicazione web, scegliere **Aggiungi**, quindi fare clic su **nuovo elemento**.</span><span class="sxs-lookup"><span data-stu-id="b7e00-132">In the **Solution Explorer** window, right-click your web application project, point to **Add**, and then click **New Item**.</span></span>
3. <span data-ttu-id="b7e00-133">Nel **Aggiungi nuovo elemento** nella finestra di dialogo **pagina HTML**.</span><span class="sxs-lookup"><span data-stu-id="b7e00-133">In the **Add New Item** dialog box, select **HTML Page**.</span></span>
4. <span data-ttu-id="b7e00-134">Nel **nome** digitare **App\_offline di Microsoft Dynamics**, quindi fare clic su **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="b7e00-134">In the **Name** box, type **App\_offline-template.htm**, and then click **Add**.</span></span>

    ![](taking-web-applications-offline-with-web-deploy/_static/image1.png)
5. <span data-ttu-id="b7e00-135">Aggiungere il codice HTML semplice per informare gli utenti che non è disponibile l'applicazione e quindi salvare il file.</span><span class="sxs-lookup"><span data-stu-id="b7e00-135">Add some simple HTML to inform users that the application is unavailable, and then save the file.</span></span> <span data-ttu-id="b7e00-136">Non includere tag qualsiasi lato server (ad esempio, i tag che sono precedute dal prefisso "asp:").</span><span class="sxs-lookup"><span data-stu-id="b7e00-136">Do not include any server-side tags (for example, any tags that are prefixed with "asp:").</span></span> 

    ![](taking-web-applications-offline-with-web-deploy/_static/image2.png)
6. <span data-ttu-id="b7e00-137">Nel **Esplora** finestra, fare doppio clic su nuovo file e quindi fare clic su **proprietà**.</span><span class="sxs-lookup"><span data-stu-id="b7e00-137">In the **Solution Explorer** window, right-click the new file, and then click **Properties**.</span></span>
7. <span data-ttu-id="b7e00-138">Nel **proprietà** finestra, nel **azione di compilazione** riga, selezionare **Nessuno**.</span><span class="sxs-lookup"><span data-stu-id="b7e00-138">In the **Properties** window, in the **Build Action** row, select **None**.</span></span>

    ![](taking-web-applications-offline-with-web-deploy/_static/image3.png)

## <a name="deploying-and-deleting-an-appoffline-file"></a><span data-ttu-id="b7e00-139">Distribuzione e l'eliminazione di un'App\_File Offline</span><span class="sxs-lookup"><span data-stu-id="b7e00-139">Deploying and Deleting an App\_Offline File</span></span>

<span data-ttu-id="b7e00-140">Il passaggio successivo consiste nella modifica di una logica di distribuzione per copiare il file nel server di destinazione all'inizio del processo di distribuzione e rimuoverlo al termine.</span><span class="sxs-lookup"><span data-stu-id="b7e00-140">The next step is to modify your deployment logic to copy the file to the destination server at the start of the deployment process and remove it at the end.</span></span>

> [!NOTE]
> <span data-ttu-id="b7e00-141">La procedura seguente si presuppone che si usi un file di progetto MSBuild personalizzato per controllare il processo di distribuzione, come descritto in [informazioni sui File di progetto](../web-deployment-in-the-enterprise/understanding-the-project-file.md).</span><span class="sxs-lookup"><span data-stu-id="b7e00-141">The next procedure assumes that you're using a custom MSBuild project file to control your deployment process, as described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md).</span></span> <span data-ttu-id="b7e00-142">Se si distribuisce direttamente da Visual Studio, è necessario usare un approccio diverso.</span><span class="sxs-lookup"><span data-stu-id="b7e00-142">If you're deploying direct from Visual Studio, you'll need to use a different approach.</span></span> <span data-ttu-id="b7e00-143">Sayed Ibrahim Hashimi viene descritto un approccio in [come eseguire l'App non in linea durante la pubblicazione sul Web](http://sedodream.com/2012/01/08/HowToTakeYourWebAppOfflineDuringPublishing.aspx).</span><span class="sxs-lookup"><span data-stu-id="b7e00-143">Sayed Ibrahim Hashimi describes one such approach in [How to Take Your Web App Offline During Publishing](http://sedodream.com/2012/01/08/HowToTakeYourWebAppOfflineDuringPublishing.aspx).</span></span>


<span data-ttu-id="b7e00-144">Per distribuire un *App\_offline* file a un sito Web IIS di destinazione, è necessario richiamare MSDeploy.exe mediante il [distribuzione Web **contentPath** provider](https://technet.microsoft.com/library/dd569034(WS.10).aspx).</span><span class="sxs-lookup"><span data-stu-id="b7e00-144">To deploy an *App\_offline* file to a destination IIS website, you need to invoke MSDeploy.exe using the [Web Deploy **contentPath** provider](https://technet.microsoft.com/library/dd569034(WS.10).aspx).</span></span> <span data-ttu-id="b7e00-145">Il **contentPath** provider supporta entrambi i percorsi di directory fisica e i percorsi del sito Web o un'applicazione IIS, che rende la soluzione ideale per la sincronizzazione di un file in una cartella di progetto di Visual Studio e un'applicazione web IIS.</span><span class="sxs-lookup"><span data-stu-id="b7e00-145">The **contentPath** provider supports both physical directory paths and IIS website or application paths, which makes it the ideal choice for synchronizing a file between a Visual Studio project folder and an IIS web application.</span></span> <span data-ttu-id="b7e00-146">Per distribuire il file, il comando di MSDeploy sarà analogo al seguente:</span><span class="sxs-lookup"><span data-stu-id="b7e00-146">To deploy the file, your MSDeploy command should resemble this:</span></span>


[!code-console[Main](taking-web-applications-offline-with-web-deploy/samples/sample1.cmd)]


<span data-ttu-id="b7e00-147">Per rimuovere il file dal sito di destinazione alla fine del processo di distribuzione, il comando di MSDeploy sarà analogo al seguente:</span><span class="sxs-lookup"><span data-stu-id="b7e00-147">To remove the file from the destination site at the end of the deployment process, your MSDeploy command should resemble this:</span></span>


[!code-console[Main](taking-web-applications-offline-with-web-deploy/samples/sample2.cmd)]


<span data-ttu-id="b7e00-148">Per automatizzare questi comandi come parte di un processo di compilazione e distribuzione, è necessario integrarli in file di progetto MSBuild personalizzato.</span><span class="sxs-lookup"><span data-stu-id="b7e00-148">To automate these commands as part of a build and deployment process, you need to integrate them into your custom MSBuild project file.</span></span> <span data-ttu-id="b7e00-149">La procedura seguente viene descritto come eseguire questa operazione.</span><span class="sxs-lookup"><span data-stu-id="b7e00-149">The next procedure describes how to do this.</span></span>

<span data-ttu-id="b7e00-150">**Per distribuire ed eliminare un'App\_file offline**</span><span class="sxs-lookup"><span data-stu-id="b7e00-150">**To deploy and delete an App\_offline file**</span></span>

1. <span data-ttu-id="b7e00-151">In Visual Studio 2010, aprire il file di progetto MSBuild che controlla il processo di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="b7e00-151">In Visual Studio 2010, open the MSBuild project file that controls your deployment process.</span></span> <span data-ttu-id="b7e00-152">Nel [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) soluzione di esempio, si tratta di *Publish.proj* file.</span><span class="sxs-lookup"><span data-stu-id="b7e00-152">In the [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) sample solution, this is the *Publish.proj* file.</span></span>
2. <span data-ttu-id="b7e00-153">Nella radice **progetto** elemento, creare un nuovo **PropertyGroup** elemento da archiviare le variabili per il *App\_offline* distribuzione:</span><span class="sxs-lookup"><span data-stu-id="b7e00-153">In the root **Project** element, create a new **PropertyGroup** element to store variables for the *App\_offline* deployment:</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample3.xml)]
3. <span data-ttu-id="b7e00-154">Il **SourceRoot** proprietà definita altrove nel *Publish.proj* file.</span><span class="sxs-lookup"><span data-stu-id="b7e00-154">The **SourceRoot** property is defined elsewhere in the *Publish.proj* file.</span></span> <span data-ttu-id="b7e00-155">Indica il percorso della cartella radice per il contenuto di origine relativo al percorso corrente&#x2014;in altre parole, relativo al percorso del *Publish.proj* file.</span><span class="sxs-lookup"><span data-stu-id="b7e00-155">It indicates the location of the root folder for the source content relative to the current path&#x2014;in other words, relative to the location of the *Publish.proj* file.</span></span>
4. <span data-ttu-id="b7e00-156">Il **contentPath** provider non accetterà i percorsi di file relativo, pertanto è necessario ottenere un percorso assoluto al file di origine prima di poterla distribuire.</span><span class="sxs-lookup"><span data-stu-id="b7e00-156">The **contentPath** provider will not accept relative file paths, so you need to get an absolute path to your source file before you can deploy it.</span></span> <span data-ttu-id="b7e00-157">È possibile utilizzare il [ConvertToAbsolutePath](https://msdn.microsoft.com/library/bb882668.aspx) attività per eseguire questa operazione.</span><span class="sxs-lookup"><span data-stu-id="b7e00-157">You can use the [ConvertToAbsolutePath](https://msdn.microsoft.com/library/bb882668.aspx) task to do this.</span></span>
5. <span data-ttu-id="b7e00-158">Aggiungere un nuovo **destinazione** elemento denominato **GetAppOfflineAbsolutePath**.</span><span class="sxs-lookup"><span data-stu-id="b7e00-158">Add a new **Target** element named **GetAppOfflineAbsolutePath**.</span></span> <span data-ttu-id="b7e00-159">All'interno di questa destinazione, utilizzare il **ConvertToAbsolutePath** attività per ottenere un percorso assoluto per il *App\_offline modello* file nella cartella del progetto.</span><span class="sxs-lookup"><span data-stu-id="b7e00-159">Within this target, use the **ConvertToAbsolutePath** task to get an absolute path to the *App\_offline-template* file in your project folder.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample4.xml)]
6. <span data-ttu-id="b7e00-160">La destinazione accetta il percorso relativo di *App\_offline modello* file nella cartella del progetto e lo salva in una nuova proprietà come un percorso assoluto.</span><span class="sxs-lookup"><span data-stu-id="b7e00-160">This target takes the relative path to the *App\_offline-template* file in your project folder and saves it to a new property as an absolute file path.</span></span> <span data-ttu-id="b7e00-161">Il **BeforeTargets** attributo specifica che la destinazione da eseguire prima il **DeployAppOffline** destinazione, verrà creata nel passaggio successivo.</span><span class="sxs-lookup"><span data-stu-id="b7e00-161">The **BeforeTargets** attribute specifies that you want this target to execute before the **DeployAppOffline** target, which you'll create in the next step.</span></span>
7. <span data-ttu-id="b7e00-162">Aggiungere una nuova destinazione denominata **DeployAppOffline**.</span><span class="sxs-lookup"><span data-stu-id="b7e00-162">Add a new target named **DeployAppOffline**.</span></span> <span data-ttu-id="b7e00-163">All'interno di questa destinazione, richiamare il comando di MSDeploy.exe che distribuisce il *App\_offline* file al server web di destinazione.</span><span class="sxs-lookup"><span data-stu-id="b7e00-163">Within this target, invoke the MSDeploy.exe command that deploys your *App\_offline* file to the destination web server.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample5.xml)]
8. <span data-ttu-id="b7e00-164">In questo esempio, il **ContactManagerIisPath** proprietà definita altrove nel file di progetto.</span><span class="sxs-lookup"><span data-stu-id="b7e00-164">In this example, the **ContactManagerIisPath** property is defined elsewhere in the project file.</span></span> <span data-ttu-id="b7e00-165">Si tratta semplicemente un percorso applicazione IIS, nel formato *[nome sito Web IIS] / [nome applicazione]*.</span><span class="sxs-lookup"><span data-stu-id="b7e00-165">This is simply an IIS application path, in the form *[IIS Website Name]/[Application Name]*.</span></span> <span data-ttu-id="b7e00-166">L'inclusione di una condizione nella destinazione consente agli utenti di passare il *App\_offline* distribuzione o disattivare la modifica di un valore della proprietà o fornendo un parametro della riga di comando.</span><span class="sxs-lookup"><span data-stu-id="b7e00-166">Including a condition in the target enables users to switch the *App\_offline* deployment on or off by changing a property value or providing a command-line parameter.</span></span>
9. <span data-ttu-id="b7e00-167">Aggiungere una nuova destinazione denominata **DeleteAppOffline**.</span><span class="sxs-lookup"><span data-stu-id="b7e00-167">Add a new target named **DeleteAppOffline**.</span></span> <span data-ttu-id="b7e00-168">All'interno di questa destinazione, richiamare il comando di MSDeploy.exe che rimuove le *App\_offline* file dal server web di destinazione.</span><span class="sxs-lookup"><span data-stu-id="b7e00-168">Within this target, invoke the MSDeploy.exe command that removes your *App\_offline* file from the destination web server.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample6.xml)]
10. <span data-ttu-id="b7e00-169">L'attività finale consiste nel richiamare queste nuove destinazioni in punti appropriati durante l'esecuzione del file di progetto.</span><span class="sxs-lookup"><span data-stu-id="b7e00-169">The final task is to invoke these new targets at appropriate points during the execution of your project file.</span></span> <span data-ttu-id="b7e00-170">È possibile farlo in vari modi.</span><span class="sxs-lookup"><span data-stu-id="b7e00-170">You can do this in various ways.</span></span> <span data-ttu-id="b7e00-171">Ad esempio, nel *Publish.proj* file, il **FullPublishDependsOn** proprietà specifica un elenco di destinazioni che devono essere eseguiti in ordine quando il **FullPublish** predefinito viene richiamata la destinazione.</span><span class="sxs-lookup"><span data-stu-id="b7e00-171">For example, in the *Publish.proj* file, the **FullPublishDependsOn** property specifies a list of targets that must be executed in order when the **FullPublish** default target is invoked.</span></span>
11. <span data-ttu-id="b7e00-172">Modificare il file di progetto MSBuild per richiamare il **DeployAppOffline** e **DeleteAppOffline** destinazioni in punti appropriati nel processo di pubblicazione.</span><span class="sxs-lookup"><span data-stu-id="b7e00-172">Modify your MSBuild project file to invoke the **DeployAppOffline** and **DeleteAppOffline** targets at appropriate points in the publishing process.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample7.xml)]

<span data-ttu-id="b7e00-173">Quando si esegue il file di progetto MSBuild personalizzata, il *App\_offline* file verrà distribuito al server immediatamente dopo una compilazione corretta.</span><span class="sxs-lookup"><span data-stu-id="b7e00-173">When you run your custom MSBuild project file, the *App\_offline* file will be deployed to the server immediately after a successful build.</span></span> <span data-ttu-id="b7e00-174">Verrà quindi eliminato dal server dopo aver complete tutte le attività di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="b7e00-174">It will then be deleted from the server once all the deployment tasks are complete.</span></span>

## <a name="adding-an-appoffline-file-to-deployment-packages"></a><span data-ttu-id="b7e00-175">Aggiunta di un'App\_File Offline ai pacchetti di distribuzione</span><span class="sxs-lookup"><span data-stu-id="b7e00-175">Adding an App\_Offline File to Deployment Packages</span></span>

<span data-ttu-id="b7e00-176">A seconda di come si configura la distribuzione, qualsiasi il contenuto esistente nella destinazione IIS applicazione web&#x2014;, ad esempio il *App\_offline.htm* file&#x2014;potrebbero essere eliminati automaticamente quando si distribuisce un sito web pacchetto di destinazione.</span><span class="sxs-lookup"><span data-stu-id="b7e00-176">Depending on how you configure your deployment, any existing content at the destination IIS web application&#x2014;like the *App\_offline.htm* file&#x2014;may be deleted automatically when you deploy a web package to the destination.</span></span> <span data-ttu-id="b7e00-177">Per garantire che il *App\_offline.htm* file rimane attivo per la durata della distribuzione, è necessario includere il file all'interno del pacchetto di distribuzione web stesso inoltre per il file direttamente all'inizio della distribuzione il processo di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="b7e00-177">To ensure that the *App\_offline.htm* file remains in place for the duration of the deployment, you need to include the file within the web deployment package itself in addition to deploying the file directly at the start of the deployment process.</span></span>

- <span data-ttu-id="b7e00-178">Se è stato seguito le attività precedenti in questo argomento, verranno aggiunti il *App\_offline.htm* file al progetto di applicazione web in un nome file diverso (utilizzassimo *App\_ non in linea di Microsoft Dynamics*) e verrà installata l'operazione di compilazione **Nessuno**.</span><span class="sxs-lookup"><span data-stu-id="b7e00-178">If you've followed the previous tasks in this topic, you'll have added the *App\_offline.htm* file to your web application project under a different filename (we used *App\_offline-template.htm*) and you'll have set the build action to **None**.</span></span> <span data-ttu-id="b7e00-179">Queste modifiche sono necessari per evitare che il file da interferenze con lo sviluppo e debug.</span><span class="sxs-lookup"><span data-stu-id="b7e00-179">These changes are necessary to prevent the file from interfering with development and debugging.</span></span> <span data-ttu-id="b7e00-180">Di conseguenza, è necessario personalizzare il processo di creazione di pacchetti per assicurarsi che il *App\_offline.htm* file è incluso nel pacchetto di distribuzione web.</span><span class="sxs-lookup"><span data-stu-id="b7e00-180">As a result, you need to customize the packaging process to ensure that the *App\_offline.htm* file is included in the web deployment package.</span></span>

<span data-ttu-id="b7e00-181">La Pipeline di pubblicazione sul Web (WPP) usa un elenco di elementi denominato **FilesForPackagingFromProject** per compilare un elenco di file che devono essere incluse nel pacchetto di distribuzione web.</span><span class="sxs-lookup"><span data-stu-id="b7e00-181">The Web Publishing Pipeline (WPP) uses an item list named **FilesForPackagingFromProject** to build a list of files that should be included in the web deployment package.</span></span> <span data-ttu-id="b7e00-182">È possibile personalizzare il contenuto dei pacchetti web tramite l'aggiunta di elementi personalizzati a questo elenco.</span><span class="sxs-lookup"><span data-stu-id="b7e00-182">You can customize the contents of your web packages by adding your own items to this list.</span></span> <span data-ttu-id="b7e00-183">A tale scopo, è necessario completare questi passaggi di alto livello:</span><span class="sxs-lookup"><span data-stu-id="b7e00-183">To do this, you need to complete these high-level steps:</span></span>

1. <span data-ttu-id="b7e00-184">Creare un file di progetto personalizzato denominato *.wpp.targets [nome progetto]* nella stessa cartella del file di progetto.</span><span class="sxs-lookup"><span data-stu-id="b7e00-184">Create a custom project file named *[project name].wpp.targets* in the same folder as your project file.</span></span>

    > [!NOTE]
    > <span data-ttu-id="b7e00-185">Il *. wpp.targets* file deve essere inserito nella stessa cartella file di progetto applicazione web&#x2014;, ad esempio, *ContactManager.Mvc.csproj*&#x2014;anziché nella stessa cartella come qualsiasi personalizzato file di progetto utilizzati per controllare il processo di compilazione e distribuzione.</span><span class="sxs-lookup"><span data-stu-id="b7e00-185">The *.wpp.targets* file needs to go in the same folder as your web application project file&#x2014;for example, *ContactManager.Mvc.csproj*&#x2014;rather than in the same folder as any custom project files you use to control the build and deployment process.</span></span>
2. <span data-ttu-id="b7e00-186">Nel *. wpp.targets* file, creare una nuova destinazione di MSBuild che esegue *prima* il **CopyAllFilesToSingleFolderForPackage** destinazione.</span><span class="sxs-lookup"><span data-stu-id="b7e00-186">In the *.wpp.targets* file, create a new MSBuild target that executes *before* the **CopyAllFilesToSingleFolderForPackage** target.</span></span> <span data-ttu-id="b7e00-187">Questa è la destinazione del sito che compila un elenco di elementi da includere nel pacchetto.</span><span class="sxs-lookup"><span data-stu-id="b7e00-187">This is the WPP target that builds a list of things to include in the package.</span></span>
3. <span data-ttu-id="b7e00-188">Nella nuova destinazione, creare un **ItemGroup** elemento.</span><span class="sxs-lookup"><span data-stu-id="b7e00-188">In the new target, create an **ItemGroup** element.</span></span>
4. <span data-ttu-id="b7e00-189">Nel **ItemGroup** elemento, aggiungere un **FilesForPackagingFromProject** elemento e specificare il *App\_offline.htm* file.</span><span class="sxs-lookup"><span data-stu-id="b7e00-189">In the **ItemGroup** element, add a **FilesForPackagingFromProject** item and specify the *App\_offline.htm* file.</span></span>

<span data-ttu-id="b7e00-190">Il *. wpp.targets* file dovrebbe essere simile alla seguente:</span><span class="sxs-lookup"><span data-stu-id="b7e00-190">The *.wpp.targets* file should resemble this:</span></span>


[!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample8.xml)]


<span data-ttu-id="b7e00-191">Questi sono i punti chiave della nota in questo esempio:</span><span class="sxs-lookup"><span data-stu-id="b7e00-191">These are the key points of note in this example:</span></span>

- <span data-ttu-id="b7e00-192">Il **BeforeTargets** attributo inserisce la destinazione in WPP specificando che deve essere eseguito immediatamente prima di **CopyAllFilesToSingleFolderForPackage** destinazione.</span><span class="sxs-lookup"><span data-stu-id="b7e00-192">The **BeforeTargets** attribute inserts this target into the WPP by specifying that it should be executed immediately before the **CopyAllFilesToSingleFolderForPackage** target.</span></span>
- <span data-ttu-id="b7e00-193">Il **FilesForPackagingFromProject** elemento viene utilizzato il **DestinationRelativePath** valore dei metadati per rinominare il file da *App\_offline di Microsoft Dynamics* per *App\_offline.htm* quando vengono aggiunti all'elenco.</span><span class="sxs-lookup"><span data-stu-id="b7e00-193">The **FilesForPackagingFromProject** item uses the **DestinationRelativePath** metadata value to rename the file from *App\_offline-template.htm* to *App\_offline.htm* as it's added to the list.</span></span>

<span data-ttu-id="b7e00-194">La procedura successiva viene illustrato come aggiungere questo *. wpp.targets* file a un progetto di applicazione web.</span><span class="sxs-lookup"><span data-stu-id="b7e00-194">The next procedure shows you how to add this *.wpp.targets* file to a web application project.</span></span>

<span data-ttu-id="b7e00-195">**Per aggiungere un. wpp.targets file a un pacchetto di distribuzione web**</span><span class="sxs-lookup"><span data-stu-id="b7e00-195">**To add a .wpp.targets file to a web deployment package**</span></span>

1. <span data-ttu-id="b7e00-196">Aprire la soluzione in Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="b7e00-196">Open your solution in Visual Studio 2010.</span></span>
2. <span data-ttu-id="b7e00-197">Nel **Esplora** finestra, fare doppio clic su un nodo di progetto applicazione web (ad esempio, **ContactManager.Mvc**), scegliere **Aggiungi**e quindi fare clic su **Nuovo elemento**.</span><span class="sxs-lookup"><span data-stu-id="b7e00-197">In the **Solution Explorer** window, right-click your web application project node (for example, **ContactManager.Mvc**), point to **Add**, and then click **New Item**.</span></span>
3. <span data-ttu-id="b7e00-198">Nel **Aggiungi nuovo elemento** la finestra di dialogo, seleziona il **File XML** modello.</span><span class="sxs-lookup"><span data-stu-id="b7e00-198">In the **Add New Item** dialog box, select the **XML File** template.</span></span>
4. <span data-ttu-id="b7e00-199">Nel **nome** , digitare *[nome progetto] * * *.wpp.targets** (ad esempio, **ContactManager.Mvc.wpp.targets**), quindi fare clic su **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="b7e00-199">In the **Name** box, type *[project name]***.wpp.targets** (for example, **ContactManager.Mvc.wpp.targets**), and then click **Add**.</span></span>

    ![](taking-web-applications-offline-with-web-deploy/_static/image4.png)

    > [!NOTE]
    > <span data-ttu-id="b7e00-200">Se si aggiunge un nuovo elemento al nodo radice di un progetto, il file viene creato nella stessa cartella del file di progetto.</span><span class="sxs-lookup"><span data-stu-id="b7e00-200">If you add a new item to the root node of a project, the file is created in the same folder as the project file.</span></span> <span data-ttu-id="b7e00-201">Per verificare, aprire la cartella in Esplora risorse.</span><span class="sxs-lookup"><span data-stu-id="b7e00-201">You can verify this by opening the folder in Windows Explorer.</span></span>
5. <span data-ttu-id="b7e00-202">Nel file, aggiungere il markup di MSBuild descritto in precedenza.</span><span class="sxs-lookup"><span data-stu-id="b7e00-202">In the file, add the MSBuild markup described previously.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample9.xml)]
6. <span data-ttu-id="b7e00-203">Salvare e chiudere il *.wpp.targets [nome progetto]* file.</span><span class="sxs-lookup"><span data-stu-id="b7e00-203">Save and close the *[project name].wpp.targets* file.</span></span>

<span data-ttu-id="b7e00-204">Alla successiva esecuzione del pacchetto e di compilazione progetto applicazione web, WPP consentirà di rilevare automaticamente il *. wpp.targets* file.</span><span class="sxs-lookup"><span data-stu-id="b7e00-204">The next time you build and package your web application project, the WPP will automatically detect the *.wpp.targets* file.</span></span> <span data-ttu-id="b7e00-205">Il *App\_offline di Microsoft Dynamics* file verrà incluso nel pacchetto di distribuzione web risultante come *App\_offline.htm*.</span><span class="sxs-lookup"><span data-stu-id="b7e00-205">The *App\_offline-template.htm* file will be included in the resulting web deployment package as *App\_offline.htm*.</span></span>

> [!NOTE]
> <span data-ttu-id="b7e00-206">Se la distribuzione non riesce, il *App\_offline.htm* rimarrà file sul posto e l'applicazione rimarrà non in linea.</span><span class="sxs-lookup"><span data-stu-id="b7e00-206">If your deployment fails, the *App\_offline.htm* file will remain in place and your application will remain offline.</span></span> <span data-ttu-id="b7e00-207">Si tratta in genere il comportamento desiderato.</span><span class="sxs-lookup"><span data-stu-id="b7e00-207">This is typically the desired behavior.</span></span> <span data-ttu-id="b7e00-208">Per attivare l'applicazione torna online, è possibile eliminare il *App\_offline.htm* file dal server web.</span><span class="sxs-lookup"><span data-stu-id="b7e00-208">To bring your application back online, you can delete the *App\_offline.htm* file from your web server.</span></span> <span data-ttu-id="b7e00-209">In alternativa, se si correggere eventuali errori, esecuzione una corretta distribuzione, il *App\_offline.htm* file verrà rimosso.</span><span class="sxs-lookup"><span data-stu-id="b7e00-209">Alternatively, if you correct any errors and run a successful deployment, the *App\_offline.htm* file will be removed.</span></span>


## <a name="conclusion"></a><span data-ttu-id="b7e00-210">Conclusione</span><span class="sxs-lookup"><span data-stu-id="b7e00-210">Conclusion</span></span>

<span data-ttu-id="b7e00-211">In questo argomento viene descritto come eseguire un'applicazione web in modalità offline per tutta la durata di una distribuzione, pubblicazione un *App\_offline.htm* file nel server di destinazione all'inizio del processo di distribuzione e alla rimozione di fine.</span><span class="sxs-lookup"><span data-stu-id="b7e00-211">This topic described how to take a web application offline for the duration of a deployment, by publishing an *App\_offline.htm* file to the destination server at the start of the deployment process and removing it at the end.</span></span> <span data-ttu-id="b7e00-212">Inoltre descritto come includere un *App\_offline.htm* file in un pacchetto di distribuzione web.</span><span class="sxs-lookup"><span data-stu-id="b7e00-212">It also covered how to include an *App\_offline.htm* file in a web deployment package.</span></span>

## <a name="further-reading"></a><span data-ttu-id="b7e00-213">Ulteriori informazioni</span><span class="sxs-lookup"><span data-stu-id="b7e00-213">Further Reading</span></span>

<span data-ttu-id="b7e00-214">Per ulteriori informazioni sulla creazione di pacchetti e processo di distribuzione, vedere [compilazione e creazione di pacchetti Web Application Projects](../web-deployment-in-the-enterprise/building-and-packaging-web-application-projects.md), [configurazione dei parametri per la distribuzione di pacchetto Web](../web-deployment-in-the-enterprise/configuring-parameters-for-web-package-deployment.md), e [ Distribuzione di pacchetti Web](../web-deployment-in-the-enterprise/deploying-web-packages.md).</span><span class="sxs-lookup"><span data-stu-id="b7e00-214">For more information on the packaging and deployment process, see [Building and Packaging Web Application Projects](../web-deployment-in-the-enterprise/building-and-packaging-web-application-projects.md), [Configuring Parameters for Web Package Deployment](../web-deployment-in-the-enterprise/configuring-parameters-for-web-package-deployment.md), and [Deploying Web Packages](../web-deployment-in-the-enterprise/deploying-web-packages.md).</span></span>

<span data-ttu-id="b7e00-215">Se la pubblicazione di applicazioni web direttamente da Visual Studio, piuttosto che utilizza l'approccio di file progetto MSBuild personalizzato descritto in queste esercitazioni, è necessario utilizzare un approccio leggermente diverso per portare l'applicazione durante la pubblicazione processo.</span><span class="sxs-lookup"><span data-stu-id="b7e00-215">If you publish your web applications directly from Visual Studio, rather than using the custom MSBuild project file approach described in these tutorials, you'll need to use a slightly different approach to take your application offline during the publishing process.</span></span> <span data-ttu-id="b7e00-216">Per ulteriori informazioni, vedere [come portare offline l'app web durante la pubblicazione](https://go.microsoft.com/?linkid=9805135) (post di blog).</span><span class="sxs-lookup"><span data-stu-id="b7e00-216">For more information, see [How to take your web app offline during publishing](https://go.microsoft.com/?linkid=9805135) (blog post).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="b7e00-217">[Precedente](excluding-files-and-folders-from-deployment.md)
> [Successivo](running-windows-powershell-scripts-from-msbuild-project-files.md)</span><span class="sxs-lookup"><span data-stu-id="b7e00-217">[Previous](excluding-files-and-folders-from-deployment.md)
[Next](running-windows-powershell-scripts-from-msbuild-project-files.md)</span></span>
