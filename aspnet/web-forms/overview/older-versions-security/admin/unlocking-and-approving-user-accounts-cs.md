---
uid: web-forms/overview/older-versions-security/admin/unlocking-and-approving-user-accounts-cs
title: Lo sblocco e approvare gli account utente (c#) | Documenti Microsoft
author: rick-anderson
description: In questa esercitazione viene illustrato come compilare una pagina web per gli amministratori per la gestione degli utenti bloccati e stati approvati. Si verifica anche come approvare o di nuovi utenti...
ms.author: aspnetcontent
manager: wpickett
ms.date: 04/01/2008
ms.topic: article
ms.assetid: 5346aab1-9974-489f-a065-ae3883b8a350
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-security/admin/unlocking-and-approving-user-accounts-cs
msc.type: authoredcontent
ms.openlocfilehash: 8b3d69e96513192bc73a2a6a7cbb4c6e33eb610b
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/06/2018
ms.locfileid: "30891399"
---
<a name="unlocking-and-approving-user-accounts-c"></a><span data-ttu-id="4074b-104">Approvazione e lo sblocco degli account utente (c#)</span><span class="sxs-lookup"><span data-stu-id="4074b-104">Unlocking and Approving User Accounts (C#)</span></span>
====================
<span data-ttu-id="4074b-105">da [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="4074b-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="4074b-106">[Scaricare codice](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.14.zip) o [Scarica il PDF](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial14_UnlockAndApprove_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="4074b-106">[Download Code](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.14.zip) or [Download PDF](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial14_UnlockAndApprove_cs.pdf)</span></span>

> <span data-ttu-id="4074b-107">In questa esercitazione viene illustrato come compilare una pagina web per gli amministratori per la gestione degli utenti bloccati e stati approvati.</span><span class="sxs-lookup"><span data-stu-id="4074b-107">This tutorial shows how to build a web page for administrators to manage users' locked out and approved statuses.</span></span> <span data-ttu-id="4074b-108">Si verifica anche come approvare nuovi utenti solo dopo che è accertato l'indirizzo di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="4074b-108">We will also see how to approve new users only after they have verified their email address.</span></span>


## <a name="introduction"></a><span data-ttu-id="4074b-109">Introduzione</span><span class="sxs-lookup"><span data-stu-id="4074b-109">Introduction</span></span>

<span data-ttu-id="4074b-110">Con un nome utente, password e posta elettronica, ogni account utente dispone di due campi di stato che indicano se l'utente può accedere al sito: bloccati e approvati.</span><span class="sxs-lookup"><span data-stu-id="4074b-110">Along with a username, password, and email, each user account has two status fields that dictate whether the user can log into the site: locked out and approved.</span></span> <span data-ttu-id="4074b-111">Un utente venga bloccato automaticamente se credenziali non valide fornisce un numero specificato di volte all'interno di un numero specificato di minuti (le impostazioni predefinite bloccano un utente dopo 5 tentativi di accesso non valido all'interno di 10 minuti).</span><span class="sxs-lookup"><span data-stu-id="4074b-111">A user is automatically locked out if they provide invalid credentials a specified number of times within a specified number of minutes (the default settings lock a user out after 5 invalid login attempts within 10 minutes).</span></span> <span data-ttu-id="4074b-112">Lo stato approvato è utile negli scenari in cui un'azione deve trascorrere prima che un nuovo utente è in grado di accedere al sito.</span><span class="sxs-lookup"><span data-stu-id="4074b-112">The approved status is useful in scenarios where some action must transpire before a new user is able to log on to the site.</span></span> <span data-ttu-id="4074b-113">Ad esempio, un utente potrebbe essere necessario verificare innanzitutto l'indirizzo di posta elettronica o essere approvate da un amministratore prima di essere in grado di account di accesso.</span><span class="sxs-lookup"><span data-stu-id="4074b-113">For example, a user might need to first verify their email address or be approved by an administrator before being able to login.</span></span>

<span data-ttu-id="4074b-114">Poiché un bloccato out o non approvati utente non è possibile eseguire l'accesso, è naturale solo a chiedersi come questi stati possono essere reimpostati.</span><span class="sxs-lookup"><span data-stu-id="4074b-114">Because a locked out or unapproved user cannot login, it's only natural to wonder how these statuses can be reset.</span></span> <span data-ttu-id="4074b-115">ASP.NET non include una funzionalità incorporata o controlli Web per la gestione degli utenti bloccati e approvato gli stati, in parte perché tali decisioni devono essere gestiti in modo da sito a sito.</span><span class="sxs-lookup"><span data-stu-id="4074b-115">ASP.NET does not include any built-in functionality or Web controls for managing users' locked out and approved statuses, in part because these decisions need to be handled on a site-by-site basis.</span></span> <span data-ttu-id="4074b-116">Alcuni siti potrebbero approvare automaticamente tutti i nuovi account utente (il comportamento predefinito).</span><span class="sxs-lookup"><span data-stu-id="4074b-116">Some sites might automatically approve all new user accounts (the default behavior).</span></span> <span data-ttu-id="4074b-117">Gli altri sono un amministratore di approvare i nuovi account o non approvare utenti fino a quando visitano un collegamento inviato all'indirizzo di posta elettronica fornito quando si è effettuato l'iscrizione.</span><span class="sxs-lookup"><span data-stu-id="4074b-117">Others have an administrator approve new accounts or do not approve users until they visit a link sent to the email address provided when they signed up.</span></span> <span data-ttu-id="4074b-118">Analogamente, alcuni siti potrebbero bloccare gli utenti fino a quando un amministratore reimposta il relativo stato, mentre altri siti inviano un messaggio di posta elettronica all'utente di blocco con un URL possono accedere per sbloccare l'account.</span><span class="sxs-lookup"><span data-stu-id="4074b-118">Likewise, some sites may lock out users until an administrator resets their status, while other sites send an email to the locked out user with a URL they can visit to unlock their account.</span></span>

<span data-ttu-id="4074b-119">In questa esercitazione viene illustrato come compilare una pagina web per gli amministratori per la gestione degli utenti bloccati e stati approvati.</span><span class="sxs-lookup"><span data-stu-id="4074b-119">This tutorial shows how to build a web page for administrators to manage users' locked out and approved statuses.</span></span> <span data-ttu-id="4074b-120">Si verifica anche come approvare nuovi utenti solo dopo che è accertato l'indirizzo di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="4074b-120">We will also see how to approve new users only after they have verified their email address.</span></span>

## <a name="step-1-managing-users-locked-out-and-approved-statuses"></a><span data-ttu-id="4074b-121">Passaggio 1: Gestione degli utenti bloccati e gli stati di approvazione</span><span class="sxs-lookup"><span data-stu-id="4074b-121">Step 1: Managing Users' Locked Out and Approved Statuses</span></span>

<span data-ttu-id="4074b-122">Nel <a id="Tutorial12"> </a> [ *creazione di un'interfaccia per selezionare un Account utente da molti* ](building-an-interface-to-select-one-user-account-from-many-cs.md) esercitazione è costruito una pagina in cui è elencato ogni account utente in un paging filtrati GridView.</span><span class="sxs-lookup"><span data-stu-id="4074b-122">In the <a id="Tutorial12"></a>[*Building an Interface to Select One User Account from Many*](building-an-interface-to-select-one-user-account-from-many-cs.md) tutorial we constructed a page that listed each user account in a paged, filtered GridView.</span></span> <span data-ttu-id="4074b-123">La griglia elenca ogni nome utente e posta elettronica, i relativi stati approvati e bloccati, se si è attualmente online ed eventuali commenti sull'utente.</span><span class="sxs-lookup"><span data-stu-id="4074b-123">The grid lists each user's name and email, their approved and locked out statuses, whether they're currently online, and any comments about the user.</span></span> <span data-ttu-id="4074b-124">Per la gestione degli utenti approvati e gli stati di blocco, è possibile stabilire questa griglia modificabile.</span><span class="sxs-lookup"><span data-stu-id="4074b-124">To manage users' approved and locked out statuses, we could make this grid editable.</span></span> <span data-ttu-id="4074b-125">Per modificare lo stato di approvazione dell'utente, l'amministratore innanzitutto individuare l'account utente e quindi modificare la riga corrispondente di GridView, selezionando o deselezionando la casella di controllo approvato.</span><span class="sxs-lookup"><span data-stu-id="4074b-125">To change a user's approved status, the administrator would first locate the user account and then edit the corresponding GridView row, checking or unchecking the approved checkbox.</span></span> <span data-ttu-id="4074b-126">In alternativa, è possibile gestire gli stati approvati e bloccati tramite una pagina ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="4074b-126">Alternatively, we could manage the approved and locked out statuses through a separate ASP.NET page.</span></span>

<span data-ttu-id="4074b-127">Per questa esercitazione si userà due pagine ASP.NET: `ManageUsers.aspx` e `UserInformation.aspx`.</span><span class="sxs-lookup"><span data-stu-id="4074b-127">For this tutorial let's use two ASP.NET pages: `ManageUsers.aspx` and `UserInformation.aspx`.</span></span> <span data-ttu-id="4074b-128">L'idea è che `ManageUsers.aspx` Elenca gli account utente nel sistema, mentre `UserInformation.aspx` consente all'amministratore di gestire gli stati approvati e bloccati per un utente specifico.</span><span class="sxs-lookup"><span data-stu-id="4074b-128">The idea here is that `ManageUsers.aspx` lists the user accounts in the system, while `UserInformation.aspx` enables the administrator to manage the approved and locked out statuses for a specific user.</span></span> <span data-ttu-id="4074b-129">Il primo è per potenziare GridView in `ManageUsers.aspx` per includere un HyperLinkField, che esegue il rendering come una colonna di collegamenti.</span><span class="sxs-lookup"><span data-stu-id="4074b-129">Our first order of business is to augment the GridView in `ManageUsers.aspx` to include a HyperLinkField, which renders as a column of links.</span></span> <span data-ttu-id="4074b-130">Si desidera che ogni collegamento per fare riferimento a `UserInformation.aspx?user=UserName`, dove *UserName* è il nome dell'utente da modificare.</span><span class="sxs-lookup"><span data-stu-id="4074b-130">We want each link to point to `UserInformation.aspx?user=UserName`, where *UserName* is the name of the user to edit.</span></span>

> [!NOTE]
> <span data-ttu-id="4074b-131">Se è stato scaricato il codice per il <a id="Tutorial13"> </a> [ *Recovering e modifica delle password* ](recovering-and-changing-passwords-cs.md) esercitazione si può notare che il `ManageUsers.aspx` pagina contiene già un set di " Gestire"collegamenti e `UserInformation.aspx` pagina fornisce un'interfaccia per la modifica delle password dell'utente selezionato.</span><span class="sxs-lookup"><span data-stu-id="4074b-131">If you downloaded the code for the <a id="Tutorial13"></a>[*Recovering and Changing Passwords*](recovering-and-changing-passwords-cs.md) tutorial you may have noticed that the `ManageUsers.aspx` page already contains a set of "Manage" links and the `UserInformation.aspx` page provides an interface for changing the selected user's password.</span></span> <span data-ttu-id="4074b-132">Ho deciso di non replicare tale funzionalità in codice associato a questa esercitazione perché funzionante evitando di utilizzare l'API di appartenenza e operare direttamente con il database di SQL Server per modificare la password dell'utente.</span><span class="sxs-lookup"><span data-stu-id="4074b-132">I decided not to replicate that functionality in the code associated with this tutorial because it worked by circumventing the Membership API and operating directly with the SQL Server database to change a user's password.</span></span> <span data-ttu-id="4074b-133">In questa esercitazione inizia da zero con la `UserInformation.aspx` pagina.</span><span class="sxs-lookup"><span data-stu-id="4074b-133">This tutorial starts from scratch with the `UserInformation.aspx` page.</span></span>


### <a name="adding-manage-links-to-theuseraccountsgridview"></a><span data-ttu-id="4074b-134">Aggiunta di "Gestisci" collegamenti per il`UserAccounts`GridView</span><span class="sxs-lookup"><span data-stu-id="4074b-134">Adding "Manage" Links to the`UserAccounts`GridView</span></span>

<span data-ttu-id="4074b-135">Aprire il `ManageUsers.aspx` pagina e aggiungere un HyperLinkField per il `UserAccounts` GridView.</span><span class="sxs-lookup"><span data-stu-id="4074b-135">Open the `ManageUsers.aspx` page and add a HyperLinkField to the `UserAccounts` GridView.</span></span> <span data-ttu-id="4074b-136">Impostare il HyperLinkField `Text` proprietà su "Manage" e il relativo `DataNavigateUrlFields` e `DataNavigateUrlFormatString` proprietà `UserName` e "UserInformation.aspx?user={0}", rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="4074b-136">Set the HyperLinkField's `Text` property to "Manage" and its `DataNavigateUrlFields` and `DataNavigateUrlFormatString` properties to `UserName` and "UserInformation.aspx?user={0}", respectively.</span></span> <span data-ttu-id="4074b-137">Queste impostazioni configurano il HyperLinkField in modo che tutti i collegamenti ipertestuali visualizzare il testo "Manage", ma ogni collegamento passa appropriata *UserName* valore nella stringa di query.</span><span class="sxs-lookup"><span data-stu-id="4074b-137">These settings configure the HyperLinkField such that all of the hyperlinks display the text "Manage", but each link passes in the appropriate *UserName* value into the querystring.</span></span>

<span data-ttu-id="4074b-138">Dopo aver aggiunto il HyperLinkField a GridView, dedicare alcuni minuti per visualizzare il `ManageUsers.aspx` pagina tramite un browser.</span><span class="sxs-lookup"><span data-stu-id="4074b-138">After adding the HyperLinkField to the GridView, take a moment to view the `ManageUsers.aspx` page through a browser.</span></span> <span data-ttu-id="4074b-139">Come illustrato nella figura 1, ogni riga GridView ora include un collegamento "Gestisci".</span><span class="sxs-lookup"><span data-stu-id="4074b-139">As Figure 1 shows, each GridView row now includes a "Manage" link.</span></span> <span data-ttu-id="4074b-140">Il collegamento "Gestisci" per Bruce punta a `UserInformation.aspx?user=Bruce`, mentre il collegamento "Gestisci" per Dave punta a `UserInformation.aspx?user=Dave`.</span><span class="sxs-lookup"><span data-stu-id="4074b-140">The "Manage" link for Bruce points to `UserInformation.aspx?user=Bruce`, whereas the "Manage" link for Dave points to `UserInformation.aspx?user=Dave`.</span></span>


<span data-ttu-id="4074b-141">[![Aggiunge il HyperLinkField un](unlocking-and-approving-user-accounts-cs/_static/image2.png)](unlocking-and-approving-user-accounts-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="4074b-141">[![The HyperLinkField Adds a](unlocking-and-approving-user-accounts-cs/_static/image2.png)](unlocking-and-approving-user-accounts-cs/_static/image1.png)</span></span>

<span data-ttu-id="4074b-142">**Figura 1**: il HyperLinkField aggiunge un collegamento "Gestisci" per ogni Account utente ([fare clic per visualizzare l'immagine ingrandita](unlocking-and-approving-user-accounts-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="4074b-142">**Figure 1**: The HyperLinkField Adds a "Manage" Link for Each User Account  ([Click to view full-size image](unlocking-and-approving-user-accounts-cs/_static/image3.png))</span></span>


<span data-ttu-id="4074b-143">Verrà creato l'interfaccia utente e codice per il `UserInformation.aspx` pagina in un momento, ma prima si parlare su come modificare a livello di codice un utente bloccato e gli stati approvati.</span><span class="sxs-lookup"><span data-stu-id="4074b-143">We will create the user interface and code for the `UserInformation.aspx` page in a moment, but first let's talk about how to programmatically change a user's locked out and approved statuses.</span></span> <span data-ttu-id="4074b-144">Il [ `MembershipUser` classe](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx) è [ `IsLockedOut` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.islockedout.aspx) e [ `IsApproved` proprietà](https://msdn.microsoft.com/library/system.web.security.membershipuser.isapproved.aspx).</span><span class="sxs-lookup"><span data-stu-id="4074b-144">The [`MembershipUser` class](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx) has [`IsLockedOut`](https://msdn.microsoft.com/library/system.web.security.membershipuser.islockedout.aspx) and [`IsApproved` properties](https://msdn.microsoft.com/library/system.web.security.membershipuser.isapproved.aspx).</span></span> <span data-ttu-id="4074b-145">Il `IsLockedOut` proprietà è di sola lettura.</span><span class="sxs-lookup"><span data-stu-id="4074b-145">The `IsLockedOut` property is read-only.</span></span> <span data-ttu-id="4074b-146">Non è disponibile alcun meccanismo di blocco a livello di codice un utente. Per sbloccare un utente, utilizzare il `MembershipUser` della classe [ `UnlockUser` metodo](https://msdn.microsoft.com/library/system.web.security.membershipuser.unlockuser.aspx).</span><span class="sxs-lookup"><span data-stu-id="4074b-146">There is no mechanism to programmatically lock out a user; to unlock a user, use the `MembershipUser` class's [`UnlockUser` method](https://msdn.microsoft.com/library/system.web.security.membershipuser.unlockuser.aspx).</span></span> <span data-ttu-id="4074b-147">Il `IsApproved` proprietà è leggibile e scrivibile.</span><span class="sxs-lookup"><span data-stu-id="4074b-147">The `IsApproved` property is readable and writeable.</span></span> <span data-ttu-id="4074b-148">Per salvare le modifiche a questa proprietà, è necessario chiamare il `Membership` della classe [ `UpdateUser` metodo](https://msdn.microsoft.com/library/system.web.security.membership.updateuser.aspx), passando il modificato `MembershipUser` oggetto.</span><span class="sxs-lookup"><span data-stu-id="4074b-148">To save any changes to this property, we need to call the `Membership` class's [`UpdateUser` method](https://msdn.microsoft.com/library/system.web.security.membership.updateuser.aspx), passing in the modified `MembershipUser` object.</span></span>

<span data-ttu-id="4074b-149">Poiché il `IsApproved` proprietà è leggibile e scrivibile, un controllo casella di controllo è probabile che l'elemento dell'interfaccia utente migliore per la configurazione di questa proprietà.</span><span class="sxs-lookup"><span data-stu-id="4074b-149">Because the `IsApproved` property is readable and writeable, a CheckBox control is probably the best user interface element for configuring this property.</span></span> <span data-ttu-id="4074b-150">Tuttavia, una casella di controllo verrà non funzionano per i `IsLockedOut` proprietà perché non è possibile bloccare un utente amministratore, può solo sbloccare un utente.</span><span class="sxs-lookup"><span data-stu-id="4074b-150">However, a CheckBox will not work for the `IsLockedOut` property because an administrator cannot lock out a user, she may only unlock a user.</span></span> <span data-ttu-id="4074b-151">Un'interfaccia utente appropriato per il `IsLockedOut` proprietà è un pulsante che, quando si fa clic, sblocca l'account utente.</span><span class="sxs-lookup"><span data-stu-id="4074b-151">A suitable user interface for the `IsLockedOut` property is a Button that, when clicked, unlocks the user account.</span></span> <span data-ttu-id="4074b-152">Questo pulsante deve essere abilitato solo se l'utente è bloccato.</span><span class="sxs-lookup"><span data-stu-id="4074b-152">This Button should only be enabled if the user is locked out.</span></span>

### <a name="creating-theuserinformationaspxpage"></a><span data-ttu-id="4074b-153">Creazione di`UserInformation.aspx`pagina</span><span class="sxs-lookup"><span data-stu-id="4074b-153">Creating the`UserInformation.aspx`Page</span></span>

<span data-ttu-id="4074b-154">A questo punto si è pronti implementare l'interfaccia utente in `UserInformation.aspx`.</span><span class="sxs-lookup"><span data-stu-id="4074b-154">We are now ready to implement the user interface in `UserInformation.aspx`.</span></span> <span data-ttu-id="4074b-155">Aprire questa pagina e aggiungere i controlli Web seguenti:</span><span class="sxs-lookup"><span data-stu-id="4074b-155">Open this page and add the following Web controls:</span></span>

- <span data-ttu-id="4074b-156">Controllare un collegamento ipertestuale che, quando si fa clic, restituisce l'amministratore per il `ManageUsers.aspx` pagina.</span><span class="sxs-lookup"><span data-stu-id="4074b-156">A HyperLink control that, when clicked, returns the administrator to the `ManageUsers.aspx` page.</span></span>
- <span data-ttu-id="4074b-157">Un controllo etichetta Web per visualizzare il nome dell'utente selezionato.</span><span class="sxs-lookup"><span data-stu-id="4074b-157">A Label Web control for displaying the selected user's name.</span></span> <span data-ttu-id="4074b-158">Impostare questa etichetta `ID` a `UserNameLabel` e cancellare la `Text` proprietà.</span><span class="sxs-lookup"><span data-stu-id="4074b-158">Set this Label's `ID` to `UserNameLabel` and clear out its `Text` property.</span></span>
- <span data-ttu-id="4074b-159">Un controllo casella di controllo denominato `IsApproved`.</span><span class="sxs-lookup"><span data-stu-id="4074b-159">A CheckBox control named `IsApproved`.</span></span> <span data-ttu-id="4074b-160">Impostare il relativo `AutoPostBack` proprietà `true`.</span><span class="sxs-lookup"><span data-stu-id="4074b-160">Set its `AutoPostBack` property to `true`.</span></span>
- <span data-ttu-id="4074b-161">Data dell'ultimo blocco un controllo etichetta per la visualizzazione dell'utente.</span><span class="sxs-lookup"><span data-stu-id="4074b-161">A Label control for displaying the user's last locked out date.</span></span> <span data-ttu-id="4074b-162">Questa etichetta nome `LastLockedOutDateLabel` e cancellare la `Text` proprietà.</span><span class="sxs-lookup"><span data-stu-id="4074b-162">Name this Label `LastLockedOutDateLabel` and clear out its `Text` property.</span></span>
- <span data-ttu-id="4074b-163">Pulsante per lo sblocco dell'utente.</span><span class="sxs-lookup"><span data-stu-id="4074b-163">A Button for unlocking the user.</span></span> <span data-ttu-id="4074b-164">Nome di questo pulsante `UnlockUserButton` e impostare il relativo `Text` proprietà su "Sblocca utente".</span><span class="sxs-lookup"><span data-stu-id="4074b-164">Name this Button `UnlockUserButton` and set its `Text` property to "Unlock User".</span></span>
- <span data-ttu-id="4074b-165">Un controllo etichetta per la visualizzazione dei messaggi di stato, ad esempio, "stato di approvazione dell'utente è stato aggiornato".</span><span class="sxs-lookup"><span data-stu-id="4074b-165">A Label control for displaying status messages, such as, "The user's approved status has been updated."</span></span> <span data-ttu-id="4074b-166">Nome di questo controllo `StatusMessage`, deselezionare le relative `Text` proprietà e set relativo `CssClass` proprietà `Important`.</span><span class="sxs-lookup"><span data-stu-id="4074b-166">Name this control `StatusMessage`, clear out its `Text` property, and set its `CssClass` property to `Important`.</span></span> <span data-ttu-id="4074b-167">(Il `Important` classe CSS è definita nel `Styles.css` file di foglio di stile; Visualizza il testo corrispondente in un tipo di carattere di grandi dimensioni, di colore rosso.)</span><span class="sxs-lookup"><span data-stu-id="4074b-167">(The `Important` CSS class is defined in the `Styles.css` stylesheet file; it displays the corresponding text in a large, red font.)</span></span>

<span data-ttu-id="4074b-168">Dopo l'aggiunta di questi controlli, la visualizzazione di progettazione in Visual Studio dovrebbe essere simile alla schermata nella figura 2.</span><span class="sxs-lookup"><span data-stu-id="4074b-168">After adding these controls, the Design view in Visual Studio should look similar to the screen shot in Figure 2.</span></span>


<span data-ttu-id="4074b-169">[![Creare l'interfaccia utente per UserInformation.aspx](unlocking-and-approving-user-accounts-cs/_static/image5.png)](unlocking-and-approving-user-accounts-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="4074b-169">[![Create the User Interface for UserInformation.aspx](unlocking-and-approving-user-accounts-cs/_static/image5.png)](unlocking-and-approving-user-accounts-cs/_static/image4.png)</span></span>

<span data-ttu-id="4074b-170">**Figura 2**: l'interfaccia utente per creare `UserInformation.aspx` ([fare clic per visualizzare l'immagine ingrandita](unlocking-and-approving-user-accounts-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="4074b-170">**Figure 2**: Create the User Interface for `UserInformation.aspx` ([Click to view full-size image](unlocking-and-approving-user-accounts-cs/_static/image6.png))</span></span>


<span data-ttu-id="4074b-171">Con l'interfaccia utente completa, l'attività successiva consiste nell'impostare il `IsApproved` casella di controllo e altri controlli in base alle informazioni dell'utente selezionato.</span><span class="sxs-lookup"><span data-stu-id="4074b-171">With the user interface complete, our next task is to set the `IsApproved` CheckBox and other controls based on the selected user's information.</span></span> <span data-ttu-id="4074b-172">Creare un gestore eventi per la pagina `Load` eventi e aggiungere il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="4074b-172">Create an event handler for the page's `Load` event and add the following code:</span></span>

[!code-csharp[Main](unlocking-and-approving-user-accounts-cs/samples/sample1.cs)]

<span data-ttu-id="4074b-173">Il codice sopra riportato avvia, verificare che questa è la prima visita la pagina e non un postback successivi.</span><span class="sxs-lookup"><span data-stu-id="4074b-173">The above code starts by ensuring that this is the first visit to the page and not a subsequent postback.</span></span> <span data-ttu-id="4074b-174">Quindi legge il nome utente passato tramite la `user` campo querystring e recupera le informazioni relative all'account utente tramite il `Membership.GetUser(username)` metodo.</span><span class="sxs-lookup"><span data-stu-id="4074b-174">It then reads the username passed through the `user` querystring field and retrieves information about that user account via the `Membership.GetUser(username)` method.</span></span> <span data-ttu-id="4074b-175">Se è stato fornito alcun nome utente tramite la stringa di query o se non è stato possibile trovare l'utente specificato, l'amministratore viene inviato il `ManageUsers.aspx` pagina.</span><span class="sxs-lookup"><span data-stu-id="4074b-175">If no username was supplied through the querystring, or if the specified user could not be found, the administrator is sent back to the `ManageUsers.aspx` page.</span></span>

<span data-ttu-id="4074b-176">Il `MembershipUser` dell'oggetto `UserName` valore viene quindi visualizzato nel `UserNameLabel` e `IsApproved` casella di controllo è selezionata in base il `IsApproved` valore della proprietà.</span><span class="sxs-lookup"><span data-stu-id="4074b-176">The `MembershipUser` object's `UserName` value is then displayed in the `UserNameLabel` and the `IsApproved` CheckBox is checked based on the `IsApproved` property value.</span></span>

<span data-ttu-id="4074b-177">Il `MembershipUser` dell'oggetto [ `LastLockoutDate` proprietà](https://msdn.microsoft.com/library/system.web.security.membershipuser.lastlockoutdate.aspx) restituisce un `DateTime` valore che indica quando l'utente è l'ultimo bloccato. Se l'utente non è stato bloccato, il valore restituito dipende dal provider di appartenenze.</span><span class="sxs-lookup"><span data-stu-id="4074b-177">The `MembershipUser` object's [`LastLockoutDate` property](https://msdn.microsoft.com/library/system.web.security.membershipuser.lastlockoutdate.aspx) returns a `DateTime` value indicating when the user was last locked out. If the user has never been locked out, the value returned depends on the Membership provider.</span></span> <span data-ttu-id="4074b-178">Quando viene creato un nuovo account, il `SqlMembershipProvider` imposta il `aspnet_Membership` della tabella `LastLockoutDate` campo `1754-01-01 12:00:00 AM`.</span><span class="sxs-lookup"><span data-stu-id="4074b-178">When a new account is created, the `SqlMembershipProvider` sets the `aspnet_Membership` table's `LastLockoutDate` field to `1754-01-01 12:00:00 AM`.</span></span> <span data-ttu-id="4074b-179">Il codice precedente consente di visualizzare una stringa vuota nel `LastLockoutDateLabel` se il `LastLockoutDate` proprietà si verifica prima dell'anno 2000; in caso contrario, la parte relativa alla data del `LastLockoutDate` proprietà viene visualizzata nell'etichetta.</span><span class="sxs-lookup"><span data-stu-id="4074b-179">The above code displays an empty string in the `LastLockoutDateLabel` if the `LastLockoutDate` property occurs before year 2000; otherwise, the date portion of the `LastLockoutDate` property is displayed in the Label.</span></span> <span data-ttu-id="4074b-180">Il `UnlockUserButton'` s `Enabled` proprietà è impostata per l'utente bloccato lo stato, vale a dire che questo pulsante viene abilitato solo se l'utente è bloccato.</span><span class="sxs-lookup"><span data-stu-id="4074b-180">The `UnlockUserButton'` s `Enabled` property is set to the user's locked out status, meaning that this Button will only be enabled if the user is locked out.</span></span>

<span data-ttu-id="4074b-181">È opportuno testare il `UserInformation.aspx` pagina tramite un browser.</span><span class="sxs-lookup"><span data-stu-id="4074b-181">Take a moment to test the `UserInformation.aspx` page through a browser.</span></span> <span data-ttu-id="4074b-182">Naturalmente, occorre iniziare in corrispondenza di `ManageUsers.aspx` e selezionare un account utente da gestire.</span><span class="sxs-lookup"><span data-stu-id="4074b-182">You will, of course, need to start at `ManageUsers.aspx` and select a user account to manage.</span></span> <span data-ttu-id="4074b-183">Al momento in arrivo presso `UserInformation.aspx`, si noti che il `IsApproved` casella di controllo è selezionata solo se l'utente è approvato.</span><span class="sxs-lookup"><span data-stu-id="4074b-183">Upon arriving at `UserInformation.aspx`, note that the `IsApproved` CheckBox is only checked if the user is approved.</span></span> <span data-ttu-id="4074b-184">Se l'utente è mai stato bloccato, la loro ultima bloccato Data.</span><span class="sxs-lookup"><span data-stu-id="4074b-184">If the user has ever been locked out, their last locked out date is displayed.</span></span> <span data-ttu-id="4074b-185">Pulsante Sblocca utente è abilitato solo se l'utente è attualmente bloccato. Selezionare o deselezionare il `IsApproved` casella di controllo o facendo clic sul pulsante Sblocca utente provoca un postback, ma non vengono eseguite modifiche all'account utente perché è stata ancora per creare i gestori eventi per questi eventi.</span><span class="sxs-lookup"><span data-stu-id="4074b-185">The Unlock User button is enabled only if the user is currently locked out. Checking or unchecking the `IsApproved` CheckBox or clicking the Unlock User button causes a postback, but no modifications are made to the user account because we've yet to create event handlers for these events.</span></span>

<span data-ttu-id="4074b-186">Tornare a Visual Studio e creare gestori eventi per il `IsApproved` della casella di controllo `CheckedChanged` evento e `UnlockUser` del pulsante `Click` evento.</span><span class="sxs-lookup"><span data-stu-id="4074b-186">Return to Visual Studio and create event handlers for the `IsApproved` CheckBox's `CheckedChanged` event and the `UnlockUser` Button's `Click` event.</span></span> <span data-ttu-id="4074b-187">Nel `CheckedChanged` gestore dell'evento, impostare l'utente `IsApproved` proprietà per il `Checked` proprietà della casella di controllo e quindi salvare le modifiche tramite una chiamata a `Membership.UpdateUser`.</span><span class="sxs-lookup"><span data-stu-id="4074b-187">In the `CheckedChanged` event handler, set the user's `IsApproved` property to the `Checked` property of the CheckBox and then save the changes via a call to `Membership.UpdateUser`.</span></span> <span data-ttu-id="4074b-188">Nel `Click` gestore dell'evento, semplicemente chiamare la `MembershipUser` dell'oggetto `UnlockUser` metodo.</span><span class="sxs-lookup"><span data-stu-id="4074b-188">In the `Click` event handler, simply call the `MembershipUser` object's `UnlockUser` method.</span></span> <span data-ttu-id="4074b-189">In entrambi i gestori eventi, viene visualizzato un messaggio appropriato nella `StatusMessage` etichetta.</span><span class="sxs-lookup"><span data-stu-id="4074b-189">In both event handlers, display a suitable message in the `StatusMessage` Label.</span></span>

[!code-csharp[Main](unlocking-and-approving-user-accounts-cs/samples/sample2.cs)]

### <a name="testing-theuserinformationaspxpage"></a><span data-ttu-id="4074b-190">Test di`UserInformation.aspx`pagina</span><span class="sxs-lookup"><span data-stu-id="4074b-190">Testing the`UserInformation.aspx`Page</span></span>

<span data-ttu-id="4074b-191">Con questi gestori eventi sul posto, rivedere la pagina e non approvati un utente.</span><span class="sxs-lookup"><span data-stu-id="4074b-191">With these event handlers in place, revisit the page and unapproved a user.</span></span> <span data-ttu-id="4074b-192">Come mostrato nella figura 3, verrà visualizzato una breve messaggio nella pagina che indica che l'utente `IsApproved` proprietà è stata modificata correttamente.</span><span class="sxs-lookup"><span data-stu-id="4074b-192">As Figure 3 shows, you should see a brief message on the page indicating that the user's `IsApproved` property was successfully modified.</span></span>


<span data-ttu-id="4074b-193">[![Chris è stato Unapproved](unlocking-and-approving-user-accounts-cs/_static/image8.png)](unlocking-and-approving-user-accounts-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="4074b-193">[![Chris has been Unapproved](unlocking-and-approving-user-accounts-cs/_static/image8.png)](unlocking-and-approving-user-accounts-cs/_static/image7.png)</span></span>

<span data-ttu-id="4074b-194">**Figura 3**: Chris è stato Unapproved ([fare clic per visualizzare l'immagine ingrandita](unlocking-and-approving-user-accounts-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="4074b-194">**Figure 3**: Chris has been Unapproved  ([Click to view full-size image](unlocking-and-approving-user-accounts-cs/_static/image9.png))</span></span>


<span data-ttu-id="4074b-195">Successivamente, disconnettersi e provare a eseguire l'accesso come utente il cui account è stato appena non approvati.</span><span class="sxs-lookup"><span data-stu-id="4074b-195">Next, logout and try to login as the user whose account was just unapproved.</span></span> <span data-ttu-id="4074b-196">Perché l'utente non viene approvata, essi non è possibile eseguire l'accesso.</span><span class="sxs-lookup"><span data-stu-id="4074b-196">Because the user is not approved, they cannot login.</span></span> <span data-ttu-id="4074b-197">Per impostazione predefinita, il controllo di accesso consente di visualizzare lo stesso messaggio se l'utente non è possibile eseguire l'accesso, a prescindere dal motivo.</span><span class="sxs-lookup"><span data-stu-id="4074b-197">By default, the Login control displays the same message if the user cannot login, regardless of the reason.</span></span> <span data-ttu-id="4074b-198">Ma nel <a id="Tutorial6"> </a> [ *convalida utente contro l'appartenenza utente archivio credenziali* ](../membership/validating-user-credentials-against-the-membership-user-store-cs.md) esercitazione è stato esaminato migliorare il controllo di accesso per visualizzare un messaggio più appropriato.</span><span class="sxs-lookup"><span data-stu-id="4074b-198">But in the <a id="Tutorial6"></a>[*Validating User Credentials Against the Membership User Store*](../membership/validating-user-credentials-against-the-membership-user-store-cs.md) tutorial we looked at enhancing the Login control to display a more appropriate message.</span></span> <span data-ttu-id="4074b-199">Come illustrato nella figura 4, Chris viene visualizzata un messaggio che spiega che ha non è possibile eseguire l'accesso perché il suo account non è ancora approvati.</span><span class="sxs-lookup"><span data-stu-id="4074b-199">As Figure 4 shows, Chris is shown a message explaining that he cannot login because his account is not yet approved.</span></span>


<span data-ttu-id="4074b-200">[![Chris non è possibile perché His Account di accesso è non approvato](unlocking-and-approving-user-accounts-cs/_static/image11.png)](unlocking-and-approving-user-accounts-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="4074b-200">[![Chris Cannot Login Because His Account is Unapproved](unlocking-and-approving-user-accounts-cs/_static/image11.png)](unlocking-and-approving-user-accounts-cs/_static/image10.png)</span></span>

<span data-ttu-id="4074b-201">**Figura 4**: Chris non è possibile perché His Account di accesso è non approvati ([fare clic per visualizzare l'immagine ingrandita](unlocking-and-approving-user-accounts-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="4074b-201">**Figure 4**: Chris Cannot Login Because His Account is Unapproved  ([Click to view full-size image](unlocking-and-approving-user-accounts-cs/_static/image12.png))</span></span>


<span data-ttu-id="4074b-202">Per testare la funzionalità di bloccata, tentare di eseguire l'accesso come utente autorizzato, ma utilizzare una password errata.</span><span class="sxs-lookup"><span data-stu-id="4074b-202">To test the locked out functionality, attempt to login as an approved user, but use an incorrect password.</span></span> <span data-ttu-id="4074b-203">Ripetere questo processo, il numero di volte fino a quando non è stato bloccato l'account utente necessari. Il controllo di accesso è stato inoltre aggiornato per mostrare un oggetto personalizzato dei messaggi se il tentativo di accesso da un account bloccato.</span><span class="sxs-lookup"><span data-stu-id="4074b-203">Repeat this process the necessary number of times until the user's account has been locked out. The Login control was also updated to show a custom message if attempting to login from a locked out account.</span></span> <span data-ttu-id="4074b-204">Si è certi che un account è stato bloccato quando si inizia a visualizzare il messaggio seguente nella pagina di accesso: "l'account è stato bloccato a causa di troppi tentativi di accesso non valido.</span><span class="sxs-lookup"><span data-stu-id="4074b-204">You know that an account has been locked out once you start seeing the following message at the login page: "Your account has been locked out because of too many invalid login attempts.</span></span> <span data-ttu-id="4074b-205">Contattare l'amministratore per l'account sbloccato."</span><span class="sxs-lookup"><span data-stu-id="4074b-205">Please contact the administrator to have your account unlocked."</span></span>

<span data-ttu-id="4074b-206">Restituito per il `ManageUsers.aspx` pagina e fare clic sul collegamento di gestione per l'utente bloccato.</span><span class="sxs-lookup"><span data-stu-id="4074b-206">Return to the `ManageUsers.aspx` page and click the Manage link for the locked out user.</span></span> <span data-ttu-id="4074b-207">Come illustrato nella figura 5, si dovrebbe essere un valore di `LastLockedOutDateLabel` pulsante Sblocca utente deve essere abilitato.</span><span class="sxs-lookup"><span data-stu-id="4074b-207">As Figure 5 shows, you should see a value in the `LastLockedOutDateLabel` the Unlock User button should be enabled.</span></span> <span data-ttu-id="4074b-208">Fare clic sul pulsante Sblocca utente per sbloccare l'account utente.</span><span class="sxs-lookup"><span data-stu-id="4074b-208">Click the Unlock User button to unlock the user account.</span></span> <span data-ttu-id="4074b-209">Dopo aver sbloccato l'utente, saranno in grado di nuovo l'accesso.</span><span class="sxs-lookup"><span data-stu-id="4074b-209">Once you have unlocked the user, they will be able to login again.</span></span>


<span data-ttu-id="4074b-210">[![Dave è stato bloccato per il sistema](unlocking-and-approving-user-accounts-cs/_static/image14.png)](unlocking-and-approving-user-accounts-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="4074b-210">[![Dave Has Been Locked Out of the System](unlocking-and-approving-user-accounts-cs/_static/image14.png)](unlocking-and-approving-user-accounts-cs/_static/image13.png)</span></span>

<span data-ttu-id="4074b-211">**Figura 5**: Dave è stato bloccato Out del sistema ([fare clic per visualizzare l'immagine ingrandita](unlocking-and-approving-user-accounts-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="4074b-211">**Figure 5**: Dave Has Been Locked Out of the System  ([Click to view full-size image](unlocking-and-approving-user-accounts-cs/_static/image15.png))</span></span>


## <a name="step-2-specifying-new-users-approved-status"></a><span data-ttu-id="4074b-212">Passaggio 2: Specificare nuovi utenti approvati stato</span><span class="sxs-lookup"><span data-stu-id="4074b-212">Step 2: Specifying New Users' Approved Status</span></span>

<span data-ttu-id="4074b-213">Lo stato approvato è utile negli scenari in cui si desidera un'azione da eseguire prima un nuovo utente è in grado di connettersi e accedere alle funzionalità specifiche dell'utente del sito.</span><span class="sxs-lookup"><span data-stu-id="4074b-213">The approved status is useful in scenarios where you want some action to be performed before a new user is able to login and access the user-specific features of the site.</span></span> <span data-ttu-id="4074b-214">Ad esempio, si potrebbe essere in esecuzione un sito Web privato in cui tutte le pagine, ad eccezione delle pagine di accesso e l'iscrizione, sono accessibili solo agli utenti autenticati.</span><span class="sxs-lookup"><span data-stu-id="4074b-214">For example, you may be running a private website where all pages, except for the login and signup pages, are accessible only to authenticated users.</span></span> <span data-ttu-id="4074b-215">Ma cosa accade se un estraneo raggiunge il sito Web, consente di trovare la pagina di iscrizione e crea un account?</span><span class="sxs-lookup"><span data-stu-id="4074b-215">But what happens if a stranger reaches your website, finds the signup page, and creates an account?</span></span> <span data-ttu-id="4074b-216">Per evitare questa situazione è possibile spostare la pagina di iscrizione per un `Administration` cartella e richiede che un amministratore di creare manualmente ogni account.</span><span class="sxs-lookup"><span data-stu-id="4074b-216">To prevent this from happening you could move the signup page to an `Administration` folder, and require that an administrator manually create each account.</span></span> <span data-ttu-id="4074b-217">In alternativa, è possibile consentono a chiunque di iscrizione, ma non consentire l'accesso del sito fino a quando non approvate da un amministratore dell'account utente.</span><span class="sxs-lookup"><span data-stu-id="4074b-217">Alternatively, you could allow anyone to signup, but prohibit site access until an administrator approves the user account.</span></span>

<span data-ttu-id="4074b-218">Per impostazione predefinita, il controllo CreateUserWizard Approva nuovi account.</span><span class="sxs-lookup"><span data-stu-id="4074b-218">By default, the CreateUserWizard control approves new accounts.</span></span> <span data-ttu-id="4074b-219">È possibile configurare questo comportamento utilizzando il controllo [ `DisableCreatedUser` proprietà](https://msdn.microsoft.com/en-gb/library/system.web.ui.webcontrols.createuserwizard.disablecreateduser.aspx).</span><span class="sxs-lookup"><span data-stu-id="4074b-219">You can configure this behavior using the control's [`DisableCreatedUser` property](https://msdn.microsoft.com/en-gb/library/system.web.ui.webcontrols.createuserwizard.disablecreateduser.aspx).</span></span> <span data-ttu-id="4074b-220">Impostare questa proprietà su `true` non approvare nuovi account utente.</span><span class="sxs-lookup"><span data-stu-id="4074b-220">Set this property to `true` to not approve new user accounts.</span></span>

> [!NOTE]
> <span data-ttu-id="4074b-221">Per impostazione predefinita il controllo CreateUserWizard accede automaticamente al nuovo account utente.</span><span class="sxs-lookup"><span data-stu-id="4074b-221">By default the CreateUserWizard control automatically logs on the new user account.</span></span> <span data-ttu-id="4074b-222">Questo comportamento è determinato del controllo [ `LoginCreatedUser` proprietà](https://msdn.microsoft.com/en-gb/library/system.web.ui.webcontrols.createuserwizard.logincreateduser.aspx).</span><span class="sxs-lookup"><span data-stu-id="4074b-222">This behavior is dictated by the control's [`LoginCreatedUser` property](https://msdn.microsoft.com/en-gb/library/system.web.ui.webcontrols.createuserwizard.logincreateduser.aspx).</span></span> <span data-ttu-id="4074b-223">Poiché gli utenti non approvati impossibilità di accedere al sito, quando `DisableCreatedUser` è `true` il nuovo account utente non è connesso al sito, indipendentemente dal valore della `LoginCreatedUser` proprietà.</span><span class="sxs-lookup"><span data-stu-id="4074b-223">Because unapproved users cannot login to the site, when `DisableCreatedUser` is `true` the new user account is not logged into the site, regardless of the value of the `LoginCreatedUser` property.</span></span>


<span data-ttu-id="4074b-224">Se si crea a livello di codice nuovi account utente tramite il `Membership.CreateUser` metodo, per creare un account utente non approvati, usare uno degli overload che accettano il nuovo utente `IsApproved` valore della proprietà come parametro di input.</span><span class="sxs-lookup"><span data-stu-id="4074b-224">If you are programmatically creating new user accounts via the `Membership.CreateUser` method, to create an unapproved user account use one of the overloads that accept the new user's `IsApproved` property value as an input parameter.</span></span>

## <a name="step-3-approving-users-by-verifying-their-email-address"></a><span data-ttu-id="4074b-225">Passaggio 3: Approvazione utenti verificando l'indirizzo di posta elettronica</span><span class="sxs-lookup"><span data-stu-id="4074b-225">Step 3: Approving Users By Verifying their Email Address</span></span>

<span data-ttu-id="4074b-226">Molti siti Web che supportano gli account utente non approvare nuovi utenti fino a quando non si verifica l'indirizzo di posta elettronica che sono forniti durante la registrazione.</span><span class="sxs-lookup"><span data-stu-id="4074b-226">Many websites that support user accounts do not approve new users until they verify the email address they supplied when registering.</span></span> <span data-ttu-id="4074b-227">Il processo di verifica in genere viene utilizzato per contrastare robot, invio di posta indesiderata e altri ne'er-do-wells perché richiede un indirizzo di posta elettronica univoco, verifica e aggiunge un ulteriore passaggio nel processo di iscrizione.</span><span class="sxs-lookup"><span data-stu-id="4074b-227">This verification process is commonly used to thwart bots, spammers, and other ne'er-do-wells as it requires a unique, verified email address and adds an extra step in the signup process.</span></span> <span data-ttu-id="4074b-228">Con questo modello, quando un nuovo utente effettua l'iscrizione viene effettuato un messaggio di posta elettronica che include un collegamento a una pagina di verifica.</span><span class="sxs-lookup"><span data-stu-id="4074b-228">With this model, when a new user signs up they are sent an email message that includes a link to a verification page.</span></span> <span data-ttu-id="4074b-229">Facendo clic sul link l'utente ha dimostrato che ricevono il messaggio di posta elettronica e, pertanto che l'indirizzo e-mail fornito è valido.</span><span class="sxs-lookup"><span data-stu-id="4074b-229">By visiting the link the user has proven that they received the email and, therefore, that the email address provided is valid.</span></span> <span data-ttu-id="4074b-230">La pagina di verifica è responsabile dell'approvazione dell'utente.</span><span class="sxs-lookup"><span data-stu-id="4074b-230">The verification page is responsible for approving the user.</span></span> <span data-ttu-id="4074b-231">Questo può essere eseguita automaticamente, in tal modo approvazione tutti gli utenti che raggiungono questa pagina, o solo dopo che l'utente fornisce informazioni aggiuntive, ad esempio un [CAPTCHA](http://en.wikipedia.org/wiki/Captcha).</span><span class="sxs-lookup"><span data-stu-id="4074b-231">This may happen automatically, thereby approving any user who reaches this page, or only after the user provides some additional information, such as a [CAPTCHA](http://en.wikipedia.org/wiki/Captcha).</span></span>

<span data-ttu-id="4074b-232">Per gestire il flusso di lavoro, è necessario innanzitutto aggiornare la pagina di creazione di account in modo che i nuovi utenti sono non approvati.</span><span class="sxs-lookup"><span data-stu-id="4074b-232">To accommodate this workflow, we need to first update the account creation page so that new users are unapproved.</span></span> <span data-ttu-id="4074b-233">Aprire il `EnhancedCreateUserWizard.aspx` nella pagina di `Membership` cartella e il controllo CreateUserWizard insieme `DisableCreatedUser` proprietà `true`.</span><span class="sxs-lookup"><span data-stu-id="4074b-233">Open the `EnhancedCreateUserWizard.aspx` page in the `Membership` folder and set the CreateUserWizard control's `DisableCreatedUser` property to `true`.</span></span>

<span data-ttu-id="4074b-234">Successivamente, è necessario configurare il controllo CreateUserWizard per inviare un messaggio di posta elettronica per il nuovo utente con istruzioni su come verificare il proprio account.</span><span class="sxs-lookup"><span data-stu-id="4074b-234">Next, we need to configure the CreateUserWizard control to send an email to the new user with instructions on how to verify their account.</span></span> <span data-ttu-id="4074b-235">In particolare, verrà incluso un collegamento nel messaggio di posta elettronica per il `Verification.aspx` pagina (che sono state ancora da creare), passando il nuovo utente `UserId` tramite la stringa di query.</span><span class="sxs-lookup"><span data-stu-id="4074b-235">In particular, we will include a link in the email to the `Verification.aspx` page (which we've yet to create), passing in the new user's `UserId` through the querystring.</span></span> <span data-ttu-id="4074b-236">Il `Verification.aspx` pagina cercare l'utente specificato e contrassegnarli approvato.</span><span class="sxs-lookup"><span data-stu-id="4074b-236">The `Verification.aspx` page will lookup the specified user and mark them approved.</span></span>

### <a name="sending-a-verification-email-to-new-users"></a><span data-ttu-id="4074b-237">L'invio di un messaggio di verifica ai nuovi utenti</span><span class="sxs-lookup"><span data-stu-id="4074b-237">Sending a Verification Email to New Users</span></span>

<span data-ttu-id="4074b-238">Per inviare un messaggio di posta elettronica dal controllo CreateUserWizard, configurare il relativo `MailDefinition` proprietà in modo appropriato.</span><span class="sxs-lookup"><span data-stu-id="4074b-238">To send an email from the CreateUserWizard control, configure its `MailDefinition` property appropriately.</span></span> <span data-ttu-id="4074b-239">Come descritto nel <a id="Tutorial13"> </a> [esercitazione precedente](recovering-and-changing-passwords-cs.md), i controlli ChangePassword e PasswordRecovery includono un [ `MailDefinition` proprietà](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.maildefinition.aspx) che funziona in modo analogo CreateUserWizard del controllo.</span><span class="sxs-lookup"><span data-stu-id="4074b-239">As discussed in the <a id="Tutorial13"></a>[previous tutorial](recovering-and-changing-passwords-cs.md), the ChangePassword and PasswordRecovery controls include a [`MailDefinition` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.maildefinition.aspx) that works in the same manner as the CreateUserWizard control's.</span></span>

> [!NOTE]
> <span data-ttu-id="4074b-240">Utilizzare il `MailDefinition` opzioni di proprietà, è necessario specificare il recapito della posta in `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="4074b-240">To use the `MailDefinition` property you need to specify mail delivery options in `Web.config`.</span></span> <span data-ttu-id="4074b-241">Per ulteriori informazioni, vedere [l'invio di posta elettronica in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="4074b-241">For more information, refer to [Sending Email in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx).</span></span>


<span data-ttu-id="4074b-242">Iniziare creando un nuovo modello di posta elettronica denominato `CreateUserWizard.txt` nel `EmailTemplates` cartella.</span><span class="sxs-lookup"><span data-stu-id="4074b-242">Start by creating a new email template named `CreateUserWizard.txt` in the `EmailTemplates` folder.</span></span> <span data-ttu-id="4074b-243">Utilizzare il seguente testo per il modello:</span><span class="sxs-lookup"><span data-stu-id="4074b-243">Use the following text for the template:</span></span>

[!code-aspx[Main](unlocking-and-approving-user-accounts-cs/samples/sample3.aspx)]

<span data-ttu-id="4074b-244">Impostare il `MailDefinition'` s `BodyFileName` proprietà su "~ / EmailTemplates/CreateUserWizard.txt" e il relativo `Subject` proprietà su "Benvenuti al mio sito Web</span><span class="sxs-lookup"><span data-stu-id="4074b-244">Set the `MailDefinition'` s `BodyFileName` property to "~/EmailTemplates/CreateUserWizard.txt" and its `Subject` property to "Welcome to My Website!</span></span> <span data-ttu-id="4074b-245">Attivare l'account."</span><span class="sxs-lookup"><span data-stu-id="4074b-245">Please activate your account."</span></span>

<span data-ttu-id="4074b-246">Si noti che il `CreateUserWizard.txt` modello di posta elettronica include un `<%VerificationUrl%>` segnaposto.</span><span class="sxs-lookup"><span data-stu-id="4074b-246">Note that the `CreateUserWizard.txt` email template includes a `<%VerificationUrl%>` placeholder.</span></span> <span data-ttu-id="4074b-247">Questa opzione è quando l'URL per il `Verification.aspx` pagina verrà inserita.</span><span class="sxs-lookup"><span data-stu-id="4074b-247">This is where the URL for the `Verification.aspx` page will be placed.</span></span> <span data-ttu-id="4074b-248">CreateUserWizard sostituisce automaticamente il `<%UserName%>` e `<%Password%>` segnaposto con il nuovo account nome utente e password, ma non esiste alcun incorporato `<%VerificationUrl%>` segnaposto.</span><span class="sxs-lookup"><span data-stu-id="4074b-248">The CreateUserWizard automatically replaces the `<%UserName%>` and `<%Password%>` placeholders with the new account's username and password, but there is no built-in `<%VerificationUrl%>` placeholder.</span></span> <span data-ttu-id="4074b-249">È necessario sostituire manualmente con l'URL di verifica appropriati.</span><span class="sxs-lookup"><span data-stu-id="4074b-249">We need to manually replace it with the appropriate verification URL.</span></span>

<span data-ttu-id="4074b-250">A tale scopo, creare un gestore eventi per il CreateUserWizard [ `SendingMail` evento](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.sendingmail.aspx) e aggiungere il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="4074b-250">To accomplish this, create an event handler for the CreateUserWizard's [`SendingMail` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.sendingmail.aspx) and add the following code:</span></span>

[!code-csharp[Main](unlocking-and-approving-user-accounts-cs/samples/sample4.cs)]

<span data-ttu-id="4074b-251">Il `SendingMail` evento viene generato dopo il `CreatedUser` evento, vale a dire che nel momento in cui il gestore dell'evento precedente viene eseguito il nuovo utente account è già stato creato.</span><span class="sxs-lookup"><span data-stu-id="4074b-251">The `SendingMail` event fires after the `CreatedUser` event, meaning that by the time the above event handler executes the new user account has already been created.</span></span> <span data-ttu-id="4074b-252">È possibile accedere al nuovo utente `UserId` valore chiamando il `Membership.GetUser` metodo passando la `UserName` immesso nel controllo CreateUserWizard.</span><span class="sxs-lookup"><span data-stu-id="4074b-252">We can access the new user's `UserId` value by calling the `Membership.GetUser` method, passing in the `UserName` entered into the CreateUserWizard control.</span></span> <span data-ttu-id="4074b-253">Successivamente, l'URL di verifica è corretto.</span><span class="sxs-lookup"><span data-stu-id="4074b-253">Next, the verification URL is formed.</span></span> <span data-ttu-id="4074b-254">L'istruzione `Request.Url.GetLeftPart(UriPartial.Authority)` restituisce il `http://yourserver.com` parte dell'URL; `Request.ApplicationPath` restituisce percorso in cui è possibile eseguire l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="4074b-254">The statement `Request.Url.GetLeftPart(UriPartial.Authority)` returns the `http://yourserver.com` portion of the URL; `Request.ApplicationPath` returns path where the application is rooted.</span></span> <span data-ttu-id="4074b-255">La verifica URL viene quindi definito come `Verification.aspx?ID=userId`.</span><span class="sxs-lookup"><span data-stu-id="4074b-255">The verification URL is then defined as `Verification.aspx?ID=userId`.</span></span> <span data-ttu-id="4074b-256">Questi due stringhe vengono quindi concatenate per formare l'URL completo.</span><span class="sxs-lookup"><span data-stu-id="4074b-256">These two strings are then concatenated to form the complete URL.</span></span> <span data-ttu-id="4074b-257">Infine, il corpo del messaggio di posta elettronica (`e.Message.Body`) dispone di tutte le occorrenze di `<%VerificationUrl%>` sostituito con l'URL completo.</span><span class="sxs-lookup"><span data-stu-id="4074b-257">Finally, the email message body (`e.Message.Body`) has all occurrences of `<%VerificationUrl%>` replaced with the full URL.</span></span>

<span data-ttu-id="4074b-258">L'effetto finale è che i nuovi utenti sono non approvati, vale a dire che non accedono al sito.</span><span class="sxs-lookup"><span data-stu-id="4074b-258">The net effect is that new users are unapproved, meaning that they cannot log into the site.</span></span> <span data-ttu-id="4074b-259">Inoltre, essi vengono inviati automaticamente un messaggio di posta elettronica con un collegamento all'URL di verifica (vedere Figura 6).</span><span class="sxs-lookup"><span data-stu-id="4074b-259">Furthermore, they are automatically sent an email with a link to the verification URL (see Figure 6).</span></span>


<span data-ttu-id="4074b-260">[![Il nuovo utente riceve un messaggio di posta elettronica con un collegamento all'URL di verifica](unlocking-and-approving-user-accounts-cs/_static/image17.png)](unlocking-and-approving-user-accounts-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="4074b-260">[![The New User Receives an Email with a Link to the Verification URL](unlocking-and-approving-user-accounts-cs/_static/image17.png)](unlocking-and-approving-user-accounts-cs/_static/image16.png)</span></span>

<span data-ttu-id="4074b-261">**Figura 6**: il nuovo utente riceve un messaggio di posta elettronica con un collegamento all'URL di verifica ([fare clic per visualizzare l'immagine ingrandita](unlocking-and-approving-user-accounts-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="4074b-261">**Figure 6**: The New User Receives an Email with a Link to the Verification URL  ([Click to view full-size image](unlocking-and-approving-user-accounts-cs/_static/image18.png))</span></span>


> [!NOTE]
> <span data-ttu-id="4074b-262">Passaggio di CreateUserWizard predefinito del controllo CreateUserWizard Visualizza un messaggio che informa l'utente con il proprio account è stato creato e viene visualizzato un pulsante Continua.</span><span class="sxs-lookup"><span data-stu-id="4074b-262">The CreateUserWizard control's default CreateUserWizard step displays a message informing the user their account has been created and displays a Continue button.</span></span> <span data-ttu-id="4074b-263">Facendo clic su questa richiede l'utente all'URL specificato per il controllo `ContinueDestinationPageUrl` proprietà.</span><span class="sxs-lookup"><span data-stu-id="4074b-263">Clicking this takes the user to the URL specified by the control's `ContinueDestinationPageUrl` property.</span></span> <span data-ttu-id="4074b-264">CreateUserWizard in `EnhancedCreateUserWizard.aspx` è configurato per inviare ai nuovi utenti del `~/Membership/AdditionalUserInfo.aspx`, che richiede l'immissione di loro hometown URL home page e firma.</span><span class="sxs-lookup"><span data-stu-id="4074b-264">The CreateUserWizard in `EnhancedCreateUserWizard.aspx` is configured to send new users to the `~/Membership/AdditionalUserInfo.aspx`, which prompts the user for their hometown, homepage URL, and signature.</span></span> <span data-ttu-id="4074b-265">Poiché queste informazioni possono essere aggiunti solo da utenti con accesso, è opportuno aggiornare questa proprietà per l'invio di utenti alla home page del sito (`~/Default.aspx`).</span><span class="sxs-lookup"><span data-stu-id="4074b-265">Because this information can only be added by logged on users, it makes sense to update this property to send users back to the site's homepage (`~/Default.aspx`).</span></span> <span data-ttu-id="4074b-266">Inoltre, il `EnhancedCreateUserWizard.aspx` pagina o il passaggio CreateUserWizard deve essere ampliato per informare l'utente che sono stati inviati un messaggio di verifica e il proprio account non verrà attivato fino a quando non seguono le istruzioni riportate in questo messaggio di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="4074b-266">Moreover, the `EnhancedCreateUserWizard.aspx` page or the CreateUserWizard step should be augmented to inform the user that they have been sent a verification email and their account won't be activated until they follow the instructions in this email.</span></span> <span data-ttu-id="4074b-267">Un esercizio lasciare queste modifiche per il lettore.</span><span class="sxs-lookup"><span data-stu-id="4074b-267">I leave these modifications as an exercise for the reader.</span></span>


### <a name="creating-the-verification-page"></a><span data-ttu-id="4074b-268">Creazione della pagina di verifica</span><span class="sxs-lookup"><span data-stu-id="4074b-268">Creating the Verification Page</span></span>

<span data-ttu-id="4074b-269">L'attività finale consiste nel creare il `Verification.aspx` pagina.</span><span class="sxs-lookup"><span data-stu-id="4074b-269">Our final task is to create the `Verification.aspx` page.</span></span> <span data-ttu-id="4074b-270">Aggiungere questa pagina per la cartella radice, associarla al `Site.master` pagina master.</span><span class="sxs-lookup"><span data-stu-id="4074b-270">Add this page to the root folder, associating it with the `Site.master` master page.</span></span> <span data-ttu-id="4074b-271">Come che abbiamo realizzato con la maggior parte delle pagine precedenti contenute aggiunte al sito, rimuovere il controllo contenuto che fa riferimento il `LoginContent` ContentPlaceHolder in modo che la pagina di contenuto utilizza la pagina master di contenuto predefinito.</span><span class="sxs-lookup"><span data-stu-id="4074b-271">As we've done with most of the previous content pages added to the site, remove the Content control that references the `LoginContent` ContentPlaceHolder so that the content page uses the master page's default content.</span></span>

<span data-ttu-id="4074b-272">Aggiungere un controllo etichetta Web per il `Verification.aspx` pagina, impostare il relativo `ID` a `StatusMessage` e cancellare la proprietà text.</span><span class="sxs-lookup"><span data-stu-id="4074b-272">Add a Label Web control to the `Verification.aspx` page, set its `ID` to `StatusMessage` and clear out its text property.</span></span> <span data-ttu-id="4074b-273">Successivamente, creare il `Page_Load` gestore dell'evento e aggiungere il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="4074b-273">Next, create the `Page_Load` event handler and add the following code:</span></span>

[!code-csharp[Main](unlocking-and-approving-user-accounts-cs/samples/sample5.cs)]

<span data-ttu-id="4074b-274">La maggior parte del codice precedente verifica che il `UserId` fornito tramite il parametro querystring esista, che è un valido `Guid` valore e che fa riferimento a un account utente esistente.</span><span class="sxs-lookup"><span data-stu-id="4074b-274">The bulk of the above code verifies that the `UserId` supplied through the querystring exists, that it is a valid `Guid` value, and that it references an existing user account.</span></span> <span data-ttu-id="4074b-275">Se tutti questi controlli di esito positivo, l'account utente è approvato; in caso contrario, viene visualizzato un messaggio di stato appropriato.</span><span class="sxs-lookup"><span data-stu-id="4074b-275">If all of these checks pass, the user account is approved; otherwise, a suitable status message is displayed.</span></span>

<span data-ttu-id="4074b-276">Figura 7 illustra il `Verification.aspx` pagina quando visitato tramite un browser.</span><span class="sxs-lookup"><span data-stu-id="4074b-276">Figure 7 shows the `Verification.aspx` page when visited through a browser.</span></span>


<span data-ttu-id="4074b-277">[![Il Account utente nuovo è approvato ora](unlocking-and-approving-user-accounts-cs/_static/image20.png)](unlocking-and-approving-user-accounts-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="4074b-277">[![The New User's Account is Now Approved](unlocking-and-approving-user-accounts-cs/_static/image20.png)](unlocking-and-approving-user-accounts-cs/_static/image19.png)</span></span>

<span data-ttu-id="4074b-278">**Figura 7**: Account utente nuovo il è ora Approved ([fare clic per visualizzare l'immagine ingrandita](unlocking-and-approving-user-accounts-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="4074b-278">**Figure 7**: The New User's Account is Now Approved  ([Click to view full-size image](unlocking-and-approving-user-accounts-cs/_static/image21.png))</span></span>


## <a name="summary"></a><span data-ttu-id="4074b-279">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="4074b-279">Summary</span></span>

<span data-ttu-id="4074b-280">Tutti gli account utente di appartenenza dispongano di due stati che determinano se l'utente può accedere al sito: `IsLockedOut` e `IsApproved`.</span><span class="sxs-lookup"><span data-stu-id="4074b-280">All Membership user accounts have two statuses that determine whether the user can log into the site: `IsLockedOut` and `IsApproved`.</span></span> <span data-ttu-id="4074b-281">Entrambe queste proprietà devono essere `true` per l'utente all'account di accesso.</span><span class="sxs-lookup"><span data-stu-id="4074b-281">Both of these properties must be `true` for the user to login.</span></span>

<span data-ttu-id="4074b-282">L'utente del bloccato lo stato viene utilizzato come misura di sicurezza per ridurre la probabilità che un pirata informatico la suddivisione in un sito tramite i metodi di attacchi di forza bruta.</span><span class="sxs-lookup"><span data-stu-id="4074b-282">The user's locked out status is used as a security measure to reduce the likelihood of a hacker breaking into a site through brute force methods.</span></span> <span data-ttu-id="4074b-283">In particolare, un utente viene bloccato se sono presenti un certo numero di tentativi di accesso non valido all'interno di un determinato intervallo di tempo.</span><span class="sxs-lookup"><span data-stu-id="4074b-283">Specifically, a user is locked out if there are a certain number of invalid login attempts within a certain window of time.</span></span> <span data-ttu-id="4074b-284">Questi limiti sono configurabili tramite le impostazioni del provider di appartenenze in `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="4074b-284">These bounds are configurable through the Membership provider settings in `Web.config`.</span></span>

<span data-ttu-id="4074b-285">Lo stato approvato in genere viene utilizzato come mezzo per impedire l'accesso fino a quando non è trascorso di un'azione di nuovi utenti.</span><span class="sxs-lookup"><span data-stu-id="4074b-285">The approved status is commonly used as a means to prohibit new users from logging in until some action has transpired.</span></span> <span data-ttu-id="4074b-286">Ad esempio il sito Web richiede che i nuovi account essere prima approvata dall'amministratore o, come illustrato nel passaggio 3, verificando l'indirizzo di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="4074b-286">Perhaps the site requires that new accounts first be approved by the administrator or, as we saw in Step 3, by verifying their email address.</span></span>

<span data-ttu-id="4074b-287">Buona programmazione!</span><span class="sxs-lookup"><span data-stu-id="4074b-287">Happy Programming!</span></span>

### <a name="about-the-author"></a><span data-ttu-id="4074b-288">Informazioni sull'autore</span><span class="sxs-lookup"><span data-stu-id="4074b-288">About the Author</span></span>

<span data-ttu-id="4074b-289">Scott Mitchell, autore di più libri e fondatore di 4GuysFromRolla, ha lavorato con tecnologie Web di Microsoft dal 1998.</span><span class="sxs-lookup"><span data-stu-id="4074b-289">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="4074b-290">Scott funziona come un consulente trainer e writer.</span><span class="sxs-lookup"><span data-stu-id="4074b-290">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="4074b-291">Il suo ultimo libro è  *[SAM insegna manualmente ASP.NET 2.0 nelle 24 ore](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span><span class="sxs-lookup"><span data-stu-id="4074b-291">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="4074b-292">Scott può essere raggiunto al [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) o tramite il suo blog all'indirizzo [ http://ScottOnWriting.NET ](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="4074b-292">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="4074b-293">Ringraziamenti speciali...</span><span class="sxs-lookup"><span data-stu-id="4074b-293">Special Thanks To…</span></span>

<span data-ttu-id="4074b-294">Questa serie di esercitazioni è stata esaminata da diversi validi revisori.</span><span class="sxs-lookup"><span data-stu-id="4074b-294">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="4074b-295">Se si è interessati my prossimi articoli MSDN?</span><span class="sxs-lookup"><span data-stu-id="4074b-295">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="4074b-296">In caso affermativo, Inviami una riga alla [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="4074b-296">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="4074b-297">[Precedente](recovering-and-changing-passwords-cs.md)
> [Successivo](building-an-interface-to-select-one-user-account-from-many-vb.md)</span><span class="sxs-lookup"><span data-stu-id="4074b-297">[Previous](recovering-and-changing-passwords-cs.md)
[Next](building-an-interface-to-select-one-user-account-from-many-vb.md)</span></span>
