---
title: Razor pagine unit test in ASP.NET Core
author: guardrex
description: Informazioni su come creare unit test per App di pagine Razor.
ms.author: riande
ms.custom: mvc
ms.date: 11/27/2017
uid: test/razor-pages-tests
ms.openlocfilehash: bde1bef78fcc7ac1d570057d54636ea0f5490de8
ms.sourcegitcommit: a1afd04758e663d7062a5bfa8a0d4dca38f42afc
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/20/2018
ms.locfileid: "36274407"
---
# <a name="razor-pages-unit-tests-in-aspnet-core"></a><span data-ttu-id="7b5d0-103">Razor pagine unit test in ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="7b5d0-103">Razor Pages unit tests in ASP.NET Core</span></span>

<span data-ttu-id="7b5d0-104">Di [Luke Latham](https://github.com/guardrex)</span><span class="sxs-lookup"><span data-stu-id="7b5d0-104">By [Luke Latham](https://github.com/guardrex)</span></span>

<span data-ttu-id="7b5d0-105">ASP.NET Core supporta unit test di App pagine Razor.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-105">ASP.NET Core supports unit tests of Razor Pages apps.</span></span> <span data-ttu-id="7b5d0-106">Test dei dati accedere layer (DAL) e i modelli di pagina consentono di garantire:</span><span class="sxs-lookup"><span data-stu-id="7b5d0-106">Tests of the data access layer (DAL) and page models help ensure:</span></span>

* <span data-ttu-id="7b5d0-107">Parti di un'app di pagine Razor funzionano in modo indipendente e insieme come una singola unità durante la costruzione di app.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-107">Parts of a Razor Pages app work independently and together as a unit during app construction.</span></span>
* <span data-ttu-id="7b5d0-108">Classi e metodi limitata gli ambiti di responsabilità.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-108">Classes and methods have limited scopes of responsibility.</span></span>
* <span data-ttu-id="7b5d0-109">Documentazione aggiuntiva esiste sul comportamento di app.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-109">Additional documentation exists on how the app should behave.</span></span>
* <span data-ttu-id="7b5d0-110">Regressioni, ovvero errori nasce da aggiornamenti al codice, sono disponibili durante la distribuzione e la compilazione automatizzata.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-110">Regressions, which are errors brought about by updates to the code, are found during automated building and deployment.</span></span>

<span data-ttu-id="7b5d0-111">In questo argomento si presuppone una conoscenza di base di pagine Razor App e gli unit test.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-111">This topic assumes that you have a basic understanding of Razor Pages apps and unit tests.</span></span> <span data-ttu-id="7b5d0-112">Se non si ha familiarità con i concetti di test o pagine Razor App, vedere gli argomenti seguenti:</span><span class="sxs-lookup"><span data-stu-id="7b5d0-112">If you're unfamiliar with Razor Pages apps or test concepts, see the following topics:</span></span>

* [<span data-ttu-id="7b5d0-113">Introduzione a Razor Pages in ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="7b5d0-113">Introduction to Razor Pages</span></span>](xref:razor-pages/index)
* [<span data-ttu-id="7b5d0-114">Introduzione a Razor Pages</span><span class="sxs-lookup"><span data-stu-id="7b5d0-114">Get started with Razor Pages</span></span>](xref:tutorials/razor-pages/razor-pages-start)
* [<span data-ttu-id="7b5d0-115">Unit test c# in .NET Core usando xUnit e test dotnet</span><span class="sxs-lookup"><span data-stu-id="7b5d0-115">Unit testing C# in .NET Core using dotnet test and xUnit</span></span>](/dotnet/articles/core/testing/unit-testing-with-dotnet-test)

<span data-ttu-id="7b5d0-116">[Visualizzare o scaricare il codice di esempio](https://github.com/aspnet/Docs/tree/master/aspnetcore/test/razor-pages-tests/samples) ([procedura per il download](xref:tutorials/index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="7b5d0-116">[View or download sample code](https://github.com/aspnet/Docs/tree/master/aspnetcore/test/razor-pages-tests/samples) ([how to download](xref:tutorials/index#how-to-download-a-sample))</span></span>

<span data-ttu-id="7b5d0-117">Il progetto di esempio è costituito da due applicazioni:</span><span class="sxs-lookup"><span data-stu-id="7b5d0-117">The sample project is composed of two apps:</span></span>

| <span data-ttu-id="7b5d0-118">App</span><span class="sxs-lookup"><span data-stu-id="7b5d0-118">App</span></span>         | <span data-ttu-id="7b5d0-119">Cartella di progetto</span><span class="sxs-lookup"><span data-stu-id="7b5d0-119">Project folder</span></span>                        | <span data-ttu-id="7b5d0-120">Descrizione</span><span class="sxs-lookup"><span data-stu-id="7b5d0-120">Description</span></span> |
| ----------- | ------------------------------------- | ----------- |
| <span data-ttu-id="7b5d0-121">App di messaggio</span><span class="sxs-lookup"><span data-stu-id="7b5d0-121">Message app</span></span> | <span data-ttu-id="7b5d0-122">*src/RazorPagesTestSample*</span><span class="sxs-lookup"><span data-stu-id="7b5d0-122">*src/RazorPagesTestSample*</span></span>            | <span data-ttu-id="7b5d0-123">Consente di aggiungere, eliminare uno, eliminare tutti e analizzare i messaggi.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-123">Allows a user to add, delete one, delete all, and analyze messages.</span></span> |
| <span data-ttu-id="7b5d0-124">App di test</span><span class="sxs-lookup"><span data-stu-id="7b5d0-124">Test app</span></span>    | <span data-ttu-id="7b5d0-125">*tests/RazorPagesTestSample.Tests*</span><span class="sxs-lookup"><span data-stu-id="7b5d0-125">*tests/RazorPagesTestSample.Tests*</span></span>    | <span data-ttu-id="7b5d0-126">Utilizzato per unit test di app il messaggio: layer (DAL) e il modello di pagina di indice di accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-126">Used to unit test the message app: Data access layer (DAL) and Index page model.</span></span> |

<span data-ttu-id="7b5d0-127">È possibile eseguire i test utilizzando le funzionalità di test predefinite di IDE, ad esempio [Visual Studio](https://www.visualstudio.com/vs/).</span><span class="sxs-lookup"><span data-stu-id="7b5d0-127">The tests can be run using the built-in test features of an IDE, such as [Visual Studio](https://www.visualstudio.com/vs/).</span></span> <span data-ttu-id="7b5d0-128">Se si utilizza [Visual Studio Code](https://code.visualstudio.com/) o la riga di comando, eseguire il comando seguente al prompt dei comandi nel *tests/RazorPagesTestSample.Tests* cartella:</span><span class="sxs-lookup"><span data-stu-id="7b5d0-128">If using [Visual Studio Code](https://code.visualstudio.com/) or the command line, execute the following command at a command prompt in the *tests/RazorPagesTestSample.Tests* folder:</span></span>

```console
dotnet test
```

## <a name="message-app-organization"></a><span data-ttu-id="7b5d0-129">Organizzazione di app di messaggio</span><span class="sxs-lookup"><span data-stu-id="7b5d0-129">Message app organization</span></span>

<span data-ttu-id="7b5d0-130">L'applicazione di messaggio è un semplice sistema messaggio Razor pagine con le caratteristiche seguenti:</span><span class="sxs-lookup"><span data-stu-id="7b5d0-130">The message app is a simple Razor Pages message system with the following characteristics:</span></span>

* <span data-ttu-id="7b5d0-131">La pagina di indice dell'app (*Pages/Index.cshtml* e *Pages/Index.cshtml.cs*) fornisce un'interfaccia utente e una pagina di metodi del modello per controllare l'aggiunta, eliminazione e l'analisi dei messaggi (parole medie per ogni messaggio) .</span><span class="sxs-lookup"><span data-stu-id="7b5d0-131">The Index page of the app (*Pages/Index.cshtml* and *Pages/Index.cshtml.cs*) provides a UI and page model methods to control the addition, deletion, and analysis of messages (average words per message).</span></span>
* <span data-ttu-id="7b5d0-132">Viene descritto un messaggio dal `Message` classe (*Data/Message.cs*) con due proprietà: `Id` (chiave) e `Text` (messaggio).</span><span class="sxs-lookup"><span data-stu-id="7b5d0-132">A message is described by the `Message` class (*Data/Message.cs*) with two properties: `Id` (key) and `Text` (message).</span></span> <span data-ttu-id="7b5d0-133">Il `Text` proprietà è necessaria e limitata a 200 caratteri.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-133">The `Text` property is required and limited to 200 characters.</span></span>
* <span data-ttu-id="7b5d0-134">I messaggi vengono archiviati utilizzando [database in memoria di Entity Framework](/ef/core/providers/in-memory/)&#8224;.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-134">Messages are stored using [Entity Framework's in-memory database](/ef/core/providers/in-memory/)&#8224;.</span></span>
* <span data-ttu-id="7b5d0-135">L'app contiene un livello di accesso ai dati (DAL) nella relativa classe di contesto di database, `AppDbContext` (*Data/AppDbContext.cs*).</span><span class="sxs-lookup"><span data-stu-id="7b5d0-135">The app contains a data access layer (DAL) in its database context class, `AppDbContext` (*Data/AppDbContext.cs*).</span></span> <span data-ttu-id="7b5d0-136">I metodi DAL sono contrassegnati `virtual`, che consente a tali i metodi da utilizzare nei test.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-136">The DAL methods are marked `virtual`, which allows mocking the methods for use in the tests.</span></span>
* <span data-ttu-id="7b5d0-137">Se il database è vuoto all'avvio dell'app, l'archivio di messaggi viene inizializzato con tre messaggi.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-137">If the database is empty on app startup, the message store is initialized with three messages.</span></span> <span data-ttu-id="7b5d0-138">Questi *sottoposto a seeding messaggi* utilizzati anche nei test.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-138">These *seeded messages* are also used in tests.</span></span>

<span data-ttu-id="7b5d0-139">&#8224;L'argomento EF [Test con InMemory](/ef/core/miscellaneous/testing/in-memory), viene illustrato come utilizzare un database in memoria per i test con MSTest.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-139">&#8224;The EF topic, [Test with InMemory](/ef/core/miscellaneous/testing/in-memory), explains how to use an in-memory database for tests with MSTest.</span></span> <span data-ttu-id="7b5d0-140">Questo argomento viene utilizzato il [xUnit](https://xunit.github.io/) framework di test.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-140">This topic uses the [xUnit](https://xunit.github.io/) test framework.</span></span> <span data-ttu-id="7b5d0-141">Concetti di test e le implementazioni di test tra test diversi Framework sono simili ma non identica.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-141">Test concepts and test implementations across different test frameworks are similar but not identical.</span></span>

<span data-ttu-id="7b5d0-142">Anche se l'app non usa il [modello di repository](http://martinfowler.com/eaaCatalog/repository.html) e non è un esempio efficace del [modello unità di lavoro (UoW)](https://martinfowler.com/eaaCatalog/unitOfWork.html), pagine Razor supporta questi modelli di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-142">Although the app doesn't use the [repository pattern](http://martinfowler.com/eaaCatalog/repository.html) and isn't an effective example of the [Unit of Work (UoW) pattern](https://martinfowler.com/eaaCatalog/unitOfWork.html), Razor Pages supports these patterns of development.</span></span> <span data-ttu-id="7b5d0-143">Per altre informazioni, vedere [progetta il livello di persistenza infrastruttura](/dotnet/standard/microservices-architecture/microservice-ddd-cqrs-patterns/infrastructure-persistence-layer-design), [implementazione del Repository e modelli di unità di lavoro in un'applicazione MVC ASP.NET](/aspnet/mvc/overview/older-versions/getting-started-with-ef-5-using-mvc-4/implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application), e [controller di Test logica](/aspnet/core/mvc/controllers/testing) (l'esempio implementa il modello di repository).</span><span class="sxs-lookup"><span data-stu-id="7b5d0-143">For more information, see [Designing the infrastructure persistence layer](/dotnet/standard/microservices-architecture/microservice-ddd-cqrs-patterns/infrastructure-persistence-layer-design), [Implementing the Repository and Unit of Work Patterns in an ASP.NET MVC Application](/aspnet/mvc/overview/older-versions/getting-started-with-ef-5-using-mvc-4/implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application), and [Test controller logic](/aspnet/core/mvc/controllers/testing) (the sample implements the repository pattern).</span></span>

## <a name="test-app-organization"></a><span data-ttu-id="7b5d0-144">Organizzazione di app di test</span><span class="sxs-lookup"><span data-stu-id="7b5d0-144">Test app organization</span></span>

<span data-ttu-id="7b5d0-145">L'app di test è un'applicazione console all'interno di *tests/RazorPagesTestSample.Tests* cartella.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-145">The test app is a console app inside the *tests/RazorPagesTestSample.Tests* folder.</span></span>

| <span data-ttu-id="7b5d0-146">Cartella di app di test</span><span class="sxs-lookup"><span data-stu-id="7b5d0-146">Test app folder</span></span> | <span data-ttu-id="7b5d0-147">Descrizione</span><span class="sxs-lookup"><span data-stu-id="7b5d0-147">Description</span></span> |
| --------------- | ----------- |
| <span data-ttu-id="7b5d0-148">*UnitTests*</span><span class="sxs-lookup"><span data-stu-id="7b5d0-148">*UnitTests*</span></span>     | <ul><li><span data-ttu-id="7b5d0-149">*DataAccessLayerTest.cs* contiene unit test per DAL.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-149">*DataAccessLayerTest.cs* contains the unit tests for the DAL.</span></span></li><li><span data-ttu-id="7b5d0-150">*IndexPageTests.cs* contiene gli unit test per il modello di pagina di indice.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-150">*IndexPageTests.cs* contains the unit tests for the Index page model.</span></span></li></ul> |
| <span data-ttu-id="7b5d0-151">*Utilità*</span><span class="sxs-lookup"><span data-stu-id="7b5d0-151">*Utilities*</span></span>     | <span data-ttu-id="7b5d0-152">Contiene il `TestingDbContextOptions` metodo utilizzato per creare le opzioni di contesto per ogni unit test DAL nuovo database in modo che il database viene reimpostato su relativa condizione della linea di base per ogni test.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-152">Contains the `TestingDbContextOptions` method used to create new database context options for each DAL unit test so that the database is reset to its baseline condition for each test.</span></span> |

<span data-ttu-id="7b5d0-153">Il framework di test è [xUnit](https://xunit.github.io/).</span><span class="sxs-lookup"><span data-stu-id="7b5d0-153">The test framework is [xUnit](https://xunit.github.io/).</span></span> <span data-ttu-id="7b5d0-154">L'oggetto tali framework è [Moq](https://github.com/moq/moq4).</span><span class="sxs-lookup"><span data-stu-id="7b5d0-154">The object mocking framework is [Moq](https://github.com/moq/moq4).</span></span>

## <a name="unit-tests-of-the-data-access-layer-dal"></a><span data-ttu-id="7b5d0-155">Unit test dei dati ad accedere layer (DAL)</span><span class="sxs-lookup"><span data-stu-id="7b5d0-155">Unit tests of the data access layer (DAL)</span></span>

<span data-ttu-id="7b5d0-156">L'app messaggio ha DAL con quattro metodi contenuti nel `AppDbContext` classe (*src/RazorPagesTestSample/Data/AppDbContext.cs*).</span><span class="sxs-lookup"><span data-stu-id="7b5d0-156">The message app has a DAL with four methods contained in the `AppDbContext` class (*src/RazorPagesTestSample/Data/AppDbContext.cs*).</span></span> <span data-ttu-id="7b5d0-157">Ogni metodo presenta uno o due unit test nell'applicazione di test.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-157">Each method has one or two unit tests in the test app.</span></span>

| <span data-ttu-id="7b5d0-158">Metodo DAL</span><span class="sxs-lookup"><span data-stu-id="7b5d0-158">DAL method</span></span>               | <span data-ttu-id="7b5d0-159">Funzione</span><span class="sxs-lookup"><span data-stu-id="7b5d0-159">Function</span></span>                                                                   |
| ------------------------ | -------------------------------------------------------------------------- |
| `GetMessagesAsync`       | <span data-ttu-id="7b5d0-160">Ottiene un `List<Message>` dal database vengono ordinato i `Text` proprietà.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-160">Obtains a `List<Message>` from the database sorted by the `Text` property.</span></span> |
| `AddMessageAsync`        | <span data-ttu-id="7b5d0-161">Aggiunge un `Message` al database.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-161">Adds a `Message` to the database.</span></span>                                          |
| `DeleteAllMessagesAsync` | <span data-ttu-id="7b5d0-162">Elimina tutti `Message` voci dal database.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-162">Deletes all `Message` entries from the database.</span></span>                           |
| `DeleteMessageAsync`     | <span data-ttu-id="7b5d0-163">Elimina una singola `Message` dal database tramite `Id`.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-163">Deletes a single `Message` from the database by `Id`.</span></span>                      |

<span data-ttu-id="7b5d0-164">Unit test del valore DAL richiedono [DbContextOptions](/dotnet/api/microsoft.entityframeworkcore.dbcontextoptions) quando si crea un nuovo `AppDbContext` per ogni test.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-164">Unit tests of the DAL require [DbContextOptions](/dotnet/api/microsoft.entityframeworkcore.dbcontextoptions) when creating a new `AppDbContext` for each test.</span></span> <span data-ttu-id="7b5d0-165">Un approccio alla creazione di `DbContextOptions` per ogni test è possibile utilizzare un [DbContextOptionsBuilder](/dotnet/api/microsoft.entityframeworkcore.dbcontextoptionsbuilder):</span><span class="sxs-lookup"><span data-stu-id="7b5d0-165">One approach to creating the `DbContextOptions` for each test is to use a [DbContextOptionsBuilder](/dotnet/api/microsoft.entityframeworkcore.dbcontextoptionsbuilder):</span></span>

```csharp
var optionsBuilder = new DbContextOptionsBuilder<AppDbContext>()
    .UseInMemoryDatabase("InMemoryDb");

using (var db = new AppDbContext(optionsBuilder.Options))
{
    // Use the db here in the unit test.
}
```

<span data-ttu-id="7b5d0-166">Il problema con questo approccio è che ogni test riceve il database in qualsiasi stato test precedente ha lasciato.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-166">The problem with this approach is that each test receives the database in whatever state the previous test left it.</span></span> <span data-ttu-id="7b5d0-167">Può essere problematico durante la scrittura atomica di unit test che non interferiscano tra loro.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-167">This can be problematic when trying to write atomic unit tests that don't interfere with each other.</span></span> <span data-ttu-id="7b5d0-168">Per forzare il `AppDbContext` per utilizzare un nuovo contesto di database per ogni test, fornire un `DbContextOptions` istanza basata su un nuovo provider del servizio.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-168">To force the `AppDbContext` to use a new database context for each test, supply a `DbContextOptions` instance that's based on a new service provider.</span></span> <span data-ttu-id="7b5d0-169">L'applicazione di test viene illustrato come eseguire questa operazione usando il relativo `Utilities` metodo della classe `TestingDbContextOptions` (*tests/RazorPagesTestSample.Tests/Utilities/Utilities.cs*):</span><span class="sxs-lookup"><span data-stu-id="7b5d0-169">The test app shows how to do this using its `Utilities` class method `TestingDbContextOptions` (*tests/RazorPagesTestSample.Tests/Utilities/Utilities.cs*):</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/Utilities/Utilities.cs?name=snippet1)]

<span data-ttu-id="7b5d0-170">Utilizzo di `DbContextOptions` nell'unità di DAL test consente a ogni test da eseguire in modo atomico con un'istanza del database aggiornato:</span><span class="sxs-lookup"><span data-stu-id="7b5d0-170">Using the `DbContextOptions` in the DAL unit tests allows each test to run atomically with a fresh database instance:</span></span>

```csharp
using (var db = new AppDbContext(Utilities.TestingDbContextOptions()))
{
    // Use the db here in the unit test.
}
```

<span data-ttu-id="7b5d0-171">Ogni metodo di test nel `DataAccessLayerTest` classe (*UnitTests/DataAccessLayerTest.cs*) segue uno schema analogo Arrange-Act-Assert:</span><span class="sxs-lookup"><span data-stu-id="7b5d0-171">Each test method in the `DataAccessLayerTest` class (*UnitTests/DataAccessLayerTest.cs*) follows a similar Arrange-Act-Assert pattern:</span></span>

1. <span data-ttu-id="7b5d0-172">Disponi: Il database è configurato per il test e/o il risultato previsto è definito.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-172">Arrange: The database is configured for the test and/or the expected outcome is defined.</span></span>
1. <span data-ttu-id="7b5d0-173">ACT: Viene eseguito il test.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-173">Act: The test is executed.</span></span>
1. <span data-ttu-id="7b5d0-174">Asserzione: Asserzioni vengono effettuate per determinare se il risultato del test viene eseguita correttamente.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-174">Assert: Assertions are made to determine if the test result is a success.</span></span>

<span data-ttu-id="7b5d0-175">Ad esempio, il `DeleteMessageAsync` metodo è responsabile della rimozione di un singolo messaggio identificato dal relativo `Id` (*src/RazorPagesTestSample/Data/AppDbContext.cs*):</span><span class="sxs-lookup"><span data-stu-id="7b5d0-175">For example, the `DeleteMessageAsync` method is responsible for removing a single message identified by its `Id` (*src/RazorPagesTestSample/Data/AppDbContext.cs*):</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/src/RazorPagesTestSample/Data/AppDbContext.cs?name=snippet4)]

<span data-ttu-id="7b5d0-176">Esistono due test per questo metodo.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-176">There are two tests for this method.</span></span> <span data-ttu-id="7b5d0-177">Un test di verifica che il metodo elimina un messaggio quando il messaggio è presente nel database.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-177">One test checks that the method deletes a message when the message is present in the database.</span></span> <span data-ttu-id="7b5d0-178">Gli altri test di metodo che il database non cambia se il messaggio `Id` per l'eliminazione non esiste.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-178">The other method tests that the database doesn't change if the message `Id` for deletion doesn't exist.</span></span> <span data-ttu-id="7b5d0-179">Il `DeleteMessageAsync_MessageIsDeleted_WhenMessageIsFound` metodo è illustrato di seguito:</span><span class="sxs-lookup"><span data-stu-id="7b5d0-179">The `DeleteMessageAsync_MessageIsDeleted_WhenMessageIsFound` method is shown below:</span></span>

[!code-csharp[](razor-pages-tests/samples_snapshot/2.x/tests/RazorPagesTestSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet1)]

<span data-ttu-id="7b5d0-180">In primo luogo, il metodo esegue il passaggio di disposizione, in cui avviene la preparazione per il passaggio di Act.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-180">First, the method performs the Arrange step, where preparation for the Act step takes place.</span></span> <span data-ttu-id="7b5d0-181">I messaggi di seeding vengono ottenuti e contenuti in `seedMessages`.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-181">The seeding messages are obtained and held in `seedMessages`.</span></span> <span data-ttu-id="7b5d0-182">I messaggi di seeding vengono salvati nel database.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-182">The seeding messages are saved into the database.</span></span> <span data-ttu-id="7b5d0-183">Il messaggio con un `Id` di `1` è impostato per l'eliminazione.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-183">The message with an `Id` of `1` is set for deletion.</span></span> <span data-ttu-id="7b5d0-184">Quando il `DeleteMessageAsync` metodo viene eseguito, dei messaggi previsti devono avere tutti i messaggi, ad eccezione di quello con un `Id` di `1`.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-184">When the `DeleteMessageAsync` method is executed, the expected messages should have all of the messages except for the one with an `Id` of `1`.</span></span> <span data-ttu-id="7b5d0-185">Il `expectedMessages` variabile rappresenta il risultato previsto.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-185">The `expectedMessages` variable represents this expected outcome.</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet1)]

<span data-ttu-id="7b5d0-186">Il metodo agisce: il `DeleteMessageAsync` metodo viene eseguito passando il `recId` di `1`:</span><span class="sxs-lookup"><span data-stu-id="7b5d0-186">The method acts: The `DeleteMessageAsync` method is executed passing in the `recId` of `1`:</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet2)]

<span data-ttu-id="7b5d0-187">Infine, il metodo ottiene il `Messages` dal contesto e confrontato con il `expectedMessages` asserzione che sono uguali:</span><span class="sxs-lookup"><span data-stu-id="7b5d0-187">Finally, the method obtains the `Messages` from the context and compares it to the `expectedMessages` asserting that the two are equal:</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet3)]

<span data-ttu-id="7b5d0-188">Per confrontare che i due `List<Message>` sono gli stessi:</span><span class="sxs-lookup"><span data-stu-id="7b5d0-188">In order to compare that the two `List<Message>` are the same:</span></span>

* <span data-ttu-id="7b5d0-189">I messaggi vengono ordinati in base `Id`.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-189">The messages are ordered by `Id`.</span></span>
* <span data-ttu-id="7b5d0-190">Coppie di messaggi vengono confrontate nel `Text` proprietà.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-190">Message pairs are compared on the `Text` property.</span></span>

<span data-ttu-id="7b5d0-191">Un metodo di test simile, `DeleteMessageAsync_NoMessageIsDeleted_WhenMessageIsNotFound` controlla il risultato del tentativo di eliminare un messaggio che non esiste.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-191">A similar test method, `DeleteMessageAsync_NoMessageIsDeleted_WhenMessageIsNotFound` checks the result of attempting to delete a message that doesn't exist.</span></span> <span data-ttu-id="7b5d0-192">In questo caso, i messaggi previsti nel database devono essere uguali per i messaggi effettivi dopo il `DeleteMessageAsync` metodo viene eseguito.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-192">In this case, the expected messages in the database should be equal to the actual messages after the `DeleteMessageAsync` method is executed.</span></span> <span data-ttu-id="7b5d0-193">Non deve esistere alcuna modifica al contenuto del database:</span><span class="sxs-lookup"><span data-stu-id="7b5d0-193">There should be no change to the database's content:</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet4)]

## <a name="unit-tests-of-the-page-model-methods"></a><span data-ttu-id="7b5d0-194">Unit test dei metodi di modello di pagina</span><span class="sxs-lookup"><span data-stu-id="7b5d0-194">Unit tests of the page model methods</span></span>

<span data-ttu-id="7b5d0-195">Un altro set di unit test è responsabile per i test dei metodi del modello di pagina.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-195">Another set of unit tests is responsible for tests of page model methods.</span></span> <span data-ttu-id="7b5d0-196">Nell'applicazione di messaggio, i modelli di pagina di indice sono inclusi i `IndexModel` classe *src/RazorPagesTestSample/Pages/Index.cshtml.cs*.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-196">In the message app, the Index page models are found in the `IndexModel` class in *src/RazorPagesTestSample/Pages/Index.cshtml.cs*.</span></span>

| <span data-ttu-id="7b5d0-197">Metodo del modello di pagina</span><span class="sxs-lookup"><span data-stu-id="7b5d0-197">Page model method</span></span> | <span data-ttu-id="7b5d0-198">Funzione</span><span class="sxs-lookup"><span data-stu-id="7b5d0-198">Function</span></span> |
| ----------------- | -------- |
| `OnGetAsync` | <span data-ttu-id="7b5d0-199">Ottiene i messaggi per l'interfaccia utente utilizzando il `GetMessagesAsync` metodo.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-199">Obtains the messages from the DAL for the UI using the `GetMessagesAsync` method.</span></span> |
| `OnPostAddMessageAsync` | <span data-ttu-id="7b5d0-200">Se il `ModelState` è valido, le chiamate `AddMessageAsync` per aggiungere un messaggio al database.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-200">If the `ModelState` is valid, calls `AddMessageAsync` to add a message to the database.</span></span> |
| `OnPostDeleteAllMessagesAsync` | <span data-ttu-id="7b5d0-201">Chiamate `DeleteAllMessagesAsync` per eliminare tutti i messaggi nel database.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-201">Calls `DeleteAllMessagesAsync` to delete all of the messages in the database.</span></span> |
| `OnPostDeleteMessageAsync` | <span data-ttu-id="7b5d0-202">Esegue `DeleteMessageAsync` per eliminare un messaggio con il `Id` specificato.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-202">Executes `DeleteMessageAsync` to delete a message with the `Id` specified.</span></span> |
| `OnPostAnalyzeMessagesAsync` | <span data-ttu-id="7b5d0-203">Se uno o più messaggi nel database, calcola il numero medio di parole per ogni messaggio.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-203">If one or more messages are in the database, calculates the average number of words per message.</span></span> |

<span data-ttu-id="7b5d0-204">I metodi del modello di pagina vengono testati utilizzando sette test il `IndexPageTests` classe (*tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs*).</span><span class="sxs-lookup"><span data-stu-id="7b5d0-204">The page model methods are tested using seven tests in the `IndexPageTests` class (*tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs*).</span></span> <span data-ttu-id="7b5d0-205">I test utilizzano il modello di Act Assert Disponi familiarità.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-205">The tests use the familiar Arrange-Assert-Act pattern.</span></span> <span data-ttu-id="7b5d0-206">Questi test sono incentrati su:</span><span class="sxs-lookup"><span data-stu-id="7b5d0-206">These tests focus on:</span></span>

* <span data-ttu-id="7b5d0-207">Determinare se i metodi di seguono il comportamento corretto quando il `ModelState` non è valido.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-207">Determining if the methods follow the correct behavior when the `ModelState` is invalid.</span></span>
* <span data-ttu-id="7b5d0-208">I metodi di conferma produrre corrette `IActionResult`.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-208">Confirming the methods produce the correct `IActionResult`.</span></span>
* <span data-ttu-id="7b5d0-209">Verifica che le assegnazioni dei valori di proprietà vengono effettuate correttamente.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-209">Checking that property value assignments are made correctly.</span></span>

<span data-ttu-id="7b5d0-210">Questo gruppo di test spesso simulare i metodi di per produrre dati previsto per il passaggio di Act, in cui viene eseguito un metodo di modello di pagina.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-210">This group of tests often mock the methods of the DAL to produce expected data for the Act step where a page model method is executed.</span></span> <span data-ttu-id="7b5d0-211">Ad esempio, il `GetMessagesAsync` metodo il `AppDbContext` è esempio per generare un output.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-211">For example, the `GetMessagesAsync` method of the `AppDbContext` is mocked to produce output.</span></span> <span data-ttu-id="7b5d0-212">Quando un metodo di modello di pagina viene eseguito questo metodo, la simulazione restituisce il risultato.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-212">When a page model method executes this method, the mock returns the result.</span></span> <span data-ttu-id="7b5d0-213">I dati non provengono dal database.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-213">The data doesn't come from the database.</span></span> <span data-ttu-id="7b5d0-214">Consente di creare condizioni di test prevedibili e affidabili per l'utilizzo dai test del modello di pagina.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-214">This creates predictable, reliable test conditions for using the DAL in the page model tests.</span></span>

<span data-ttu-id="7b5d0-215">Il `OnGetAsync_PopulatesThePageModel_WithAListOfMessages` test Mostra come `GetMessagesAsync` metodo è esempio per il modello di pagina:</span><span class="sxs-lookup"><span data-stu-id="7b5d0-215">The `OnGetAsync_PopulatesThePageModel_WithAListOfMessages` test shows how the `GetMessagesAsync` method is mocked for the page model:</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs?name=snippet1&highlight=3-4)]

<span data-ttu-id="7b5d0-216">Quando il `OnGetAsync` metodo viene eseguito nel passaggio Act, chiama il modello di pagina `GetMessagesAsync` metodo.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-216">When the `OnGetAsync` method is executed in the Act step, it calls the page model's `GetMessagesAsync` method.</span></span>

<span data-ttu-id="7b5d0-217">Passaggio di Act di unit test (*tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs*):</span><span class="sxs-lookup"><span data-stu-id="7b5d0-217">Unit test Act step (*tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs*):</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs?name=snippet2)]

<span data-ttu-id="7b5d0-218">`IndexPage` modello di pagina `OnGetAsync` metodo (*src/RazorPagesTestSample/Pages/Index.cshtml.cs*):</span><span class="sxs-lookup"><span data-stu-id="7b5d0-218">`IndexPage` page model's `OnGetAsync` method (*src/RazorPagesTestSample/Pages/Index.cshtml.cs*):</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/src/RazorPagesTestSample/Pages/Index.cshtml.cs?name=snippet1&highlight=3)]

<span data-ttu-id="7b5d0-219">Il `GetMessagesAsync` DAL metodo non restituisce il risultato per questa chiamata al metodo.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-219">The `GetMessagesAsync` method in the DAL doesn't return the result for this method call.</span></span> <span data-ttu-id="7b5d0-220">La versione del metodo simulata restituisce il risultato.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-220">The mocked version of the method returns the result.</span></span>

<span data-ttu-id="7b5d0-221">Nel `Assert` passaggio, i messaggi effettivi (`actualMessages`) vengono assegnati dal `Messages` proprietà del modello di pagina.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-221">In the `Assert` step, the actual messages (`actualMessages`) are assigned from the `Messages` property of the page model.</span></span> <span data-ttu-id="7b5d0-222">Un controllo del tipo viene eseguito anche quando vengono assegnati i messaggi.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-222">A type check is also performed when the messages are assigned.</span></span> <span data-ttu-id="7b5d0-223">I messaggi previsti ed effettivi vengono confrontati per loro `Text` proprietà.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-223">The expected and actual messages are compared by their `Text` properties.</span></span> <span data-ttu-id="7b5d0-224">Il test asserisce che i due `List<Message>` istanze contengono gli stessi messaggi.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-224">The test asserts that the two `List<Message>` instances contain the same messages.</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs?name=snippet3)]

<span data-ttu-id="7b5d0-225">Altri test in questo gruppo di creare pagina di oggetti modello che includono il `DefaultHttpContext`, `ModelStateDictionary`, un `ActionContext` per stabilire il `PageContext`, un `ViewDataDictionary`e un `PageContext`.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-225">Other tests in this group create page model objects that include the `DefaultHttpContext`, the `ModelStateDictionary`, an `ActionContext` to establish the `PageContext`, a `ViewDataDictionary`, and a `PageContext`.</span></span> <span data-ttu-id="7b5d0-226">Questi sono utili per l'esecuzione di test.</span><span class="sxs-lookup"><span data-stu-id="7b5d0-226">These are useful in conducting tests.</span></span> <span data-ttu-id="7b5d0-227">Ad esempio, l'app messaggio stabilisce un `ModelState` errore con `AddModelError` per verificare che un oggetto valido `PageResult` viene restituito quando `OnPostAddMessageAsync` viene eseguita:</span><span class="sxs-lookup"><span data-stu-id="7b5d0-227">For example, the message app establishes a `ModelState` error with `AddModelError` to check that a valid `PageResult` is returned when `OnPostAddMessageAsync` is executed:</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs?name=snippet4&highlight=11,26,29,32)]

## <a name="additional-resources"></a><span data-ttu-id="7b5d0-228">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="7b5d0-228">Additional resources</span></span>

* [<span data-ttu-id="7b5d0-229">Unit test c# in .NET Core usando xUnit e test dotnet</span><span class="sxs-lookup"><span data-stu-id="7b5d0-229">Unit testing C# in .NET Core using dotnet test and xUnit</span></span>](/dotnet/articles/core/testing/unit-testing-with-dotnet-test)
* [<span data-ttu-id="7b5d0-230">Test controller</span><span class="sxs-lookup"><span data-stu-id="7b5d0-230">Test controllers</span></span>](xref:mvc/controllers/testing)
* <span data-ttu-id="7b5d0-231">[Il codice dello unit Test](/visualstudio/test/unit-test-your-code) (Visual Studio)</span><span class="sxs-lookup"><span data-stu-id="7b5d0-231">[Unit Test Your Code](/visualstudio/test/unit-test-your-code) (Visual Studio)</span></span>
* [<span data-ttu-id="7b5d0-232">Test di integrazione</span><span class="sxs-lookup"><span data-stu-id="7b5d0-232">Integration tests</span></span>](xref:test/integration-tests)
* [<span data-ttu-id="7b5d0-233">xUnit.net</span><span class="sxs-lookup"><span data-stu-id="7b5d0-233">xUnit.net</span></span>](https://xunit.github.io/)
* [<span data-ttu-id="7b5d0-234">Introduzione a xUnit.net (.NET Core/ASP.NET Core)</span><span class="sxs-lookup"><span data-stu-id="7b5d0-234">Getting started with xUnit.net (.NET Core/ASP.NET Core)</span></span>](https://xunit.github.io/docs/getting-started-dotnet-core)
* [<span data-ttu-id="7b5d0-235">Moq</span><span class="sxs-lookup"><span data-stu-id="7b5d0-235">Moq</span></span>](https://github.com/moq/moq4)
* [<span data-ttu-id="7b5d0-236">Guida introduttiva Moq</span><span class="sxs-lookup"><span data-stu-id="7b5d0-236">Moq Quickstart</span></span>](https://github.com/Moq/moq4/wiki/Quickstart)
