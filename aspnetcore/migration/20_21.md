---
title: Eseguire la migrazione da ASP.NET Core 2.0 a 2.1
author: rick-anderson
description: Questo articolo vengono illustrate le nozioni fondamentali per la migrazione di un'app di ASP.NET Core 2.0 a 2.1.
ms.author: riande
ms.date: 05/30/2018
uid: migration/20_21
ms.openlocfilehash: 8d27d916b04c12c17c0054de8392408f751b6990
ms.sourcegitcommit: 1faf2525902236428dae6a59e375519bafd5d6d7
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/28/2018
ms.locfileid: "37089893"
---
# <a name="migrate-from-aspnet-core-20-to-21"></a>Eseguire la migrazione da ASP.NET Core 2.0 a 2.1

Di [Rick Anderson](https://twitter.com/RickAndMSFT)

Vedere [ciò che è stato introdotto in ASP.NET Core 2.1](xref:aspnetcore-2.1) per una panoramica delle nuove funzionalità di ASP.NET Core 2.1.

In questo articolo:

* Vengono illustrate le nozioni fondamentali per la migrazione di un'app di ASP.NET Core 2.0 a 2.1.
* Viene fornita una panoramica delle modifiche ai modelli di applicazione web ASP.NET Core.

È un modo rapido per ottenere una panoramica delle modifiche nel 2.1:

* Creare un'app web di ASP.NET Core 2.0 denominata WebApp1.
* Eseguire il commit di WebApp1 in un controllo del codice sorgente.
* Eliminare WebApp1 e creare un'app web ASP.NET Core 2.1 denominata WebApp1 nella stessa posizione.
* Verificare le modifiche nella versione 2.1.

In questo articolo viene fornita una panoramica sulla migrazione a ASP.NET Core 2.1. Non contiene un elenco completo di tutte le modifiche necessarie per eseguire la migrazione alla versione 2.1. Alcuni progetti potrebbero richiedere passaggi ulteriori a seconda del opzioni selezionate quando è stato creato il progetto e le modifiche apportate al progetto.

## <a name="update-the-project-file-to-use-21-versions"></a>Aggiornare il file di progetto per utilizzare le 2.1 versioni

Aggiornamento di *csproj* file di progetto:

* Change `<TargetFramework>netcoreapp2.0</TargetFramework>` alla versione 2.1, che è `<TargetFramework>netcoreapp2.1</TargetFramework>`.
* Sostituire la versione specificata riferimento al pacchetto di "Microsoft.AspNetCore.All" con il riferimento al pacchetto di versionless "Microsoft.AspNetCore.App". Si potrebbe essere necessario aggiungere le dipendenze che sono stati rimossi da "Microsoft.AspNetCore.All". Vedere [la migrazione da Microsoft.AspNetCore.All a Microsoft.AspNetCore.App](xref:fundamentals/metapackage#migrate) e [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app). Se si è interessati a .NET Framework:

  * Aggiungere riferimenti a singolo pacchetto anziché un riferimento al pacchetto di metadati.
  * Aggiornare ogni riferimento pacchetto a 2.1.
* Rimuovere tutti i riferimenti a `<DotNetCliToolReference>` elementi per i pacchetti "Microsoft.AspNetCore", "Microsoft.VisualStudio" e "Microsoft.EntityFrameworkCore". Questi strumenti sono stati sostituiti dagli strumenti globali.

Di seguito viene illustrato il modello generato 2.0 *csproj* file di progetto:

[!code-xml[Main](20_21/sample/WebApp20.csproj)]

Di seguito viene illustrato il modello generato 2.1 *csproj* file di progetto:

[!code-xml[Main](20_21/sample/WebApp21.csproj)]

## <a name="rules-for-projects-targeting-the-shared-runtime"></a>Regole per progetti destinati a runtime condiviso

ASP.NET Core include i runtime condivisi seguenti:

* [Microsoft.AspNetCore.App](xref:fundamentals/metapackage-app)
* [Microsoft.AspNetCore.All](xref:fundamentals/metapackage)

Regole per progetti destinati a runtime condiviso:

* Progetti di riferimento il `Microsoft.AspNetCore.All` o `Microsoft.AspNetCore.App` pacchetti impostare SDK del progetto `Microsoft.NET.Sdk.Web` nella parte superiore del file di progetto (`<Project Sdk="Microsoft.NET.Sdk.Web">`).
* I progetti che fanno riferimento a pacchetti o i progetti che fanno riferimento in modo transitivo `Microsoft.AspNetCore.All` o `Microsoft.AspNetCore.App`:
  * È necessario impostare SDK del progetto `Microsoft.NET.Sdk.Web` nella parte superiore del file di progetto (`<Project Sdk="Microsoft.NET.Sdk.Web">`).
  * Deve fare riferimento allo stesso pacchetto di runtime condivisa. Se fa riferimento a LibraryA `Microsoft.AspNetCore.App`, è necessario anche fare riferimento a tutti i progetti che fanno riferimento a LibraryA `Microsoft.AspNetCore.App`.
* I progetti eseguibili (progetti che contengono le app che vengono avviate con `dotnet run` o le app che eseguono e progetti per App di test) non deve specificare una versione per `Microsoft.AspNetCore.App`. il SDK consente di specificare la versione in modo implicito tramite `<PackageReference Include="Microsoft.AspNetCore.App" />`.
* Progetti di cui viene fatto riferimento (progetti che non sono il punto di ingresso e i riferimenti al progetto `Microsoft.AspNetCore.All` o `Microsoft.AspNetCore.App`) deve specificare una versione del pacchetto.

## <a name="changes-to-take-advantage-of-the-new-code-based-idioms-that-are-recommended-in-aspnet-core-21"></a>Modifiche per sfruttare i nuovo idiomi basata su codice consigliati in ASP.NET Core 2.1

### <a name="changes-to-main"></a>Modifiche a Main

Le immagini seguenti mostrano le modifiche apportate a basata su modelli generati *Program.cs* file.

![differenze di versione precedente](20_21/_static/main20.png)

L'immagine precedente mostra la versione 2.0 con le eliminazioni in rosso.

Nella figura seguente mostra il codice 2.1. Il codice in verde sostituito la versione 2.0:

![differenze di versione nuovi](20_21/_static/main21.png)

Il codice seguente illustra la versione 2.1 *Program.cs*:

[!code-csharp[Main](20_21/sample/Program.cs?name=snippet)]

Il nuovo `Main` sostituisce la chiamata a `BuildWebHost` con [CreateWebHostBuilder](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.createwebhostbuilder). [IWebHostBuilder](/dotnet/api/microsoft.aspnetcore.hosting.iwebhostbuilder) è stato aggiunto per supportare un nuovo [infrastruttura del test di integrazione](xref:test/integration-tests).

### <a name="changes-to-startup"></a>Modifiche dell'avvio

Il codice seguente mostra le modifiche al codice 2.1 modello generato. Tutte le modifiche appena aggiunti codice, con la differenza che `UseBrowserLink` è stato rimosso:

[!code-csharp[Main](20_21/sample/Startup.cs?highlight=3,4,21-26,30,42,45,47)]

Le modifiche di codice precedenti vengono descritti in dettaglio:

* [PILR supportare in ASP.NET Core](xref:security/gdpr) per `CookiePolicyOptions` e `UseCookiePolicy`.
* [Protocollo di sicurezza trasporto Strict HTTP (HSTS)](xref:security/enforcing-ssl#http-strict-transport-security-protocol-hsts) per `UseHsts`.
* [Utilizzo di HTTPS](xref:security/enforcing-ssl#require-https) per `UseHttpsRedirection`.
* [SetCompatibilityVersion](xref:fundamentals/startup#setcompatibilityversion) per `SetCompatibilityVersion(CompatibilityVersion.Version_2_1)`.

## <a name="changes-to-authentication-code"></a>Modifiche al codice di autenticazione

ASP.NET Core 2.1 fornisce [ASP.NET Identity Core](xref:security/authentication/identity) come una [libreria di classi Razor](xref:razor-pages/ui-class) (RCL).

Il valore predefinito 2.1 dell'interfaccia utente di identità non attualmente forniscono nuove funzionalità significative versione 2.0. Sostituendo l'identità con il pacchetto RCL è facoltativo. I vantaggi per sostituire il modello generato identità del codice con la versione RCL includono:

* Numero di file viene spostati all'esterno di struttura ad albero di origine.
* Qualsiasi funzionalità di nuovo all'identità o correzioni di bug sono inclusi nel [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app). Si ottiene automaticamente l'identità aggiornata quando `Microsoft.AspNetCore.App` viene aggiornato.

Se sono state apportate considerevole modifiche al modello generato codice identità:

* I vantaggi possono giustificare non conversione per la versione RCL.
* È possibile mantenere il codice ASP.NET Core 2.0 Identity, è completamente supportato.

Identità 2.1 espone endpoint con il `Identity` area. Ad esempio, nella tabella seguente vengono illustrati esempi di endpoint di identità che variano da 2.0 a 2.1:

| 2.0 URL         | 2.1 URL |
| --------------- | ------------ |
| /Account/Login  | / Identità/Account/account di accesso |
| /Account/Logout | / Identità/Account/disconnessione |
| / Account/gestire | / Identità/Account/gestire |

Le applicazioni che dispone di codice utilizzando l'identità e sostituire 2.0 UI di identità con l'esigenza di identità libreria 2.1 per prendere in considerazione gli URL di identità sono disponibili `/Identity` segmento anteposto il simbolo gli URI. Un modo per gestire il nuovo endpoint di identità consiste nell'impostare reindirizzamenti, ad esempio dal `/Account/Login` a `/Identity/Account/Login`.

### <a name="update-identity-to-version-21"></a>Identità di aggiornamento alla versione 2.1

Le opzioni seguenti sono disponibili per aggiornare l'identità a 2.1.

* Usare il codice di identità dell'interfaccia utente 2.0 senza modifiche. Mediante il codice di identità dell'interfaccia utente 2.0 è completamente supportato. Questo è un buon approccio quando sono state apportate modifiche di significativo nel codice generato di identità.
* Eliminare il codice esistente di identità 2.0 e [identità Scaffold](xref:security/authentication/scaffold-identity) nel progetto. Il progetto utilizzerà il [ASP.NET Identity Core](xref:security/authentication/identity) [libreria di classi Razor](xref:razor-pages/ui-class). È possibile generare codice e l'interfaccia utente per qualsiasi parte del codice dell'interfaccia utente di identità che è stato modificato. Applicare le modifiche al codice per il codice dell'interfaccia utente appena scaffolding.
* Eliminare il codice esistente di identità 2.0 e [identità Scaffold](xref:security/authentication/scaffold-identity) nel progetto con l'opzione per **eseguire l'Override di tutti i file**.

### <a name="replace-identity-20-ui-with-the-identity-21-razor-class-library"></a>Sostituire identità 2.0 dell'interfaccia utente con la libreria di classi Razor identità 2.1

In questa sezione vengono delineati i passaggi per sostituire il codice di identità ASP.NET Core 2.0 modello generato con il [ASP.NET Identity Core](xref:security/authentication/identity) [libreria di classi Razor](xref:razor-pages/ui-class). I passaggi seguenti per un progetto di pagine Razor, ma l'approccio per un progetto MVC è simile.

* Verificare il [file di progetto viene aggiornato per utilizzare le 2.1 versioni](#update-the-project-file-to-use-21-versions)
* Eliminare tutti i file in esse contenuti e le cartelle seguenti:
  * *Controller*
  * *Pagine/Account /*
  * *Estensioni*
* Compilare il progetto.
* [Eseguire lo scaffolding di identità](xref:security/authentication/scaffold-identity) nel progetto:
  * Selezionare i progetti uscire *cshtml* file.
  * Selezionare il **+** icona sul lato destro del **classe contesto dati**. Accettare il nome predefinito.
  * Selezionare **Aggiungi** per creare una nuova classe contesto dati. È necessario per eseguire lo scaffolding di creare un nuovo contesto dati. Rimuovere il nuovo contesto dati nella sezione successiva.

### <a name="update-after-scaffolding-identity"></a>L'aggiornamento dopo lo scaffolding di identità

* Eliminare il scaffolder identità generato `IdentityDbContext` classe derivata di *aree / / i dati diidentità/* cartella.
* Eliminare *Areas/Identity/IdentityHostingStartup.cs*
* Aggiornamento di *loginpartial. cshtml* file:
  * Spostare *Pages/_LoginPartial.cshtml* a *Pages/Shared/_LoginPartial.cshtml*
  * Aggiungere `asp-area="Identity"` i collegamenti di form e ancoraggio.
  * Aggiornamento di `<form />` elemento `    <form asp-area="Identity" asp-page="/Account/Logout" asp-route-returnUrl="@Url.Page("/Index", new { area = "" })" method="post" id="logoutForm" class="navbar-right">`

  Nel codice seguente viene aggiornata *loginpartial. cshtml* file:

  [!code-cshtml[Main](20_21/sample/_LoginPartial.cshtml?highlight=8,11,22,23)]

Aggiornamento `ConfigureServices` con il codice seguente:

[!code-csharp[Main](20_21/sample/Startup2.cs?name=snippet)]

## <a name="changes-to-razor-pages-projects-razor-files"></a>Modifica alle pagine Razor progetti file Razor

### <a name="the-layout-file"></a>Il file di layout

* Spostare *Pages/_Layout.cshtml* a *Pages/Shared/_Layout.cshtml*
* Il *cshtml* file presenta le seguenti modifiche:

  * `<partial name="_CookieConsentPartial" />` viene aggiunto. Per altre informazioni, vedere [Supporto per il Regolamento generale sulla protezione dei dati in ASP.NET Core](xref:security/gdpr).
  * modifiche jQuery dal 2.2.0 3.3.1

### <a name="validationscriptspartialcshtml"></a>_ValidationScriptsPartial.cshtml

* *Pages/_ValidationScriptsPartial.cshtml* sposta *Pages/Shared/_ValidationScriptsPartial.cshtml*
* *jQuery.Validate/1.14.0* diventa *jquery.validate/1.17.0*

### <a name="new-files"></a>Nuovi file

Vengono aggiunti i seguenti file:

* *Privacy.cshtml*
* *Privacy.cshtml.cs*

Vedere [PILR supportare in ASP.NET Core](xref:security/gdpr) per informazioni sui file precedente.

## <a name="changes-to-mvc-projects-razor-files"></a>Vengono modificati per i progetti MVC Razor

### <a name="the-layout-file"></a>Il file di layout

Il *cshtml* file presenta le seguenti modifiche:

* `<partial name="_CookieConsentPartial" />` viene aggiunto.
* modifiche jQuery dal 2.2.0 3.3.1

### <a name="validationscriptspartialcshtml"></a>_ValidationScriptsPartial.cshtml

*jQuery.Validate/1.14.0* diventa *jquery.validate/1.17.0*

### <a name="new-files-and-action-methods"></a>I nuovi file e i metodi di azione

Vengono aggiunti i seguenti:

* *Views/Home/Privacy.cshtml*
* Il `Privacy` metodo di azione viene aggiunto al controller Home.

Vedere [PILR supportare in ASP.NET Core](xref:security/gdpr) per informazioni sui file precedente.

## <a name="additional-changes"></a>Altre modifiche

* [SetCompatibilityVersion](xref:fundamentals/startup#setcompatibilityversion)
* [Configurazione del trasporto](xref:fundamentals/servers/kestrel#transport-configuration)
