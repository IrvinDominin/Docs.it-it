---
title: Eseguire la migrazione da ASP.NET Core 2.0 a 2.1
author: rick-anderson
description: Questo articolo vengono illustrate le nozioni fondamentali per la migrazione di un'app di ASP.NET Core 2.0 a 2.1.
ms.author: riande
ms.date: 05/30/2018
uid: migration/20_21
ms.openlocfilehash: 52fc34731b036e4e805eedc01573bee65cdfe197
ms.sourcegitcommit: a1afd04758e663d7062a5bfa8a0d4dca38f42afc
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/20/2018
ms.locfileid: "36274275"
---
# <a name="migrate-from-aspnet-core-20-to-21"></a>Eseguire la migrazione da ASP.NET Core 2.0 a 2.1

Di [Rick Anderson](https://twitter.com/RickAndMSFT)

Vedere [ciò che è stato introdotto in ASP.NET Core 2.1](xref:aspnetcore-2.1) per una panoramica delle nuove funzionalità di ASP.NET Core 2.1.

In questo articolo:

* Vengono illustrate le nozioni fondamentali per la migrazione di un'app di ASP.NET Core 2.0 a 2.1.
* Viene fornita una panoramica delle modifiche ai modelli di applicazione web ASP.NET Core.

È un modo rapido per ottenere una panoramica delle modifiche nel 2.1:

* Creare un'app web di ASP.NET Core 2.0 denominata WebApp1.
* Eseguire il commit di WebApp1 in un controllo del codice sorgente.
* Eliminare WebApp1 e creare un'app web ASP.NET Core 2.1 denominata WebApp1 nella stessa posizione.
* Verificare le modifiche nella versione 2.1.

In questo articolo viene fornita una panoramica sulla migrazione a ASP.NET Core 2.1. Non contiene un elenco completo di tutte le modifiche necessarie per eseguire la migrazione alla versione 2.1. Alcuni progetti potrebbero richiedere passaggi ulteriori a seconda del opzioni selezionate quando è stato creato il progetto e le modifiche apportate al progetto.

## <a name="update-the-project-file-to-use-21-versions"></a>Aggiornare il file di progetto per utilizzare le 2.1 versioni

Aggiornamento di *csproj* file di progetto:

* Change `<TargetFramework>netcoreapp2.0</TargetFramework>` alla versione 2.1, che è `<TargetFramework>netcoreapp2.1</TargetFramework>`.
* Sostituire la versione specificata riferimento al pacchetto di "Microsoft.AspNetCore.All" con il riferimento al pacchetto di versionless "Microsoft.AspNetCore.App". Si potrebbe essere necessario aggiungere le dipendenze che sono stati rimossi da "Microsoft.AspNetCore.All". Vedere [la migrazione da Microsoft.AspNetCore.All a Microsoft.AspNetCore.App](xref:fundamentals/metapackage#migrate) e [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app). Se si è interessati a .NET Framework:

  * Aggiungere riferimenti a singolo pacchetto anziché un riferimento al pacchetto di metadati.
  * Aggiornare ogni riferimento pacchetto a 2.1.
* Rimuovere tutti i riferimenti a `<DotNetCliToolReference>` elementi per i pacchetti "Microsoft.AspNetCore", "Microsoft.VisualStudio" e "Microsoft.EntityFrameworkCore". Questi strumenti sono stati sostituiti dagli strumenti globali.

Di seguito viene illustrato il modello generato 2.0 *csproj* file di progetto:

[!code-xml[Main](20_21/sample/WebApp20.csproj)]

Di seguito viene illustrato il modello generato 2.1 *csproj* file di progetto:

[!code-xml[Main](20_21/sample/WebApp21.csproj)]

## <a name="rules-for-projects-targeting-the-shared-runtime"></a>Regole per progetti destinati a runtime condiviso

ASP.NET Core include i runtime condivisi seguenti:

* [Microsoft.AspNetCore.App](xref:fundamentals/metapackage-app)
* [Microsoft.AspNetCore.All](xref:fundamentals/metapackage)

Regole per progetti destinati a runtime condiviso:

* Progetti di riferimento `Microsoft.AspNetCore.All` oppure `Microsoft.AspNetCore.App` deve fare riferimento a pacchetti, `Microsoft.Net.Sdk.Web` Sdk.
* I progetti che fanno riferimento a pacchetti o i progetti che fanno riferimento in modo transitivo `Microsoft.AspNetCore.All` o `Microsoft.AspNetCore.App`:
  * Deve fare riferimento al `Microsoft.Net.Sdk.Web` Sdk e,
  * Deve fare riferimento allo stesso pacchetto di runtime condivisa. Ad esempio, se fa riferimento a LibraryA `Microsoft.AspNetCore.App`, devono fare riferimento a tutti i progetti fanno riferimento al `Microsoft.AspNetCore.App`.
* Progetti eseguibili:
  * Sono i progetti che contengono le app che vengono avviate con `dotnet run`.
  * Sono applicazioni che eseguono e progetti per le applicazioni di test.
  * I progetti eseguibili non devono specificare la versione. il Sdk consente di specificare la versione in modo implicito tramite `<PackageReference Include="Microsoft.AspNetCore.App" />`.
* Progetti di riferimento, ovvero:
  * I progetti che non sono il punto di ingresso, e
  * I riferimenti al progetto `Microsoft.AspNetCore.All` o `Microsoft.AspNetCore.App`.
  * Progetti di riferimento è necessario specificare una versione del pacchetto.

## <a name="changes-to-take-advantage-of-the-new-code-based-idioms-that-are-recommended-in-aspnet-core-21"></a>Modifiche per sfruttare i nuovo idiomi basata su codice consigliati in ASP.NET Core 2.1

### <a name="changes-to-main"></a>Modifiche a Main

Le immagini seguenti mostrano le modifiche apportate a basata su modelli generati *Program.cs* file.

![differenze di versione precedente](20_21/_static/main20.png)

L'immagine precedente mostra la versione 2.0 con le eliminazioni in rosso.

Nella figura seguente mostra il codice 2.1. Il codice in verde sostituito la versione 2.0:

![differenze di versione nuovi](20_21/_static/main21.png)

Il codice seguente illustra la versione 2.1 *Program.cs*:

[!code-csharp[Main](20_21/sample/Program.cs?name=snippet)]

Il nuovo `Main` sostituisce la chiamata a `BuildWebHost` con [CreateWebHostBuilder](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.createwebhostbuilder). [IWebHostBuilder](/dotnet/api/microsoft.aspnetcore.hosting.iwebhostbuilder) è stato aggiunto per supportare un nuovo [infrastruttura del test di integrazione](xref:test/integration-tests).

### <a name="changes-to-startup"></a>Modifiche dell'avvio

Il codice seguente mostra le modifiche al codice 2.1 modello generato. Tutte le modifiche appena aggiunti codice, con la differenza che `UseBrowserLink` è stato rimosso:

[!code-csharp[Main](20_21/sample/Startup.cs?highlight=3,4,21-26,30,42,45,47)]

Le modifiche di codice precedenti vengono descritti in dettaglio:

* [PILR supportare in ASP.NET Core](xref:security/gdpr) per `CookiePolicyOptions` e `UseCookiePolicy`.
* [Protocollo di sicurezza trasporto Strict HTTP (HSTS)](xref:security/enforcing-ssl#http-strict-transport-security-protocol-hsts) per `UseHsts`.
* [Utilizzo di HTTPS](xref:security/enforcing-ssl#require-https) per `UseHttpsRedirection`.
* [SetCompatibilityVersion](xref:fundamentals/startup#setcompatibilityversion) per `SetCompatibilityVersion(CompatibilityVersion.Version_2_1)`.

### <a name="changes-to-authentication-code"></a>Modifiche al codice di autenticazione

ASP.NET Core 2.1 fornisce [ASP.NET Identity Core](xref:security/authentication/identity) come una [libreria di classi Razor](xref:razor-pages/ui-class). Se non sono state apportate sostanziali modifiche al modello 2.0 generato codice identità, prendere in considerazione l'approccio di aggiornamento seguente:

* Eliminare il codice esistente di identità.
* [Eseguire lo scaffolding di identità](xref:security/authentication/scaffold-identity) nel progetto.

## <a name="changes-to-razor-pages-projects-razor-files"></a>Modifica alle pagine Razor progetti file Razor

### <a name="the-layout-file"></a>Il file di layout

* *Pages/_Layout.cshtml* sposta *Pages/Shared/_Layout.cshtml*
* Il *cshtml* file presenta le seguenti modifiche:

  * `<partial name="_CookieConsentPartial" />` viene aggiunto. Per altre informazioni, vedere [PILR supportare in ASP.NET Core](xref:security/gdpr).
  * modifiche jQuery dal 2.2.0 3.3.1

### <a name="validationscriptspartialcshtml"></a>_ValidationScriptsPartial.cshtml

* *Pages/_ValidationScriptsPartial.cshtml* sposta *Pages/Shared/_ValidationScriptsPartial.cshtml*
* *jQuery.Validate/1.14.0* diventa *jquery.validate/1.17.0*

### <a name="new-files"></a>Nuovi file

Vengono aggiunti i seguenti file:

* *Privacy.cshtml*
* *Privacy.cshtml.cs*

Vedere [PILR supportare in ASP.NET Core](xref:security/gdpr) per informazioni sui file precedente.

## <a name="changes-to-mvc-projects-razor-files"></a>Vengono modificati per i progetti MVC Razor

### <a name="the-layout-file"></a>Il file di layout

Il *cshtml* file presenta le seguenti modifiche:

* `<partial name="_CookieConsentPartial" />` viene aggiunto.
* modifiche jQuery dal 2.2.0 3.3.1

### <a name="validationscriptspartialcshtml"></a>_ValidationScriptsPartial.cshtml

*jQuery.Validate/1.14.0* diventa *jquery.validate/1.17.0*

### <a name="new-files-and-action-methods"></a>I nuovi file e i metodi di azione

Vengono aggiunti i seguenti:

* *Views/Home/Privacy.cshtml*
* Il `Privacy` metodo di azione viene aggiunto al controller Home.

Vedere [PILR supportare in ASP.NET Core](xref:security/gdpr) per informazioni sui file precedente.

## <a name="additional-changes"></a>Altre modifiche

* [SetCompatibilityVersion](xref:fundamentals/startup#setcompatibilityversion)
* [Configurazione del trasporto](xref:fundamentals/servers/kestrel#transport-configuration)
