---
title: Gerarchia scopo e multi-tenancy in ASP.NET Core
author: rick-anderson
description: Informazioni sulle funzionalità multi-tenancy e scopo stringa gerarchia, tra cui le API di protezione dati di ASP.NET Core.
ms.author: riande
ms.date: 10/14/2016
uid: security/data-protection/consumer-apis/purpose-strings-multitenancy
ms.openlocfilehash: f0c39d54c164595c2135e0eb0d911796e215dd66
ms.sourcegitcommit: a1afd04758e663d7062a5bfa8a0d4dca38f42afc
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/20/2018
ms.locfileid: "36273611"
---
# <a name="purpose-hierarchy-and-multi-tenancy-in-aspnet-core"></a><span data-ttu-id="70304-103">Gerarchia scopo e multi-tenancy in ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="70304-103">Purpose hierarchy and multi-tenancy in ASP.NET Core</span></span>

<span data-ttu-id="70304-104">Poiché un `IDataProtector` è inoltre in modo implicito un `IDataProtectionProvider`, a scopo può essere concatenato.</span><span class="sxs-lookup"><span data-stu-id="70304-104">Since an `IDataProtector` is also implicitly an `IDataProtectionProvider`, purposes can be chained together.</span></span> <span data-ttu-id="70304-105">In questo senso, `provider.CreateProtector([ "purpose1", "purpose2" ])` equivale a `provider.CreateProtector("purpose1").CreateProtector("purpose2")`.</span><span class="sxs-lookup"><span data-stu-id="70304-105">In this sense, `provider.CreateProtector([ "purpose1", "purpose2" ])` is equivalent to `provider.CreateProtector("purpose1").CreateProtector("purpose2")`.</span></span>

<span data-ttu-id="70304-106">In questo modo per alcune relazioni gerarchiche interessanti attraverso il sistema di protezione dati.</span><span class="sxs-lookup"><span data-stu-id="70304-106">This allows for some interesting hierarchical relationships through the data protection system.</span></span> <span data-ttu-id="70304-107">Nell'esempio precedente di [Contoso.Messaging.SecureMessage](xref:security/data-protection/consumer-apis/purpose-strings#data-protection-contoso-purpose), può chiamare il componente SecureMessage `provider.CreateProtector("Contoso.Messaging.SecureMessage")` dedicano una sola volta e memorizza nella cache il risultato in una privata `_myProvide` campo.</span><span class="sxs-lookup"><span data-stu-id="70304-107">In the earlier example of [Contoso.Messaging.SecureMessage](xref:security/data-protection/consumer-apis/purpose-strings#data-protection-contoso-purpose), the SecureMessage component can call `provider.CreateProtector("Contoso.Messaging.SecureMessage")` once up-front and cache the result into a private `_myProvide` field.</span></span> <span data-ttu-id="70304-108">Protezioni future possono quindi essere creati tramite chiamate a `_myProvider.CreateProtector("User: username")`, e queste protezioni possono essere utilizzate per la protezione dei singoli messaggi.</span><span class="sxs-lookup"><span data-stu-id="70304-108">Future protectors can then be created via calls to `_myProvider.CreateProtector("User: username")`, and these protectors would be used for securing the individual messages.</span></span>

<span data-ttu-id="70304-109">Questo può anche essere invertito.</span><span class="sxs-lookup"><span data-stu-id="70304-109">This can also be flipped.</span></span> <span data-ttu-id="70304-110">Prendere in considerazione una singola applicazione logica quali host più tenant (un CMS sembra ragionevole) e ogni tenant può essere configurato con un proprio sistema di gestione di autenticazione e lo stato.</span><span class="sxs-lookup"><span data-stu-id="70304-110">Consider a single logical application which hosts multiple tenants (a CMS seems reasonable), and each tenant can be configured with its own authentication and state management system.</span></span> <span data-ttu-id="70304-111">L'applicazione di tipo generico è un unico provider master, e chiama `provider.CreateProtector("Tenant 1")` e `provider.CreateProtector("Tenant 2")` per concedere a ogni tenant periodo isolato del sistema di protezione dati.</span><span class="sxs-lookup"><span data-stu-id="70304-111">The umbrella application has a single master provider, and it calls `provider.CreateProtector("Tenant 1")` and `provider.CreateProtector("Tenant 2")` to give each tenant its own isolated slice of the data protection system.</span></span> <span data-ttu-id="70304-112">I tenant Impossibile derivare le proprie singoli programmi di protezione in base alle proprie esigenze, ma indipendentemente dalla modalità tentano non possono creare protezioni con cui sono in conflitto con un altro tenant nel sistema.</span><span class="sxs-lookup"><span data-stu-id="70304-112">The tenants could then derive their own individual protectors based on their own needs, but no matter how hard they try they cannot create protectors which collide with any other tenant in the system.</span></span> <span data-ttu-id="70304-113">Graficamente, rappresentati come indicato di seguito.</span><span class="sxs-lookup"><span data-stu-id="70304-113">Graphically, this is represented as below.</span></span>

![A scopo di tenancy multipla](purpose-strings-multitenancy/_static/purposes-multi-tenancy.png)

>[!WARNING]
> <span data-ttu-id="70304-115">Si presuppone che il generico controlli dell'applicazione, le API sono disponibili ai singoli tenant e che i tenant non è possibile eseguire codice arbitrario nel server.</span><span class="sxs-lookup"><span data-stu-id="70304-115">This assumes the umbrella application controls which APIs are available to individual tenants and that tenants cannot execute arbitrary code on the server.</span></span> <span data-ttu-id="70304-116">Se un tenant può eseguire codice arbitrario, è stato possibile eseguire la reflection privata per interrompere le garanzie di isolamento oppure può solo leggere direttamente il materiale della chiave master e derivare il sottochiavi lo desiderano.</span><span class="sxs-lookup"><span data-stu-id="70304-116">If a tenant can execute arbitrary code, they could perform private reflection to break the isolation guarantees, or they could just read the master keying material directly and derive whatever subkeys they desire.</span></span>

<span data-ttu-id="70304-117">Il sistema di protezione dati utilizza effettivamente una sorta di multi-tenancy nella configurazione predefinita della casella.</span><span class="sxs-lookup"><span data-stu-id="70304-117">The data protection system actually uses a sort of multi-tenancy in its default out-of-the-box configuration.</span></span> <span data-ttu-id="70304-118">Per impostazione predefinita materiale della chiave master verrà archiviato nella cartella del profilo utente dell'account del processo di lavoro (o il Registro di sistema per le identità del pool di applicazioni IIS).</span><span class="sxs-lookup"><span data-stu-id="70304-118">By default master keying material is stored in the worker process account's user profile folder (or the registry, for IIS application pool identities).</span></span> <span data-ttu-id="70304-119">Ma è piuttosto comune per utilizzare un singolo account per l'esecuzione di più applicazioni e pertanto tutte queste applicazioni interromperebbe la condivisione di materiale per le chiavi master.</span><span class="sxs-lookup"><span data-stu-id="70304-119">But it's actually fairly common to use a single account to run multiple applications, and thus all these applications would end up sharing the master keying material.</span></span> <span data-ttu-id="70304-120">Per risolvere questo problema, il sistema di protezione dati consente di inserire automaticamente un identificatore univoco per ogni applicazione come primo elemento nella catena di scopo complessivo.</span><span class="sxs-lookup"><span data-stu-id="70304-120">To solve this, the data protection system automatically inserts a unique-per-application identifier as the first element in the overall purpose chain.</span></span> <span data-ttu-id="70304-121">Funzione implicita serve a [isolare le singole applicazioni](xref:security/data-protection/configuration/overview#per-application-isolation) uno da altro in modo efficace considerando ogni applicazione come un tenant univoco all'interno del sistema e il processo di creazione di protezione è identico alla figura precedente.</span><span class="sxs-lookup"><span data-stu-id="70304-121">This implicit purpose serves to [isolate individual applications](xref:security/data-protection/configuration/overview#per-application-isolation) from one another by effectively treating each application as a unique tenant within the system, and the protector creation process looks identical to the image above.</span></span>
